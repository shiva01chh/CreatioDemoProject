"use strict";(self.webpackChunkapp_studio_enterprise_system_designer=self.webpackChunkapp_studio_enterprise_system_designer||[]).push([[718],{51718:(He,U,c)=>{c.r(U),c.d(U,{QueueObject:()=>B,QueueObjectColumn:()=>H,QueueObjectColumnOrderDirection:()=>J,QueueObjectColumnPageComponent:()=>y,QueueObjectColumnService:()=>Q,QueueObjectColumnTableComponent:()=>O,QueueObjectService:()=>S,QueueObjectTableComponent:()=>w,QueueSortingModule:()=>Z,QueueSortingPageComponent:()=>v,QueueSortingSectionComponent:()=>D});var b=c(88692),_=c(20092),N=c(83331),P=c(79510),j=c(15756),Y=c(37697),M=c(74817),r=c(73514),R=c(55799),m=c(56707),g=c(26522),I=c(69403),d=c(80542),s=c(75378),f=c(84945),L=c(84967),h=c(27969);class B{}class H{}var J;(function(o){o.Descending="8E7E394F-B0C5-4C06-8E5D-CF789128AC08",o.Ascending="91E2CCE1-6F51-4AFD-BFD9-DC786BD7E666",o.None="7C155038-77D2-4EA1-BCAE-82D64698119D"})(J||(J={}));var p=c(36619),K=c(54882),e=c(64537);class q{_createQueueObject(t){return{id:t.Id,isClosedQueue:t.IsClosedQueue,entitySchema:{value:t.EntitySchemaUId,displayValue:t.EntitySchemaCaption}}}getEntity(t){return this._createQueueObject(t)}getEntityColumns(t){const n=t.entitySchema||{value:null,displayValue:""};return[new p._H7("Id",t.id,s.DataValueType.Guid),new p._H7("IsClosedQueue",t.isClosedQueue,s.DataValueType.Boolean),new p._H7("EntitySchemaCaption",n.displayValue,s.DataValueType.Text),new p._H7("EntitySchemaUId",n.value,s.DataValueType.Guid)]}}q.\u0275fac=function(t){return new(t||q)},q.\u0275prov=e.Yz7({token:q,factory:q.\u0275fac});class x{constructor(t){this.translateService=t}_createQueueObjectColumn(t){return{id:t.Id,queueObjectId:t.QueueObject.value,orderDirection:t.OrderDirection,name:t.Name,caption:t.Caption,position:t.Position}}getEntity(t){return this._createQueueObjectColumn(t)}getEntityColumns(t){const n=t.orderDirection||{value:null};return[new p._H7("Id",t.id,s.DataValueType.Guid),new p._H7("QueueObject",t.queueObjectId,s.DataValueType.Lookup),new p._H7("OrderDirection",n.value,s.DataValueType.Lookup),new p._H7("Name",t.name,s.DataValueType.Text),new p._H7("Caption",t.caption,s.DataValueType.Text),new p._H7("Position",t.position,s.DataValueType.Integer)]}}x.\u0275fac=function(t){return new(t||x)(e.LFG(m.sK))},x.\u0275prov=e.Yz7({token:x,factory:x.\u0275fac});class S extends I.UE{constructor(t,n,a,i){super(t,n,a),this.entitySchemaService=i,this.entitySchemaName="QueueObject"}_getEntityLocalizableCaption(t,n){return this.entitySchemaService.getEntitySchemaByUId(t).pipe((0,h.U)(a=>(a.entitySchema||{caption:n}).caption.toString()))}loadAdditionalInfo(t){return(0,f.of)(t).pipe((0,K.z)(n=>{const a=n.map(i=>this._getEntityLocalizableCaption(i.EntitySchemaUId,i.EntitySchemaCaption));return(0,L.D)(a).pipe((0,h.U)(i=>(n.forEach((u,l)=>{u.EntitySchemaCaption=i[l]}),n)))}))}getEntityObjects(){const t=new s.EntitySchemaQuery("VwEntityObjects");return t.addSchemaColumn("Id","value"),t.addSchemaColumn("[SysSchema:UId:Id].Caption","displayValue"),this.queryExecutor.executeSelectQuery(t).pipe((0,h.U)(n=>n))}getUsedQueueEntityShemas(){const t=new s.EntitySchemaQuery("Queue");return t.isDistinct=!0,t.addSchemaColumn("QueueEntitySchema.Id","QueueEntitySchemaId"),this.queryExecutor.executeSelectQuery(t).pipe((0,h.U)(n=>n.map(a=>a.QueueEntitySchemaId)))}}S.\u0275fac=function(t){return new(t||S)(e.LFG(I.oq),e.LFG(m.sK),e.LFG(q),e.LFG(p.t1w))},S.\u0275prov=e.Yz7({token:S,factory:S.\u0275fac});var k=c(33568),$=c(35732);class Q extends I.UE{constructor(t,n,a,i){super(t,n,a),this._httpClient=i,this._serviceEndpoint="rest/RightsService",this._getCanExecuteOperationMethodName="SetCustomRecordPosition",this._relativeColumnName="QueueObjectId",this.entitySchemaName="QueueObjectColumn"}getQueueObjectColumns(t){const n=this.createGetAllItemsEsq();return n.filters.addSchemaColumnFilterWithParameter(s.ComparisonType.Equal,"QueueObject",t),this.queryExecutor.executeSelectQuery(n).pipe((0,h.U)(a=>({success:!0,errorInfo:null,result:a.map(i=>this.entityConverter.getEntity(i))})),(0,k.K)(a=>this.getBaseErrorResponse(a)))}getQueueObjectEntitySchema(t){const n=new s.EntitySchemaQuery("QueueObject");return n.addSchemaColumn("EntitySchemaUId"),n.filters.addSchemaColumnFilterWithParameter(s.ComparisonType.Equal,"Id",t),this.queryExecutor.executeSelectQuery(n).pipe((0,h.U)(a=>a&&a[0].EntitySchemaUId||""),(0,k.K)(()=>(0,f.of)("")))}getLastPositionQueueObjectColumn(t){const n=new s.EntitySchemaQuery(this.entitySchemaName);return n.addSchemaColumn("Position").withOrdering(s.OrderDirection.Desc,0),n.filters.addSchemaColumnFilterWithParameter(s.ComparisonType.Equal,"QueueObject",t),this.queryExecutor.executeSelectQuery(n).pipe((0,h.U)(a=>a&&a.length?a[0].Position:-1),(0,k.K)(()=>(0,f.of)(-1)))}getOrderDirectionItems(){const t=new s.EntitySchemaQuery("SysOrderDirection");return t.addSchemaColumn("Id","value"),t.addSchemaColumn("Name","displayValue").withOrdering(s.OrderDirection.Asc,0),this.queryExecutor.executeSelectQuery(t).pipe((0,h.U)(n=>({success:!0,errorInfo:null,result:n})),(0,k.K)(n=>(0,f.of)({success:!1,errorInfo:{errorCode:null,message:n.message,stackTrace:n.stack},result:null})))}setItemPosition(t,n){const a=`${this._serviceEndpoint}/${this._getCanExecuteOperationMethodName}`;return this._httpClient.post(a,{tableName:this.entitySchemaName,primaryColumnValue:t.id,position:n,grouppingColumnNames:this._relativeColumnName}).pipe((0,h.U)(()=>({success:!0})),(0,k.K)(i=>(0,f.of)({success:!1,errorInfo:{errorCode:null,message:i.message,stackTrace:i.error}})))}}Q.\u0275fac=function(t){return new(t||Q)(e.LFG(I.oq),e.LFG(m.sK),e.LFG(x),e.LFG($.eN))},Q.\u0275prov=e.Yz7({token:Q,factory:Q.\u0275fac});var C=c(7976);function z(o,t){o&1&&(e.TgZ(0,"th",19)(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),o&2&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"QueueSorting.QueueObjectColumnTable.ColumnCaption")))}function X(o,t){if(o&1&&(e.TgZ(0,"td",20)(1,"span"),e._uU(2),e.qZA()()),o&2){const n=t.$implicit;e.xp6(2),e.Oqu(n.caption)}}function W(o,t){o&1&&(e.TgZ(0,"th",19)(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),o&2&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"QueueSorting.QueueObjectColumnTable.SortDirection")))}function ee(o,t){if(o&1&&(e.TgZ(0,"td",20)(1,"span"),e._uU(2),e.qZA()()),o&2){const n=t.$implicit;e.xp6(2),e.Oqu(n.orderDirection==null?null:n.orderDirection.displayValue)}}function te(o,t){o&1&&(e.TgZ(0,"th",19)(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),o&2&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"QueueSorting.QueueObjectColumnTable.Position")))}function ne(o,t){if(o&1&&(e.TgZ(0,"td",21)(1,"span"),e._uU(2),e.qZA()()),o&2){const n=t.$implicit;e.xp6(2),e.Oqu(n.position)}}function oe(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(n);const i=e.oxw().$implicit,u=e.oxw(2);return e.KtG(u.moveUp(i))}),e._UZ(1,"mat-icon",29),e.qZA()}if(o&2){const n=e.oxw().$implicit,a=e.oxw(2);e.Q6J("disabled",a.isMinPosition(n))}}function ae(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(n);const i=e.oxw().$implicit,u=e.oxw(2);return e.KtG(u.moveDown(i))}),e._UZ(1,"mat-icon",31),e.qZA()}if(o&2){const n=e.oxw().$implicit,a=e.oxw(2);e.Q6J("disabled",a.isMaxPosition(n))}}function ie(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){e.CHM(n);const i=e.oxw().$implicit,u=e.oxw(2);return e.KtG(u.onEditRow(i))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}o&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"QueueSorting.QueueObjectColumnTable.Actions.Edit")," "))}function ue(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",33),e.NdJ("click",function(){e.CHM(n);const i=e.oxw().$implicit,u=e.oxw(2);return e.KtG(u.onDeleteRow(i))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}o&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"QueueSorting.QueueObjectColumnTable.Actions.Delete")," "))}function ce(o,t){if(o&1&&(e.TgZ(0,"td",22)(1,"div",23),e.YNc(2,oe,2,1,"button",24),e.YNc(3,ae,2,1,"button",25),e.YNc(4,ie,3,3,"button",26),e.YNc(5,ue,3,3,"button",27),e.qZA()()),o&2){const n=t.$implicit,a=e.oxw(2);e.uIk("colspan",a.displayedColumns.length),e.xp6(2),e.Q6J("ngIf",a.isActiveRow(n)),e.xp6(1),e.Q6J("ngIf",a.isActiveRow(n)),e.xp6(1),e.Q6J("ngIf",a.isActiveRow(n)),e.xp6(1),e.Q6J("ngIf",a.isActiveRow(n))}}function se(o,t){o&1&&e._UZ(0,"tr",34)}const le=function(o,t){return{"even-row":o,selected:t}};function re(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"tr",35),e.NdJ("click",function(){const u=e.CHM(n).$implicit,l=e.oxw(2);return e.KtG(l.onRowClicked(u))}),e.qZA()}if(o&2){const n=t.$implicit,a=t.dataIndex,i=e.oxw(2);e.Q6J("ngClass",e.WLB(1,le,a%2,i.isActiveRow(n)))}}const me=function(o){return{"actions-row":!0,selected:o}};function de(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"tr",35),e.NdJ("click",function(){const u=e.CHM(n).$implicit,l=e.oxw(2);return e.KtG(l.onRowClicked(u))}),e.qZA()}if(o&2){const n=t.$implicit,a=e.oxw(2);e.Q6J("ngClass",e.VKq(1,me,a.isActiveRow(n)))}}const pe=function(){return["expandedDetail"]};function be(o,t){if(o&1&&(e.TgZ(0,"table",8),e.ynx(1,9),e.YNc(2,z,4,3,"th",10),e.YNc(3,X,3,1,"td",11),e.BQk(),e.ynx(4,12),e.YNc(5,W,4,3,"th",10),e.YNc(6,ee,3,1,"td",11),e.BQk(),e.ynx(7,13),e.YNc(8,te,4,3,"th",10),e.YNc(9,ne,3,1,"td",14),e.BQk(),e.ynx(10,15),e.YNc(11,ce,6,5,"td",16),e.BQk(),e.YNc(12,se,1,0,"tr",17),e.YNc(13,re,1,4,"tr",18),e.YNc(14,de,1,3,"tr",18),e.qZA()),o&2){const n=e.oxw();e.Q6J("dataSource",n.tableDataSource)("multiTemplateDataRows",!0),e.xp6(12),e.Q6J("matHeaderRowDef",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",e.DdM(5,pe))}}function _e(o,t){o&1&&(e.TgZ(0,"div",36)(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),o&2&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"QueueSorting.QueueObjectColumnTable.Empty")))}class O extends d.AFp{constructor(t,n,a,i,u,l){super(),this.route=t,this.router=n,this.dialogService=a,this.translateService=i,this.queueObjectColumnService=u,this.injector=l,this.displayedColumns=["caption","orderDirection","position"],this.savePage=new e.vpe,this.changeBroadcastService=this.createChangeBroadcastService(),this.changeBroadcastService.subscribe(E=>{this.onRecordChanged(E)})}requestTableDataHandler(t){t.success&&(this.data=t.result.sort((n,a)=>n.position-a.position))}onRecordChanged(t){if(this.data.find(i=>i===t)||!t.queueObjectId)return;const a=this.data.find(i=>i.id===t.id);a?this.updateRecord(a,t):this.addRecord(t)}addRecord(t){this.data=this.data.concat(t),this.activeRow=t}updateRecord(t,n){Object.assign(t,n)}requestTableData(){return this.queueObjectColumnService.getQueueObjectColumns(this.queueObjectId)}createChangeBroadcastService(){return this.injector.get(d.Pnv)}handleResponseHandler(t,n){t.success?n():this.dialogService.openInfoDialog(t.errorInfo.message)}setItemPosition(t,n,a=null){this.queueObjectColumnService.setItemPosition(t,n).subscribe(i=>{this.handleResponseHandler(i,()=>{a?a():this.requestTableData().subscribe(this.requestTableDataHandler.bind(this))})})}onRowClicked(t){this.activeRow=t}isActiveRow(t){return t!=null&&t===this.activeRow}onEditRow(t){this.router.navigate(["QueueObjectColumn/Edit/",t.id],{relativeTo:this.route})}openQueueObjectColumnsPage(){if(this.forceSave&&!this.forceSaveRequested){this.forceSaveRequested=!0,this.savePage.emit();return}this.router.navigate(["QueueObjectColumn/New/",this.queueObjectId],{relativeTo:this.route})}onDeleteRow(t){this.dialogService.openConfirmationDialog(this.translateService.instant("BaseSection.DeleteRecordConfirmation")).subscribe(n=>{if(n===g.Zz.result){const a=()=>{this.queueObjectColumnService.deleteItem(t).subscribe(i=>{this.handleResponseHandler(i,()=>{this.requestTableData().subscribe(this.requestTableDataHandler.bind(this))})})};this.setItemPosition(t,-1,a)}})}ngOnInit(){this.requestTableData().subscribe(this.requestTableDataHandler.bind(this))}moveUp(t){this.setItemPosition(t,t.position-1)}moveDown(t){this.setItemPosition(t,t.position+1)}isMaxPosition(t){return this.data.find(n=>n.position>t.position)==null}isMinPosition(t){return this.data.find(n=>n.position<t.position)==null}}O.\u0275fac=function(t){return new(t||O)(e.Y36(C.gz),e.Y36(C.F0),e.Y36(g.xA),e.Y36(m.sK),e.Y36(Q),e.Y36(e.zs3))},O.\u0275cmp=e.Xpm({type:O,selectors:[["ts-queue-object-column-table"]],inputs:{queueObjectId:"queueObjectId",forceSave:"forceSave"},outputs:{savePage:"savePage"},features:[e.qOj],decls:10,vars:5,consts:[[1,"detail-wrapper"],[1,"detail-table-wrapper"],[1,"detail-bottom-action"],[1,"detail-title"],["data-qa","add-queue-object-column","mat-button","","onclick","this.blur()","data-qa","queue-object-column-grid-add",3,"click"],["svgIcon","add-button"],["mat-table","","matSort","","matSortDisableClear","",3,"dataSource","multiTemplateDataRows",4,"ngIf"],["class","detail-blank-slate",4,"ngIf"],["mat-table","","matSort","","matSortDisableClear","",3,"dataSource","multiTemplateDataRows"],["matColumnDef","caption"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","data-qa","queue-object-column-grid-caption",4,"matCellDef"],["matColumnDef","orderDirection"],["matColumnDef","position"],["mat-cell","","data-qa","queue-object-column-grid-position",4,"matCellDef"],["matColumnDef","expandedDetail"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","mat-sort-header",""],["mat-cell","","data-qa","queue-object-column-grid-caption"],["mat-cell","","data-qa","queue-object-column-grid-position"],["mat-cell",""],[1,"grid-actions"],["mat-flat-button","","color","primary","class","action-btn img-btn","data-qa","queue-object-column-grid-up",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","primary","class","action-btn img-btn","data-qa","queue-object-column-grid-down",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","primary","class","action-btn edit-btn","data-qa","queue-object-column-grid-edit",3,"click",4,"ngIf"],["mat-button","","class","action-btn","data-qa","queue-object-column-grid-delete",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","data-qa","queue-object-column-grid-up",1,"action-btn","img-btn",3,"disabled","click"],["svgIcon","move-up",1,"action-btn-icon"],["mat-flat-button","","color","primary","data-qa","queue-object-column-grid-down",1,"action-btn","img-btn",3,"disabled","click"],["svgIcon","move-down",1,"action-btn-icon"],["mat-flat-button","","color","primary","data-qa","queue-object-column-grid-edit",1,"action-btn","edit-btn",3,"click"],["mat-button","","data-qa","queue-object-column-grid-delete",1,"action-btn",3,"click"],["mat-header-row",""],["mat-row","",3,"ngClass","click"],[1,"detail-blank-slate"]],template:function(t,n){t&1&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e._uU(4),e.ALo(5,"translate"),e.TgZ(6,"button",4),e.NdJ("click",function(){return n.openQueueObjectColumnsPage()}),e._UZ(7,"mat-icon",5),e.qZA()()(),e.YNc(8,be,15,6,"table",6),e.YNc(9,_e,4,3,"div",7),e.qZA()()),t&2&&(e.xp6(4),e.hij("",e.lcZ(5,3,"QueueSorting.QueueObjectColumnTable.Caption")," "),e.xp6(4),e.Q6J("ngIf",!n.isEmpty()),e.xp6(1),e.Q6J("ngIf",n.isEmpty()))},dependencies:[b.mk,b.O5,j.eB,N.Hw,r.ty,r.wO,r.S4,r.t3,r.R3,r.Al,r.L7,r.ML,r.fg,r.Zw,m.X$],styles:[".detail-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.mat-row.actions-row[_ngcontent-%COMP%]:not(.selected){display:none}.detail-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.mat-row.selected[_ngcontent-%COMP%]:not(.actions-row)   td[_ngcontent-%COMP%]{border-bottom:none}.detail-table-wrapper[_ngcontent-%COMP%]   .detail-bottom-action[_ngcontent-%COMP%]{margin-top:0!important;margin-left:10px}.detail-table-wrapper[_ngcontent-%COMP%]   .detail-bottom-action[_ngcontent-%COMP%]   .mat-button[_ngcontent-%COMP%]:hover{background:none}.detail-table-wrapper[_ngcontent-%COMP%]   .detail-bottom-action[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:1em;width:1em;line-height:1em}.detail-table-wrapper[_ngcontent-%COMP%]   .grid-actions[_ngcontent-%COMP%]{display:flex}.detail-table-wrapper[_ngcontent-%COMP%]   .grid-actions[_ngcontent-%COMP%]   .mat-button[_ngcontent-%COMP%]{margin-right:1em}.detail-table-wrapper[_ngcontent-%COMP%]   .grid-actions[_ngcontent-%COMP%]   .img-btn[_ngcontent-%COMP%]{min-width:auto}"]});var F=c(60527),V=c(78464),G=c(95411),A=c(95236);function ge(o,t){o&1&&e._UZ(0,"ts-mask")}function he(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.save())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}o&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"BasePageComponent.Apply")," "))}function Ce(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.cancelEdit())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}o&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"BasePageComponent.Cancel")," "))}function fe(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.close())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}o&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"BasePageComponent.Close")," "))}function Se(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"div",24)(1,"mat-form-field",25)(2,"mat-label",13),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"input",26),e.NdJ("blur",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.updateQueueObjectName())})("ngModelChange",function(i){e.CHM(n);const u=e.oxw();return e.KtG(u.queueObjectName=i)}),e.qZA(),e.TgZ(6,"button",27),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.selectQueueObject())}),e._UZ(7,"mat-icon",28),e.qZA()()()}if(o&2){const n=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,3,"QueueSorting.QueueObjectCaption")),e.xp6(2),e.Q6J("value",n.queueObjectName)("ngModel",n.queueObjectName)}}function Qe(o,t){if(o&1&&(e.TgZ(0,"mat-option",29),e._uU(1),e.qZA()),o&2){const n=t.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n.displayValue," ")}}class v extends d.neP{constructor(t,n,a,i){super(t),this.route=n,this.queueObjectService=a,this.dialogService=i,this._searchColumnsSqlSchemas=["displayValue"],this.isSaved=!0,this.queueObjectName="",this.getGtmSchemaName=()=>"QueueSortingEditPageComponent",this._blindQueue={value:(0,s.generateGuid)(),displayValue:this.translateInstant("QueueSorting.BlindQueue")},this._regularQueue={value:null,displayValue:this.translateInstant("QueueSorting.RegularQueue")},this.typeList=[this._blindQueue,this._regularQueue]}set type(t){const{value:n}=t||{value:null,displayValue:""},a=n!=null;this.model.isClosedQueue!==a&&(this.model.isClosedQueue=a,this.setCanSave())}get type(){return this.model.isClosedQueue?this._blindQueue:this._regularQueue}_getFakeSuccessResponse(){return(0,f.of)({success:!0,errorInfo:null,result:[]})}_getFakeErrorResponse(t){return(0,f.of)({success:!1,errorInfo:{errorCode:"",message:t,stackTrace:""},result:[]})}_requiredFieldsNotEmpty(){return!!this.model.entitySchema}_getMultiSelectSqlSchemasDialogData(){const t={columns:[{name:"displayValue",caption:this.translateInstant("QueueSorting.QueueObjectLookup.NameColumnCaption"),valueType:s.DataValueType.Text}]};return{title:this.translateInstant("QueueSorting.QueueObjectLookup.Title"),dataSchema:t,data:this._objectsList,searchColumns:this._searchColumnsSqlSchemas,selectMode:"single"}}_selectEntitySchema(t){this.dialogService.open(d.iQ4,{data:this._getMultiSelectSqlSchemasDialogData()}).subscribe(t)}_processRoutingParams(){this.route.paramMap.subscribe(t=>{this.isNew=t.get("mode")==="New",this.isCopy=t.get("mode")==="Copy",this.isNew?(this.id=(0,s.generateGuid)(),this.model=this.createEmptyModel(),this.isSaved=!1):this.id=t.get("id")})}_loadLookupObjects(){return(0,L.D)([this.queueObjectService.getEntityObjects(),this.queueObjectService.getItems()]).pipe((0,h.U)(([t,n])=>{const a=t||[],i=n.result||[];return a.filter(u=>!i.find(l=>l.entitySchema.value===u.value))}))}_getQueueObjectName(){return this.selectDisplayValue(this.model.entitySchema)}getModelFromLoadResponse(t){return t.result[0]}createEmptyModel(){const t=new B;return t.id=this.id,t.isClosedQueue=!1,t}preProcessPageLoadingResponse(t){super.preProcessPageLoadingResponse(t);const n=t.result[0];return this.pageTitle=n.entitySchema.displayValue,t}requestPageData(){return this.queueObjectService.getItem(this.id)}savePageData(t){return this._requiredFieldsNotEmpty()?this.isChanged?this.isNew||this.isCopy?this.queueObjectService.insertItem(t):this.queueObjectService.updateItem(t):this._getFakeSuccessResponse():this._getFakeErrorResponse(this.translateInstant("QueueSorting.RequiredFieldValue"))}executePageDataLoading(t){return this.isNew?(this.sendGtmAction(this.getPageOpenGtmData()),this.preProcessLoadedPageModel(this.model),this.pageTitle=this.translateInstant("QueueSorting.AddQueueObjectCaption"),this._loadLookupObjects().subscribe(n=>{this._objectsList=n,this.isLoading=!1}),this._getFakeSuccessResponse()):super.executePageDataLoading(t)}preProcessSaveResponse(t){return t&&t.success&&this.columnsTable.forceSaveRequested?(this.closePageAfterSave=!1,this.isSaved=!0,this.isSaveButtonVisible=!1,this.isNew=!1,this.pageTitle=this.model.entitySchema.displayValue,this.columnsTable.openQueueObjectColumnsPage()):this.closePageAfterSave=!0,this.columnsTable.forceSaveRequested=!1,super.preProcessSaveResponse(t)}ngOnInit(){this._processRoutingParams(),super.ngOnInit()}setCanSave(){this._requiredFieldsNotEmpty()&&(this.isSaveButtonVisible=!0),this.setIsChanged()}selectDisplayValue(t){return t&&t.displayValue||""}cancelEdit(){this.cancel(),this.isNew&&this.clearQueueObject(),this.isSaveButtonVisible=!1}selectQueueObject(){this._selectEntitySchema(t=>{t&&(this.model.entitySchema=t[0],this.queueObjectName=this._getQueueObjectName(),this.setCanSave())})}onTypeSelected(t){const n=t.option.value;this.type!==n&&(this.type=n)}updateQueueObjectName(){this.queueObjectName=this._getQueueObjectName()}clearQueueObject(){this.model.entitySchema=null,this.queueObjectName=this._getQueueObjectName(),this.isSaveButtonVisible=!1}}v.\u0275fac=function(t){return new(t||v)(e.Y36(e.zs3),e.Y36(C.gz),e.Y36(S),e.Y36(g.xA))},v.\u0275cmp=e.Xpm({type:v,selectors:[["ts-queue-sorting-page"]],viewQuery:function(t,n){if(t&1&&e.Gf(O,5),t&2){let a;e.iGM(a=e.CRH())&&(n.columnsTable=a.first)}},features:[e.qOj],decls:23,vars:15,consts:[[4,"ngIf"],[1,"base-page-wrap","queue-sorting-page"],[1,"header"],[1,"pane"],[3,"title"],["class","action-button","mat-flat-button","","color","accent","data-qa","queue-sorting-apply-button",3,"click",4,"ngIf"],["class","action-button","mat-flat-button","","color","primary","data-qa","cancel-button",3,"click",4,"ngIf"],["class","action-button","mat-flat-button","","color","primary","data-qa","queue-sorting-close-button",3,"click",4,"ngIf"],[1,"page-content-wrapper"],[1,"main-content","pane"],["class","queue-object",4,"ngIf"],[1,"queue-type"],["floatLabel","always",1,"combobox-edit"],[1,"field-title"],["matInput","","type","text","spellcheck","false","data-qa","queue-type-input",3,"matAutocomplete","value"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","",1,"lookup-button"],["svgIcon","arrow-down",1,"lookup-button-icon"],[3,"queueObjectId","forceSave","savePage"],["mat-flat-button","","color","accent","data-qa","queue-sorting-apply-button",1,"action-button",3,"click"],["mat-flat-button","","color","primary","data-qa","cancel-button",1,"action-button",3,"click"],["mat-flat-button","","color","primary","data-qa","queue-sorting-close-button",1,"action-button",3,"click"],[1,"queue-object"],["floatLabel","always"],["matInput","","spellcheck","false","autocomplete","off","type","text","required","",3,"value","ngModel","blur","ngModelChange"],["matSuffix","","mat-icon-button","","onclick","this.blur()","data-qa","queue-object-select-button",1,"lookup-button",3,"click"],["svgIcon","search",1,"lookup-button-icon"],[3,"value"]],template:function(t,n){if(t&1&&(e.YNc(0,ge,1,0,"ts-mask",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"ts-header",4),e.YNc(5,he,3,3,"button",5),e.YNc(6,Ce,3,3,"button",6),e.YNc(7,fe,3,3,"button",7),e.qZA()()(),e.TgZ(8,"div",8)(9,"div",9),e.YNc(10,Se,8,5,"div",10),e.TgZ(11,"div",11)(12,"mat-form-field",12)(13,"mat-label",13),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._UZ(16,"input",14),e.TgZ(17,"mat-autocomplete",15,16),e.NdJ("optionSelected",function(i){return n.onTypeSelected(i)}),e.YNc(19,Qe,2,2,"mat-option",17),e.qZA(),e.TgZ(20,"button",18),e._UZ(21,"mat-icon",19),e.qZA()()(),e.TgZ(22,"ts-queue-object-column-table",20),e.NdJ("savePage",function(){return n.save()}),e.qZA()()()()),t&2){const a=e.MAs(18);e.Q6J("ngIf",n.isLoading),e.xp6(4),e.Q6J("title",n.pageTitle),e.xp6(1),e.Q6J("ngIf",n.isSaveButtonVisible),e.xp6(1),e.Q6J("ngIf",n.isSaveButtonVisible),e.xp6(1),e.Q6J("ngIf",!n.isSaveButtonVisible),e.xp6(3),e.Q6J("ngIf",n.isNew),e.xp6(4),e.Oqu(e.lcZ(15,13,"QueueSorting.QueueTypeCaption")),e.xp6(2),e.Q6J("matAutocomplete",a)("value",n.selectDisplayValue(n.type)),e.xp6(1),e.Q6J("displayWith",n.selectDisplayValue),e.xp6(2),e.Q6J("ngForOf",n.typeList),e.xp6(3),e.Q6J("queueObjectId",n.id)("forceSave",n.isNew&&!n.isSaved)}},dependencies:[b.sg,b.O5,F.G,_.Fj,_.JJ,_.Q7,_.On,V.g,P.VN,P.QJ,G.CK,j.eB,N.Hw,A.v_,A.$V,A.nX,M.k0,O,m.X$],encapsulation:2});function Oe(o,t){o&1&&e._UZ(0,"ts-mask")}function ve(o,t){o&1&&(e.TgZ(0,"th",14)(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),o&2&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"QueueSorting.QueueObjectCaption")))}function ye(o,t){if(o&1&&(e.TgZ(0,"td",15)(1,"span"),e._uU(2),e.qZA()()),o&2){const n=t.$implicit;e.xp6(2),e.Oqu(n.entitySchema.displayValue)}}function Te(o,t){o&1&&(e.TgZ(0,"th",14)(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),o&2&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"QueueSorting.QueueTypeCaption")))}function je(o,t){o&1&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),o&2&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"QueueSorting.BlindQueue")))}function qe(o,t){o&1&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),o&2&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"QueueSorting.RegularQueue")))}function xe(o,t){if(o&1&&(e.TgZ(0,"td",15),e.YNc(1,je,3,3,"span",0),e.YNc(2,qe,3,3,"span",0),e.qZA()),o&2){const n=t.$implicit;e.xp6(1),e.Q6J("ngIf",n.isClosedQueue),e.xp6(1),e.Q6J("ngIf",!n.isClosedQueue)}}function we(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(n);const i=e.oxw().$implicit,u=e.oxw(2);return e.KtG(u.onEditRow(i))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}o&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"QueueSorting.QueueObjectTable.Actions.Edit")," "))}function De(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(n);const i=e.oxw().$implicit,u=e.oxw(2);return e.KtG(u.onDeleteRow(i))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(o&2){const n=e.oxw().$implicit,a=e.oxw(2);e.Q6J("disabled",a.isUsedQueueEntitySchema(n)),e.xp6(1),e.hij(" ",e.lcZ(2,2,"QueueSorting.QueueObjectTable.Actions.Delete")," ")}}function Ze(o,t){if(o&1&&(e.TgZ(0,"td",16),e.YNc(1,we,3,3,"button",17),e.TgZ(2,"div",18),e.ALo(3,"translate"),e.YNc(4,De,3,4,"button",19),e.qZA()()),o&2){const n=t.$implicit,a=e.oxw(2);e.uIk("colspan",a.displayedColumns.length),e.xp6(1),e.Q6J("ngIf",a.isActiveRow(n)),e.xp6(1),e.Q6J("matTooltip",e.lcZ(3,5,"QueueSorting.QueueObjectTable.RemoveToolTip"))("matTooltipDisabled",!a.isUsedQueueEntitySchema(n)),e.xp6(2),e.Q6J("ngIf",a.isActiveRow(n))}}function Pe(o,t){o&1&&e._UZ(0,"tr",22)}const Ie=function(o,t){return{"even-row":o,selected:t}};function Ae(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"tr",23),e.NdJ("click",function(){const u=e.CHM(n).$implicit,l=e.oxw(2);return e.KtG(l.onRowClicked(u))}),e.qZA()}if(o&2){const n=t.$implicit,a=t.dataIndex,i=e.oxw(2);e.Q6J("ngClass",e.WLB(1,Ie,a%2,i.isActiveRow(n)))}}const Ne=function(o){return{"actions-row":!0,selected:o}};function ke(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"tr",23),e.NdJ("click",function(){const u=e.CHM(n).$implicit,l=e.oxw(2);return e.KtG(l.onRowClicked(u))}),e.qZA()}if(o&2){const n=t.$implicit,a=e.oxw(2);e.Q6J("ngClass",e.VKq(1,Ne,a.isActiveRow(n)))}}const Ee=function(){return["expandedDetail"]};function Me(o,t){if(o&1&&(e.TgZ(0,"table",5),e.ynx(1,6),e.YNc(2,ve,4,3,"th",7),e.YNc(3,ye,3,1,"td",8),e.BQk(),e.ynx(4,9),e.YNc(5,Te,4,3,"th",7),e.YNc(6,xe,3,2,"td",8),e.BQk(),e.ynx(7,10),e.YNc(8,Ze,5,7,"td",11),e.BQk(),e.YNc(9,Pe,1,0,"tr",12),e.YNc(10,Ae,1,4,"tr",13),e.YNc(11,ke,1,3,"tr",13),e.qZA()),o&2){const n=e.oxw();e.Q6J("dataSource",n.tableDataSource)("multiTemplateDataRows",!0),e.xp6(9),e.Q6J("matHeaderRowDef",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",e.DdM(5,Ee))}}function Re(o,t){o&1&&(e.TgZ(0,"div",24)(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),o&2&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"QueueSorting.Empty")))}class w extends d.AFp{constructor(t,n,a,i,u){super(),this.router=t,this.dialogService=n,this.translateService=a,this.queueObjectService=i,this.injector=u,this.displayedColumns=["entitySchema","isClosedQueue"],this.tableDataSource.sortingDataAccessor=(l,E)=>l[E].toLocaleLowerCase(),this.changeBroadcastService=this.createChangeBroadcastService(),this.changeBroadcastService.subscribe(l=>{this.onRecordChanged(l)})}_requestTableDataHandler(t){t.success&&(this.data=t.result),this.isLoading=!1}_usedQueueEntityShemasHandler(t){this.usedQueueEntitySchemas=t}onRecordChanged(t){if(this.data.find(i=>i===t)||!t.entitySchema)return;const a=this.data.find(i=>i.id===t.id);a?this.updateRecord(a,t):this.addRecord(t)}addRecord(t){this.data=this.data.concat(t),this.activeRow=t}updateRecord(t,n){Object.assign(t,n)}requestTableData(){return this.queueObjectService.getItems()}createChangeBroadcastService(){return this.injector.get(d.Pnv)}deleteResponseHandler(t,n){t.success?n():this.dialogService.openInfoDialog(t.errorInfo.message)}onRowClicked(t){this.activeRow=t}isActiveRow(t){return t!=null&&t===this.activeRow}onEditRow(t){this.router.navigate(["QueueSorting/Edit/",t.id])}onDeleteRow(t){this.dialogService.openConfirmationDialog(this.translateService.instant("BaseSection.DeleteRecordConfirmation")).subscribe(n=>{n===g.Zz.result&&this.queueObjectService.deleteItem(t).subscribe(a=>{this.deleteResponseHandler(a,()=>{super.onDeleteRow(t)})})})}ngOnInit(){this.isLoading=!0,this.queueObjectService.getUsedQueueEntityShemas().subscribe(this._usedQueueEntityShemasHandler.bind(this)),this.requestTableData().subscribe(this._requestTableDataHandler.bind(this))}isUsedQueueEntitySchema(t){return this.usedQueueEntitySchemas&&t.entitySchema?this.usedQueueEntitySchemas.some(n=>n===t.entitySchema.value):!1}}w.\u0275fac=function(t){return new(t||w)(e.Y36(C.F0),e.Y36(g.xA),e.Y36(m.sK),e.Y36(S),e.Y36(e.zs3))},w.\u0275cmp=e.Xpm({type:w,selectors:[["ts-queue-object-table"]],features:[e.qOj],decls:5,vars:3,consts:[[4,"ngIf"],[1,"detail-wrapper"],[1,"detail-table-wrapper"],["mat-table","","matSort","","matSortDisableClear","",3,"dataSource","multiTemplateDataRows",4,"ngIf"],["class","detail-blank-slate",4,"ngIf"],["mat-table","","matSort","","matSortDisableClear","",3,"dataSource","multiTemplateDataRows"],["matColumnDef","entitySchema"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","data-qa","queue-object-grid-name",4,"matCellDef"],["matColumnDef","isClosedQueue"],["matColumnDef","expandedDetail"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","mat-sort-header",""],["mat-cell","","data-qa","queue-object-grid-name"],["mat-cell",""],["mat-flat-button","","color","primary","class","action-btn edit-btn","data-qa","queue-object-grid-edit",3,"click",4,"ngIf"],[1,"remove-btn-wrapper",3,"matTooltip","matTooltipDisabled"],["mat-button","","class","action-btn remove-btn","data-qa","queue-object-grid-delete",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","primary","data-qa","queue-object-grid-edit",1,"action-btn","edit-btn",3,"click"],["mat-button","","data-qa","queue-object-grid-delete",1,"action-btn","remove-btn",3,"disabled","click"],["mat-header-row",""],["mat-row","",3,"ngClass","click"],[1,"detail-blank-slate"]],template:function(t,n){t&1&&(e.YNc(0,Oe,1,0,"ts-mask",0),e.TgZ(1,"div",1)(2,"div",2),e.YNc(3,Me,12,6,"table",3),e.YNc(4,Re,4,3,"div",4),e.qZA()()),t&2&&(e.Q6J("ngIf",n.isLoading),e.xp6(3),e.Q6J("ngIf",!n.isEmpty()),e.xp6(1),e.Q6J("ngIf",n.isEmpty()))},dependencies:[b.mk,b.O5,V.g,j.eB,r.ty,r.wO,r.S4,r.t3,r.R3,r.Al,r.L7,r.ML,r.fg,r.Zw,R.Kd,m.X$],styles:[".detail-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.mat-row.actions-row[_ngcontent-%COMP%]:not(.selected){display:none}.detail-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.mat-row.selected[_ngcontent-%COMP%]:not(.actions-row)   td[_ngcontent-%COMP%]{border-bottom:none}.detail-table-wrapper[_ngcontent-%COMP%]   .detail-bottom-action[_ngcontent-%COMP%]{margin-top:15px;margin-left:10px}.detail-table-wrapper[_ngcontent-%COMP%]   .remove-btn-wrapper[_ngcontent-%COMP%]{display:inline-block}"]});class D{constructor(t){this.router=t}openAddQueueSortObjectPage(){this.router.navigate(["QueueSorting/New"])}}D.\u0275fac=function(t){return new(t||D)(e.Y36(C.F0))},D.\u0275cmp=e.Xpm({type:D,selectors:[["ts-queue-sorting-section"]],decls:11,vars:6,consts:[[1,"base-page-wrap"],[1,"header"],[1,"pane"],[3,"title"],["data-qa","add-queue-sort-object","mat-flat-button","","color","accent","data-qa","queue-section-add-button",1,"action-button",3,"click"],[1,"page-content-wrapper"],[1,"main-content","pane"]],template:function(t,n){t&1&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"ts-header",3),e.ALo(4,"translate"),e.TgZ(5,"button",4),e.NdJ("click",function(){return n.openAddQueueSortObjectPage()}),e._uU(6),e.ALo(7,"translate"),e.qZA()()()(),e.TgZ(8,"div",5)(9,"div",6),e._UZ(10,"ts-queue-object-table"),e.qZA()()()),t&2&&(e.xp6(3),e.Q6J("title",e.lcZ(4,2,"QueueSorting.QueueSectionHeader")),e.xp6(3),e.hij(" ",e.lcZ(7,4,"QueueSorting.AddQueueSortObjectCaption")," "))},dependencies:[F.G,j.eB,w,m.X$]});function Le(o,t){o&1&&e._UZ(0,"ts-mask")}function Je(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.save())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}o&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"BasePageComponent.Apply")," "))}function Fe(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.cancelEdit())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}o&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"BasePageComponent.Cancel")," "))}function Ve(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.close())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}o&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"BasePageComponent.Close")," "))}function Ue(o,t){if(o&1){const n=e.EpF();e.TgZ(0,"div",23)(1,"mat-form-field",24)(2,"mat-label",13),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"input",25),e.NdJ("blur",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.setSortColumnName())})("ngModelChange",function(i){e.CHM(n);const u=e.oxw();return e.KtG(u.sortColumnName=i)}),e.qZA(),e.TgZ(6,"button",26),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.selectSortColumn())}),e._UZ(7,"mat-icon",27),e.qZA()()()}if(o&2){const n=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,3,"QueueSorting.QueueObjectColumnPage.SelectColumn")),e.xp6(2),e.Q6J("value",n.sortColumnName)("ngModel",n.sortColumnName)}}function Ye(o,t){if(o&1&&(e.TgZ(0,"mat-option",28),e._uU(1),e.qZA()),o&2){const n=t.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n.displayValue," ")}}class y extends d.neP{constructor(t,n,a,i,u){super(t),this.entitySchemaService=n,this.queueObjectColumnService=a,this.dialogService=i,this.route=u,this._searchColumnsSqlSchemas=["displayValue","name"],this.isSaved=!0,this.sortColumnName="",this.orderDirectionDisplayValue="",this.getGtmSchemaName=()=>"QueueObjectColumnPageComponent"}_loadLookupColumns(){this.queueObjectColumnService.getQueueObjectEntitySchema(this.model.queueObjectId).subscribe(t=>{(0,L.D)([this.entitySchemaService.getEntitySchemaByUId(t),this.queueObjectColumnService.getQueueObjectColumns(this.model.queueObjectId)]).subscribe(([n,a])=>{const i=n.success&&n.entitySchema.columns||[],u=a.result||[];this._columnList=i.filter(l=>!u.find(E=>E.name===l.name)).map(l=>({value:l.uId,name:l.name,displayValue:l.caption})),this.isLoading=!1})})}_loadOrderDirectionList(){this.queueObjectColumnService.getOrderDirectionItems().subscribe(t=>{t.success&&(this.orderDirectionList=t.result)})}_processRoutingParams(){this.route.paramMap.subscribe(t=>{const n=t.get("id");this.isNew=t.get("mode")==="New",this.isNew?(this.model=this.createEmptyModel(),this.model.queueObjectId=n,this.isSaved=!1,this._getLastPosition().subscribe(a=>{this.newQueueObjectColumnPosition=++a})):this.id=n})}_getLastPosition(){return this.queueObjectColumnService.getLastPositionQueueObjectColumn(this.model.queueObjectId)}_requiredFieldsNotEmpty(){return!!this.model.name&&!!this.model.queueObjectId&&!!this.model.orderDirection.value}_getSortColumnName(){return this.model.caption}_getFakeSuccessResponse(){return(0,f.of)({success:!0,errorInfo:null,result:[]})}_getFakeErrorResponse(t){return(0,f.of)({success:!1,errorInfo:{errorCode:"",message:t,stackTrace:""},result:[]})}_selectEntitySchemaColumns(t){this.dialogService.open(d.iQ4,{data:this._getMultiSelectSqlSchemaColumnsDialogData()}).subscribe(t)}_getMultiSelectSqlSchemaColumnsDialogData(){const t={columns:[{name:"displayValue",caption:this.translateInstant("QueueSorting.QueueObjectColumnLookup.NameColumnCaption"),valueType:s.DataValueType.Text}]};return{title:this.translateInstant("QueueSorting.QueueObjectColumnLookup.Title"),dataSchema:t,data:this._columnList,searchColumns:this._searchColumnsSqlSchemas,selectMode:"single"}}getModelFromLoadResponse(t){return t.result[0]}createEmptyModel(){const t=new H;return t.id=(0,s.generateGuid)(),t.name="",t.caption="",t.orderDirection={value:null,displayValue:""},t}preProcessPageLoadingResponse(t){super.preProcessPageLoadingResponse(t);const n=t.result[0];return this.pageTitle=n.caption,t}applyPageLoadResponse(t){super.applyPageLoadResponse(t),this.setOrderDirectionDisplayValue()}requestPageData(){return this.queueObjectColumnService.getItem(this.id)}savePageData(t){return this._requiredFieldsNotEmpty()?this.isChanged?this.isNew?(t.position=this.newQueueObjectColumnPosition,this.queueObjectColumnService.insertItem(t)):this.queueObjectColumnService.updateItem(t):this._getFakeSuccessResponse():this._getFakeErrorResponse(this.translateInstant("QueueSorting.QueueObjectColumnPage.RequiredFieldValue"))}executePageDataLoading(t){return this._loadOrderDirectionList(),this.isNew?(this.sendGtmAction(this.getPageOpenGtmData()),this.preProcessLoadedPageModel(this.model),this.pageTitle=this.translateInstant("QueueSorting.QueueObjectColumnPage.AddQueueObjectColumn"),this._loadLookupColumns(),this._getFakeSuccessResponse()):super.executePageDataLoading(t)}preProcessSaveResponse(t){return t&&t.success&&(this.isSaved=!0),super.preProcessSaveResponse(t)}ngOnInit(){this._processRoutingParams(),super.ngOnInit()}setCanSave(){this._requiredFieldsNotEmpty()&&(this.isSaveButtonVisible=!0),this.setIsChanged()}selectSortColumn(){this._selectEntitySchemaColumns(t=>{t&&(this.model.name=t[0].name,this.model.caption=t[0].displayValue,this.setSortColumnName(),this.setCanSave())})}setSortColumnName(){this.sortColumnName=this._getSortColumnName()}getOrderDirectionDisplayValue(){const t=this.model.orderDirection;return t&&t.displayValue||""}setOrderDirectionDisplayValue(){this.orderDirectionDisplayValue=this.getOrderDirectionDisplayValue()}cancelEdit(){this.cancel(),this.isNew&&this.setSortColumnName(),this.setOrderDirectionDisplayValue(),this.isSaveButtonVisible=!1}onOrderDirectionSelected(t){const n=t.option.value||{value:null,displayValue:""};(!this.model.orderDirection||this.model.orderDirection&&this.model.orderDirection.value!==n.value)&&(this.model.orderDirection=n,this.setCanSave()),this.setOrderDirectionDisplayValue()}}y.\u0275fac=function(t){return new(t||y)(e.Y36(e.zs3),e.Y36(p.t1w),e.Y36(Q),e.Y36(g.xA),e.Y36(C.gz))},y.\u0275cmp=e.Xpm({type:y,selectors:[["ts-queue-object-column-page"]],features:[e.qOj],decls:22,vars:14,consts:[[4,"ngIf"],[1,"base-page-wrap"],[1,"header"],[1,"pane"],[3,"title"],["class","action-button","mat-flat-button","","color","accent","data-qa","queue-sorting-apply-button",3,"click",4,"ngIf"],["class","action-button","mat-flat-button","","color","primary","data-qa","cancel-button",3,"click",4,"ngIf"],["class","action-button","mat-flat-button","","color","primary","data-qa","queue-sorting-close-button",3,"click",4,"ngIf"],[1,"page-content-wrapper"],[1,"main-content","pane"],["class","queue-select-column",4,"ngIf"],[1,"queue-sort-column-direction"],["floatLabel","always",1,"combobox-edit"],[1,"field-title"],["matInput","","type","text","spellcheck","false","required","","data-qa","queue-sort-column-direction",3,"matAutocomplete","value","ngModel","ngModelChange","blur"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","",1,"lookup-button"],["svgIcon","arrow-down",1,"lookup-button-icon"],["mat-flat-button","","color","accent","data-qa","queue-sorting-apply-button",1,"action-button",3,"click"],["mat-flat-button","","color","primary","data-qa","cancel-button",1,"action-button",3,"click"],["mat-flat-button","","color","primary","data-qa","queue-sorting-close-button",1,"action-button",3,"click"],[1,"queue-select-column"],["floatLabel","always"],["matInput","","spellcheck","false","autocomplete","off","type","text","required","",3,"value","ngModel","blur","ngModelChange"],["matSuffix","","mat-icon-button","","onclick","this.blur()","data-qa","queue-sort-column-select-button",1,"lookup-button",3,"click"],["svgIcon","search",1,"lookup-button-icon"],[3,"value"]],template:function(t,n){if(t&1&&(e.YNc(0,Le,1,0,"ts-mask",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"ts-header",4),e.YNc(5,Je,3,3,"button",5),e.YNc(6,Fe,3,3,"button",6),e.YNc(7,Ve,3,3,"button",7),e.qZA()()(),e.TgZ(8,"div",8)(9,"div",9),e.YNc(10,Ue,8,5,"div",10),e.TgZ(11,"div",11)(12,"mat-form-field",12)(13,"mat-label",13),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"input",14),e.NdJ("ngModelChange",function(i){return n.orderDirectionDisplayValue=i})("blur",function(){return n.setOrderDirectionDisplayValue()}),e.qZA(),e.TgZ(17,"mat-autocomplete",15,16),e.NdJ("optionSelected",function(i){return n.onOrderDirectionSelected(i)}),e.YNc(19,Ye,2,2,"mat-option",17),e.qZA(),e.TgZ(20,"button",18),e._UZ(21,"mat-icon",19),e.qZA()()()()()()),t&2){const a=e.MAs(18);e.Q6J("ngIf",n.isLoading),e.xp6(4),e.Q6J("title",n.pageTitle),e.xp6(1),e.Q6J("ngIf",n.isSaveButtonVisible),e.xp6(1),e.Q6J("ngIf",n.isSaveButtonVisible),e.xp6(1),e.Q6J("ngIf",!n.isSaveButtonVisible),e.xp6(3),e.Q6J("ngIf",n.isNew),e.xp6(4),e.Oqu(e.lcZ(15,12,"QueueSorting.QueueObjectColumnPage.SortDirection")),e.xp6(2),e.Q6J("matAutocomplete",a)("value",n.orderDirectionDisplayValue)("ngModel",n.orderDirectionDisplayValue),e.xp6(1),e.Q6J("displayWith",n.getOrderDirectionDisplayValue.bind(n)),e.xp6(2),e.Q6J("ngForOf",n.orderDirectionList)}},dependencies:[b.sg,b.O5,F.G,_.Fj,_.JJ,_.Q7,_.On,V.g,P.VN,P.QJ,G.CK,j.eB,N.Hw,A.v_,A.$V,A.nX,M.k0,m.X$]});const Be=[{path:"",component:D},{path:":mode/:id",component:v,data:{shouldReuse:!0}},{path:":mode",component:v,data:{shouldReuse:!0}},{path:":mode/:id/QueueObjectColumn/:mode/:id",component:y},{path:":mode/QueueObjectColumn/:mode/:id",component:y}];class T{}T.\u0275fac=function(t){return new(t||T)},T.\u0275mod=e.oAB({type:T}),T.\u0275inj=e.cJS({imports:[C.Bz.forChild(Be),C.Bz]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&e.kYT(T,{imports:[C.Bz],exports:[C.Bz]})}();class Z{}Z.\u0275fac=function(t){return new(t||Z)},Z.\u0275mod=e.oAB({type:Z}),Z.\u0275inj=e.cJS({providers:[d.Pnv,q,x,S,Q,{provide:d.thQ,useValue:"QueueSortingModule"}],imports:[b.ez,d.kLW,g.Su,_.u5,g._M,P.D8,j.yu,Y.yj,N.Ps,M.x4,r.U5,R.AA,T,m.aw,I.nD]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&e.kYT(Z,{declarations:[w,D,v,O,y],imports:[b.ez,d.kLW,g.Su,_.u5,g._M,P.D8,j.yu,Y.yj,N.Ps,M.x4,r.U5,R.AA,T,m.aw,I.nD]})}()}}]);
