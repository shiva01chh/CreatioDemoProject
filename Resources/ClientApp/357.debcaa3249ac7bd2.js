"use strict";(self.webpackChunkapp_studio_enterprise_system_designer=self.webpackChunkapp_studio_enterprise_system_designer||[]).push([[357],{63357:(Q,T,o)=>{o.r(T),o.d(T,{ASSEMBLY_PACKAGE_SOURCE_CODE_SCHEMA:()=>x,META_ITEM_SOURCE_CODE_API_URL:()=>k,MetaItemSourceCodeApiService:()=>m,MetaItemSourceCodeFactoryService:()=>p,MetaItemSourceCodeStructureService:()=>S,NEW_SOURCE_CODE_SCHEMA:()=>J,SOURCE_CODE_SCHEMA:()=>w,SourceCodeDesignerStructureService:()=>d,SourceCodeFactoryService:()=>g,SourceCodeSchemaConverterService:()=>f,SourceCodeSchemaDesignerApiService:()=>l,SourceCodeSchemaDesignerModule:()=>y,getMetaItemSourceCodeApiUrlProvider:()=>z});var A=o(88692),_=o(15756),P=o(56707),I=o(26522),s=o(65149),v=o(80542),a=o(28262),E=o(36619),t=o(64537);class D extends a.vM{constructor(e){super(e)}get editDescriptionCaptionKey(){return"SchemaDesigners.SourceCodeDesignerMiniPage.Title"}}D.\u0275fac=function(e){return new(e||D)(t.LFG(t.zs3))},D.\u0275prov=t.Yz7({token:D,factory:D.\u0275fac});var O=o(11465),b=o(55953),L=o(82909),G=o(13528),N=o(84967),F=o(98168),R=o(27969),B=o(11770);class U extends s.Pp{get DefaultName(){return"SourceCodeSchema"}}class d extends a.wm{constructor(e){super(e)}get translationPrefix(){return"SchemaDesigners.SourceCodeSchemaDesignerPage"}getModelStructureData(e){const r=[],c=super.createSchemaStructureElement({caption:this.getTranslation("CsharpCaption"),icon:"schema-designer-code-icon.svg"}),u=this.getLocalizableStringSchemaStructureElement(e);return r.push(c,u),r}}d.\u0275fac=function(e){return new(e||d)(t.LFG(t.zs3))},d.\u0275prov=t.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"});class S extends a.wm{constructor(e){super(e)}get translationPrefix(){return"SchemaDesigners.SourceCodeSchemaDesignerPage"}getModelStructureData(e){const r=[],c=super.createSchemaStructureElement({caption:this.getTranslation("CsharpCaption"),icon:"schema-designer-code-icon.svg",selected:!0});return r.push(c),r}}S.\u0275fac=function(e){return new(e||S)(t.LFG(t.zs3))},S.\u0275prov=t.Yz7({token:S,factory:S.\u0275fac});var Y=o(26903);class l extends s.wY{constructor(e){super(e)}publishSchema(e){const r=this.serviceEndpoint+"PublishSchema";return this.httpClient.post(r,e).pipe((0,Y.B)())}}l.\u0275fac=function(e){return new(e||l)(t.LFG(t.zs3))},l.\u0275prov=t.Yz7({token:l,factory:l.\u0275fac});class f extends s.gX{constructor(){super(U)}convertToSchema(e){const r=super.createSchema(e);return r.caption=new E.CjD(e.caption),r.description=new E.CjD(e.description),r.localizableStrings=super.createLocalizableStrings(e.localizableStrings),r}}f.\u0275fac=function(e){return new(e||f)},f.\u0275prov=t.Yz7({token:f,factory:f.\u0275fac});var i=o(75378);const w={name:"CaseTermInterval",uId:(0,i.generateGuid)(),body:`namespace Terrasoft.Configuration
{
	using System;
	using System.Clobalization;
	using Terrasoft.Configuration;
	using Terrasoft.Core;
	using Terrasoft.Core.Entities;

	#region Class: UidBasedSinceSyncStrategy

	/// <summary>
	/// <see cref="ISyncStrategy"/>implementation, delivered from <see cref="UidBasedSyncStraregy">
	/// </summary>
	public class UidBasedSinceSyncStrategy : UidBasedSyncStrategy
	{ }

	#endregion

}`,isReadOnly:!1,id:(0,i.generateGuid)(),package:{isChanged:!1,isLocked:!1,name:"Calendar",uId:(0,i.generateGuid)()},caption:[{cultureName:"en-US",value:"CaseTermInterval"}],description:[{cultureName:"en-US",value:"test description"}],localizableStrings:[{name:"PrivateTagDisplayValue",uId:(0,i.generateGuid)(),values:[{cultureName:"en-US",value:"Private"},{cultureName:"ru-RU",value:"\u041B\u0438\u0447\u043D\u044B\u0439"},{cultureName:"uk-UK",value:"\u041F\u0440\u0438\u0432\u0430\u0442\u043D\u0438\u0439"}]}]},J={name:"NewTestSourceCode",uId:(0,i.generateGuid)(),body:"",isReadOnly:!1,id:(0,i.generateGuid)(),package:{isChanged:!1,isLocked:!1,name:"Calendar",uId:(0,i.generateGuid)()},caption:[{cultureName:"en-US",value:"NewTestSourceCode"}],description:[],localizableStrings:[]},x={name:"AssemblyPackageSourceCode",uId:"24733d4d-8f04-4aad-aee5-3ff56062b865",body:`namespace Terrasoft.Configuration
{
	using System;
	using System.Clobalization;
	using Terrasoft.Configuration;
	using Terrasoft.Core;
	using Terrasoft.Core.Entities;

	#region Class: AssemblyPackageSourceCode

	public class AssemblyPackageSourceCode 
	{ }

	#endregion

}`,isReadOnly:!1,id:(0,i.generateGuid)(),package:{isChanged:!1,isLocked:!1,type:b.yR.Assembly,name:"AssemblyPackage",uId:"74b9f4af-7233-4e6c-ad5f-a32149516edb"},caption:[{cultureName:"en-US",value:"AssemblyPackageSourceCode"}],description:[{cultureName:"en-US",value:"test description"}],localizableStrings:[{name:"PrivateTagDisplayValue",uId:(0,i.generateGuid)(),values:[{cultureName:"en-US",value:"Private"},{cultureName:"ru-RU",value:"\u041B\u0438\u0447\u043D\u044B\u0439"},{cultureName:"uk-UK",value:"\u041F\u0440\u0438\u0432\u0430\u0442\u043D\u0438\u0439"}]}]},k=new t.OlP("MetaItemSourceCodeService"),z=n=>(0,s.aU)(n,k);class m extends s.wY{constructor(e){super(e),this.getSchemaMethodName="GetSourceCode",this.serviceEndpoint=e.get(k)}}m.\u0275fac=function(e){return new(e||m)(t.LFG(t.zs3))},m.\u0275prov=t.Yz7({token:m,factory:m.\u0275fac});class g{constructor(e,r){this._designerStructureService=e,this._designerApiDataService=r}getSourceCodeApiService(){return this._designerApiDataService}getSourceCodeStructureService(){return this._designerStructureService}}g.\u0275fac=function(e){return new(e||g)(t.LFG(d),t.LFG(l))},g.\u0275prov=t.Yz7({token:g,factory:g.\u0275fac});class p{constructor(e,r){this._metaItemSourceCodeStructureService=e,this._metaItemSourceCodeApiService=r}getSourceCodeApiService(){return this._metaItemSourceCodeApiService}getSourceCodeStructureService(){return this._metaItemSourceCodeStructureService}}p.\u0275fac=function(e){return new(e||p)(t.LFG(S),t.LFG(m))},p.\u0275prov=t.Yz7({token:p,factory:p.\u0275fac});var V=o(15748),Z=o(65304),j=o(40508);function H(n,e){if(n&1){const r=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){t.CHM(r);const u=t.oxw();return t.KtG(u.publish())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}n&2&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"BasePageComponent.Publish")," "))}class C extends a.qj{constructor(e){super(e),this.csharpLanguage=v.YpL.Csharp}get apiDataService(){return this._sourceCodeServicesFactory.getSourceCodeApiService()}get designerStructureService(){return this._sourceCodeServicesFactory.getSourceCodeStructureService()}get modelType(){return U}get workspaceItemType(){return b.yG.SourceCodeSchema}_setSourceCodeFactory(e){this._showMetaItemSourceCode=e,e?(this.isPublishVisible=!1,this._isRunActionItemVisible=!1,this._sourceCodeServicesFactory=this.injector.get(p)):(this.isPublishVisible=!0,this._isRunActionItemVisible=!0,this._sourceCodeServicesFactory=this.injector.get(g))}_enableRunScriptMenuItem(){this.addActionMenuItem({caption:this.translateInstant("SchemaDesigners.SourceCodeSchemaDesignerPage.RunButtonCaption"),code:"Run",hidden:!1,handler:()=>this.runScript().pipe((0,G.R)(this.destroyed$)).subscribe()})}_runInstallScript(){return this._workspaceExplorerService=this.injector.get(L.Fh),this.showBodyMask(),this.restErrorHandler.handleRequest(this._workspaceExplorerService.executeInstallScript(this.model.uId)).pipe((0,F.b)(()=>this.hideBodyMask()),(0,R.U)(e=>{if(e?.success){const r=this.translateInstant("SchemaDesigners.SourceCodeSchemaDesignerPage.RunSourceCodeCaption");this.showSuccessMessage(r)}return e}))}getGtmSchemaName(){return"SourceCodeSchemaDesignerPage"}injectDependencies(){super.injectDependencies()}processRouting(){super.processRouting(),this.activateRoute.queryParams.subscribe(e=>{this.showMetaItemSourceCode=!!e.showMetaItemSourceCode,this._setSourceCodeFactory(this.showMetaItemSourceCode)})}getOpenDesignerEditModeUrl(){const e=O.zz.getSourceCodeDesignerOpenTemplate();return B.Ld.Format(e,this.model.uId)}requestInitialPageData(){return(0,N.D)([super.requestInitialPageData(),this.featureService.getFeatureState("Feature-UsePackageInstallScripts")]).pipe((0,F.b)(([e,r])=>{this._usePackageInstallScripts=r}),(0,R.U)(([e])=>e))}afterPageDataLoaded(){super.afterPageDataLoaded(),this._isRunActionItemVisible&&this._usePackageInstallScripts&&this.model.package.type===b.yR.Assembly&&this._enableRunScriptMenuItem()}onCodeChanged(e){this.model.body=e,this.setIsChanged()}runScript(){return this._runInstallScript()}ngOnInit(){super.ngOnInit(),this._showMetaItemSourceCode||this.enableOpenMetaDataMenuItem()}}C.\u0275fac=function(e){return new(e||C)(t.Y36(t.zs3))},C.\u0275cmp=t.Xpm({type:C,selectors:[["ts-source-code-schema-designer-page"]],features:[t.qOj],decls:10,vars:11,consts:[[1,"base-section-wrap"],[3,"saveButtonVisible","actionMenuItemsConfig","saveClick","cancelClick","closeClick"],["class","action-button","mat-button","",3,"click",4,"ngIf"],[1,"schema-designer-page"],[1,"schema-designer-structure-wrapper","pane"],[3,"dataSource","caption","isSearchEnabled","hideSchemaDescriptorActions","designerTypeCaptionImage","itemActionClick","itemClick"],[1,"schema-designer-page-main-content"],[1,"pane"],[1,"schema-designer-page-code-editor-wrapper"],[3,"text","language","readOnly","textChange"],["mat-button","",1,"action-button",3,"click"]],template:function(e,r){e&1&&(t.TgZ(0,"div",0)(1,"ts-schema-designer-page-header",1),t.NdJ("saveClick",function(){return r.save()})("cancelClick",function(){return r.cancel()})("closeClick",function(){return r.close()}),t.YNc(2,H,3,3,"button",2),t.qZA(),t.TgZ(3,"div",3)(4,"div",4)(5,"ts-schema-designer-structure",5),t.NdJ("itemActionClick",function(u){return r.onStructureItemClick(u)})("itemClick",function(u){return r.onStructureItemClick(u)}),t.qZA()(),t.TgZ(6,"div",6)(7,"div",7)(8,"div",8)(9,"ts-code-editor",9),t.NdJ("textChange",function(u){return r.onCodeChanged(u)}),t.qZA()()()()()()),e&2&&(t.xp6(1),t.Q6J("saveButtonVisible",r.saveButtonVisible())("actionMenuItemsConfig",r.getActionsConfig()),t.xp6(1),t.Q6J("ngIf",r.isPublishVisible),t.xp6(3),t.Q6J("dataSource",r.schemaStructure)("caption",r.model.name)("isSearchEnabled",r.isSearchEnabled)("hideSchemaDescriptorActions",r.showMetaItemSourceCode)("designerTypeCaptionImage","entity-schema-sourcecode-icon.svg"),t.xp6(4),t.Q6J("text",r.model.body)("language",r.csharpLanguage)("readOnly",r.isReadOnlyMode))},dependencies:[A.O5,_.eB,V.h,Z.a,j.w,P.X$],encapsulation:2});var M=o(7976);const K=[{path:"",component:C},{path:"new",component:C},{path:":uId",component:C}];class h{}h.\u0275fac=function(e){return new(e||h)},h.\u0275mod=t.oAB({type:h}),h.\u0275inj=t.cJS({imports:[M.Bz.forChild(K),M.Bz]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&t.kYT(h,{imports:[M.Bz],exports:[M.Bz]})}();class y{}y.\u0275fac=function(e){return new(e||y)},y.\u0275mod=t.oAB({type:y}),y.\u0275inj=t.cJS({providers:[v.Pnv,I.xA,a.ZR,a.G8,a.mM,a.Wr,{provide:v.thQ,useValue:"SourceCodeSchemaDesignerModule"},d,l,g,S,m,p,(0,s.Ap)("SourceCodeSchemaDesignerService.svc"),z("MetaItemSourceCodeService.svc"),{provide:s.Jk,useClass:f},{provide:a.ZS,useClass:D},E.V1j],imports:[A.ez,v.kLW,_.yu,a.Z_,v.Y05,h,P.aw,I._M,I.Su,s.JI]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&t.kYT(y,{declarations:[C],imports:[A.ez,v.kLW,_.yu,a.Z_,v.Y05,h,P.aw,I._M,I.Su,s.JI]})}()}}]);
