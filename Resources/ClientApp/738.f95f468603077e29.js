"use strict";(self.webpackChunkapp_studio_enterprise_system_designer=self.webpackChunkapp_studio_enterprise_system_designer||[]).push([[738],{32738:(X,F,r)=>{r.r(F),r.d(F,{NEW_USER_TASK_SCHEMA:()=>$,USER_TASK_SCHEMA:()=>_,UserTaskDesignerStructureService:()=>m,UserTaskSchemaDesignerApiService:()=>p,UserTaskSchemaDesignerModule:()=>f});var z=r(88692),b=r(15756),A=r(56707),v=r(26522),l=r(65149),B=r(55953),n=r(80542),c=r(28262),P=r(36619),g=r(75378),u=r(84945),R=r(98168),y=r(54882),N=r(35732),J=r(27969),w=r(26903),a=r(64537),I=r(7976);class G extends l.y1{}class C{constructor(e,t){this.httpClient=e,this._activatedRoute=t,this._serviceUrl="/ServiceModel/ClientUnitSchemaDesignerService.svc"}getEditPages(e,t=!1){const s=this._activatedRoute.snapshot.queryParams,i=s?.useFullHierarchy==="true",d=`${this._serviceUrl}/GetAvailableParentSchemas`,O={packageUId:e,allowExtended:t,useFullHierarchy:i};return this.httpClient.post(d,O,{headers:new N.WM({"Content-Type":"application/json"})}).pipe((0,J.U)(E=>E.success?E.items.map(L=>{const M=new G;return M.name=L.name,M.title=L.title,M.uId=L.uId,M}):[]),(0,w.B)())}}C.\u0275fac=function(e){return new(e||C)(a.LFG(N.eN),a.LFG(I.gz))},C.\u0275prov=a.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"});class T extends c.vM{constructor(e){super(e),this.editPageListProvider=e.get(C)}get editDescriptionCaptionKey(){return"SchemaDesigners.UserTaskDesignerMiniPage.Title"}prepareEditPageList(e){return this.isEditMiniCard(e)?this.editPageListProvider.getEditPages(e.package.uId).pipe((0,R.b)(t=>{this.editPageList=t.map(s=>({key:s.uId,value:s.title}))})):(0,u.of)({})}getControlsForCreate(e){return[new n.kSE({controlType:n.$5M.CheckBox,key:"userTask",value:e.userTask,label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.UserTask"),required:!1}),new n.kSE({controlType:n.$5M.CheckBox,key:"customEventHandler",value:e.customEventHandler,label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.WithCustomEventHandler"),required:!1}),new n.kSE({controlType:n.$5M.CheckBox,key:"partial",value:e.partial,label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.Partial"),required:!1})]}getSelectedParameterEditPage(e){return(0,g.isEmptyGuid)(e)?void 0:this.editPageList.find(t=>t.key===e)||{key:e,value:e}}isPageInList(e){return(0,g.isEmptyGuid)(e)||!!this.editPageList.find(t=>t.key===e)}getControlsForEdit(e){var t,s,i,d;return[new n.kSE({controlType:n.$5M.Autocomlete,key:"editPageSchemaUId",value:this.getSelectedParameterEditPage(e.editPageSchemaUId),label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.ParametersEditPage"),required:!1,options:this.editPageList,info:this.isPageInList(e.editPageSchemaUId)?null:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.PageInaccessibleFromPackageInfo")}),new n.kSE({controlType:n.$5M.Autocomlete,key:"dcmEditPageSchemaUId",value:this.getSelectedParameterEditPage(e.dcmEditPageSchemaUId),label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.DcmParametersEditPage"),required:!1,options:this.editPageList,info:this.isPageInList(e.dcmEditPageSchemaUId)?null:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.PageInaccessibleFromPackageInfo")}),new n.kSE({controlType:n.$5M.TextBox,key:"color",value:e.color,label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.Color"),required:!1}),new n.kSE({controlType:n.$5M.ImageUploader,key:"smallSvgImage.file",value:(t=e.smallSvgImage)===null||t===void 0?void 0:t.file,label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.SmallSvgImage"),required:!1}),new n.kSE({controlType:n.$5M.ImageUploader,key:"largeSvgImage.file",value:(s=e.largeSvgImage)===null||s===void 0?void 0:s.file,label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.LargeSvgImage"),required:!1}),new n.kSE({controlType:n.$5M.ImageUploader,key:"titleSvgImage.file",value:(i=e.titleSvgImage)===null||i===void 0?void 0:i.file,label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.TitleSvgImage"),required:!1}),new n.kSE({controlType:n.$5M.ImageUploader,key:"dcmSmallSvgImage.file",value:(d=e.dcmSmallSvgImage)===null||d===void 0?void 0:d.file,label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.DcmSmallSvgImage"),required:!1}),...this.getControlsForCreate(e),new n.kSE({controlType:n.$5M.CheckBox,key:"serializeToDB",value:e.serializeToDB,label:this.translateService.instant("SchemaDesigners.UserTaskCaptionsMiniPage.Serialize"),required:!1})]}isEditMiniCard(e){return this.pageMode===c.t2.edit||!!e.name}getMiniCardControls(e){const t=super.getMiniCardControls(e),s=e.model;return this.isEditMiniCard(s)?t.push(...this.getControlsForEdit(s)):t.push(...this.getControlsForCreate(s)),t.forEach(i=>i.isDisabled=this.getIsReadOnly(s)),t}execute(e){return this.prepareEditPageList(e.model).pipe((0,y.z)(()=>super.execute(e)))}}T.\u0275fac=function(e){return new(e||T)(a.LFG(a.zs3))},T.\u0275prov=a.Yz7({token:T,factory:T.\u0275fac});var j=r(11465),Y=r(11770);class U{constructor(e){this._isChanged=!1,this.file=e}get file(){return this._file}set file(e){!(e&&e.lastModified)||(this._isChanged=!0,this._file=e)}get isChanged(){return this._isChanged}}class x extends l.Rb{get DefaultName(){return"UserTaskSchema"}updateDescription(e){super.updateDescription(e),this.partial=e.partial,this.userTask=e.userTask,this.customEventHandler=e.customEventHandler,l.O4.updateLookupValue(e,this,"editPageSchemaUId"),l.O4.updateLookupValue(e,this,"dcmEditPageSchemaUId"),this.color=e.color,this.smallSvgImage=new U(e["smallSvgImage.file"]),this.largeSvgImage=new U(e["largeSvgImage.file"]),this.titleSvgImage=new U(e["titleSvgImage.file"]),this.dcmSmallSvgImage=new U(e["dcmSmallSvgImage.file"]),this.serializeToDB=e.serializeToDB}}class m extends c.p4{constructor(e){super(e)}get translationPrefix(){return"SchemaDesigners.UserTaskSchemaDesignerPage"}get miniPageTitleKey(){return"SchemaDesigners.UserTaskDesignerMiniPage.Title"}getModelStructureData(e){const t=[],s=c.lw.create({caption:this.getTranslation("CsharpCaption"),icon:"schema-designer-code-icon.svg"}),i=this.getLocalizableStringSchemaStructureElement(e),d=this.getParametersSchemaStructureElement(e);return t.push(s,i,d),t}}m.\u0275fac=function(e){return new(e||m)(a.LFG(a.zs3))},m.\u0275prov=a.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"});var V=r(66393),Z=r(84967);class k{getFileReader(){return new FileReader}}k.\u0275fac=function(e){return new(e||k)},k.\u0275prov=a.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"});class p extends l.wY{constructor(e,t){super(e),this.fileReaderProvider=t}getContent(e){return new Promise((t,s)=>{const i=this.fileReaderProvider.getFileReader();i.onload=()=>{const d=i.result,E=new Uint8Array(d).toString();t(E)},i.onerror=()=>{s(new Error("Unable to read file."))},i.readAsArrayBuffer(e)})}loadSvgImage(e){return(0,V.D)(this.getContent(e.file).then(t=>(e.content=t,e)))}loadContent(e){return(0,Z.D)([e.smallSvgImage.isChanged?this.loadSvgImage(e.smallSvgImage):(0,u.of)(null),e.largeSvgImage.isChanged?this.loadSvgImage(e.largeSvgImage):(0,u.of)(null),e.titleSvgImage.isChanged?this.loadSvgImage(e.titleSvgImage):(0,u.of)(null),e.dcmSmallSvgImage.isChanged?this.loadSvgImage(e.dcmSmallSvgImage):(0,u.of)(null)]).pipe((0,y.z)(t=>(0,u.of)(e)))}saveSchema(e){return this.loadContent(e).pipe((0,y.z)(t=>super.saveSchema(t)),(0,w.B)())}}p.\u0275fac=function(e){return new(e||p)(a.LFG(a.zs3),a.LFG(k))},p.\u0275prov=a.Yz7({token:p,factory:p.\u0275fac});const _={name:"UserTaskSchemaMock",uId:"07c9eb8d-9f64-452f-bb8b-541f528dfa66",body:`namespace Terrasoft.Core.Process.Configuration
{

	using Newtonsoft.Json;
	using Newtonsoft.Json.Linq;
	using System;
	using System.Collections.Generic;
	using System.Collections.ObjectModel;
	using System.Globalization;
	using Terrasoft.Common;
	using Terrasoft.Configuration;
	using Terrasoft.Core;
	using Terrasoft.Core.Configuration;
	using Terrasoft.Core.DB;
	using Terrasoft.Core.Entities;
	using Terrasoft.Core.Process;
	using Terrasoft.UI.WebControls.Controls;

	#region Class: UserTaskSchemaMock

	/// <exclude/>
	public partial class UserTaskSchemaMock
	{

		#region Methods: Protected

		protected override bool InternalExecute(ProcessExecutingContext context) {
			return true;
		}

		#endregion

		#region Methods: Public

		public override bool CompleteExecuting(params object[] parameters) {
			return base.CompleteExecuting(parameters);
		}

		public override void CancelExecuting(params object[] parameters) {
			base.CancelExecuting(parameters);
		}

		public override string GetExecutionData() {
			return string.Empty;
		}

		public override ProcessElementNotification GetNotificationData() {
			return base.GetNotificationData();
		}

		#endregion

	}

	#endregion

}

`,id:"8477766a-9424-4937-a6ce-1d6fbf253dab",isReadOnly:!1,package:{isChanged:!1,isLocked:!0,name:"PackageMock",uId:"162826b3-667c-43ae-a736-3ff427d65588"},smallSvgImage:{file:{name:"(Image)"},content:null},editPageSchemaUId:"c748bf4e-e4e1-454e-8f5b-4f65f91d8396",largeSvgImage:{file:{name:"(Image)"},content:null},titleSvgImage:{file:{name:""},content:null},caption:[{cultureName:"en-US",value:"User task schema mock"}],description:[{cultureName:"en-US",value:"test description"}],color:"#AA00FF",userTask:!0,partial:!0,localizableStrings:[{uId:"a60b9613-c74f-43dd-a070-d575fd2c72f1",name:"LocalizableString1Mock",values:[{cultureName:"en-US",value:"Mockup localizable string 1"},{cultureName:"ru-RU",value:"\u041C\u0430\u043A\u0435\u0442 \u043B\u043E\u043A\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0439 \u0441\u0442\u0440\u043E\u043A\u0438 1"}]}],parameters:[{uId:"9871d4b0-61b5-450e-87ae-2d43a8429e84",caption:[{cultureName:"en-US",value:"User task schema parameter mock"}],name:"TextParameter",type:g.DataValueType.Text,resulting:!0},{uId:"94720F39-7710-4FA1-A07C-11DE875989F4",name:"LookupParameter",type:g.DataValueType.Lookup},{uId:"F565CD2D-404A-4F9B-A8D9-28A34C3A18B5",name:"LczParameter",type:g.DataValueType.LOCALIZABLE_STRING},{uId:"FDD3483D-AEDC-4D22-A9B3-76A1BECB753A",name:"NotLczParameter",type:g.DataValueType.METADATA_TEXT},{uId:"72EBC6D3-E0DB-4D19-8D6D-521D8CB9781F",name:"EntityParameter",type:g.DataValueType.ENTITY,lazyLoad:!0},{uId:"6F8D1D65-AF3E-4973-87F3-4DD606428DC2",name:"ObjectParameter",type:g.DataValueType.CUSTOM_OBJECT,lazyLoad:!0},{uId:"74318F72-3AE9-B160-5D62-2BAC9A7409D5",name:"CompositeObjectList",type:g.DataValueType.COMPOSITE_OBJECT_LIST}]},$={name:"NewUserTaskSchemaMock",uId:(0,g.generateGuid)(),body:"",id:(0,g.generateGuid)(),isReadOnly:!1,package:{isChanged:!1,isLocked:!0,name:"PackageMock",uId:"162826b3-667c-43ae-a736-3ff427d65588"},smallSvgImage:null,editPageSchemaUId:"c748bf4e-e4e1-454e-8f5b-4f65f91d8396",largeSvgImage:null,titleSvgImage:null,caption:[{cultureName:"en-US",value:"New User task schema mock"}],description:[{cultureName:"en-US",value:"new test description"}],color:"#AA00FF",userTask:!0,partial:!0,localizableStrings:[],parameters:[]};var H=r(15748),W=r(65304),K=r(40508);class h extends c.qj{get designerStructureService(){return this._designerStructureService}get apiDataService(){return this._apiDataService}get modelType(){return x}get workspaceItemType(){return B.yG.ProcessUserTaskSchema}constructor(e,t){super(e),this.dialogService=t,this.csharpLanguage=n.YpL.Csharp}_saveAndClose(){return this.save().pipe((0,y.z)(()=>(this.close(),(0,u.of)(!0))))}_handleNewUserTask(e){return e?this._saveAndClose():(this.close(),(0,u.of)(!1))}_checkClassName(e){const t=`\\bpublic\\s+partial\\s+class\\s+${e.name}\\b`,s=RegExp(t);return this.isNewMode||s.test(e.body)}injectDependencies(){super.injectDependencies(),this._designerStructureService=this.injector.get(m),this._apiDataService=this.injector.get(p)}getGtmSchemaName(){return"UserTaskSchemaDesignerPage"}changeDescription(){return super.changeDescription().pipe((0,y.z)(e=>this.isNewMode?this._handleNewUserTask(e):(0,u.of)(e)))}onItemEditComplete(e,t){super.onItemEditComplete(e,t);const s=this.model.findParameterByUId(e.uId);s&&(t.item.icon=(0,P.Qud)(s.type))}getOpenDesignerEditModeUrl(){const e=j.zz.getUserCodeDesignerOpenTemplate();return Y.Ld.Format(e,this.model.uId)}save(){if(!this._checkClassName(this.model))this.dialogService.openConfirmationDialog(this.translateInstant("SchemaDesigners.UserTaskSchemaDesignerPage.InvalidClassNameConfirmationMessage")).subscribe(e=>e===v.Zz.result?super.save():(0,u.of)(null));else return super.save()}onCodeChanged(e){this.model.body=e,this.setIsChanged()}ngOnInit(){super.ngOnInit(),this.enableOpenMetaDataMenuItem(),this.enableOpenSourceCodeMenuItem()}}h.\u0275fac=function(e){return new(e||h)(a.Y36(a.zs3),a.Y36(v.xA))},h.\u0275cmp=a.Xpm({type:h,selectors:[["ts-user-task-schema-designer-page"]],features:[a.qOj],decls:12,vars:12,consts:[[1,"base-section-wrap"],[3,"saveButtonVisible","actionMenuItemsConfig","saveClick","cancelClick","closeClick"],["mat-button","",1,"action-button",3,"click"],[1,"schema-designer-page"],[1,"schema-designer-structure-wrapper","pane"],[3,"dataSource","caption","isSearchEnabled","designerTypeCaptionImage","itemActionClick","itemClick"],[1,"schema-designer-page-main-content"],[1,"pane"],[1,"schema-designer-page-code-editor-wrapper"],[3,"text","language","readOnly","textChange"]],template:function(e,t){e&1&&(a.TgZ(0,"div",0)(1,"ts-schema-designer-page-header",1),a.NdJ("saveClick",function(){return t.save()})("cancelClick",function(){return t.cancel()})("closeClick",function(){return t.close()}),a.TgZ(2,"button",2),a.NdJ("click",function(){return t.publish()}),a._uU(3),a.ALo(4,"translate"),a.qZA()(),a.TgZ(5,"div",3)(6,"div",4)(7,"ts-schema-designer-structure",5),a.NdJ("itemActionClick",function(i){return t.onStructureItemClick(i)})("itemClick",function(i){return t.onStructureItemClick(i)}),a.qZA()(),a.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"ts-code-editor",9),a.NdJ("textChange",function(i){return t.onCodeChanged(i)}),a.qZA()()()()()()),e&2&&(a.xp6(1),a.Q6J("saveButtonVisible",t.saveButtonVisible())("actionMenuItemsConfig",t.getActionsConfig()),a.xp6(2),a.hij(" ",a.lcZ(4,10,"BasePageComponent.Publish")," "),a.xp6(4),a.Q6J("dataSource",t.schemaStructure)("caption",t.model.name)("isSearchEnabled",t.isSearchEnabled)("designerTypeCaptionImage","user-task-caption-icon.svg"),a.xp6(4),a.Q6J("text",t.model.body)("language",t.csharpLanguage)("readOnly",t.isReadOnlyMode))},dependencies:[b.eB,H.h,W.a,K.w,A.X$],encapsulation:2});class D extends l.gX{constructor(){super(x)}convertToSchema(e){const t=super.createSchema(e);return t.caption=new P.CjD(e.caption),t.description=new P.CjD(e.description),t.localizableStrings=super.createLocalizableStrings(e.localizableStrings),t.parameters=new l.Ts,e.parameters.forEach(s=>{const i=new l.O4(s);t.parameters.push(i)}),t}}D.\u0275fac=function(e){return new(e||D)},D.\u0275prov=a.Yz7({token:D,factory:D.\u0275fac});const Q=[{path:"",component:h,data:{shouldReuse:!0}},{path:"new",component:h},{path:":uId",component:h}];class S{}S.\u0275fac=function(e){return new(e||S)},S.\u0275mod=a.oAB({type:S}),S.\u0275inj=a.cJS({imports:[I.Bz.forChild(Q),I.Bz]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&a.kYT(S,{imports:[I.Bz],exports:[I.Bz]})}();class f{}f.\u0275fac=function(e){return new(e||f)},f.\u0275mod=a.oAB({type:f}),f.\u0275inj=a.cJS({providers:[n.Pnv,v.xA,c.ZR,c.G8,c.mM,c.Wr,{provide:n.thQ,useValue:"UserTaskSchemaDesignerModule"},m,p,c.kb,c.HL,c.J9,B.W1,(0,l.Ap)("ProcessUserTaskSchemaDesignerService.svc"),{provide:l.Jk,useClass:D},{provide:c.ZS,useClass:T},P.V1j],imports:[z.ez,n.kLW,b.yu,c.Z_,n.Y05,S,A.aw,v._M,v.Su,l.JI]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&a.kYT(f,{declarations:[h],imports:[z.ez,n.kLW,b.yu,c.Z_,n.Y05,S,A.aw,v._M,v.Su,l.JI]})}()}}]);
