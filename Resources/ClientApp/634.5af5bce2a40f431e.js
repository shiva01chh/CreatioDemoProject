"use strict";(self.webpackChunkapp_studio_enterprise_system_designer=self.webpackChunkapp_studio_enterprise_system_designer||[]).push([[634],{14634:(Tr,di,_)=>{_.r(di),_.d(di,{InterfaceDesignerModule:()=>Q,InterfaceDesignerProxyModule:()=>xe,playerFactory:()=>Li});var Gi=_(84911),W=_(88692),mi=_(35732),pi=_(20092),fi=_(15756),gi=_(37697),hi=_(95236),vi=_(74817),b=_(75378),$=_(56707),ki=_(93555),ee=_(26522),_i=_(73715),te=_(17315),Xt=_(69403),Qt=_(79458),yi=_(65149),v=_(86200),F=_(10469),h=_(85351),m=_(8239),D=_(11465),f=_(36619),C=_(36559),bi=_(38023),M=_(84945),he=_(13528),w=_(27969),Si=_(33568),l=_(64537);class ie{constructor(e){this.httpClient=e,this._getDcmServiceEndpoint="rest/DcmService/GetDcmStageColumnName",this._destroyed$=new bi.x}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}getStageColumnName(e){return this.httpClient.post(this._getDcmServiceEndpoint,{entitySchemaName:e}).pipe((0,he.R)(this._destroyed$),(0,w.U)(t=>t.GetDcmStageColumnNameResult),(0,Si.K)(()=>(0,M.of)(null)))}}ie.\u0275fac=function(e){return new(e||ie)(l.LFG(mi.eN))},ie.\u0275prov=l.Yz7({token:ie,factory:ie.\u0275fac});var L=_(49875),qi=_(31854);class z{constructor(e){this._featureService=e,this._disableSaveToProfileAttributesFeature="DisableSaveToProfileAttributes"}get isProfileDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._disableSaveToProfileAttributesFeature))}createOrUpdateAttributeWithChangeRequest(e,t,i,r=""){var o;const n=t[i],a=e.viewModelConfig.attributes,s=`${t.name}_${(0,qi.Z)(i)}_Profile`,u=(0,L.zX)(n,a)?n.slice(1):r||s,d={...a[u]};d.value=(o=d.value)!==null&&o!==void 0?o:(0,L.zX)(n,a)?void 0:n,d.change=Array.isArray(d.change)?d.change:[{...d.change}].filter(p=>Object.keys(p).length>0),d.change.push({request:"crt.SaveAttributeToProfileRequest",params:{profileAttributeName:u}}),a[u]=d,t[i]=`$${u}`}prepareAttributeWithFeatureCheck(e,t,i,r="",o=""){var n=this;return(0,m.Z)(function*(){const a=(0,C.n)(n._featureService.getFeatureState(o));(yield n.isProfileDisabled)||(yield a)||n.createOrUpdateAttributeWithChangeRequest(e,t,i,r)})()}}z.\u0275fac=function(e){return new(e||z)(l.LFG(D.UZ))},z.\u0275prov=l.Yz7({token:z,factory:z.\u0275fac});function Ci(c){return{request:"crt.LoadDataRequest",params:{dataSourceName:c,parameters:[]}}}function Ai(){return{rowCount:30}}var O=_(57445);class R{static _getMasterRecordEntitySchemaName(e,t,i){var r,o;if(!e?.startsWith("$"))return Promise.resolve(null);const n=e.substring(1),a=t.viewModelConfig.attributes&&t.viewModelConfig.attributes[n];if(!a)return Promise.resolve(null);let s="";a&&(0,h.bjw)(a)&&(s=(o=(r=a.modelConfig)===null||r===void 0?void 0:r.path)!==null&&o!==void 0?o:"");const u=s?.split("."),d=u?.shift()||"",p=u?.pop()||"";return R.getDataSchemaName({models:i,schema:t,dataSourceName:d,attributeName:p})}static _findRelatedPath(e,t){var i,r;const o=e.split(".");if(o.length!==2)return;const n=o[0],a=o[1],s=(i=t.modelConfig)===null||i===void 0?void 0:i.dataSources,u=s&&s[n],d=(r=u?.config)===null||r===void 0?void 0:r.attributes,p=d&&d[a];if(!!p?.path)return`${n}.${p.path}`}static _getRelativeAttributePath(e,t){var i,r;const n=(i=(t.viewModelConfig.attributes||{})[e])!==null&&i!==void 0?i:{};if(!n||!(0,h.bjw)(n)||!(!((r=n.modelConfig)===null||r===void 0)&&r.path))return;const a=n.modelConfig.path;return this._findRelatedPath(a,t)||a}static _createDependency(e,t){return[{attributePath:t,relationPath:e}]}static _getReferenceColumnName(e){return e.masterRecordColumnName||e.recordColumnName}static getDataSchemaName(e){var t=this;return(0,m.Z)(function*(){var i,r,o;const n=yield t.getDataSchema(e.models,e.dataSourceName);if(!n){const a=((i=e.schema.modelConfig)===null||i===void 0?void 0:i.dataSources)&&((r=e.schema.modelConfig)===null||r===void 0?void 0:r.dataSources[e.dataSourceName]);return(o=a?.config)===null||o===void 0?void 0:o.entitySchemaName}if(e.attributeName){const a=n?.attributes.find(s=>s.name===e.attributeName);return a?.referenceSchemaName||n?.name}return n?.name})()}static getDataSchema(e,t){const i=e.find(r=>{var o;return((o=r.getDataSource())===null||o===void 0?void 0:o.dataSourceName)===t});return(0,O.z)(i?.getSchema()||(0,M.of)(null))}static getDataSourcePrimaryAttribute(e,t="Id"){var i,r;const o=(i=e.modelConfig)===null||i===void 0?void 0:i.primaryDataSourceName;if(!o)return"";const n=(r=e.viewModelConfig)===null||r===void 0?void 0:r.attributes;return n&&!n[t]&&(n[t]={modelConfig:{path:`${o}.${t}`}}),t}static getDataSourceNameByAttribute(e){if(!e?.startsWith("$"))return null;const t=e.substring(1);return this.getAttributeDSName(t)}static getAttributeDSName(e){return`${e}${h.gWy}`}static createDataSourceConfig(e){return{type:"crt.EntityDataSource",scope:b.DataSourceScope.ViewElement,config:{entitySchemaName:e}}}static getRecordEntitySchemaName(e,t,i,r){var o=this;return(0,m.Z)(function*(){const n=R.getDataSourceNameByAttribute(e);if(!n)return Promise.resolve(null);const a=yield R.getDataSchema(r,n);return!a?.findAttributeByName(o._recordSchemaNameColumnName)?Promise.resolve(null):o._getMasterRecordEntitySchemaName(t,i,r)})()}static addDependencies(e,t,i){var r;const o=((r=e.modelConfig)===null||r===void 0?void 0:r.dependencies)||{};if(!o[i]&&t.masterRecordColumnValue){const n=t.masterRecordColumnValue.split("$")[1];if(!n)return;const a=this._getRelativeAttributePath(n,e);if(!a)return;const s=this._getReferenceColumnName(t);if(!s)return;o[i]=this._createDependency(a,s),e.modelConfig=e.modelConfig||{},e.modelConfig.dependencies=o}}}R._recordSchemaNameColumnName="RecordSchemaName";const Di="SysFile";function Zi(c){const e=[];return c.forEach(t=>{const i={expressionType:2,parameter:{dataValueType:10,value:{Id:t,value:t}}};e.push(i)}),e}function Fi(c){const e=[],t={expressionType:2,parameter:{dataValueType:1,value:c}};return e.push(t),e}function Ui(c,e,t,i){const r={};if(c?.length){const o=(0,b.generateGuid)(),n={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"FileGroup"},isAggregative:!1,dataValueType:10,referenceSchemaName:"FileGroup",rightExpressions:Zi(c)};r[o]=n}if(e?.trim()){const o=(0,b.generateGuid)(),n={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"Tag"},isAggregative:!1,dataValueType:2,rightExpressions:Fi(e)};r[o]=n}if(i&&t===Di){const o=(0,b.generateGuid)(),n={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"RecordSchemaName"},isAggregative:!1,dataValueType:2,rightExpressions:Fi(i)};r[o]=n}return Object.getOwnPropertyNames(r).length?{value:{items:r,logicalOperation:0,isEnabled:!0,filterType:6,rootSchemaName:t||Di}}:null}function Wi(c,e){return`${c}_${e}`}function Jt(c,e){let t="";return e&&Object.keys(c).forEach(i=>{var r;const o=c[i];o&&(0,h.bjw)(o)&&((r=o.modelConfig)===null||r===void 0?void 0:r.path)===e&&(t=i)}),t}class ke{get isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._actionDashboardPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._dcmSettingsService=t,this._actionDashboardPreprocessingDisableFeature="DisableActionDashboardPreprocessing"}_addStageAttribute(e,t,i){const r=e.viewModelConfig.attributes||{},o=`${i}.${t}`;if(!Jt(r,o)){const n=`LookupAttribute_${t}`;r[n]={modelConfig:{path:o}},e.viewModelConfig.attributes=r}}_extendWithDcmStageAttribute(e,t){var i=this;return(0,m.Z)(function*(){const r=yield(0,C.n)(i._dcmSettingsService.getStageColumnName(t.viewConfig.entitySchemaName),{defaultValue:null});r&&i._addStageAttribute(e,r,t.viewConfig.dataSourceName)})()}_extendWithPrimaryValueAttribute(e,t,i,r){const o=e.viewModelConfig.attributes||{},n=`${i}.${r}`;let a=Jt(o,n);a||(a=`ActionDashboard_${r}`,o[a]={modelConfig:{path:n}},e.viewModelConfig.attributes=o),t.viewConfig.primaryColumnValue=`$${a}`}processItemsAsync(e,t,i){var r=this;return(0,m.Z)(function*(){if(!t)return;const o=e.map(function(){var n=(0,m.Z)(function*(a){const s=t.getDataSource(),u=yield(0,C.n)(t.getSchema());a.viewConfig.dataSourceName=s.dataSourceName,a.viewConfig.entitySchemaName=u.name,a.viewConfig.primaryDisplayColumnValue=`$${u.primaryDisplayAttributeName}`,yield r._extendWithDcmStageAttribute(i,a),r._extendWithPrimaryValueAttribute(i,a,s.dataSourceName,u.primaryAttributeName||"Id")});return function(a){return n.apply(this,arguments)}}());yield Promise.all(o)})()}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(yield t.isProcessingDisabled)return e;const i=e;return f.AXp.getViewConfigInfoByProperty("type","crt.ActionDashboard",i.viewConfig).forEach(o=>{o.viewConfig.allowedActions||(o.viewConfig.allowedActions=(0,v.L0N)())}),e})()}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){var r;if((yield i.isProcessingDisabled)||t.length===0)return e;const o=e,n=f.AXp.getViewConfigInfoByProperty("type","crt.ActionDashboard",o.viewConfig),a=(r=o.modelConfig)===null||r===void 0?void 0:r.primaryDataSourceName,s=t.find(u=>u.name===a);return yield i.processItemsAsync(n,s,o),e})()}}ke.\u0275fac=function(e){return new(e||ke)(l.LFG(D.UZ),l.LFG(ie))},ke.\u0275prov=l.Yz7({token:ke,factory:ke.\u0275fac});var Ni=_(42993);class qe{get isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState("DisableApprovalsPreprocessing"))}constructor(e,t){this._featureService=e,this._sysSettingsService=t,this._componentName="crt.Approval",this._dataLoadedAttributeSuffix="_DataLoaded",this._approvalMetricsAttributeSuffix="_ApprovalsMetrics",this._approvalChangedHandlerAttributeSuffix="_ApprovalChangedHandler",this._listAttributeSuffix="_ApprovalList"}_getApprovals(e){return f.AXp.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getApprovalName(e){return e.name.replace(/\./g,"_")}_getAcceptApprovalSettingValue(){return(0,C.n)(this._sysSettingsService.getByCodes(["AcceptApprovalWithoutComment"]).pipe((0,Ni.j)("values"),(0,w.U)(e=>{var t;return(t=e.AcceptApprovalWithoutComment)===null||t===void 0?void 0:t.value})))}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){if(yield i.isProcessingDisabled)return e;const r=e,o=i._getApprovals(r);for(const n of o){const a=n?.viewConfig;let s=r.viewModelConfig.attributes;s||(s=r.viewModelConfig.attributes={});const u=i._getApprovalName(a);s[`${u}${i._listAttributeSuffix}`]={value:null},s[`${u}${i._approvalMetricsAttributeSuffix}`]={value:null},s[`${u}${i._dataLoadedAttributeSuffix}`]={value:!1},s[`${u}${i._approvalChangedHandlerAttributeSuffix}`]={value:!1}}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){if(yield r.isProcessingDisabled)return e;const o=yield r._getAcceptApprovalSettingValue(),n=e,a=r._getApprovals(n);for(const s of a){const u=s?.viewConfig,d=r._getApprovalName(u),p=`${d}${r._listAttributeSuffix}`,g=`${d}${r._dataLoadedAttributeSuffix}`,y=`${d}${r._approvalChangedHandlerAttributeSuffix}`,S=`${d}${r._approvalMetricsAttributeSuffix}`;u.recordId="$Id",u.approval=`$${p}`,u.approvalsMetrics=`$${S}`,u.dataLoaded=`$${g}`,u.approvalChangedHandler=`$${y}`,u.loadData={request:"crt.ApprovalLoadDataRequest",params:{dataAttribute:p,dataMetricsAttribute:S,dataLoadedAttribute:g,config:"@event"}},o?u.approve={request:"crt.ApprovalActionHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:y}}:u.approve={request:"crt.ApprovalCofirmationHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:y}},u.reject={request:"crt.ApprovalCofirmationHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:y}}}return e})()}}qe.\u0275fac=function(e){return new(e||qe)(l.LFG(D.UZ),l.LFG(D.lI))},qe.\u0275prov=l.Yz7({token:qe,factory:qe.\u0275fac});class Ze{constructor(e){this._sysSettingsService=e,this._componentName="crt.ApprovalList"}_getApprovalLists(e){return f.AXp.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getApprovalListName(e){var t;return(t=e.items)===null||t===void 0?void 0:t.slice(1)}_getAcceptApprovalSettingValue(){return(0,C.n)(this._sysSettingsService.getByCodes(["AcceptApprovalWithoutComment"]).pipe((0,Ni.j)("values"),(0,w.U)(e=>{var t;return(t=e.AcceptApprovalWithoutComment)===null||t===void 0?void 0:t.value})))}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){const r=e,o=i._getApprovalLists(r);for(const n of o){const a=n?.viewConfig;let s=r.viewModelConfig.attributes;s||(s=r.viewModelConfig.attributes={});const u=i._getApprovalListName(a);s[`${u}_ApprovalsList`]={value:[]},s[`${u}_EntityName`]={value:a.entityName}}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){const o=e,n=yield r._getAcceptApprovalSettingValue(),a=r._getApprovalLists(o);for(const s of a){const u=s?.viewConfig,d=r._getApprovalListName(u),p=`${d}_ApprovalsList`,g=`$${d}.${d}${h.gWy}_Id`,y=n?"crt.ApprovalListActionRequest":"crt.ApprovalListConfirmationRequest";u.recordId="$Id",u.rowToolbarItems=[{type:"crt.MenuItem",caption:"ApprovalList.ApproveButtonLabel",icon:"approve-icon",iconColor:"accent",disabled:`${g} | crt.ToDisabledApprovalActionConverter: $${p}`,clicked:{request:y,params:{config:{id:g,schemaName:u.approvalEntityName,actionType:v.l4S.Approve},loadDataConfig:{parentSchemaName:u.entityName,parentRecordId:"$Id"},approvalListAttributeName:p,viewElementName:d}}},{type:"crt.MenuItem",caption:"ApprovalList.RejectButtonLabel",icon:"reject-icon",iconColor:"warn",disabled:`${g} | crt.ToDisabledApprovalActionConverter: $${p}`,clicked:{request:"crt.ApprovalListConfirmationRequest",params:{config:{id:g,schemaName:u.approvalEntityName,actionType:v.l4S.Reject},loadDataConfig:{parentSchemaName:u.entityName,parentRecordId:"$Id"},approvalListAttributeName:p,viewElementName:d}}}],u.reloadData={request:"crt.ApprovalListReloadRequest",params:{config:"@event",viewElementName:d}}}return e})()}}Ze.\u0275fac=function(e){return new(e||Ze)(l.LFG(D.lI))},Ze.\u0275prov=l.Yz7({token:Ze,factory:Ze.\u0275fac});class Kt{hasEntityEditPage(e,t){return(0,m.Z)(function*(){const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:e,payload:{entityName:t}};return yield b.HandlerChainService.instance.process(i)})()}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){return yield Promise.all((0,F.r2)(e,r.viewItemTypes).filter(o=>!o.rowToolbarItems).map(o=>r.setRowToolbarMenuItems(o,i))),e})()}}class ve extends Kt{constructor(){super(...arguments),this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var i=this;return(0,m.Z)(function*(){var r;const o=e.items.slice(1),n=t.getBoundDataSourceNameByAttributePath(o),a=(r=t.getBoundDataSchemaByAttributePath(o))===null||r===void 0?void 0:r.name,s=yield i.hasEntityEditPage(t,a),u=`$${o}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:"DataGrid.RowToolbar.Open",icon:"edit-row-action",visible:s,disabled:u,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:o,recordId:`$${o}.${n}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:"DataGrid.RowToolbar.Copy",icon:"copy-row-action",visible:s,disabled:u,clicked:{request:"crt.CopyRecordRequest",params:{itemsAttributeName:o,recordId:`$${o}.${n}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:"DataGrid.RowToolbar.Delete",icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:o,recordId:`$${o}.${n}_Id`},useRelativeContext:!1}}]})()}}ve.\u0275fac=function(){let c;return function(t){return(c||(c=l.n5z(ve)))(t||ve)}}(),ve.\u0275prov=l.Yz7({token:ve,factory:ve.\u0275fac});var N=_(68380);class Ue{constructor(e){this._dataGridDefaultBulkActionsCreator=e,this.viewItemTypes=["crt.DataGrid"]}_setDefaultBulkActions(e,t){var i;const r=(0,N.BJ)(e.items).attributePath;if(!r)return;const o=t[r],n=(i=o?.modelConfig)===null||i===void 0?void 0:i.path;!n||(e.bulkActions=this._dataGridDefaultBulkActionsCreator.createDefaultBulkActions(n,e))}crtOnMetaDataInit(e){var t;const i=e,r=(t=i.viewModelConfig.attributes)!==null&&t!==void 0?t:{};return(0,F.r2)(i,this.viewItemTypes).filter(o=>o.bulkActions===void 0).forEach(o=>{this._setDefaultBulkActions(o,r)}),Promise.resolve(e)}}Ue.\u0275fac=function(e){return new(e||Ue)(l.LFG(v.cF5))},Ue.\u0275prov=l.Yz7({token:Ue,factory:Ue.\u0275fac});var We=_(6388);class ze{constructor(e){this._dataGridDefaultBulkActionsCreator=e,this.viewItemTypes=["crt.DataGrid"]}_clearDefaultBulkActions(e,t){var i;const r=(0,N.BJ)(e.items).attributePath;if(!r)return;const o=t[r],n=(i=o?.modelConfig)===null||i===void 0?void 0:i.path;if(!n)return;const a=this._dataGridDefaultBulkActionsCreator.createDefaultBulkActions(n,e);a&&(0,We.Z)(e.bulkActions,a)&&(e.bulkActions=void 0)}crtOnMetaDataChanged(e){var t;const i=e,r=(t=i.viewModelConfig.attributes)!==null&&t!==void 0?t:{};return(0,F.r2)(i,this.viewItemTypes).forEach(o=>{this._clearDefaultBulkActions(o,r)}),Promise.resolve(e)}}ze.\u0275fac=function(e){return new(e||ze)(l.LFG(v.cF5))},ze.\u0275prov=l.Yz7({token:ze,factory:ze.\u0275fac});class j{}j.\u0275fac=function(e){return new(e||j)},j.\u0275mod=l.oAB({type:j}),j.\u0275inj=l.cJS({providers:[{provide:h.Gp3,useClass:Ue,multi:!0},{provide:h.E5$,useClass:ze,multi:!0}]});var k=_(33177),ei=_(89226),zt=_(7206),zi=_(40271);class Z{constructor(e,t,i,r,o){this._comboboxDropdownPageSizeService=e,this._translateService=t,this._dataSchemaRepository=i,this._featureService=r,this._window=o,this._disableLookupSelectionWindowFeatureName="DisableLookupSelectionWindow"}_getBindedAttributeName(e){return e.slice(1).split(".").pop()||""}_setComboboxShowListEvent(e,t){e.showList=this._createLoadDataRequestConfig(t),e.showList.params={...e.showList.params,config:{loadType:"reload"}}}_setComboboxPaginationChange(e,t){e.paginationChange=this._createLoadDataRequestConfig(t)}_createLoadDataRequestConfig(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:`${e}_DS`,parameters:[],primaryDisplayFilterValue:"@event.filterValue"},useRelativeContext:!0}}_setComboboxListActions(e,t){if(!e.listActions&&(e.listActions=[],e.isAddAllowed)){const r={...v.RCT,name:k.NameGenerator.generateUnique("ListAction")};e.listActions.push(r)}const i=e.listActions.find(r=>r.code===v.aIe.AddRecord);if(i){const r=e.attributeName;i.clicked.params={itemsAttributeName:`${t}`,attributeName:`${r}`,detail:"@event.detail"}}}_setComboboxControlActions(e,t){if(!e.controlActions&&(e.controlActions=[],e.isGoToSourceAllowed)){const o={...v.FFE,name:k.NameGenerator.generateUnique("ControlAction")};e.controlActions.push(o)}const i=e.controlActions.find(o=>o.code===v.aIe.GoToRecordList);i&&(i.clicked.params={itemsAttributeName:`${t}`});const r=e.controlActions.find(o=>o.code===v.aIe.OpenLookupPage);r&&(r.clicked.params={itemsAttributeName:`${t}`,itemAttributeName:`${e.attributeName}`})}_getReferenceSchemaName(e,t){const i=e.items.slice(1),r=t.getBoundDataSchemaByAttributePath(i);return r?.name}_setComboboxLinkViewConfig(e,t,i){const r=this._getReferenceSchemaName(e,t),o=this._translateService.instant("ComboBox.EmptyDisplayValue"),n=e.attributeName;e.linkViewConfig={type:"crt.Link",mode:"preventDefault",caption:`$${n} | crt.ToObjectProp : 'displayValue' : '${o}'`,href:`$${n} | crt.ToObjectProp : 'value' | crt.ToRecordLinkAsync : '${i}'`,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:n,recordId:`$${n} | crt.ToObjectProp : 'value'`,entityName:r}}}}_setComboboxConfig(e,t){this._setComboboxShowListEvent(e,t),this._setComboboxListActions(e,t),this._setComboboxControlActions(e,t),this._setComboboxPaginationChange(e,t)}_checkEditPagesAndExtendWithLinkViewConfig(e,t){var i=this;return(0,m.Z)(function*(){if(!e.showValueAsLink)return;if(yield i._hasSectionEditPage(e,t)){const o=e.items.slice(1);i._setComboboxLinkViewConfig(e,t,o)}})()}_addListAttribute(e,t){const i=e[t];e[t]={isCollection:!0,isLookup:!0,...i}}_addBusinessRuleListFilterAttribute(e,t){const i=(0,f.o$V)(t);e[i]||(e[i]={value:{}})}_setEmbeddedModel(e,t){var i=this;return(0,m.Z)(function*(){var r,o;const{vmListAttribute:n,model:a,comboboxAttributeName:s,vmAttribute:u}=e,d=yield(0,C.n)(a.getSchema(),{defaultValue:null}),p=d?.attributes,g=(r=p?.find(({name:y})=>y===t))===null||r===void 0?void 0:r.referenceSchemaName;!g||(n.embeddedModel=i._createEmbeddedModel((0,f.i_V)(s),g,(o=u.modelConfig)===null||o===void 0?void 0:o.showDeactivatedRecords))})()}_setViewModelConfig(e,t){var i=this;return(0,m.Z)(function*(){const{vmListAttribute:r,model:o,comboboxAttributeName:n}=e,a=yield(0,C.n)(o.getSchema(),{defaultValue:null}),s=a?.findAttributeByName(t);if(!s){r.viewModelConfig={attributes:{value:{},displayValue:{},primaryColorValue:{}}};return}const u=yield i._getDataSchema(s?.referenceSchemaName),d=i._createViewModelConfig((0,f.i_V)(n),u);u?.primaryColorAttributeName&&(d.attributes.primaryColorValue={modelConfig:{path:`${(0,f.i_V)(n)}_DS.${u?.primaryColorAttributeName}`}}),r.viewModelConfig=d})()}_getFilterAttributes(e,t){var i;const r=e.modelConfig,o={name:(0,f.o$V)((0,f.i_V)(t)),loadOnChange:!0},n=(i=r?.filterAttributes)!==null&&i!==void 0?i:[];return n.find(a=>a.name===o.name)||n.push(o),n}_setModelConfig(e,t){var i=this;return(0,m.Z)(function*(){const{vmListAttribute:r,model:o,comboboxAttributeName:n}=e,a=yield i._getModelConfigDefaultSorting(o,t),s=yield i._comboboxDropdownPageSizeService.getPageSize(),u=i._getFilterAttributes(r,n),d=i._createModelConfig((0,f.i_V)(n),a,s,u);i._mergeModelConfig(r,d)})()}_getModelConfigDefaultSorting(e,t){var i=this;return(0,m.Z)(function*(){const r=[],o=yield(0,C.n)(e.getSchema(),{defaultValue:null}),n=o?.findAttributeByName(t);if(n){const a=yield i._getDataSchema(n.referenceSchemaName);r.push(i._getDefaultSorting(a))}return r})()}_getDefaultSorting(e){return{columnName:e?.primaryDisplayAttributeName,direction:"asc"}}_getDataSchema(e){return(0,C.n)(this._dataSchemaRepository.get(e),{defaultValue:null})}_mergeModelConfig(e,t){const i=e.modelConfig;e.modelConfig=(0,zt.Z)(t,i)}_getComboboxLookupModeFromDataSchema({attribute:e,models:t}){return(0,m.Z)(function*(){var i,r,o;const n=(i=e.modelConfig)===null||i===void 0?void 0:i.path.split(".")[0],a=(r=e.modelConfig)===null||r===void 0?void 0:r.path.split(".").pop(),s=t.find(g=>g.name===n),u=yield(0,C.n)(s.getSchema(),{defaultValue:null}),d=u?.findAttributeByName(a),p=ei.l.List;return(o=d?.lookupMode)!==null&&o!==void 0?o:p})()}_setComboboxMode({viewConfig:e,attributes:t,models:i,comboboxAttributeName:r}){var o=this;return(0,m.Z)(function*(){var n,a;const s=!(yield(0,C.n)(o._featureService.getFeatureState(o._disableLookupSelectionWindowFeatureName)));if(!((n=(0,zi.Z)(o._window,"Terrasoft"))===null||n===void 0?void 0:n.isAngularHost)||!s){e.mode=ei.l.List;return}const d=(a=t[r])!==null&&a!==void 0?a:{};!(0,h.bjw)(d)||(e.mode===void 0&&(e.mode=yield o._getComboboxLookupModeFromDataSchema({attribute:d,models:i})),e.mode===ei.l.SelectionWindow&&o._setSelectionWindowAction(e,t))})()}_setComboboxListAttribute({attributes:e,models:t,comboboxAttributeName:i}){var r=this;return(0,m.Z)(function*(){var o,n,a;const s=(o=e[i])!==null&&o!==void 0?o:{};if(!(0,h.bjw)(s))return;const u=(n=s.modelConfig)===null||n===void 0?void 0:n.path.split(".")[0],d=(a=s.modelConfig)===null||a===void 0?void 0:a.path.split(".").pop(),p=e[(0,f.i_V)(i)],g=t.find(S=>S.name===u),y={vmListAttribute:p,model:g,comboboxAttributeName:i,vmAttribute:s};yield r._setEmbeddedModel(y,d),yield r._setViewModelConfig(y,d),yield r._setModelConfig(y,d)})()}_setComboboxListSortingAttribute(e,t){const i=this._getComboboxListSortingAttributeName(t),r=e[i];e[i]={...r,isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}}}_getComboboxListSortingAttributeName(e){return`${e}_Sorting`}_hasSectionEditPage(e,t){var i=this;return(0,m.Z)(function*(){const r=i._getReferenceSchemaName(e,t);if(!r)return Promise.resolve(!1);const o={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:r}};return yield b.HandlerChainService.instance.process(o)})()}_createAttributeConfigByDataSchema(e,t){var i=this;return(0,m.Z)(function*(){const r=[i._getDefaultSorting(t)],o=yield i._comboboxDropdownPageSizeService.getPageSize();return{isCollection:!0,embeddedModel:i._createEmbeddedModel(e,t.name),viewModelConfig:i._createViewModelConfig(e,t),modelConfig:i._createModelConfig(e,r,o,[])}})()}_createAndAddFilterAttribute(e,t,i){const r=`${t}_Filter`,a=((e[t]||{}).modelConfig||{}).filterAttributes||[];!!a.find(u=>u.name===r)||a.push({name:r,loadOnChange:!0}),e[r]={value:i}}_createEmbeddedModel(e,t,i=!1){return{name:`${e}_DS`,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t,useRecordDeactivation:!i}}}}_createViewModelConfig(e,t){return{attributes:{value:{modelConfig:{path:`${e}_DS.${t?.primaryAttributeName}`}},displayValue:{modelConfig:{path:`${e}_DS.${t?.primaryDisplayAttributeName}`}}}}}_createModelConfig(e,t,i,r){return{path:`${e}_DS`,sortingConfig:{attributeName:this._getComboboxListSortingAttributeName(e),default:t},pagingConfig:{rowCount:i,rowsOffset:null},filterAttributes:r}}_getFiltersConfig(e,t){var i;const r=e[t],o=(i=r?.modelConfig)===null||i===void 0?void 0:i.filterAttributes;if(!o)return null;const n={};return o.forEach(a=>{n[a.name]={value:"$"+a.name}}),{filterAttributes:o,attributesConfig:n}}_setSelectionWindowAction(e,t){var i,r;const o=(0,f.i_V)(e.control).slice(1),n=e.attributeName;if(!o||!n)return;const a=this._getFiltersConfig(t,o),s=e?.listActions.some(p=>p.code===v.aIe.AddRecord),u=(i=t[n])!==null&&i!==void 0?i:{},d=Boolean((r=u.modelConfig)===null||r===void 0?void 0:r.showDeactivatedRecords);e.selectionWindowIconPressed={request:"crt.OpenLookupPageRequest",params:{itemsAttributeName:o,itemAttributeName:n,filtersConfig:a,features:{showDeactivatedRecords:d,create:{enabled:s}}}}}crtOnMetaDataInit(e,t){const i=e.control;if((0,L.zX)(i,t)){const r=this._getBindedAttributeName(i),o=e.items,n=(0,f.i_V)(r);if((0,L.zX)(o,t)){const a=o.slice(1).split(".").pop();t[a].isLookup=!0}else this._addListAttribute(t,n),e.items=(0,f.i_V)(i);this._addBusinessRuleListFilterAttribute(t,n),e.attributeName=r,this._setComboboxConfig(e,n)}}crtOnModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){const o=e.control;if((0,L.zX)(o,t)){const n=r._getBindedAttributeName(o);r._setComboboxListSortingAttribute(t,(0,f.i_V)(n)),yield r._setComboboxListAttribute({attributes:t,models:i,comboboxAttributeName:n}),yield r._setComboboxMode({viewConfig:e,attributes:t,models:i,comboboxAttributeName:n})}})()}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){const o=e.items;(0,L.zX)(o,t)&&(yield r._checkEditPagesAndExtendWithLinkViewConfig(e,i))})()}setupComboboxMetadataByEntitySchema(e,t,i,r){var o=this;return(0,m.Z)(function*(){const n=yield o._getDataSchema(i);if(!n)return;const a=(0,f.i_V)(e.name);t[a]=yield o._createAttributeConfigByDataSchema(a,n),r&&o._createAndAddFilterAttribute(t,a,r),o._setComboboxListSortingAttribute(t,a),e.items=`$${a}`,o._setComboboxShowListEvent(e,a),o._setComboboxPaginationChange(e,a)})()}}Z.\u0275fac=function(e){return new(e||Z)(l.LFG(v.Zb_),l.LFG($.sK),l.LFG(h.afi),l.LFG(D.UZ),l.LFG(k.WINDOW_TOKEN))},Z.\u0275prov=l.Yz7({token:Z,factory:Z.\u0275fac});class je{constructor(e){this._comboboxPreprocessorService=e}crtOnMetaDataInit(e){const t=e,i=t.viewModelConfig.attributes;return f.AXp.getViewConfigInfoByProperty("type","crt.ComboBox",t.viewConfig).forEach(o=>{this._comboboxPreprocessorService.crtOnMetaDataInit(o.viewConfig,i)}),Promise.resolve(e)}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){const r=e,o=r.viewModelConfig.attributes,n=f.AXp.getViewConfigInfoByProperty("type","crt.ComboBox",r.viewConfig);for(const a of n)yield i._comboboxPreprocessorService.crtOnModelInit(a.viewConfig,o,t);return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){const o=e,n=o.viewModelConfig.attributes,a=f.AXp.getViewConfigInfoByProperty("type","crt.ComboBox",o.viewConfig);for(const s of a)yield r._comboboxPreprocessorService.crtOnViewModelInit(s.viewConfig,n,i);return e})()}}je.\u0275fac=function(e){return new(e||je)(l.LFG(Z))},je.\u0275prov=l.Yz7({token:je,factory:je.\u0275fac});const ji={[b.DataValueType.Integer]:0,[b.DataValueType.FLOAT1]:1,[b.DataValueType.FLOAT2]:2,[b.DataValueType.FLOAT3]:3,[b.DataValueType.FLOAT4]:4,[b.DataValueType.FLOAT8]:8};class re{process(e,t){var i;const r=(i=ji[t])!==null&&i!==void 0?i:null;r!==null&&!e.format&&(e.format={decimalPrecision:r})}}re.\u0275fac=function(e){return new(e||re)},re.\u0275prov=l.Yz7({token:re,factory:re.\u0275fac});class He{constructor(e){this._numberInputPreprocessorService=e}_process(e,t,i){var r,o,n;const a=e.control.startsWith("$")?e.control.substring(1):"",s=(o=(r=t.attributes)===null||r===void 0?void 0:r[a])!==null&&o!==void 0?o:{};if(!(0,h.bjw)(s))return;const u=(n=s?.modelConfig)===null||n===void 0?void 0:n.path;if(!u)return;const d=this._getDataSchemaAttributeByPath(u,i),p=d?.dataValueType;!p||this._numberInputPreprocessorService.process(e,p)}_getDataSchemaAttributeByPath(e,t){var i;const[r,o]=e.split("."),n=(i=t.dataSchemas[r])===null||i===void 0?void 0:i.attributes;let a;for(const s in n)if(n[s].path===o){a=n[s];break}return a}crtOnViewModelInit(e,t,i){const r=e;return f.AXp.getViewConfigInfoByProperty("type","crt.NumberInput",r.viewConfig).forEach(n=>{this._process(n.viewConfig,r.viewModelConfig,i)}),Promise.resolve(e)}}He.\u0275fac=function(e){return new(e||He)(l.LFG(re))},He.\u0275prov=l.Yz7({token:He,factory:He.\u0275fac});class Ye{constructor(e,t,i,r,o){this._editingCellViewConfigCreatorFactory=e,this._featureService=t,this._metadataModifierService=i,this._comboboxPreprocessorService=r,this._numberInputPreprocessorService=o}_isEditingModeDisabled(){return(0,O.z)(this._featureService.getFeatureState(F.BY))}_updateAttributeProperties(e,t,i){L.zA.updateCollectionAttributeProperties(t,e,i,[{name:"readonly",defaultValue:!1}])}_addColumnsEditingCellViewConfigs(e,t,i,r=!1){var o=this;return(0,m.Z)(function*(){const n=e.columns;if(!Array.isArray(n))return;const a=e.items,s=n.filter(u=>!u.editingCellView);for(const u of s){const p=yield o._editingCellViewConfigCreatorFactory.create(u.dataValueType).getViewElementConfig({column:u,itemsAttributeName:a,context:t});r&&p&&o._updateAttributeProperties(i,p,a),p&&o._metadataModifierService.addProperty(u,"editingCellView",p)}})()}_getColumnDefinitionByPredicate(e,t){return Array.isArray(e.columns)?(e.columns||[]).filter(t):[]}_getDataGridComboBoxColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>Boolean(t.dataValueType===b.DataValueType.Lookup&&t.editingCellView))}_getDataGridNumberInputColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>{var i;return Boolean(((i=t.editingCellView)===null||i===void 0?void 0:i.type)==="crt.DataTableEditNumericCell")})}_getDataGridItemsAttributeConfig(e,t){var i;const r=(0,F.TN)(e);if(!r)return;const n=t.viewModelConfig.attributes[r];return(i=n?.viewModelConfig)===null||i===void 0?void 0:i.attributes}_addEditableFeature(e,t){const i=e.features;if((0,N.Ht)(i))return;const r=(0,v.FwP)(i?.editable,!t);if(!i)return this._metadataModifierService.addProperty(e,"features",{editable:r});const o=i.editable;if(o==null)return this._metadataModifierService.addProperty(i,"editable",r);typeof o!="boolean"&&(o.enable==null&&this._metadataModifierService.addProperty(o,"enable",r.enable),o.itemsCreation==null&&this._metadataModifierService.addProperty(o,"itemsCreation",o.enable&&r.itemsCreation))}_addActionAddRecordToListActions(e,t){var i,r;const o=t[`${e.attributeName}_List`],n=o&&"embeddedModel"in o&&((r=(i=o?.embeddedModel)===null||i===void 0?void 0:i.config.config)===null||r===void 0?void 0:r.entitySchemaName);if(!n)return;const a=e.control.split(".").pop(),s={...v.RCT,clicked:{request:"crt.CreateRecordFromEditLookupCellRequest",params:{schemaName:n,attributeName:a,detail:"@event.detail"},useRelativeContext:!0},name:k.NameGenerator.generateUnique("ListAction")};this._addComboboxActionIfNotExist(e,v.aIe.AddRecord,s)}_addComboboxActionIfNotExist(e,t,i){e.listActions||(e.listActions=[]),!e.listActions.some(o=>o.code===t)&&e.listActions.push(i)}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){const i=e,r=yield t._isEditingModeDisabled(),o=(0,F.q3)(e);for(const n of o){if(t._addEditableFeature(n,r),r)continue;yield t._addColumnsEditingCellViewConfigs(n,null,i,!0);const a=t._getDataGridItemsAttributeConfig(n,e);if(!a)continue;const s=t._getDataGridComboBoxColumnDefinitions(n);for(const u of s)t._comboboxPreprocessorService.crtOnMetaDataInit(u.editingCellView,a)}return e})()}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){if(yield i._isEditingModeDisabled())return e;const r=(0,F.q3)(e);for(const o of r){const n=i._getDataGridItemsAttributeConfig(o,e);if(!n)continue;const a=i._getDataGridComboBoxColumnDefinitions(o);for(const s of a)yield i._comboboxPreprocessorService.crtOnModelInit(s.editingCellView,n,t)}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){if(yield r._isEditingModeDisabled())return e;const o=e,n=(0,F.q3)(e);for(const a of n){const s=r._getDataGridItemsAttributeConfig(a,e);if(!s)continue;yield r._addColumnsEditingCellViewConfigs(a,i,o);const u=r._getDataGridComboBoxColumnDefinitions(a);for(const p of u)yield r._comboboxPreprocessorService.crtOnViewModelInit(p.editingCellView,s,i),r._addActionAddRecordToListActions(p.editingCellView,s);r._getDataGridNumberInputColumnDefinitions(a).forEach(p=>{const g=p.dataValueType,y=p.editingCellView;r._numberInputPreprocessorService.process(y,g)})}return e})()}}Ye.\u0275fac=function(e){return new(e||Ye)(l.LFG(F.z6),l.LFG(D.UZ),l.LFG(h.pi2),l.LFG(Z),l.LFG(re))},Ye.\u0275prov=l.Yz7({token:Ye,factory:Ye.\u0275fac});var Pi=_(84967),E=_(61528);class oe{constructor(e,t,i){this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=i,this.featureName="DisableDataGridColumnsPreprocessing",this.viewItemTypes=["crt.DataGrid"]}_getColumnDefinitions(e,t){var i=this;return(0,m.Z)(function*(){const r=e.columns,o=yield i.getGenerateCellViewConfig(e,t);return o?yield(0,C.n)(i.dataGridColumnDefinitionService.processDataGridColumnDefinitions(o,r)):[]})()}_addColumnsCellViewConfigs(e,t){var i=this;return(0,m.Z)(function*(){const r=e.columns;if(!Array.isArray(r)||r.length===0)return;const o=yield i._getColumnDefinitions(e,t);i._addColumnProperty(r,o,"cellView"),i._addColumnProperty(r,o,"readonly")})()}_addColumnProperty(e,t,i){e.filter(r=>!r[i]).map(r=>[r,t.find(o=>o.code===r.code)]).forEach(([r,o])=>this.metadataModifierService.addProperty(r,i,o?.[i]))}getGenerateCellViewConfig(e,t){const i=(0,M.of)(t),r=(0,F.TN)(e);if(!r)return Promise.resolve(null);const o=i.pipe((0,w.U)(s=>s?.getBoundDataSourceNameByAttributePath(r))),n=i.pipe((0,w.U)(s=>s?.getBoundDataSchemaByAttributePath(r))),a=e.items;return(0,C.n)((0,Pi.D)([o,n]).pipe((0,E.w)(([s,u])=>s&&u?(0,M.of)({dataSchema:u,dataSourceName:s,itemsAttributeName:a,viewModel:t,features:e.features,dataGridName:e.name}):(0,M.of)(null))))}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){if(yield(0,C.n)(r.featureService.getFeatureState(r.featureName),{defaultValue:null}))return e;const n=f.AXp.getViewConfigInfoByPropertyForValues("type",r.viewItemTypes,e.viewConfig);for(const a of n)yield r._addColumnsCellViewConfigs(a.viewConfig,i);return e})()}}oe.\u0275fac=function(e){return new(e||oe)(l.LFG(D.UZ),l.LFG(h.pi2),l.LFG(F.bL))},oe.\u0275prov=l.Yz7({token:oe,factory:oe.\u0275fac});class Xe{constructor(e){this._filterOptionsBackwardCompatibilityModifier=e}_isEmptyExposeFilters(e){var t;const i=e?._filterOptions;return i?!(!((t=i.expose)===null||t===void 0)&&t.length):!1}crtOnMetaDataInit(e){return(0,F.q3)(e,["crt.DataGrid"]).filter(t=>this._isEmptyExposeFilters(t)).forEach(t=>this._filterOptionsBackwardCompatibilityModifier.modify(t)),Promise.resolve(e)}}Xe.\u0275fac=function(e){return new(e||Xe)(l.LFG(v.uoG))},Xe.\u0275prov=l.Yz7({token:Xe,factory:Xe.\u0275fac});var B=_(33569);class Qe{_setInitialFilterOptions(e){var t,i;(t=e.items)!==null&&t!==void 0||(e.items=`$${(0,v.Ndu)(e)}`),(i=e.activeRow)!==null&&i!==void 0||(e.activeRow=`$${(0,v.rE5)(e)}`);const r=(0,v.Hl3)(e);r&&(e._filterOptions=r)}_canSetInitialFilterOptions(e){return(0,B.Z)(e?._filterOptions)&&(0,v.mUg)(e)}crtOnMetaDataInit(e){return(0,F.q3)(e,["crt.DataGrid"]).filter(this._canSetInitialFilterOptions).forEach(t=>this._setInitialFilterOptions(t)),Promise.resolve(e)}}Qe.\u0275fac=function(e){return new(e||Qe)},Qe.\u0275prov=l.Yz7({token:Qe,factory:Qe.\u0275fac});class _e{}_e.\u0275fac=function(e){return new(e||_e)},_e.\u0275mod=l.oAB({type:_e}),_e.\u0275inj=l.cJS({providers:[v.uoG,{provide:h.Gp3,useClass:Qe,multi:!0},{provide:h.Gp3,useClass:Xe,multi:!0}]});var ti=_(31177);class Je{_cleanupDefaultFilterOptionsMetadata(e){var t;const i=e._filterOptions;if(!i)return this._cleanupDefaultActiveRow(e);const r=(0,ti.Z)(e),o=`$${(0,v.rE5)(e)}`;(t=r.activeRow)!==null&&t!==void 0||(r.activeRow=o);const n=(0,v.Hl3)(r);!(0,We.Z)(i,n)||(delete e._filterOptions,this._cleanupDefaultActiveRow(e))}_cleanupDefaultActiveRow(e){const t=e.activeRow,i=`$${(0,v.rE5)(e)}`;(0,We.Z)(t,i)&&delete e.activeRow}crtOnMetaDataChanged(e){return(0,F.q3)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultFilterOptionsMetadata(t)),Promise.resolve(e)}}Je.\u0275fac=function(e){return new(e||Je)},Je.\u0275prov=l.Yz7({token:Je,factory:Je.\u0275fac});class ye{}ye.\u0275fac=function(e){return new(e||ye)},ye.\u0275mod=l.oAB({type:ye}),ye.\u0275inj=l.cJS({providers:[{provide:h.E5$,useClass:Je,multi:!0}]});class Ke{constructor(e){this._defaultFeatures=e}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){var i,r;const o=(0,F.q3)(e).filter(n=>!n.headerToolbarItems);for(const n of o)n.headerToolbarItems=[{type:"crt.MenuItem",caption:"DataGrid.ActionsToolbar.ResetToDefault",icon:"reset",clicked:{request:"crt.DataGridResetConfigsToDefaultRequest",params:{dataGridName:n.name}}}],!((r=(i=t._defaultFeatures)===null||i===void 0?void 0:i.operations)===null||r===void 0)&&r.canCreateDefaultGridSettings&&n.headerToolbarItems.unshift({type:"crt.MenuItem",caption:"DataGrid.ActionsToolbar.SaveForAll",icon:"save",clicked:{request:"crt.DataGridSaveConfigsForAllRequest",params:{dataGridName:n.name}}});return e})()}}Ke.\u0275fac=function(e){return new(e||Ke)(l.LFG(v.ud6,8))},Ke.\u0275prov=l.Yz7({token:Ke,factory:Ke.\u0275fac});class et{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,O.z)(this._featureService.getFeatureState(F.BY))}_setCancelItemsChangesOutput(e){const t=e.items.slice(1);e.cancelItemsChanges={request:"crt.DataGridCancelItemsChangesRequest",params:{itemsAttributeName:t,changedItems:"@event"}}}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){return(yield t._isEditingModeDisabled())||(0,F.r2)(e).filter(i=>i.cancelItemsChanges==null).forEach(i=>t._setCancelItemsChangesOutput(i)),e})()}}et.\u0275fac=function(e){return new(e||et)(l.LFG(D.UZ))},et.\u0275prov=l.Yz7({token:et,factory:et.\u0275fac});class tt{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,O.z)(this._featureService.getFeatureState(F.BY))}_isItemsCreationEnabled(e){const t=e.features;if((0,N.Ht)(t))return!0;const i=(0,v.FwP)(t?.editable,!0);return Boolean(i.itemsCreation)}_bindEditingCellsInput(e,t){if(e.editingCells)return;const i=e.name&&`${e.name}_EditingCells`;!i||(t[i]||(t[i]={value:null}),e.editingCells=`$${i}`)}_bindItemCreatingOutput(e,t,i){if(e.createItem)return;const r=this._getDefaultValuesFromDependencies(e,t,i);e.createItem={request:"crt.DataGridCreateItemRequest",params:{dataGridName:e.name,insertionIndex:"@event.index",defaultValues:r.map(({attributeName:o,value:n})=>({attributeName:o,value:n}))}}}_getDefaultValuesFromDependencies(e,t,i){var r;const o=i.dependencies,n=i.dataSources,a=e.items.slice(1),s=t[a],u=(r=s?.modelConfig)===null||r===void 0?void 0:r.path,d=u&&o?.[u];return d?d.filter(p=>this._isDependOnPageDataSource(p,n)).map(p=>this._getDependencyAttributeName(p,t)).map((p,g)=>p||`${e.name}_DependencyValue_${g}`).map((p,g)=>{const y=d[g];return this._setDependencyViewModelAttribute(p,y,t),this._getDefaultValue(p,y,n)}):[]}_getRelatedDataSourceName(e){var t;return(t=e.relationPath.split(".").shift())!==null&&t!==void 0?t:""}_isDependOnPageDataSource(e,t){var i;const r=this._getRelatedDataSourceName(e);return((i=t?.[r])===null||i===void 0?void 0:i.scope)===b.DataSourceScope.Page}_getDefaultValue(e,t,i){var r;const o=this._getRelatedDataSourceName(t),n=((r=i?.[o])===null||r===void 0?void 0:r.config)||{},a=n.entitySchemaName?`$${e} | crt.ToLookup : '${n.entitySchemaName}'`:`$${e}`;return{attributeName:t.attributePath,value:a}}_setDependencyViewModelAttribute(e,t,i){i[e]||(i[e]={modelConfig:{path:t.relationPath}})}_getDependencyAttributeName(e,t){return Object.keys(t).find(i=>{var r;const o=t[i];return((r=o?.modelConfig)===null||r===void 0?void 0:r.path)===e.relationPath})}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){var i;if(yield t._isEditingModeDisabled())return e;const r=e;r.viewModelConfig=(i=r.viewModelConfig)!==null&&i!==void 0?i:{};const o=r.viewModelConfig.attributes=r.viewModelConfig.attributes||{},n=r.modelConfig||{};return(0,F.r2)(r).filter(a=>t._isItemsCreationEnabled(a)).forEach(a=>{t._bindEditingCellsInput(a,o),t._bindItemCreatingOutput(a,o,n)}),e})()}}tt.\u0275fac=function(e){return new(e||tt)(l.LFG(D.UZ))},tt.\u0275prov=l.Yz7({token:tt,factory:tt.\u0275fac});class it{_bindItemDeletionOutput(e){const t=e.items.slice(1);e.deleteItem||!t||(e.deleteItem={request:"crt.DeleteRecordRequest",params:{itemsAttributeName:t,recordId:"@event.rowId"}})}crtOnMetaDataInit(e){var t;const i=e;return i.viewModelConfig=(t=i.viewModelConfig)!==null&&t!==void 0?t:{},(0,F.r2)(i).forEach(r=>{this._bindItemDeletionOutput(r)}),Promise.resolve(e)}}it.\u0275fac=function(e){return new(e||it)},it.\u0275prov=l.Yz7({token:it,factory:it.\u0275fac});class rt{constructor(e){this._featureService=e,this._featureName="DisableDataGridEditingMode"}_isEditingModeDisabled(){return(0,O.z)(this._featureService.getFeatureState(F.BY))}_setSaveItemsChangesOutput(e){const t=e.items.slice(1);e.saveItemsChanges={request:"crt.SaveRecordsRequest",params:{itemsAttributeName:t}}}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){return(yield t._isEditingModeDisabled())||(0,F.r2)(e).filter(i=>i.saveItemsChanges==null).forEach(i=>t._setSaveItemsChangesOutput(i)),e})()}}rt.\u0275fac=function(e){return new(e||rt)(l.LFG(D.UZ))},rt.\u0275prov=l.Yz7({token:rt,factory:rt.\u0275fac});class ot{constructor(e){this._featureService=e,this._featureName="DisableDataGridPagingPreprocessing"}_setPaginationChange(e,t){var i;if(e.paginationChange)return;const r=(i=e.items)===null||i===void 0?void 0:i.slice(1),o=t.getBoundDataSourceNameByAttributePath(r);e.paginationChange=Ci(o)}_setPagingConfig(e,t){var i,r,o;const n=(i=e.items)===null||i===void 0?void 0:i.slice(1),a=(o=((r=t?.viewModelConfig)===null||r===void 0?void 0:r.attributes)[n])!==null&&o!==void 0?o:{};if(!(0,h.bjw)(a))return;const s=a.modelConfig;!s||s?.pagingConfig||(s.pagingConfig=Ai())}get _isFeatureDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._featureName))}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(yield t._isFeatureDisabled)return e;const i=e,r=(0,F.r2)(e);for(const o of r)t._setPagingConfig(o,i);return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){if(yield r._isFeatureDisabled)return e;const o=(0,F.r2)(e);for(const n of o)r._setPaginationChange(n,i);return e})()}}ot.\u0275fac=function(e){return new(e||ot)(l.LFG(D.UZ))},ot.\u0275prov=l.Yz7({token:ot,factory:ot.\u0275fac});var Hi=_(75079);class nt{constructor(e){this._featureService=e,this._featureName="DisableDataGridPlaceholderPreprocessing"}_setNoConfiguredPlaceholder(e){e.skeleton==null&&(e.skeleton=[{type:"crt.Placeholder",image:{type:"icon",icon:"data-table",width:null,height:null,padding:null},title:"",subhead:""}])}_setNoItemsPlaceholders(e,t,i){var r,o;const n=t.placeholder,a=(o=(r=t.items)===null||r===void 0?void 0:r.split("$"))===null||o===void 0?void 0:o.pop(),s=this._getSearchFilterAttributesNames(i,a),d=[...this._getFilterAttributesNames(e,a),...s];if(!n?.length||!d.length)return;n.map(g=>g.visible).map(g=>{var y;const S=g??"";return(y=S?.split("$"))===null||y===void 0?void 0:y.pop()}).filter(Boolean).map(g=>e[g]).filter(Boolean).forEach(g=>g.from=(0,Hi.Z)([...g.from,...d]))}_getFilterAttributesNames(e,t){var i,r;const o=e[t],n=(r=(i=o?.modelConfig)===null||i===void 0?void 0:i.filterAttributes)!==null&&r!==void 0?r:[];return Object.values(n).filter(a=>a.loadOnChange).filter(a=>!a.name.endsWith("_PredefinedFilter")).map(a=>a.name)}_getSearchFilterAttributesNames(e,t){return e.filter(i=>{var r;return(r=i.targetAttributes)===null||r===void 0?void 0:r.includes(t)}).map(({name:i})=>Wi(i,t))}_getSearchFilterViewConfigs(e){return f.AXp.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){var i;if(yield(0,C.n)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const o=e;o.viewModelConfig.attributes=(i=o.viewModelConfig.attributes)!==null&&i!==void 0?i:{};const n=o.viewModelConfig.attributes,a=t._getSearchFilterViewConfigs(o);return(0,F.q3)(e).forEach(s=>{(0,L.zX)(s.items,n)?t._setNoItemsPlaceholders(n,s,a):t._setNoConfiguredPlaceholder(s)}),e})()}}nt.\u0275fac=function(e){return new(e||nt)(l.LFG(D.UZ))},nt.\u0275prov=l.Yz7({token:nt,factory:nt.\u0275fac});class at{_setOnChangeAttributeRequests(e,t){var i;(i=e.change)!==null&&i!==void 0||(e.change=[]),Array.isArray(e.change)||(e.change=[e.change]),e.change.push(...t)}_bindActiveRow(e,t){if(e.activeRow===void 0&&(e.activeRow=`$${(0,v.rE5)(e)}`),!(0,N.Ht)(e.activeRow))return;const i=(0,N.BJ)(e.activeRow).attributePath;t[i]||(t[i]={value:null});const r=[this._createActivateRowBusinessRulesRequest(i,e)];this._setOnChangeAttributeRequests(t[i],r)}_createActivateRowBusinessRulesRequest(e,t){return{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:e,dataGridViewElementName:t.name}}}crtOnMetaDataInit(e){var t,i;const o=(t=(i=e.viewModelConfig).attributes)!==null&&t!==void 0?t:i.attributes={};return(0,F.q3)(e).forEach(n=>this._bindActiveRow(n,o)),Promise.resolve(e)}}at.\u0275fac=function(e){return new(e||at)},at.\u0275prov=l.Yz7({token:at,factory:at.\u0275fac});class st{constructor(e){this._featureService=e,this._featureName="DisableDataGridRowDoubleClickPreprocessing"}_hasSectionEditPage(e,t){return(0,m.Z)(function*(){const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:e}};return yield b.HandlerChainService.instance.process(i)})()}_getReferenceSchemaName(e,t){return(0,m.Z)(function*(){const i=yield(0,h.f9G)(t,e);return i?.referenceSchemaName})()}_getPrimaryAttributeName(e,t){const i=(0,F.TN)(e),r=t.getBoundDataSourceNameByAttributePath(i),o=t.getBoundDataSchemaByAttributePath(i),{primaryAttributeName:n}=o??{};return n?`${r}_${n}`:""}_isPageExists(e,t){var i=this;return(0,m.Z)(function*(){const r=i._getPrimaryAttributeName(e,t),o=yield i._getReferenceSchemaName(r,t);return i._hasSectionEditPage(o,t)})()}_getDataGridViewConfigs(e,t){var i=this;return(0,m.Z)(function*(){const r=(0,F.r2)(e);return(yield Promise.all(r.map(n=>i._isPageExists(n,t)))).reduce((n,a,s)=>(a&&!r[s].rowDoubleClick&&n.push(r[s]),n),[])})()}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){if(yield(0,C.n)(r._featureService.getFeatureState(r._featureName),{defaultValue:null}))return e;const n=yield r._getDataGridViewConfigs(e,i);for(const a of n)a.rowDoubleClick={request:"crt.DataGridRowDoubleClickRequest",params:{itemsAttributeName:(0,F.TN)(a),rowId:"@event.rowId"}};return e})()}}st.\u0275fac=function(e){return new(e||st)(l.LFG(D.UZ))},st.\u0275prov=l.Yz7({token:st,factory:st.\u0275fac});class lt{constructor(e){this._featureService=e}_isSelectionPreprocessingDisabled(){const e=this._featureService.getFeatureState("DisableDataGridRowsSelectionPreprocessing");return(0,C.n)(e,{defaultValue:!1})}_bindSelectedRows(e,t){var i;if((i=e.selectedRows)!==null&&i!==void 0||(e.selectedRows=`$${(0,v.KIL)(e)}`),!(0,N.Ht)(e.selectedRows))return;const r=(0,N.BJ)(e.selectedRows).attributePath;t[r]||(t[r]={value:null})}_bindSelectionState(e,t){var i,r,o;if((i=e.selectionState)!==null&&i!==void 0||(e.selectionState=`$${(0,v.IK3)(e)}`),!(0,N.Ht)(e.selectionState))return;const n=(0,N.BJ)(e.selectionState).attributePath;if((r=t[n])!==null&&r!==void 0||(t[n]={value:null}),!(0,N.Ht)(e.items))return;const a=(0,N.BJ)(e.items).attributePath;if((o=e.totalItemsCount)!==null&&o!==void 0||(e.totalItemsCount=`$${a}_TotalItemsCount`),!(0,N.Ht)(e.totalItemsCount))return;const s=(0,N.BJ)(e.totalItemsCount).attributePath,u=`${a}_SelectedItemsCount`;this._createTotalItemsCountAttribute(s,{itemsAttributeName:a,selectionStateAttributeName:n},t),this._createSelectedItemsCountAttribute(u,{itemsAttributeName:a,selectionStateAttributeName:n,totalItemsCountAttributeName:s},t);const d=t[n];if(d.change||(d.change=[]),Array.isArray(d.change)||(d.change=[d.change]),d.change.push({request:"crt.DataGridCleanupCachedItemsCountLoadParametersRequest",params:{itemsAttributeName:a,selectionStateAttributeName:n}},{request:"crt.DataGridRunSelectedItemsCountAttributeCalculationRequest",params:{selectionStateAttributeName:n,selectedItemsCountAttributeName:u}}),!(0,N.Ht)(e.selectedRows))return;const p=(0,N.BJ)(e.selectedRows).attributePath;d.change.push({request:"crt.DataGridSetSelectedRowsFromSelectionStateRequest",params:{selectedRowsAttributeName:p,selectionStateAttributeName:n}})}_createTotalItemsCountAttribute(e,t,i){var r,o;const{itemsAttributeName:n,selectionStateAttributeName:a}=t,s=`${e}_Actualization`;(r=i[e])!==null&&r!==void 0||(i[e]={from:[n,s],converter:`crt.ToCollectionItemsCount : '${n}' : '${e}'`}),(o=i[s])!==null&&o!==void 0||(i[s]={from:a,converter:"crt.IsAnySelected"})}_createSelectedItemsCountAttribute(e,t,i){var r;const{itemsAttributeName:o,selectionStateAttributeName:n,totalItemsCountAttributeName:a}=t;(r=i[e])!==null&&r!==void 0||(i[e]={from:[o,n,a],converter:`crt.ToCollectionSelectedItemsCount : '${o}' : '${e}'`,change:{request:"crt.DataGridSetSelectedCountToRowsSelectionStateRequest",params:{selectionStateAttributeName:n,selectedItemsCountAttributeName:e}}})}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){var i,r;if(yield t._isSelectionPreprocessingDisabled())return e;const n=(i=(r=e.viewModelConfig).attributes)!==null&&i!==void 0?i:r.attributes={};return(0,F.q3)(e).forEach(a=>{t._bindSelectedRows(a,n),t._bindSelectionState(a,n)}),e})()}}lt.\u0275fac=function(e){return new(e||lt)(l.LFG(D.UZ))},lt.\u0275prov=l.Yz7({token:lt,factory:lt.\u0275fac});class ct{constructor(e=!1){this._isDesignTime=e}_setInitialSelectionOptions(e){(0,F.q3)(e,["crt.DataGrid"]).filter(t=>this._canSetSelectionOptions(t)).forEach(t=>this._setSelectionOptions(t))}_canSetSelectionOptions(e){return(0,B.Z)(e?._selectionOptions)&&(0,v.$k3)(e)}_setSelectionOptions(e){var t;(t=e.selectionState)!==null&&t!==void 0||(e.selectionState=`$${(0,v.IK3)(e)}`);const i=(0,v.y3p)(e);i&&(e._selectionOptions=i)}_setExportToExcelRequestFiltersParameter(e){(0,L.eV)(e.viewConfig,"crt.ExportDataGridToExcelRequest",this._canSetExportToExcelRequestFiltersParameter).forEach(t=>{const i=t.params.viewName,r=this._getExportToExcelRequestFiltersParameter(e,i);!r||(t.params={...t.params,filters:r})})}_canSetExportToExcelRequestFiltersParameter(e){var t;const{viewName:i,filters:r}=(t=e?.params)!==null&&t!==void 0?t:{};return Boolean(i)&&r===void 0}_getExportToExcelRequestFiltersParameter(e,t){const i=f.AXp.getViewConfigInfoByName(e,t);if(!i?.viewConfig)return null;const{items:r,_selectionOptions:o}=i.viewConfig,n=(0,N.Ht)(r)&&(0,N.BJ)(r).attributePath,a=(0,N.iy)(o);return!n||!a?null:(0,N.a9)(n,a,{supportEmptySelection:!0})}crtOnMetaDataInit(e){const t=e;return this._setInitialSelectionOptions(t),this._isDesignTime||this._setExportToExcelRequestFiltersParameter(t),Promise.resolve(e)}}ct.\u0275fac=function(e){return new(e||ct)(l.LFG(f.LxT,8))},ct.\u0275prov=l.Yz7({token:ct,factory:ct.\u0275fac});class H{}H.\u0275fac=function(e){return new(e||H)},H.\u0275mod=l.oAB({type:H}),H.\u0275inj=l.cJS({providers:[{provide:h.Gp3,useClass:ct,multi:!0}]});class ut{_isSelectionStateAttributeBound(e,t,i){const r=(0,ti.Z)(i),n=f.AXp.getViewConfigInfoByName(r,e).viewConfig;return delete n._selectionOptions,delete n.selectionState,f.AXp.isViewModelAttributeBound(r,t)}_cleanupDefaultSelectionOptionsMetadata(e,t){var i;const r=e._selectionOptions;if(!r)return this._cleanupDefaultSelectionState(e,t);const o=(0,ti.Z)(e),n=`$${(0,v.IK3)(e)}`;(i=o.selectionState)!==null&&i!==void 0||(o.selectionState=n);const a=(0,v.y3p)(o);if(!(0,We.Z)(r,a))return;const s=(0,N.iy)(r);e.name&&this._isSelectionStateAttributeBound(e.name,s,t)||(delete e._selectionOptions,this._cleanupDefaultSelectionState(e,t))}_cleanupDefaultSelectionState(e,t){const i=e.selectionState,r=`$${(0,v.IK3)(e)}`;if(!(0,We.Z)(i,r))return;const o=(0,N.BJ)(i).attributePath;e.name&&this._isSelectionStateAttributeBound(e.name,o,t)||delete e.selectionState}crtOnMetaDataChanged(e){return(0,F.q3)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultSelectionOptionsMetadata(t,e)),Promise.resolve(e)}}ut.\u0275fac=function(e){return new(e||ut)},ut.\u0275prov=l.Yz7({token:ut,factory:ut.\u0275fac});class be{}be.\u0275fac=function(e){return new(e||be)},be.\u0275mod=l.oAB({type:be}),be.\u0275inj=l.cJS({providers:[{provide:h.E5$,useClass:ut,multi:!0}]});class dt{constructor(e){this._featureService=e,this._featureName="DisableDataGridSortingPreprocessing"}_setSorting(e,t){if(e.sorting)return;const i=`${e.name.split(" ").join("").replace(/\./g,"_")}Sorting`,r=t.viewModelConfig.attributes;r[i]||(r[i]={});const n=`| crt.ToDataTableSortingConfig: '${e.items.slice(1)}'`;e.sorting=`$${i} ${n}`}_setSortingChange(e){if(e.sortingChange)return;const t=e.items.slice(1);e.sortingChange={request:"crt.DataGridSortDataRequest",params:{itemsAttributeName:t,sorting:"@event"}}}_setSortingConfig(e,t){var i,r,o,n;const a=e.items.slice(1),s=t.viewModelConfig.attributes;s[a]||(s[a]={});const u=(r=((i=t?.viewModelConfig)===null||i===void 0?void 0:i.attributes)[a])!==null&&r!==void 0?r:{};if(!(0,h.bjw)(u))return;const d=u?.modelConfig;!d||((o=d.sortingConfig)===null||o===void 0?void 0:o.attributeName)||(u.modelConfig={...u.modelConfig,sortingConfig:{...(n=u.modelConfig)===null||n===void 0?void 0:n.sortingConfig,attributeName:`${e.name.split(" ").join("").replace(/\./g,"_")}Sorting`}})}setSortingValuesToViewConfig(e,t){this._setSorting(e,t),this._setSortingChange(e),this._setSortingConfig(e,t)}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(yield(0,C.n)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const r=e,o=(0,F.r2)(e);for(const n of o)t.setSortingValuesToViewConfig(n,r);return e})()}}dt.\u0275fac=function(e){return new(e||dt)(l.LFG(D.UZ))},dt.\u0275prov=l.Yz7({token:dt,factory:dt.\u0275fac});class mt{constructor(e,t,i){this._featureService=e,this._dcmSchemaManagerService=t,this._entitySchemaRepository=i,this._dcmDataAttributePostfix="_DCMData",this._dcmSchemas=[],this._dataGridToDataSourceMap=[],this._dataSourceSchemas=[]}_getDataGridToDataSourceMap(e,t){return e.map(i=>{var r;const o=(r=i.primaryColumnName)===null||r===void 0?void 0:r.split("_");o?.pop();const n=o?.join("_")||"",a=t[n];return{dataGridName:i.name,dataSource:a,dataSourceName:n}}).filter(({dataSource:i})=>i!=null)}_getEntitySchemaFromDataSourceSchemas(e){return this._dataSourceSchemas.find(t=>{var i;return t.name===((i=e?.config)===null||i===void 0?void 0:i.entitySchemaName)})}_getFilterColumnPath(e){var t;const i=(t=e.find(o=>o.filters))===null||t===void 0?void 0:t.filters;let r="";if(i){const o=JSON.parse(i);r=`${Object.values(o.items)[0].leftExpression.columnPath}`}return r}_fillDataGridModelConfig(e,t,i,r){var o=this;return(0,m.Z)(function*(){const n=o._dcmSchemas.filter(y=>y.entitySchemaUId===e);if(!n?.length)return;const a=o._getFilterColumnPath(n),s=o._dcmSchemaManagerService.getDcmSchemaDataItems(e),u=yield(0,O.z)(s),d=`${t.name}${o._dcmDataAttributePostfix}`;r[d]={value:{schemas:n,schemasData:u,filterColumnAttributePath:`${i?.dataSourceName}_${a}`}};const p=t.items.substring(1),g=r[p].viewModelConfig;a&&p&&!g.attributes[a]&&(g.attributes[`${i?.dataSourceName}_${a}`]={modelConfig:{path:`${i?.dataSourceName}.${a}`}})})()}_initDataGridViewConfigAttributes(e,t){var i=this;return(0,m.Z)(function*(){const r=i._dataGridToDataSourceMap.find(n=>n.dataGridName===e.name);if(!r)return;const o=i._getEntitySchemaFromDataSourceSchemas(r.dataSource);!o||(yield i._fillDataGridModelConfig(o?.uId,e,r,t))})()}_getDataSourceSchemas(){var e=this;return(0,m.Z)(function*(){const t=e._dataGridToDataSourceMap.map(i=>{var r,o;return{name:(o=(r=i?.dataSource)===null||r===void 0?void 0:r.config)===null||o===void 0?void 0:o.entitySchemaName,loadLookupColumns:!0}});return yield(0,O.z)(e._entitySchemaRepository.getSchemes(t))})()}get isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState("DisableDataGridProgressBarStageCell"))}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(yield t.isProcessingDisabled)return e;const i=(0,F.q3)(e);if(!i?.length)return e;const r=e.modelConfig.dataSources||{};t._dcmSchemas=yield(0,O.z)(t._dcmSchemaManagerService.getDcmSchemaDataCollection()),t._dataGridToDataSourceMap=t._getDataGridToDataSourceMap(i,r),t._dataSourceSchemas=yield t._getDataSourceSchemas();const o=e,n=o.viewModelConfig.attributes=o.viewModelConfig.attributes||{};for(const a of i)yield t._initDataGridViewConfigAttributes(a,n);return e})()}}mt.\u0275fac=function(e){return new(e||mt)(l.LFG(D.UZ),l.LFG(D.RC),l.LFG(f.FGz))},mt.\u0275prov=l.Yz7({token:mt,factory:mt.\u0275fac});class Se extends oe{constructor(){super(...arguments),this.viewItemTypes=["crt.ApprovalList"]}}Se.\u0275fac=function(){let c;return function(t){return(c||(c=l.n5z(Se)))(t||Se)}}(),Se.\u0275prov=l.Yz7({token:Se,factory:Se.\u0275fac});var jt=_(3518);function Yi(c){var e;return(e=c.map(i=>{var r;return{UId:(r=i?.typeId)!==null&&r!==void 0?r:"",...i}}))!==null&&e!==void 0?e:[]}class pt{constructor(e){this._configurationDataService=e}_getMenuItem(e,t,i){return{type:"crt.MenuItem",caption:e.caption||e.captionLcz,clicked:{request:"crt.CreateRecordRequest",params:{entityName:t,defaultValues:i}}}}_getDefaultValues(e,t,i){const r=i?[{attributeName:i,value:e.typeId}]:[];return t.length&&r.splice(0,0,...t),r}_getEntityName(e,t){const i=e.viewConfig.clicked.params;let r=i.entityName||"";if(!r){const o=i.itemsAttributeName;if(o){const n=t.getBoundDataSourceNameByAttributePath(o),a=t.dataSchemas[n];r=a?.name}}return r}_getButtonsWithCreateRecordRequest(e){return f.AXp.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(i=>{const r=i.viewConfig.clicked;return r?.params&&r.request==="crt.CreateRecordRequest"})}_fillMenuItems({button:e,entityName:t},i){var r,o,n,a;const s=i.entitiesStructure.find(P=>P.entitySchemaName===t);if(!s)return;const u=s.pages||[],d=Yi(u),p=jt.N8.getPagesForAddAction(d);if(p.length===0)return;const g=((r=e.viewConfig.clicked.params)===null||r===void 0?void 0:r.defaultValues)||[],y=s.typeColumnName;if(!((o=g.find(P=>P.attributeName===y))===null||o===void 0?void 0:o.value)){if(p.length>1){e.viewConfig.clickMode="menu";const P=p.map(I=>{const T=this._getDefaultValues(I,g,y);return this._getMenuItem(I,t,T)});(n=(a=e.viewConfig).menuItems)!==null&&n!==void 0||(a.menuItems=[]),e.viewConfig.menuItems.splice(0,0,...P)}else if(y){const P=this._getDefaultValues(p[0],g,y);e.viewConfig.clicked.params.defaultValues=P}}}_handlerConfigurationDataResponse(e,t){const{data:i,success:r}=e;r&&i?.entitiesStructure&&t.forEach(o=>{this._fillMenuItems(o,i)})}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){const o=r._getButtonsWithCreateRecordRequest(e).map(s=>({button:s,entityName:r._getEntityName(s,i)})).filter(s=>s.entityName);if(o.length===0)return e;const n=o.map(s=>s.entityName),a=yield(0,O.z)(r._configurationDataService.getEntitiesData(n));return r._handlerConfigurationDataResponse(a,o),e})()}}pt.\u0275fac=function(e){return new(e||pt)(l.LFG(D.iD))},pt.\u0275prov=l.Yz7({token:pt,factory:pt.\u0275fac});var Xi=_(67764),ii=_(62865);class ft{constructor(e){this.crtRoute=e}_getButtonsWithDefaultPageRequest(e){return f.AXp.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(i=>{var r,o;return((o=(r=i?.viewConfig)===null||r===void 0?void 0:r.clicked)===null||o===void 0?void 0:o.request)==="crt.ContinueInOtherPageRequest"})}_prepareButton(e,t){const i=e.viewConfig;(0,Xi.Z)(i.visible)||(i.visible=t)}_getEntityNavigationOptions(e){const t=(0,N.r0)(e),i=this.crtRoute.getState(),r=(0,ii.Z)(i?.children),o=(0,ii.Z)(r?.modelInitConfigs),n=(0,ii.Z)(i?.modelInitConfigs);return{defaultValues:o?.defaultValues||n?.defaultValues||[],entityName:t,recordId:o?.recordId}}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){const i=e,r=t._getButtonsWithDefaultPageRequest(i),o=t._getEntityNavigationOptions(i),n=yield jt.N8.getPageForActionAsync({action:b.ModelInPageAction.Edit,...o}),a=yield jt.N8.getPageForActionAsync({action:b.ModelInPageAction.Add,...o}),s=n?.cardSchema===a?.cardSchema,u=n?.cardSchema===i.name,d=Boolean(!s&&!u&&a&&n?.cardSchema);return r.forEach(p=>{t._prepareButton(p,d)}),Promise.resolve(e)})()}}ft.\u0275fac=function(e){return new(e||ft)(l.LFG(jt.S$))},ft.\u0275prov=l.Yz7({token:ft,factory:ft.\u0275fac});const Qi="SelectedItem";class gt{constructor(e,t){this._userInfo=e,this._profileAttributeService=t}_getButtonToggleGroups(e){return f.AXp.getViewConfigInfoByProperty("type","crt.ButtonToggleGroup",e.viewConfig).filter(i=>i.viewConfig.for)}_getDefaultSelectedTabValue(e){return e.selectedTab?{value:e.selectedTab}:{}}_filterTabs(e){return this._userInfo.isSSP||this._userInfo.isDataInputRestricted?e.filter(t=>t.name==="FeedsTab"):e}crtOnModelInit(e){var t=this;return(0,m.Z)(function*(){var i,r;const o=e,n=(i=o?.viewModelConfig)===null||i===void 0?void 0:i.attributes,a=t._getButtonToggleGroups(o);for(const s of a){const u=s.viewConfig,d=u.for,p=(r=f.AXp.getViewConfigInfoByFilter(P=>P.name===d,o.viewConfig))===null||r===void 0?void 0:r[0],g=p?.viewConfig,y=`${d}_Items`;u.items=`$${y}`;let S=g?.items;if(g.name==="CommunicationsPanelItemsTabPanel"&&(S=t._filterTabs(S)),S?.length){const P=S.map(T=>({value:T.name,icon:T.icon,iconPosition:T.iconPosition,tooltipTitle:T.title,displayValue:T.caption}))||[];n[y]={value:P};const I=`${d}_${Qi}`;n[I]=n[I]||t._getDefaultSelectedTabValue(g),u.value=`$${I}`,g.selectedTab=`$${I}`,g.visible=`$${I} | crt.ToBoolean`,yield t._profileAttributeService.prepareAttributeWithFeatureCheck(o,g,"selectedTab",I,"DisableSaveToProfileToggleGroupSelectedTab")}g?.allowToggleClose!==void 0&&(u.allowUntoggle=g?.allowToggleClose)}return Promise.resolve(e)})()}}gt.\u0275fac=function(e){return new(e||gt)(l.LFG(f.aoG),l.LFG(z))},gt.\u0275prov=l.Yz7({token:gt,factory:gt.\u0275fac});class ht{constructor(){this._pageSize=150}_getViewConfigs(e,t){return f.AXp.getViewConfigInfoByProperty("type",t,e.viewConfig).map(i=>i?.viewConfig).filter(Boolean)}_getDsAttributeName(e,t){return e.replace(`${t}_`,"")}_getCalendarDateColumns(e,t,i){var r,o,n;if(!t.modelConfig||!e.modelConfig||!e.modelConfig.dataSources)return[];const a=t.modelConfig.path,s=e.modelConfig.dataSources[a],u=((r=s?.config)===null||r===void 0?void 0:r.attributes)||{},d=i.templateValuesMapping;return[(o=u[this._getDsAttributeName(d.startColumn,a)])===null||o===void 0?void 0:o.path,(n=u[this._getDsAttributeName(d.endColumn,a)])===null||n===void 0?void 0:n.path].filter(p=>Boolean(p))}_setFilterAttribute(e,t,i){var r,o;if(i.filters)return;const n=e.viewModelConfig.attributes,a=n[(r=i.items)===null||r===void 0?void 0:r.replace("$","")];if(!a||!(!((o=a.modelConfig)===null||o===void 0)&&o.filterAttributes)||t.length===0)return;const s=this._getCalendarDateColumns(e,a,i),u=this._getCalendarDateFilterAttributes(a,t,s);u.length!==0&&(i.filters=`$${this._createCalculatedAttribute(n,i,u)}`)}_getCalendarDateFilterAttributes(e,t,i){var r,o;const n=((o=(r=e.modelConfig)===null||r===void 0?void 0:r.filterAttributes)===null||o===void 0?void 0:o.map(a=>a.name))||[];return t.filter(a=>{if(a.filterType!==v.KYG.DateRange||!n.find(u=>u.startsWith(a.name)))return!1;const s=new Array;return a._filterOptions.expose.forEach(u=>{var d;return(d=u.converters)===null||d===void 0?void 0:d.forEach(p=>{var g;return(g=p.args)===null||g===void 0?void 0:g.forEach(y=>{const S=y.target;s.push(S.filterColumn),s.push(S.filterColumnEnd),s.push(S.filterColumnStart)})})}),!!i.find(u=>s.includes(u))}).map(a=>a.value.replace("$",""))}_createCalculatedAttribute(e,t,i){const r=`${t.name}_FilterValues`;return e[r]={from:i},r}_setCrudEventsBindings(e){if((0,B.Z)(e.items))return;const t=e.items.slice(1);e.saveItemsChanges={request:"crt.SaveCalendarChangesRequest",params:{itemsAttributeName:t}},e.cancelItemsChanges={request:"crt.CancelCalendarChangesRequest",params:{itemsAttributeName:t}}}_setShowWeekendsAttribute(e){(0,B.Z)(e.showWeekends)||(e.showWeekendsAttributeName=e.showWeekends.replace("$",""))}_setLoadNextPageOptions(e,t){var i,r;const n=e.viewModelConfig.attributes[(i=t.items)===null||i===void 0?void 0:i.replace("$","")];this._setPagingConfig(n,t),this._setSortingConfig(e,n,t);const a=(r=n?.modelConfig)===null||r===void 0?void 0:r.path;t.loadNextPage={request:"crt.LoadDataRequest",params:{dataSourceName:a}}}_setPagingConfig(e,t){var i;if(!e?.modelConfig||e.modelConfig.pagingConfig){const r=(i=e?.modelConfig)===null||i===void 0?void 0:i.pagingConfig;t.pageSize=r?.rowCount||this._pageSize;return}e.modelConfig.pagingConfig={rowCount:this._pageSize,rowsOffset:null}}_setSortingConfig(e,t,i){var r,o,n;if(!t?.modelConfig||t.modelConfig.sortingConfig||!(!((r=e?.modelConfig)===null||r===void 0)&&r.dataSources))return;const a=i.templateValuesMapping.startColumn,s=t.modelConfig.path,u=e.modelConfig.dataSources[s],p=(n=(((o=u?.config)===null||o===void 0?void 0:o.attributes)||{})[this._getDsAttributeName(a,s)])===null||n===void 0?void 0:n.path;t.modelConfig.sortingConfig={attributeName:"ItemsSorting",default:[{columnName:p,direction:"asc"}]}}crtOnMetaDataInit(e){const t=e,i=this._getViewConfigs(t,"crt.Calendar"),r=this._getViewConfigs(t,"crt.QuickFilter");return i.forEach(o=>{this._setFilterAttribute(t,r,o),this._setCrudEventsBindings(o),this._setShowWeekendsAttribute(o),this._setLoadNextPageOptions(t,o)}),Promise.resolve(e)}}ht.\u0275fac=function(e){return new(e||ht)},ht.\u0275prov=l.Yz7({token:ht,factory:ht.\u0275fac});class Ht{constructor(e){this.translateService=e,this.translatePrefix="CommunicationOptions"}translate(e){return this.translateService.instant(`${this.translatePrefix}.${e}`)}}var Ii=_(26903),Ji=_(5998),Ki=_(83331);class Ce extends Ht{constructor(e,t,i,r,o){super(e),this.translateService=e,this._queryExecutor=t,this._domSanitizer=i,this._matIconRegistry=r,this._rightsService=o,this._addCommunicationOptionsRequestName="crt.AddCommunicationOptionsRequest"}_getMenuItemClickRequest(e,t,i,r,o,n){return{request:"crt.CreateCommunicationOptionRequest",params:{componentName:e,indexToInsert:"@event.index",masterRecordColumnName:o,values:{CommunicationType:t,[o]:r,CommunicationTypeName:n,CommunicationTypeDisplayFormat:i}},useRelativeContext:!0}}_getSubMenuItem(e,t,i,r,o,n,a){return{type:"crt.MenuItem",caption:e,clicked:this._getMenuItemClickRequest(t,i,r,o,n,e),...a&&{icon:`${a}`}}}_getMenuItem(e,t){return{type:"crt.MenuItem",caption:t,items:[],...e&&{icon:`${e}`}}}_registerIcon(e){if(!e)return;const t=this._domSanitizer.bypassSecurityTrustResourceUrl(window.location.origin+(0,f.XpF)(e));this._matIconRegistry.addSvgIcon(e,t)}_getAddOptionItems(e,t,i,r){var o=this;return(0,m.Z)(function*(){var n;const a=[],s=yield o.getCommTypes(r),u=[...new Set(s.map(d=>d.typeOrGroupId))];for(const d of u){const p=s.filter(S=>S.typeOrGroupId===d),g=p[0],y=(n=g?.groupIcon)===null||n===void 0?void 0:n.value;if(p.length>1){const S=o._getMenuItem(y,g.groupName);S.items=p.map(P=>o._getSubMenuItemFromType(P,e,t,i)),a.push(S)}else{const S=o._getSubMenuItemFromType(g,e,t,i);a.push(S)}}return a})()}_getSubMenuItemFromType(e,t,i,r){var o,n,a;const s=this._getSubMenuItem(e.displayValue,t,e.value,e.displayFormat,i,r,(o=e.typeIcon)===null||o===void 0?void 0:o.value);return this._registerIcon((n=e?.typeIcon)===null||n===void 0?void 0:n.value),this._registerIcon((a=e?.groupIcon)===null||a===void 0?void 0:a.value),s}_getValidationResult(e,t=""){return{success:e,errorMessage:t}}_validateComponentState(e,t){var i=this;return(0,m.Z)(function*(){const r=i._getValidationResult(!0);if(!e.masterRecordColumnName||!e.masterRecordColumnValue)return i._getValidationResult(!1,i.translate("Validations.IncorrectSetupComponentMessage"));if(e.readonly)return i._getValidationResult(!1,i.translate("Validations.ReadOnlyStateMessage"));const o={isNew:!0,schemaName:t},n=yield(0,C.n)(i._rightsService.getCanEdit(o));return n&&!n.result?i._getValidationResult(!1,n.message):r})()}_applyAddButtonState(e,t,i,r){var o=this;return(0,m.Z)(function*(){const n=yield o._validateComponentState(t,r);if(!n.success){e.forEach(a=>{a.clicked={request:"crt.NotificationRequest",params:{message:n.errorMessage,duration:1e4}},a.clickMode="default",a.menuItems=[]});return}e.forEach(a=>{a.clickMode="menu",a.menuItems=[...i,...a.menuItems||[]]})})()}_selectCommTypesFromDB(e){const t=new b.EntitySchemaQuery("CommunicationType");return t.addMacrosFunctionColumn(b.QueryMacrosType.PrimaryColumn,"typeId"),t.addMacrosFunctionColumn(b.QueryMacrosType.PrimaryDisplayColumn,"typeName"),t.addSchemaColumn("ImageLink","typeIcon"),t.addSchemaColumn("DisplayFormat","displayFormat"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Id","groupId"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Name","groupName"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.ImageLink","groupIcon"),t.filters.addSchemaColumnFilterWithParameter(b.ComparisonType.Not_equal,"[ComTypebyCommunication:CommunicationType:Id].Communication",v.ZOq.SMS),e==="ContactCommunication"&&t.filters.addSchemaColumnFilterWithParameter(b.ComparisonType.Equal,"UseforContacts",!0),e==="AccountCommunication"&&t.filters.addSchemaColumnFilterWithParameter(b.ComparisonType.Equal,"UseforAccounts",!0),this._queryExecutor.executeSelectQuery(t).pipe((0,Ii.B)(),(0,w.U)(i=>i.map(r=>({typeOrGroupId:r.groupId||r.typeId,value:r.typeId,displayValue:r.typeName,groupName:r.groupName,typeIcon:r.typeIcon,groupIcon:r.groupIcon,displayFormat:r.displayFormat}))),(0,Si.K)(i=>(0,M.of)([])))}_getAddCommOptionsButtonsConfigs(e){return f.AXp.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(t=>{var i;return((i=t.viewConfig.clicked)===null||i===void 0?void 0:i.request)===this._addCommunicationOptionsRequestName}).map(t=>t.viewConfig)}getCommTypes(e){return(0,C.n)(this._selectCommTypesFromDB(e))}processAddButton(e,t,i){var r=this;return(0,m.Z)(function*(){var o,n,a;const s=r._getAddCommOptionsButtonsConfigs(t),u=(o=t?.modelConfig)===null||o===void 0?void 0:o.dataSources,d=u&&((a=(n=u[i])===null||n===void 0?void 0:n.config)===null||a===void 0?void 0:a.entitySchemaName)||"",p=yield r._getAddOptionItems(e.name,e.masterRecordColumnValue,e.masterRecordColumnName,d),g=s.filter(y=>{var S,P;return e.name===((P=(S=y.clicked)===null||S===void 0?void 0:S.params)===null||P===void 0?void 0:P.viewElementName)});yield r._applyAddButtonState(g,e,p,d)})()}}Ce.\u0275fac=function(e){return new(e||Ce)(l.LFG($.sK),l.LFG(Xt.oq),l.LFG(Ji.H7),l.LFG(Ki.jv),l.LFG(D._h))},Ce.\u0275prov=l.Yz7({token:Ce,factory:Ce.\u0275fac});class Ae extends Ht{constructor(e){super(e),this.translateService=e}_setSortingConfig(e,t){var i;const r=e.items.slice(1),o=`${r}_Sorting`,n=t.viewModelConfig.attributes;n[o]={isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}};const a=n[r];a.modelConfig={...a.modelConfig,sortingConfig:{...(i=a.modelConfig)===null||i===void 0?void 0:i.sortingConfig,attributeName:o,default:[{columnName:"CreatedOn",direction:"asc"}]}}}_initTypeNameAttribute(e,t){var i;const r=`${t}_CommunicationTypeName`,o=`${t}_Primary`,n=`${t}_NonActual`,a=" \u2022 "+this.translate("Primary"),s=" \u2022 "+this.translate("Invalid"),u=`${r}_Extended`,d=(i=e?.viewModelConfig.attributes)!==null&&i!==void 0?i:{};d[u]={from:[r,o,n],converter:`crt.AppendConditionalParts : '${a}' : '${s}'`}}_prepareAttributes(e,t,i,r){var o,n;(0,h.bjw)(i)&&!(!((n=(o=i.modelConfig)===null||o===void 0?void 0:o.sortingConfig)===null||n===void 0)&&n.attributeName)&&this._setSortingConfig(e,t),this._initTypeNameAttribute(i,r)}processAttributes(e,t,i,r){this._prepareAttributes(e,t,i,r)}}Ae.\u0275fac=function(e){return new(e||Ae)(l.LFG($.sK))},Ae.\u0275prov=l.Yz7({token:Ae,factory:Ae.\u0275fac});class De extends Ht{constructor(e){super(e),this.translateService=e}_getActionClickedRequest(e,t,i){return{request:e,params:{recordId:`$${t}.${i}_Id`,collectionAttributeName:t}}}_getDefaultOptionActions(e,t){const i=`${e}.${t}_Primary`,r=`${e}.${t}_NonActual`,o=this.translate("MarkAsPrimary"),n=this.translate("MarkAsValid"),a=this.translate("MarkAsInvalid"),s=this.translate("DeleteOption");return[{type:"crt.MenuItem",caption:o,icon:"flag-button-icon",visible:`$${i} | crt.NorCondition : $${r}`,clicked:this._getActionClickedRequest("crt.MakeCommunicationOptionPrimaryRequest",e,t)},{type:"crt.MenuItem",caption:`$${r}
					| crt.BooleanToStringValue : '${n}' : '${a}'`,icon:`$${r}
					| crt.BooleanToStringValue : 'valid-circle' : 'invalid-circle'`,clicked:this._getActionClickedRequest("crt.ChangeCommunicationInvalidStateRequest",e,t)},{type:"crt.MenuItem",caption:s,icon:"delete-button-icon",clicked:this._getActionClickedRequest("crt.RemoveCommunicationOptionRequest",e,t)}]}_getOptionActions(e,t,i){const r=this._getDefaultOptionActions(t,i),o=e.optionActions||[];return[...r,...o]}_extendViewConfig(e,t,i){e.primaryColumnName=`${i}_Id`,e.numberColumnName=`${i}_Number`,e.typeColumnName=`${i}_CommunicationType`,e.displayFormatColumnName=`${i}_CommunicationTypeDisplayFormat`,e.optionActions=this._getOptionActions(e,t,i)}_getDefaultOptionConfig(e,t,i){return{label:`$${`${`${e}.${t}_CommunicationTypeName`}_Extended`}`,control:`$${e}.${t}_Number`,labelPosition:i}}_applyReadonlyState(e,t){Object.entries(e).forEach(([,i])=>{t.readonly&&(i.readonly=t.readonly),i.bindTo=`$${(0,f.AJf)(t.name)}`})}_getToolsTemplate(e){return[{type:"crt.Button",icon:"actions-button-icon",iconPosition:"only-icon",color:"default",size:"none",clickMode:"menu",displayType:"text",classes:["actions-btn"],menuItems:e.optionActions}]}_extendWithProperties(e,t){Object.keys(e).forEach(i=>{e[i]={...t,...e[i]}})}_initTemplates(e,t,i){const r=this._getDefaultOptionConfig(t,i,e.labelPosition||"auto"),o=e.templates||{},n=this._getToolsTemplate(e),a={[v.wZb.Email]:{type:"crt.EmailInput"},[v.wZb.Phone]:{type:"crt.PhoneInput",phoneAsLink:!0,displayAsPhone:!1,displayPhoneMask:!1},[v.wZb.Web]:{type:"crt.WebInput"},[v.wZb.Google]:{type:"crt.WebInput",icon:"google-web-icon"},[v.wZb.Facebook]:{type:"crt.WebInput",icon:"facebook-web-icon"},[v.wZb.LinkedIn]:{type:"crt.WebInput",icon:"linkedin-web-icon"},[v.wZb.Twitter]:{type:"crt.WebInput",icon:"twitter-web-icon"},[v.wZb.Skype]:{type:"crt.WebInput",icon:"skype-web-icon"},[v.wZb.Text]:{type:"crt.Input"}};this._extendWithProperties(a,{tools:n});const s={...a,...o};this._extendWithProperties(s,r),this._applyReadonlyState(s,e),e.templates=s}processViewConfig(e,t,i){this._extendViewConfig(e,t,i),this._initTemplates(e,t,i)}}De.\u0275fac=function(e){return new(e||De)(l.LFG($.sK))},De.\u0275prov=l.Yz7({token:De,factory:De.\u0275fac});class Fe{}Fe.\u0275fac=function(e){return new(e||Fe)},Fe.\u0275mod=l.oAB({type:Fe}),Fe.\u0275inj=l.cJS({providers:[Ce,De,Ae]});class vt extends Ht{constructor(e,t,i,r,o){super(t),this._featureService=e,this.translateService=t,this._addButtonService=i,this._viewConfigService=r,this._attributesService=o,this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this.translatePrefix="CommunicationOptions"}get isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_isValidItemsBinding(e,t){var i;return(0,L.zX)(e.items,(i=t.viewModelConfig)===null||i===void 0?void 0:i.attributes)?!0:(console.warn(`The setup property [items] for component [${e.name}] is incorrect.Only binding to the ViewModel collection attribute is allowed for this property.`),!1)}processItem(e,t){var i=this;return(0,m.Z)(function*(){var r,o,n,a;if(i._isValidItemsBinding(e,t)){const s=e.items.split("$")[1],u=(n=(o=(r=t.viewModelConfig)===null||r===void 0?void 0:r.attributes)===null||o===void 0?void 0:o[s])!==null&&n!==void 0?n:{},d=((a=u?.modelConfig)===null||a===void 0?void 0:a.path)||"";i._viewConfigService.processViewConfig(e,s,d),i._attributesService.processAttributes(e,t,u,d),R.addDependencies(t,e,d),yield i._addButtonService.processAddButton(e,t,d)}})()}processItemsAsync(e,t){var i=this;return(0,m.Z)(function*(){const r=e.map(function(){var o=(0,m.Z)(function*(n){yield i.processItem(n.viewConfig,t)});return function(n){return o.apply(this,arguments)}}());yield Promise.all(r)})()}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(yield t.isProcessingDisabled)return e;const i=e,r=f.AXp.getViewConfigInfoByProperty("type","crt.CommunicationOptions",i.viewConfig);return yield t.processItemsAsync(r,i),e})()}}vt.\u0275fac=function(e){return new(e||vt)(l.LFG(D.UZ),l.LFG($.sK),l.LFG(Ce),l.LFG(De),l.LFG(Ae))},vt.\u0275prov=l.Yz7({token:vt,factory:vt.\u0275fac});class _t{constructor(e){this._featureService=e,this._commonCommunicationsBehaviorFeature="CommonCommunicationsBehavior",this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this._replacementConfig={ContactCommunicationOptions:{replaceData:[{type:"crt.EmailInput",label:"Email",labelPosition:"above",control:"$Email",visible:!0,placeholder:"",tooltip:"",name:"Email"},{type:"crt.PhoneInput",label:"Mobile phone",labelPosition:"above",control:"$MobilePhone",visible:!0,placeholder:"",tooltip:"",name:"MobilePhone"}],additionalAttributesConfig:{MobilePhone:{modelConfig:{path:"PDS.MobilePhone"}},Email:{modelConfig:{path:"PDS.Email"}}}},AccountCommunicationOptions:{replaceData:[{type:"crt.WebInput",label:"Web",labelPosition:"above",control:"$Web",visible:!0,placeholder:"",tooltip:"",name:"Web"},{type:"crt.PhoneInput",label:"Primary phone",labelPosition:"above",control:"$Phone",visible:!0,placeholder:"",tooltip:"",name:"Phone"}],additionalAttributesConfig:{Phone:{modelConfig:{path:"PDS.Phone"}},Web:{modelConfig:{path:"PDS.Web"}}}}},this._namesToDelete=[...Object.keys(this._replacementConfig),"ContactCommunicationOptionsAddButton","AccountCommunicationOptionsAddButton"]}get isCommonCommunicationsBehaviorEnabled(){return(0,C.n)(this._featureService.getFeatureState(this._commonCommunicationsBehaviorFeature))}get isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_prepareAttibutesBeforeReplacement(e,t){var i;const r=e?.additionalAttributesConfig||{};for(const[o,n]of Object.entries(r)){const a=Jt(t,(i=n.modelConfig)===null||i===void 0?void 0:i.path);a&&a!==o&&(r[a]=t[a],delete r[o],e.replaceData=[...e.replaceData].map(s=>s.control===`$${o}`?{...s,control:`$${a}`}:s))}Object.assign(t,r)}_replaceCommOptionsWithFields(e){e.viewModelConfig={attributes:{},...e.viewModelConfig},f.AXp.getViewConfigInfoByPropertyForValues("name",this._namesToDelete,e.viewConfig).forEach(i=>{var r;const n=f.AXp.getViewConfigInfoByProperty("name",i.parentName,e.viewConfig)[0].viewConfig,a=i.viewConfig.name,s=n[i.parentPropertyName],u=s.indexOf(i.viewConfig);this._prepareAttibutesBeforeReplacement(this._replacementConfig[i.viewConfig.name],e.viewModelConfig.attributes);const d=((r=this._replacementConfig[a])===null||r===void 0?void 0:r.replaceData)||[];s.splice(u,1,...d)})}_makeOtherCommOptionsComponentsReadonly(e){e.filter(i=>!this._namesToDelete.includes(i.viewConfig.name)).forEach(i=>i.viewConfig.readonly=!0)}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if((yield t.isProcessingDisabled)||(yield t.isCommonCommunicationsBehaviorEnabled))return e;const i=e,r=f.AXp.getViewConfigInfoByProperty("type","crt.CommunicationOptions",i.viewConfig);return t._replaceCommOptionsWithFields(i),t._makeOtherCommOptionsComponentsReadonly(r),e})()}}_t.\u0275fac=function(e){return new(e||_t)(l.LFG(D.UZ))},_t.\u0275prov=l.Yz7({token:_t,factory:_t.\u0275fac});var ne=_(6932);class ae{get isProcessingDisabled(){return(0,C.n)(this.featureService.getFeatureState(this.preprocessingFeature))}constructor(e,t,i,r,o){this.featureService=e,this.metadataModifierService=t,this.comboboxPreprocessorService=i,this.attributeConfigProvider=r,this.translateService=o,this.preprocessingFeature="",this.translatePrefix="",this.viewItemTypes=[],this.profileConfig={},this.editColumns=[],this.viewColumns=[]}_addImageSelectedRequest(e,t){e.imageSelected||this.metadataModifierService.addProperty(e,"imageSelected",{request:"crt.UploadImageRequest",params:{imageAttributeName:t,details:"@event"}})}_addimageClearRequest(e,t){e.imageClear||this.metadataModifierService.addProperty(e,"imageClear",{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:t,attributeValue:null}})}_getDataSourceAttributeByPath(e,t){return t?.find(i=>i.path===e)}_getViewModelAttributeByDataSourcePath(e,t,i){const r=Object.keys(t).find(n=>{var a,s;const u=(a=t[n])!==null&&a!==void 0?a:{};return(0,h.bjw)(u)&&((s=u?.modelConfig)===null||s===void 0?void 0:s.path)===e}),o=e.split(".");if(!r&&o.length>2){const n=o[0],a=o.slice(1).join("."),s=this._getDataSourceAttributeByPath(a,i?.attributes);return s&&this._getViewModelAttributeByDataSourcePath(`${n}.${s.name}`,t,i)}return r}_createViewModelAttribute(e,t,i){i[e]||(i[e]={modelConfig:{path:t}})}_findOrCreateViewModelAttribute(e,t,i,r){let o=this._getViewModelAttributeByDataSourcePath(e,t,i);if(!o){const n=e.split(".").slice(1).join("");o=`${this.profileConfig.name}_${n}`,this._createViewModelAttribute(o,e,t)}return r&&(t[o].validators={required:{type:"crt.Required"}}),o}_createFormField(e,t){const{columnName:i,propertyName:r,...o}=e;o.name=`${this.profileConfig.name}_${i.replace(".","")}Field`,o.control=this.profileConfig[r];const n=t?.attributes&&this._getDataSourceAttributeByPath(i,t.attributes);return n?(o.label=o.label||n.caption,o.type=o.type||this.attributeConfigProvider.getConfigByType(n.dataValueType).controlType):o.type=o.type||ne.yP.Input,o.readonly||(o.readonly=i.split(".").length>1),o}_getComboBoxFieldDefinitions(e){return(e.dialogItems||[]).filter(i=>i.type===ne.yP.Combobox&&!i.readonly)}_processComboboxes(e,t,i){var r=this;return(0,m.Z)(function*(){const o=r._getComboBoxFieldDefinitions(e);for(const n of o)r.comboboxPreprocessorService.crtOnMetaDataInit(n,t),yield r.comboboxPreprocessorService.crtOnModelInit(n,t,i)})()}_getReferenceColumnPath(e,t,i){var r,o;let s=(((r=t[e].modelConfig)===null||r===void 0?void 0:r.path)||"").split(".");const u=s.shift()||"";if(s.slice(-1)[0]==="Id"&&s.pop(),!s.length)return u;if(s.length===1){const p=s[0];s=(((o=i.findAttributeByName(p))===null||o===void 0?void 0:o.path)||"").split(".")}return s.unshift(u),s.join(".")}_initProfileConfig(e,t,i,r){this.profileConfig={name:e.name},this.viewColumns.forEach(o=>{if(!o.propertyName)return;const n=t+"."+o.columnName,a=o.isRequired&&!e.readonly,s=this._findOrCreateViewModelAttribute(n,i,r,a);this.profileConfig[o.propertyName]=`$${s}`}),this.profileConfig.photo+=this.profileConfig.photo?" | crt.ToImageLink":"",Object.assign(this.profileConfig,e),Object.assign(e,this.profileConfig)}_initDialogItems(e,t){e.dialogItems||(e.dialogItems=[]),e.dialogTitle=this.translateService.instant(this.translatePrefix+".DialogTitle"),this.editColumns.forEach(i=>{const r=this._createFormField(i,t);e.dialogItems.findIndex(n=>n.name===r.name)===-1&&e.dialogItems.push(r)})}addProfileChangeHandlers(e){if(e.photo){const i=e.photo.split("|").map(r=>r.trim())[0].slice(1);this._addImageSelectedRequest(e,i),this._addimageClearRequest(e,i)}}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){var r,o;if(yield i.isProcessingDisabled)return e;const n=e,a=f.AXp.getViewConfigInfoByPropertyForValues("type",i.viewItemTypes,n.viewConfig);for(const s of a){const u=s.viewConfig.referenceColumn||"",d=u.slice(1).split(".").pop()||"",g=e.viewModelConfig.attributes;if((0,L.zX)(u,g)){const y=(r=g[d])!==null&&r!==void 0?r:{};let S="";(0,h.bjw)(y)&&(S=(o=y.modelConfig)===null||o===void 0?void 0:o.path.split(".")[0]);const P=t.find(K=>K.name===S),I=yield(0,C.n)(P.getSchema()),T=i._getReferenceColumnPath(d,g,I);s.viewConfig.readonly=T.split(".").length>1||s.viewConfig.readonly,i._initProfileConfig(s.viewConfig,T,g,I),s.viewConfig.readonly||(i.addProfileChangeHandlers(s.viewConfig),i._initDialogItems(s.viewConfig,I),yield i._processComboboxes(s.viewConfig,g,t))}else s.viewConfig.readonly=!0}return e})()}}ae.\u0275fac=function(e){return new(e||ae)(l.LFG(D.UZ),l.LFG(h.pi2),l.LFG(Z),l.LFG(ne.KR),l.LFG($.sK))},ae.\u0275prov=l.Yz7({token:ae,factory:ae.\u0275fac});class Ne extends ae{constructor(){super(...arguments),this.preprocessingFeature="DisableAccountCompactProfilePreprocessing",this.translatePrefix="AccountCompactProfile",this.viewItemTypes=["crt.AccountCompactProfile"],this.editColumns=[{columnName:"Name",propertyName:"accountName"},{columnName:"AlternativeName",propertyName:"alternativeName",label:this.translateService.instant(this.translatePrefix+".AlternativeNameFieldLabel")}],this.viewColumns=[...this.editColumns,{columnName:"Country",propertyName:"country"},{columnName:"City",propertyName:"city"},{columnName:"AccountLogo",propertyName:"photo"},{columnName:"City.TimeZone",propertyName:"timeZone"}]}}Ne.\u0275fac=function(){let c;return function(t){return(c||(c=l.n5z(Ne)))(t||Ne)}}(),Ne.\u0275prov=l.Yz7({token:Ne,factory:Ne.\u0275fac});class Pe extends ae{constructor(){super(...arguments),this.preprocessingFeature="DisableContactCompactProfilePreprocessing",this.translatePrefix="ContactCompactProfile",this.viewItemTypes=["crt.ContactCompactProfile"],this.editColumns=[{columnName:"GivenName",propertyName:"firstName",isRequired:!0},{columnName:"Surname",propertyName:"lastName"},{columnName:"MiddleName",propertyName:"middleName"},{columnName:"BirthDate",propertyName:"birthDate",pickerType:"date"}],this.viewColumns=[...this.editColumns,{columnName:"Country",propertyName:"country"},{columnName:"City",propertyName:"city"},{columnName:"Photo",propertyName:"photo"},{columnName:"City.TimeZone",propertyName:"timeZone"},{columnName:"Name",propertyName:"displayName"}]}_addChangeHandler(e,t,i){if(e[t]&&!e[i]){const r=e[t];this.metadataModifierService.addProperty(e,i,{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:r.slice(1),attributeValue:"@event"}})}}addProfileChangeHandlers(e){super.addProfileChangeHandlers(e),this._addChangeHandler(e,"displayName","fullNameChange"),this._addChangeHandler(e,"firstName","firstNameChange"),this._addChangeHandler(e,"lastName","lastNameChange"),this._addChangeHandler(e,"middleName","middleNameChange")}}Pe.\u0275fac=function(){let c;return function(t){return(c||(c=l.n5z(Pe)))(t||Pe)}}(),Pe.\u0275prov=l.Yz7({token:Pe,factory:Pe.\u0275fac});class Ie extends ae{constructor(){super(...arguments),this.preprocessingFeature="DisableUserCompactProfilePreprocessing",this.translatePrefix="UserCompactProfile",this.viewItemTypes=["crt.UserCompactProfile"],this.editColumns=[{columnName:"FirstName",propertyName:"firstName",isRequired:!0},{columnName:"MiddleName",propertyName:"middleName"},{columnName:"LastName",propertyName:"lastName"}],this.viewColumns=[...this.editColumns,{columnName:"Photo",propertyName:"photo"}]}}Ie.\u0275fac=function(){let c;return function(t){return(c||(c=l.n5z(Ie)))(t||Ie)}}(),Ie.\u0275prov=l.Yz7({token:Ie,factory:Ie.\u0275fac});class yt{_modifyInputType(e,t,i){var r,o;const n=e.control.replace("$",""),a=(o=(r=t.attributes[n])===null||r===void 0?void 0:r.modelConfig)===null||o===void 0?void 0:o.path;if(a){const s=this._getDataSchemaAttributeByPath(a,i);b.DataValueType.EMAIL_TEXT&&s?.dataValueType===b.DataValueType.EMAIL_TEXT&&(e.type="crt.EmailInput",e.isFormatValidated=s.isFormatValidated)}}_getDataSchemaAttributeByPath(e,t){var i;const[r,o]=e.split("."),n=(i=t.dataSchemas[r])===null||i===void 0?void 0:i.attributes;let a;for(const s in n)if(n[s].path===o){a=n[s];break}return a}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){const o=e,n=f.AXp.getViewConfigInfoByProperty("type","crt.Input",o.viewConfig),a=f.AXp.getViewConfigInfoByProperty("type","crt.EmailInput",o.viewConfig);return n.forEach(s=>{r._modifyInputType(s.viewConfig,o.viewModelConfig,i)}),a.forEach(s=>{r._modifyInputType(s.viewConfig,o.viewModelConfig,i)}),e})()}}yt.\u0275fac=function(e){return new(e||yt)},yt.\u0275prov=l.Yz7({token:yt,factory:yt.\u0275fac});class bt{get isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState("DisableEntityStageProgressBarPreprocessing"))}constructor(e,t,i,r){this._featureService=e,this._dcmSettingsService=t,this._dcmSchemaManagerService=i,this._configurationDataService=r,this._componentName="crt.EntityStageProgressBar",this._stagesAttributeSuffix="_StagesList",this._stageConnectionsAttributeSuffix="_StageConnections",this._allowedStagesAttributeSuffix="_AllowedStages",this._valueAttributeSuffix="_CurrentStage",this._stageFilteredByAttributePrefix="_StageFilteredBy",this._stageRunningProcessUIdAttributePrefix="_RunningProcessUId",this._entityStageSchemasAttributePrefix="_EntityStageSchemas",this._isAppropriateEntityStageSchemaAttributePrefix="_IsAppropriateEntityStageSchema",this._currentStageAttributeName="",this._filteredByValueAttributeName="",this._primaryDataSourceName=""}_getComponents(e){return f.AXp.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getComponentName(e){return e.name.replace(/\./g,"_")}_getStageColumnName(e){return(0,C.n)(this._dcmSettingsService.getStageColumnName(e),{defaultValue:null})}_getEntityStagesSchemas(e){return(0,C.n)(this._dcmSchemaManagerService.getDcmSchemaDataCollection().pipe((0,w.U)(t=>t.filter(i=>i.entitySchemaUId===e))))}_getEntitySchemaUid(e){return(0,C.n)(this._configurationDataService.getEntityUId(e).pipe((0,w.U)(t=>{var i,r;return(r=(i=t?.data)===null||i===void 0?void 0:i.entityUIds)===null||r===void 0?void 0:r.filter(o=>o.entitySchemaName===e)[0].entitySchemaUId})))}_findAttributeKeyByPath(e,t){let i=null;return Object.keys(e).forEach(r=>{var o;const n=e[r];((o=n?.modelConfig)===null||o===void 0?void 0:o.path)===t&&(i=r)}),i}_loadEntityStageSchemas(e,t){var i=this;return(0,m.Z)(function*(){var r;const o=yield i._getEntitySchemaUid(t.viewConfig.entityName),n=yield i._getEntityStagesSchemas(o);if(n&&n.filter(a=>a.isActive&&a.isActiveVersion)){const a=i._getComponentName(t?.viewConfig);e[`${a}${i._entityStageSchemasAttributePrefix}`]={value:n};const s=(r=n.find(S=>S.filters))===null||r===void 0?void 0:r.filters;if(!s)return;const u=JSON.parse(s),p=Object.values(u.items)[0].leftExpression.columnPath,g=`${i._primaryDataSourceName}.${p}`,y=i._findAttributeKeyByPath(e,g);y&&(i._filteredByValueAttributeName=y),i._filteredByValueAttributeName||(i._filteredByValueAttributeName=`${a}${i._stageFilteredByAttributePrefix}`,e[i._filteredByValueAttributeName]={modelConfig:{path:g}})}})()}_setupCurrentValueAttribute(e,t){var i=this;return(0,m.Z)(function*(){const r=t?.viewConfig,o=i._getComponentName(r),n=yield i._getStageColumnName(r.entityName);if(!n)return;const a=`${i._primaryDataSourceName}.${n}`,s=i._findAttributeKeyByPath(e,a);s&&(i._currentStageAttributeName=s),i._currentStageAttributeName||(i._currentStageAttributeName=`${o}${i._valueAttributeSuffix}`,e[i._currentStageAttributeName]={modelConfig:{path:a}})})()}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){if(yield i.isProcessingDisabled)return e;const r=e;i._primaryDataSourceName=(0,N.kC)(r);const o=i._getComponents(r);for(const n of o){i._filteredByValueAttributeName="",i._currentStageAttributeName="";const a=n?.viewConfig,s=i._getComponentName(a);let u=r.viewModelConfig.attributes;u||(u=r.viewModelConfig.attributes={}),u[`${s}${i._entityStageSchemasAttributePrefix}`]={value:null},yield i._setupCurrentValueAttribute(u,n),yield i._loadEntityStageSchemas(u,n),u[`${s}${i._stagesAttributeSuffix}`]={value:null},u[`${s}${i._stageConnectionsAttributeSuffix}`]={value:null},u[`${s}${i._allowedStagesAttributeSuffix}`]={value:null},u[`${s}${i._stageRunningProcessUIdAttributePrefix}`]={value:null},u[`${s}${i._isAppropriateEntityStageSchemaAttributePrefix}`]={value:!0}}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){if(yield r.isProcessingDisabled)return e;const o=e,n=r._getComponents(o);for(const a of n){const s=a?.viewConfig,u=r._getComponentName(s),d=`${u}${r._stagesAttributeSuffix}`,p=`${u}${r._stageConnectionsAttributeSuffix}`,g=`${u}${r._allowedStagesAttributeSuffix}`,y=`${u}${r._stageRunningProcessUIdAttributePrefix}`,S=`${u}${r._entityStageSchemasAttributePrefix}`,P=`${u}${r._isAppropriateEntityStageSchemaAttributePrefix}`,I=r._filteredByValueAttributeName?`$${r._filteredByValueAttributeName}`:"";s.recordId="$Id",s.stages=`$${d}`,s.stageConnections=`$${p}`,s.allowedStages=`$${g}`,s.stageSchemaFilterByValue=I,s.value=`$${r._currentStageAttributeName}`,s.isAppropriateEntityStageSchema=`$${P}`,s.stageRunningProcessUId=`$${y}`,s.stageChanged={request:"crt.EntityStageProgressBarStageChangedHandlerRequest",params:{stageAttribute:r._currentStageAttributeName,stagesAttribute:d,config:"@event"}},s.loadData={request:"crt.EntityStageProgressBarLoadDataHandlerRequest",params:{stagesAttribute:d,stageConnectionsAttribute:p,allowedStagesAttribute:g,stageRunningProcessUIdAttribute:y,stageSchemaFilterByValue:I,config:"@event"}},s.checkIsAnAppropriateProcessSchema={request:"crt.EntityStageProcessAppropriateCheckHandlerRequest",params:{entityStageSchemas:`$${S}`,stageRunningProcessUId:`$${y}`,filterColumnValue:I,isAppropriateEntityStageSchemaAttribute:P,config:"@event"}},s.changeToAppropriateEntityStageSchema={request:"crt.EntityStageProgressBarChangeStageProcessHandlerRequest",params:{entityName:a?.viewConfig.entityName,entityId:"$Id",currentStage:`$${r._currentStageAttributeName}`,stageRunningProcessUIdAttribute:y,isAppropriateEntityStageSchemaAttribute:P,loadDataRequest:s.loadData}}}return e})()}}bt.\u0275fac=function(e){return new(e||bt)(l.LFG(D.UZ),l.LFG(ie),l.LFG(D.RC),l.LFG(D.iD))},bt.\u0275prov=l.Yz7({token:bt,factory:bt.\u0275fac});var x=_(80542);const er=32,tr=81;class Te{_getDataGridViewConfigs(e){return f.AXp.getViewConfigInfoByProperty("type","crt.DataGrid",e?.items)}_setDataGridMaxHeight(e){var t;if(!(!((t=e.layoutConfig)===null||t===void 0)&&t.rowSpan))return;const r=e.layoutConfig.rowSpan*er,o=Math.max(r,tr);e.layoutConfig.rowSpan=1,e.styles=(0,zt.Z)(e.styles,{["max-height"]:`${o}px`})}_replaceLegacyGridContainerRowsConfig(e){var t,i;const r=f.AXp.getViewConfigInfoByProperty("type","crt.GridContainer",e).shift();((i=(t=r?.viewConfig)===null||t===void 0?void 0:t.rows)===null||i===void 0?void 0:i.replace(/\s/g,""))==="minmax(32px,32px)"&&(r.viewConfig.rows="minmax(max-content, 32px)")}setDataGridMaxHeight(e){const t=this._getDataGridViewConfigs(e);t.forEach(i=>{this._setDataGridMaxHeight(i.viewConfig)}),t.length&&this._replaceLegacyGridContainerRowsConfig(e?.items)}}Te.\u0275fac=function(e){return new(e||Te)},Te.\u0275prov=l.Yz7({token:Te,factory:Te.\u0275fac});class St{constructor(e,t,i){this._featureService=e,this._expandedListLayoutService=t,this._profileAttributeService=i,this._expPanelActionsProcessingDisableFeature="DisableExpansionPanelPreprocessing"}_filterItemsByGridType(e){var t;if(!e.items||e.items.length===0)return;const i=(t=e?.tools)!==null&&t!==void 0?t:[],r=e.items.filter(o=>o.gridContainerType===v.$df.TOOLS);i?.length===0&&r?.length>0&&(e.items=e.items.filter(o=>o.gridContainerType!==v.$df.TOOLS),e.tools=r)}_processPaddings(e){e.padding||(e.padding={top:x.mOF.Small,bottom:x.mOF.Small,left:x.mOF.Medium,right:x.mOF.Medium})}get _isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._expPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(yield t._isProcessingDisabled)return e;const i=e;return f.AXp.getViewConfigInfoByProperty("type","crt.ExpansionPanel",i.viewConfig).forEach(function(){var o=(0,m.Z)(function*(n){t._expandedListLayoutService.setDataGridMaxHeight(n.viewConfig),t._filterItemsByGridType(n.viewConfig),t._processPaddings(n.viewConfig),yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,n.viewConfig,"expanded","","DisableSaveToProfileExpPanelExpanded")});return function(n){return o.apply(this,arguments)}}()),e})()}}St.\u0275fac=function(e){return new(e||St)(l.LFG(D.UZ),l.LFG(Te),l.LFG(z))},St.\u0275prov=l.Yz7({token:St,factory:St.\u0275fac});class Ct{_getFeedViewConfigs(e){return f.AXp.getViewConfigInfoByProperty("type","crt.Feed",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_setValueAttribute(e,t){t.feedType!==v.dTA.Record||this._validateRecordFeedConfig(e,t)||!(0,N.kC)(e)||(t.primaryColumnValue=`$${this._getOrAddAttribute(e,t)}`,t.entitySchemaName=this._getEntitySchemaName(e))}_validateRecordFeedConfig(e,t){var i;const r=e.viewModelConfig.attributes,o=(i=t.primaryColumnValue)===null||i===void 0?void 0:i.split("$")[1],n=r[o];return!(0,B.Z)(t.entitySchemaName)&&!!n}_getOrAddAttribute(e,t){return this._findAttribute(e,t)||this._createAttribute(e,t)}_findAttribute(e,t){const r=`${(0,N.kC)(e)}.Id`,o="#PrimaryDataSourceName()#.Id",n=e.viewModelConfig.attributes,a=Object.keys(n).find(u=>{var d,p;const y=(p=((d=n[u])!==null&&d!==void 0?d:{}).modelConfig)===null||p===void 0?void 0:p.path;return y===r||y===o});if(!(0,B.Z)(a))return a;const s=`${t.name}_RecordId`;return s in n?s:void 0}_createAttribute(e,t){const i=(0,N.kC)(e),r=e.viewModelConfig.attributes,o=`${t.name}_RecordId`;return r[o]={modelConfig:{path:`${i}.Id`}},o}_getEntitySchemaName(e){var t,i;const r=(0,N.kC)(e),n=(((t=e.modelConfig)===null||t===void 0?void 0:t.dataSources)||{})[r];return(i=n?.config)===null||i===void 0?void 0:i.entitySchemaName}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){const i=e;return t._getFeedViewConfigs(i).forEach(o=>{t._setValueAttribute(i,o)}),Promise.resolve(e)})()}}Ct.\u0275fac=function(e){return new(e||Ct)},Ct.\u0275prov=l.Yz7({token:Ct,factory:Ct.\u0275fac});class At{get isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._fileInputPreprocessingDisableFeature))}constructor(e){this._featureService=e,this._fileInputPreprocessingDisableFeature="DisableFileInputPreprocessing"}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(yield t.isProcessingDisabled)return e;const i=e;return f.AXp.getViewConfigInfoByProperty("type","crt.FileInput",i.viewConfig).forEach(o=>{if(!o.viewConfig.upload){const a=o.viewConfig.control.slice(1);o.viewConfig.upload={request:"crt.UploadDataAttributeFileRequest",params:{fileAttributeName:a,detail:"@event.detail"}}}o.viewConfig.download||(o.viewConfig.download={request:"crt.DownloadEntityFileRequest",params:{detail:"@event.detail"}})}),e})()}}At.\u0275fac=function(e){return new(e||At)(l.LFG(D.UZ))},At.\u0275prov=l.Yz7({token:At,factory:At.\u0275fac});class Me extends Kt{constructor(){super(...arguments),this.viewItemTypes=["crt.FileList"]}setRowToolbarMenuItems(e,t){return(0,m.Z)(function*(){const i=e.items.slice(1),r=t.getBoundDataSourceNameByAttributePath(i);e.rowToolbarItems=[{type:"crt.MenuItem",caption:"DataGrid.RowToolbar.Delete",icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${r}_Id`},useRelativeContext:!1}}]})()}}Me.\u0275fac=function(){let c;return function(t){return(c||(c=l.n5z(Me)))(t||Me)}}(),Me.\u0275prov=l.Yz7({token:Me,factory:Me.\u0275fac});class Dt extends oe{constructor(e,t,i,r){super(e,t,i),this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=i,this._cellViewConfigCreatorFactory=r,this._predefinedColumns={},this.viewItemTypes=["crt.FileList"]}_setPredefinedColumnDefinitions(e){for(const t of e){const i=t.viewConfig.name,r=t.viewConfig.columns,o=[];for(const n of r)n.cellView&&o.push(n.code);this._predefinedColumns[i]=o}}_processFileListColumnDefinitions(e,t,i){var r=this;return(0,m.Z)(function*(){var o;const{dataSourceName:n,dataSchema:a,itemsAttributeName:s,viewModel:u}=t,{primaryAttributeName:d,primaryDisplayAttributeName:p}=a??{},g=a.name,y=d&&`${n}_${d}`;for(const S of i){const P=a.attributes.find(Ir=>(0,f._fv)(`${n}_${Ir.name}`)===S.code);if(!P)continue;const I=P.name,T={columnName:I,dataValueType:P.dataValueType,primaryDisplayAttributeName:p},K={column:S,context:u,itemsAttributeName:s,primaryAttributeName:y,dataSchemaName:g,columnName:I},Ge=r._cellViewConfigCreatorFactory.create(T),xi=yield Ge?.getViewElementConfig(K);xi&&!(!((o=r._predefinedColumns[e])===null||o===void 0)&&o.includes(S.code))&&r.metadataModifierService.addProperty(S,"cellView",xi)}})()}crtOnViewModelInit(e,t,i){var r=()=>super.crtOnViewModelInit,o=this;return(0,m.Z)(function*(){if(yield(0,C.n)(o.featureService.getFeatureState(o.featureName),{defaultValue:null}))return e;const a=f.AXp.getViewConfigInfoByPropertyForValues("type",o.viewItemTypes,e.viewConfig);o._setPredefinedColumnDefinitions(a),e=yield r().call(o,e,t,i);for(const s of a){const u=s.viewConfig.columns,d=s.viewConfig.name,p=yield o.getGenerateCellViewConfig(s.viewConfig,i);p&&(yield o._processFileListColumnDefinitions(d,p,u))}return e})()}}Dt.\u0275fac=function(e){return new(e||Dt)(l.LFG(D.UZ),l.LFG(h.pi2),l.LFG(F.bL),l.LFG(F.ec))},Dt.\u0275prov=l.Yz7({token:Dt,factory:Dt.\u0275fac});class se{get order(){return this.index||0}constructor(e){this.featureService=e,this.componentTypes=[]}getComponentsToProcess(e){return f.AXp.getViewConfigInfoByPropertyForValues("type",this.componentTypes,e.viewConfig)}process(e,t){var i=this;return(0,m.Z)(function*(){const r=i.getComponentsToProcess(e);return yield i.innerProcess(r,e,t)})()}}se.\u0275fac=function(e){return new(e||se)(l.LFG(D.UZ))},se.\u0275prov=l.Yz7({token:se,factory:se.\u0275fac});class we extends se{constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=2,this.defaultFilesEntitySchemaName="SysFile",this._galleryColumnNames=["Name","CreatedOn","Size"]}_addDataSourceAttributes(e,t){let i=e[t];i||(i=R.createDataSourceConfig(this.defaultFilesEntitySchemaName),e[t]=i);const r=i.config||{attributes:{}};r.attributes=r.attributes||{},this._galleryColumnNames.forEach(o=>{r?.attributes[o]||(r.attributes[o]={path:o})}),i.config=r}_addViewModelAttributes(e,t,i){var r;if(!e?.attributes)return;const o=e.attributes[t],n=(r=o?.viewModelConfig)===null||r===void 0?void 0:r.attributes;!n||this._galleryColumnNames.forEach(a=>{const s=`${i}_${a}`;n[s]||(n[s]={modelConfig:{path:`${i}.${a}`}})})}_applyGalleryConfig(e,t){t.viewConfig.galleryItemConfig||(t.viewConfig.galleryItemConfig={templateValuesMapping:{fileId:`${e}_Id`,fileName:`${e}_Name`,fileCreatedOn:`${e}_CreatedOn`,fileSize:`${e}_Size`}}),t.viewConfig.galleryItemConfig.defaultSize=t.viewConfig.tileSize||x.mOF.Medium}_getAttributeDSName(e){return`${e}${h.gWy}`}innerProcess(e,t,i){var r=this;return(0,m.Z)(function*(){return e.forEach(o=>{var n;const a=o.viewConfig.items;if(typeof a!="string")return;const s=a.split("$")[1];if(!s)return;const u=r._getAttributeDSName(s);r._addDataSourceAttributes(((n=t.modelConfig)===null||n===void 0?void 0:n.dataSources)||{},u),r._addViewModelAttributes(t.viewModelConfig,s,u),r._applyGalleryConfig(u,o)}),yield Promise.resolve(t)})()}}we.\u0275fac=function(){let c;return function(t){return(c||(c=l.n5z(we)))(t||we)}}(),we.\u0275prov=l.Yz7({token:we,factory:we.\u0275fac});class Re extends se{constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=1,this.defaultPrimaryColumnName="Id",this.defaultFilesEntitySchemaName="SysFile",this.defaultRecordColumnName="RecordId",this._fileDropDisableFeature="DisableFileListDropPreprocessing"}_getAdditionalFilterName(e){return`${e}_PredefinedFilter`}_createViewModelAttribute(e){return{isCollection:!0,modelConfig:{path:e},viewModelConfig:{attributes:{}}}}_getUploadFileRequest(e){return{request:"crt.UploadFileRequest",params:{viewElementName:e}}}_setFileListDropZoneParameters(e,t){t&&(e.viewConfig.droppable=!1,e.viewConfig.fileDropped=void 0),e.viewConfig.droppable!==!1&&(e.viewConfig.droppable=!0,e.viewConfig.fileDropped||(e.viewConfig.fileDropped=this._getUploadFileRequest(e.viewConfig.name)))}_setFileListUploadButtonParameters(e){e.viewConfig.uploadClicked||(e.viewConfig.uploadClicked=this._getUploadFileRequest(e.viewConfig.name))}_tryAddFileListProperties(e){if(e.viewConfig.items||(e.viewConfig.items=`$${e.viewConfig.name}`),!e.viewConfig.primaryColumnName){const t=e.viewConfig.name,r=`${R.getAttributeDSName(t)}_${this.defaultPrimaryColumnName}`;e.viewConfig.primaryColumnName=r}}_linkFilterToAttribute(e,t){if(e=e??{},!(0,h.bjw)(e)||!e.modelConfig)return;const i=e.modelConfig.filterAttributes||[];i.find(r=>r.name===t)||i.push({loadOnChange:!0,name:t}),e.modelConfig.filterAttributes=i}tryAddAttributeAndDataSource(e,t,i){var r=this;return(0,m.Z)(function*(){var o,n;const a=i.viewConfig.items;if(typeof a!="string")return;const s=a.split("$")[1];if(!s)return;const u=R.getAttributeDSName(s),d=r._getAdditionalFilterName(s);e.modelConfig||(e.modelConfig={});const p=e.modelConfig.dataSources||{},g=e.viewModelConfig.attributes||{};if(p[u]||(p[u]=R.createDataSourceConfig(r.defaultFilesEntitySchemaName),e.modelConfig.dataSources=p),R.addDependencies(e,i.viewConfig,u),g[s]||(g[s]=r._createViewModelAttribute(u),e.viewModelConfig.attributes=g),!g[d]){const y=i.viewConfig.fileGroups,S=i.viewConfig.tag||"",P=(o=p[u].config)===null||o===void 0?void 0:o.entitySchemaName,I=yield R.getRecordEntitySchemaName(i.viewConfig.items,(n=i.viewConfig)===null||n===void 0?void 0:n.masterRecordColumnValue,e,t),T=Ui(y,S,P,I);T&&(g[d]=T,r._linkFilterToAttribute(g[s],d),e.viewModelConfig.attributes=g)}})()}innerProcess(e,t,i){var r=this;return(0,m.Z)(function*(){const o=r.featureService.getFeatureState(r._fileDropDisableFeature),n=yield(0,C.n)(o);return e.forEach(function(){var a=(0,m.Z)(function*(s){r._tryAddFileListProperties(s),r._setFileListDropZoneParameters(s,n),r._setFileListUploadButtonParameters(s),yield r.tryAddAttributeAndDataSource(t,i,s)});return function(s){return a.apply(this,arguments)}}()),t})()}}Re.\u0275fac=function(){let c;return function(t){return(c||(c=l.n5z(Re)))(t||Re)}}(),Re.\u0275prov=l.Yz7({token:Re,factory:Re.\u0275fac});const Yt=new l.OlP("FILE_UPLOAD_METADATA_WORKER");class Ft{constructor(e){this._workers=e??[]}run(e,t){var i=this;return(0,m.Z)(function*(){const r=[...i._workers].sort((o,n)=>o.order-n.order);for(const o of r)yield o.process(e,t)})()}}Ft.\u0275fac=function(e){return new(e||Ft)(l.LFG(Yt,8))},Ft.\u0275prov=l.Yz7({token:Ft,factory:Ft.\u0275fac,providedIn:"root"});class Ee extends se{constructor(){super(...arguments),this.index=3,this._uploadFileRequestName="crt.UploadFileRequest",this._defaultFilesEntitySchemaName="SysFile",this._defaultRecordColumnName="RecordId"}_getUploadFileRequestConfigs(e){return f.AXp.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(t=>{var i;return((i=t.viewConfig.clicked)===null||i===void 0?void 0:i.request)===this._uploadFileRequestName}).map(t=>t.viewConfig.clicked)}_getFileLists(e){return f.AXp.getViewConfigInfoByProperty("type","crt.FileList",e.viewConfig)}_getFileDropRequestConfigs(e){const t=this._getFileLists(e);return t.filter(i=>{var r;return((r=i.viewConfig.fileDropped)===null||r===void 0?void 0:r.request)===this._uploadFileRequestName}).map(i=>i.viewConfig.fileDropped).concat(t.filter(i=>{var r;return((r=i.viewConfig.uploadClicked)===null||r===void 0?void 0:r.request)===this._uploadFileRequestName}).map(i=>i.viewConfig.uploadClicked))}getFilesEntitySchemaName(e,t,i){const r=R.getDataSourceNameByAttribute(e);return r?R.getDataSchemaName({models:i,schema:t,dataSourceName:r}):Promise.resolve(null)}setRequestParam(e,t,i){!e[t]&&i&&(e[t]=i)}getBaseRequestParams(){return{fileGroup:h.jf2.Attachments,tag:"",files:"@event.files"}}getDefaultRequestParams(e){const t=R.getDataSourcePrimaryAttribute(e);return{...this.getBaseRequestParams(),recordId:`$${t}`,fileEntitySchemaName:this._defaultFilesEntitySchemaName,recordColumnName:this._defaultRecordColumnName}}getRequestParams(e,t,i){var r=this;return(0,m.Z)(function*(){const o=r.getBaseRequestParams(),n=e.items,a=(yield r.getFilesEntitySchemaName(n,t,i))||r._defaultFilesEntitySchemaName,s=e?.masterRecordColumnValue,u=yield R.getRecordEntitySchemaName(n,s,t,i);return{...o,fileGroup:e?.fileGroups&&e.fileGroups[0],tag:e?.tag,recordId:s,itemsAttributeName:e.name,fileEntitySchemaName:a,recordEntitySchemaName:u,recordColumnName:e.recordColumnName||r._defaultRecordColumnName}})()}_setRequestParams(e,t){for(const i in t)t[i]&&this.setRequestParam(e.params,i,t[i])}_extendRequestParams(e,t,i,r){var o=this;return(0,m.Z)(function*(){e.params=e.params||{};const n=t.find(s=>s.viewConfig.name===e.params.viewElementName),a=n?yield o.getRequestParams(n.viewConfig,i,r):o.getDefaultRequestParams(i);o._setRequestParams(e,a)})()}getComponentsToProcess(e){return[...this._getUploadFileRequestConfigs(e),...this._getFileDropRequestConfigs(e)]}innerProcess(e,t,i){var r=this;return(0,m.Z)(function*(){const o=r._getFileLists(t);for(const n of e)yield r._extendRequestParams(n,o,t,i);return t})()}}Ee.\u0275fac=function(){let c;return function(t){return(c||(c=l.n5z(Ee)))(t||Ee)}}(),Ee.\u0275prov=l.Yz7({token:Ee,factory:Ee.\u0275fac});class le{}le.\u0275fac=function(e){return new(e||le)},le.\u0275mod=l.oAB({type:le}),le.\u0275inj=l.cJS({providers:[{provide:Yt,useClass:we,multi:!0},{provide:Yt,useClass:Re,multi:!0},{provide:Yt,useClass:Ee,multi:!0}],imports:[W.ez]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.kYT(le,{imports:[W.ez]})}();class Nt{get isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._fileListPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._workersService=t,this._fileListPreprocessingDisableFeature="DisableFileListPreprocessing"}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){if(yield i.isProcessingDisabled)return e;const r=e;return yield i._workersService.run(r,t),e})()}}Nt.\u0275fac=function(e){return new(e||Nt)(l.LFG(D.UZ),l.LFG(Ft))},Nt.\u0275prov=l.Yz7({token:Nt,factory:Nt.\u0275fac});const Mr={fileLists:{A:"FileListA",B:"FileListB",C:"FileListC",D:"FileListD",E:"FileListE",F:"FileListF",G:"FileListG",H:"FileListH",I:"FileListI",WithDeepMasterRecordColumn:"FileListWithDeepMasterRecordColumn",WithAttributeWoPath:"FileListWithAttributeWoPath",WithUploadButton:"FileListWithCustomUploadButton",WoMasterRecordColumn:"FileListWoMasterRecordColumn",WoRecordSchemaName:"FileListWoRecordSchemaName",WithRecordSchemaName:"FileListWithRecordSchemaName",WoDropZone:"FileListWoDropZone"},recordColumnNameA:"ColumnA",testFileEntity:"TestFile",testEntityName:"TestEntity",testTag:"TestTag"};function wr(){return{viewConfig:[{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.WithUploadButton,uploadClicked:{request:"crt.UploadFileRequest",params:{viewElementName:"custom"}}},{type:"crt.FileList",droppable:!1,name:TEST_SCHEMA_DATA.fileLists.WoDropZone},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerId",recordColumnName:TEST_SCHEMA_DATA.recordColumnNameA,primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.A,tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListRecordSchemaName",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName},{type:"crt.FileList",items:"$FileListE",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.E,fileGroups:[FileGroupEnum.Attachments]},{type:"crt.FileList",items:"$FileListF",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.F,fileGroups:[FileGroupEnum.Attachments],tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListG",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.G},{type:"crt.FileList",items:TEST_SCHEMA_DATA.fileLists.H,masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.H},{type:"crt.FileList",items:"$FileListI",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.I},{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.B,droppable:!0}],name:"InnerContainer"},{type:"crt.Button",name:"ButtonA",clicked:{request:"crt.UploadFileRequest",params:{maximumAllowedFileSize:null,allowedFileTypes:"",viewElementName:TEST_SCHEMA_DATA.fileLists.A}}},{type:"crt.Button",name:"ButtonB",clicked:{request:"crt.UploadFileRequest",params:{}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName}}},{type:"crt.Button",name:"ButtonC",menuItems:[{type:"crt.MenuItem",name:"MenuItemA",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.B}}},{type:"crt.MenuItem",name:"MenuItemB",clicked:{request:"crt.UpdateRecordRequest",params:{}}},{type:"crt.MenuItem",name:"MenuItemC"}]},{type:"crt.Button",name:"ButtonD",clicked:"$onClick"},{type:"crt.Button",name:"ButtonE"},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountId",name:TEST_SCHEMA_DATA.fileLists.C,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoColumn",name:TEST_SCHEMA_DATA.fileLists.D,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoPath",name:TEST_SCHEMA_DATA.fileLists.WithAttributeWoPath},{type:"crt.FileList",masterRecordColumnValue:"not a master record attribute",name:TEST_SCHEMA_DATA.fileLists.WoMasterRecordColumn},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn,recordColumnName:"RecordId"},{type:"crt.Button",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn}}}],name:"MainContainer"}],viewModelConfig:{attributes:{OwnerId:{modelConfig:{path:"PDS.Id"}},OwnerAccountId:{modelConfig:{path:"PDS.OwnerAccountId"}},FileListA:{isCollection:!0,modelConfig:{path:"FileListADS",filterAttributes:[{loadOnChange:!0,name:"FileListA_PredefinedFilter"}]},viewModelConfig:{attributes:{FileListADS_Name:{modelConfig:{path:"FileListADS.NamePredefined"}},FileListADS_CreatedOn:{modelConfig:{path:"FileListADS.CreatedOnPredefined"}},FileListADS_Size:{modelConfig:{path:"FileListADS.SizePredefined"}}}}},FileListRecordSchemaName:{isCollection:!0,modelConfig:{path:"FileListRecordSchemaNameDS"}},FileListE:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListF:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListG:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListI:{isCollection:!0,modelConfig:null,viewModelConfig:{attributes:{}}},AttributeWoColumn:{modelConfig:{path:"AttributeWoColumn"}},AttributeWoPath:{modelConfig:{path:""}},AttributeWoModelConfig:{modelConfig:void 0},OwnerAccountCreatedBy:{modelConfig:{path:"PDS.OwnerAccountCreatedBy"}}}},modelConfig:{dataSources:{PDS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testEntityName,attributes:{OwnerAccountId:{path:"Owner.Account.Id"},OwnerAccountCreatedBy:{path:"Owner.Account.CreatedBy"}}}},FileListADS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testFileEntity}},FileListRecordSchemaNameDS:{type:"crt.EntityDataSource",config:{entitySchemaName:"ObjectWithoutRecordSchemaName"}}},primaryDataSourceName:"PDS",dependencies:{FileListADS:[{attributePath:"RecordId",relationPath:"PDS.Id"}]}}}}class Pt{constructor(e,t){this._filterViewElementOptionsModifierFactory=e,this._exposeAttributeConverterMetadataGenerator=t}_getFilterViewConfigs(e){return f.AXp.getViewConfigInfoByFilter(t=>Boolean(t?._filterOptions),e).map(t=>t.viewConfig)}_modifyFilterViewConfig(e){var t;const i=(t=this._filterViewElementOptionsModifierFactory)===null||t===void 0?void 0:t.create(e?.type);return i?.modify(e)||e}_generateFiltersAttributes(e){const{from:t,converters:i,expose:r}=e._filterOptions||{};return(0,B.Z)(t)||(0,B.Z)(r)?{}:r.filter(o=>Boolean(o?.attribute)).map(o=>({from:t,converters:i,expose:o})).map(o=>this._generateFilterAttributes(o)).reduce((o,n)=>({...o,...n}),{})}_generateFilterAttributes(e){const{from:t,expose:i}=e,r=i.attribute;if(!r)return{};const o=this._exposeAttributeConverterMetadataGenerator.generate({...i,converters:this._getFilterConverters(i.converters,e.converters)});return o?{[r]:{from:t,converter:o.converterExpression},...o.converterArgsAttributes}:{}}_getFilterConverters(e,t){var i,r;const o=(i=e?.filter(({converter:a})=>Boolean(a)))!==null&&i!==void 0?i:[],n=(r=t?.filter(({converter:a})=>Boolean(a)))!==null&&r!==void 0?r:[];return o.length===0?n:o.map(({converter:a,args:s})=>{const u=n.find(d=>d.converter===a);return{converter:a,args:s??u?.args}})}crtOnMetaDataInit(e){const t=e;return this._getFilterViewConfigs(t.viewConfig).map(i=>this._modifyFilterViewConfig(i)).map(i=>this._generateFiltersAttributes(i)).forEach(i=>{var r;t.viewModelConfig.attributes={...(r=t.viewModelConfig.attributes)!==null&&r!==void 0?r:{},...i}}),Promise.resolve(e)}}Pt.\u0275fac=function(e){return new(e||Pt)(l.LFG(N.oE,8),l.LFG(N.Ju))},Pt.\u0275prov=l.Yz7({token:Pt,factory:Pt.\u0275fac});function ir(c,e){return new k.Factory(c,new Map(e))}class Y{static withModifiers(e){return{ngModule:Y,providers:e.map(t=>({provide:N.tp,useValue:t,multi:!0}))}}}Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275mod=l.oAB({type:Y}),Y.\u0275inj=l.cJS({providers:[N.Ju,{provide:h.Gp3,useClass:Pt,multi:!0},{provide:N.oE,useFactory:ir,deps:[l.zs3,N.tp]}]});class It{get _isProcessingDisabled(){return(0,O.z)(this._featureService.getFeatureState(this._folderTreeProcessingDisableFeature))}constructor(e,t){this._featureService=e,this._userInfo=t,this._folderTreeProcessingDisableFeature="DisableFolderTreePreprocessing",this._isNewStructure=i=>!!i._filterOptions}_getFolderTreeViewConfigs(e){return f.AXp.getViewConfigInfoByProperty("type","crt.FolderTree",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_isOldSourceSchema(e){return(0,v.n7u)(e.sourceSchemaName)}_setActiveFolderChanged(e){e.activeFolderChanged||(e.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:e.name,id:"@event.id",name:"@event.name",filterData:"@event.filterData",isFavorite:"@event.isFavorite"}})}_setFolderTreeVisibleChanged(e){e.folderTreeVisibleChanged||(e.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.name,visible:"@event.visible"}})}_setAddFolderRequest(e){e.addFolder||(e.addFolder={request:"crt.AddFolderDataRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData"}})}_setCopyFolderRequest(e){e.copyFolder||(e.copyFolder={request:"crt.CopyFolderDataRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",sourceId:"@event.sourceId",copyRights:"@event.copyRights",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData"}})}_setFolderRenameRequest(e){e.folderRenamed||(e.folderRenamed={request:"crt.FolderTreeRenameRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",sourceSchemaName:"@event.sourceSchemaName",reloadFavorites:"@event.reloadFavorites"}})}_setToggleFolderFavoriteRequest(e){e.toggleFolderFavorite||(e.toggleFolderFavorite={request:"crt.ToggleFolderFavoriteRequest",params:{folderTreeName:e.name,id:"@event.id",favoriteId:"@event.favoriteId",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",status:"@event.status"}})}_setFolderFiltersUpdatedRequest(e){e.folderFiltersUpdated||(e.folderFiltersUpdated={request:"crt.FolderTreeUpdateFiltersRequest",params:{folderTreeName:e.name,filterData:"@event.filterData",sourceSchemaName:"@event.sourceSchemaName",folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}})}_setDeleteFolderRequest(e,t){if(t.deleteFolder)return;const{itemsAttrName:i}=(0,f.E_N)(t.name);t.deleteFolder={request:"crt.DeleteFolderDataRequest",params:{dataSourceName:this._getDataSourceNameByItems(e,i),folderTreeName:t.name,folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}}}_getDataSourceNameByItems(e,t){var i,r,o,n,a;const s=(o=(r=(i=e?.viewModelConfig)===null||i===void 0?void 0:i.attributes)===null||r===void 0?void 0:r[t])!==null&&o!==void 0?o:{};return"embeddedModel"in s&&(a=(n=s?.embeddedModel)===null||n===void 0?void 0:n.name)!==null&&a!==void 0?a:""}_setItemsAttrValue(e){if(e.items)return;const{itemsAttrName:t}=(0,f.E_N)(e.name);e.items=`$${t}`}_setItemsFilterAttrValue(e,t){var i;if(!(!((i=e?.viewModelConfig)===null||i===void 0)&&i.attributes))return;const{itemsFilterAttrName:r}=(0,f.E_N)(t.name),o=this._createItemsFilterGroup(t);e.viewModelConfig.attributes[r]={value:o}}_createItemsFilterGroup(e){const t=new b.FilterGroup(b.LogicalOperatorType.And);return this._isOldSourceSchema(e)?t.addSchemaColumnFilterWithParameter(b.ComparisonType.Equal,"FolderType",v.Tmb):t.addSchemaColumnFilterWithParameter(b.ComparisonType.Equal,"EntitySchemaName",e.rootSchemaName),t}_setVisibleAttrValue(e){if(e.visible)return;const{visibleAttrName:t}=(0,f.E_N)(e.name);e.visible=`$${t}`}_setActiveFolderIdAttrValue(e){if(e.activeFolderId)return;const{activeFolderIdAttrName:t}=(0,f.E_N)(e.name);e.activeFolderId=`$${t}`}_setActiveFolderFilterAttrValue(e,t){var i;if(this._isNewStructure(t)||!(!((i=e?.viewModelConfig)===null||i===void 0)&&i.attributes))return;const{activeFolderIdAttrName:r,activeFolderFilterAttrName:o,itemsAttrName:n,favoriteItemsAttrName:a}=(0,f.E_N)(t.name);e.viewModelConfig.attributes[o]={from:[n,a,r],converter:"crt.FolderTreeActiveFilterAttributeConverter"}}_setFavoriteItemsConfig(e,t){const{favoriteItemsAttrName:i}=(0,f.E_N)(t.name);t.favoriteItems=`$${i}`;const r=`${i}_DS`,o=`${r}_filter`;this._setFavoriteItemsFilterAttr(o,e,t);const n={isCollection:!0,modelConfig:{path:r,filterAttributes:[{name:o,loadOnChange:!0}]}};this._addFavoriteItemsViewModelConfig(n,t,r),this._addFavoriteItemsEmbeddedModel(n,t,r),this._addViewModelConfigAttribute(e,i,n)}_addFavoriteItemsViewModelConfig(e,t,i){const r=this._isOldSourceSchema(t),o=r?"":".FolderTree",n=r?"FolderId":"Id";e.viewModelConfig={attributes:{Id:{modelConfig:{path:`${i}.Id`}},Name:{modelConfig:{path:`${i}${o}.Name`}},FolderTreeId:{modelConfig:{path:`${i}${o}.${n}`}},FilterData:{modelConfig:{path:`${i}${o}.FilterData`}}}}}_addFavoriteItemsEmbeddedModel(e,t,i){const r=this._isOldSourceSchema(t),o=r?v.Ccj:v.hQ,n={name:i,config:{type:"crt.EntityDataSource",config:{entitySchemaName:o},hiddenInPageDesigner:!1}};if(r){const a=t.sourceSchemaName;n.config.config.attributes={Name:{path:`[${a}:Id:FolderId].Name`,type:b.DataSchemaAttributeType.ForwardReferenceAttribute},FilterData:{path:`[${a}:Id:FolderId].SearchData`,type:b.DataSchemaAttributeType.ForwardReferenceAttribute}}}e.embeddedModel=n}_setFavoriteItemsFilterAttr(e,t,i){var r,o,n;if(((o=(r=t?.viewModelConfig)===null||r===void 0?void 0:r.attributes)===null||o===void 0?void 0:o[e])||!t.viewModelConfig.attributes)return;const a=this._isOldSourceSchema(i),s=new b.FilterGroup(b.LogicalOperatorType.And),u=new b.CompareFilter(b.ComparisonType.Equal,new b.ColumnExpression({columnPath:"SysAdminUnit"}),new b.ParameterExpression({value:(n=this._userInfo)===null||n===void 0?void 0:n.id,dataValueType:b.DataValueType.Guid}));if(s.add(u,"adminUnitFilter"),a){const d=i.sourceSchemaName;s.addExistsFilter(`[${d}:Id:FolderId].Id`)}else{const d=new b.CompareFilter(b.ComparisonType.Equal,new b.ColumnExpression({columnPath:"EntitySchemaName"}),new b.ParameterExpression({value:i.rootSchemaName}));s.add(d,"schemaFilter")}t.viewModelConfig.attributes[e]={value:s}}_setExpandedItemsAttrValue(e,t){if(t.expandedItems)return;const{expandedItemsAttrName:i}=(0,f.E_N)(t.name);t.expandedItems=`$${i}`,this._addViewModelConfigAttribute(e,i,{})}_addViewModelConfigAttribute(e,t,i){var r;!(!((r=e?.viewModelConfig)===null||r===void 0)&&r.attributes)||e.viewModelConfig.attributes[t]||(e.viewModelConfig.attributes[t]=i)}_setFolderTreeExpandedItemsChanged(e){e.folderTreeExpandedItemsChanged||(e.folderTreeExpandedItemsChanged={request:"crt.FolderTreeExpandedItemsRequest",params:{folderTreeName:e.name,expandedItems:"@event.expandedItems"}})}_setFolderChangeRights(e){e.folderChangeRights||(e.folderChangeRights={request:"crt.LoadRightsModuleRequest",params:{payload:{entitySchemaName:"@event.entitySchemaName",entitySchemaCaption:"@event.entitySchemaCaption",primaryColumnValue:"@event.primaryColumnValue",primaryDisplayColumnValue:"@event.primaryDisplayColumnValue"}}})}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(yield t._isProcessingDisabled)return e;const i=e,r=t._getFolderTreeViewConfigs(i);for(const o of r)t._setItemsAttrValue(o),t._setItemsFilterAttrValue(i,o),t._setExpandedItemsAttrValue(i,o),t._setVisibleAttrValue(o),t._setActiveFolderIdAttrValue(o),t._setActiveFolderFilterAttrValue(i,o),t._setActiveFolderChanged(o),t._setFolderTreeVisibleChanged(o),t._setAddFolderRequest(o),t._setCopyFolderRequest(o),t._setFolderRenameRequest(o),t._setFolderFiltersUpdatedRequest(o),t._setDeleteFolderRequest(i,o),t._setFolderTreeExpandedItemsChanged(o),t._setFolderChangeRights(o),t._setFavoriteItemsConfig(i,o),t._setToggleFolderFavoriteRequest(o);return e})()}}It.\u0275fac=function(e){return new(e||It)(l.LFG(D.UZ),l.LFG(f.aoG))},It.\u0275prov=l.Yz7({token:It,factory:It.\u0275fac});class Tt{_setProperties(e){return(0,m.Z)(function*(){const t=e.viewConfig.folderTree,{activeFolderIdAttrName:i,activeFolderNameAttrName:r,activeFolderFavoriteStateAttrName:o,itemsAttrName:n,favoriteItemsAttrName:a}=(0,f.E_N)(t);e.viewConfig.activeFolderId||(e.viewConfig.activeFolderId=t?`$${i}`:null),e.viewConfig.activeFolderName||(e.viewConfig.activeFolderName=t?`$${r}`:null),e.viewConfig.activeFolderFavoriteState||(e.viewConfig.activeFolderFavoriteState=t?`$${o}`:null),e.viewConfig.items||(e.viewConfig.items=t?`$${n}`:null),e.viewConfig.favoriteItems||(e.viewConfig.favoriteItems=t?`$${a}`:null)})()}_setActiveFolderChangedRequest(e){var t;e.viewConfig.activeFolderChanged||(e.viewConfig.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:(t=e.viewConfig.folderTree)!==null&&t!==void 0?t:null,id:"@event.id",name:"@event.name",filterData:"@event.filterData",isFavorite:"@event.isFavorite"}})}_setFolderTreeVisibleChangedRequest(e){var t;e.viewConfig.folderTreeVisibleChanged||(e.viewConfig.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:(t=e.viewConfig.folderTree)!==null&&t!==void 0?t:null,togglePanel:"@event.togglePanel"}})}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){const i=e,r=f.AXp.getViewConfigInfoByProperty("type","crt.FolderTreeActions",i.viewConfig);for(const o of r)yield t._setProperties(o),t._setActiveFolderChangedRequest(o),t._setFolderTreeVisibleChangedRequest(o);return e})()}}Tt.\u0275fac=function(e){return new(e||Tt)},Tt.\u0275prov=l.Yz7({token:Tt,factory:Tt.\u0275fac});class Mt{get isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._imageInputPreprocessingDisableFeature))}get isAutobindDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._autoBindToDisabled))}constructor(e,t){this._featureService=e,this._metadataModifierService=t,this._imageInputPreprocessingDisableFeature="DisableImageInputPreprocessing",this._autoBindToDisabled="AutoBindToDisabled"}_addToImageLinkConverter(e,t){const i=t.indexOf("|");if(t.startsWith("$")&&i===-1){const r=t+" | crt.ToImageLink";this._metadataModifierService.updateProperty({source:e,keys:["value"],value:r})}}_addBusinessRulesBinding(e,t,i,r,o){if(r.startsWith("$")&&!e.bindTo&&!o){this._metadataModifierService.addProperty(e,"bindTo",`$${i}`);const n=t.attributes||{};n[i]={...n[i],viewItemName:e.name},t.attributes=n}}_addImageSelectedRequest(e,t){e.imageSelected||this._metadataModifierService.addProperty(e,"imageSelected",{request:"crt.UploadImageRequest",params:{imageAttributeName:t,details:"@event"}})}_addimageClearRequest(e,t){e.imageClear||this._metadataModifierService.addProperty(e,"imageClear",{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:t,attributeValue:null}})}_setReadonlyByType(e,t,i){var r=this;return(0,m.Z)(function*(){var o,n,a;const s=t.viewModelConfig.attributes,u=r._getBindingAttributeWoConverters(e.value);if((0,L.zX)(u,s)){const d=u.slice(1).split(".").pop(),p=(o=s[d])!==null&&o!==void 0?o:{};let g="";(0,h.bjw)(p)&&(g=(n=p.modelConfig)===null||n===void 0?void 0:n.path.split(".")[0]);let y="";(0,h.bjw)(p)&&(y=(a=p.modelConfig)===null||a===void 0?void 0:a.path.split(".").pop());const S=i.find(T=>T.name===g),P=S?yield(0,C.n)(S.getSchema(),{defaultValue:null}):null,I=P?.findAttributeByName(y);I&&I.dataValueType!==b.DataValueType.IMAGELOOKUP&&(e.readonly||r._metadataModifierService.updateProperty({source:e,keys:["readonly"],value:!0}),r._metadataModifierService.removeProperty(e,"bindTo"))}})()}_getBindingAttributeWoConverters(e){const t=e?.indexOf("|");return t&&t!==-1&&(e=e.substring(0,t-1).trimEnd()),e}_getBindAttributeName(e){return this._getBindingAttributeWoConverters(e).replace("$","")}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(yield t.isProcessingDisabled)return e;const i=e,r=f.AXp.getViewConfigInfoByProperty("type","crt.ImageInput",i.viewConfig),o=yield t.isAutobindDisabled;return r.forEach(n=>{const a=n.viewConfig.value,s=t._getBindAttributeName(a);t._addToImageLinkConverter(n.viewConfig,a),t._addBusinessRulesBinding(n.viewConfig,i.viewModelConfig,s,a,o),t._addImageSelectedRequest(n.viewConfig,s),t._addimageClearRequest(n.viewConfig,s)}),e})()}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){if(yield i.isProcessingDisabled)return e;const r=e;return f.AXp.getViewConfigInfoByProperty("type","crt.ImageInput",r.viewConfig).forEach(function(){var n=(0,m.Z)(function*(a){yield i._setReadonlyByType(a.viewConfig,r,t)});return function(a){return n.apply(this,arguments)}}()),e})()}}Mt.\u0275fac=function(e){return new(e||Mt)(l.LFG(D.UZ),l.LFG(h.pi2))},Mt.\u0275prov=l.Yz7({token:Mt,factory:Mt.\u0275fac});class wt{constructor(e){this._featureService=e,this._labelProcessingDisableFeature="DisableLabelPreprocessing"}_actualizeLabelType(e){const t=v.JF[e.labelType];t&&(e.labelType=t)}get _isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._labelProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(yield t._isProcessingDisabled)return e;const i=e;return f.AXp.getViewConfigInfoByProperty("type","crt.Label",i.viewConfig).forEach(o=>{t._actualizeLabelType(o.viewConfig)}),e})()}}wt.\u0275fac=function(e){return new(e||wt)(l.LFG(D.UZ))},wt.\u0275prov=l.Yz7({token:wt,factory:wt.\u0275fac});class Rt{_modifyInputType(e,t,i){var r,o;const n=e.control.replace("$",""),a=(o=(r=t.attributes[n])===null||r===void 0?void 0:r.modelConfig)===null||o===void 0?void 0:o.path;if(a){const s=this._getDataSchemaAttributeByPath(a,i);s?.dataValueType===b.DataValueType.PHONE_TEXT&&(e.type="crt.PhoneInput",e.phoneAsLink=!0,e.displayAsPhone=s.isMasked)}}_getDataSchemaAttributeByPath(e,t){var i;const[r,o]=e.split("."),n=(i=t.dataSchemas[r])===null||i===void 0?void 0:i.attributes;let a;for(const s in n)if(n[s].path===o||n[s].name===o){a=n[s];break}return a}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){const o=e,n=f.AXp.getViewConfigInfoByProperty("type","crt.Input",o.viewConfig),a=f.AXp.getViewConfigInfoByProperty("type","crt.PhoneInput",o.viewConfig);return n.forEach(s=>{r._modifyInputType(s.viewConfig,o.viewModelConfig,i)}),a.forEach(s=>{r._modifyInputType(s.viewConfig,o.viewModelConfig,i)}),e})()}}Rt.\u0275fac=function(e){return new(e||Rt)},Rt.\u0275prov=l.Yz7({token:Rt,factory:Rt.\u0275fac});class Ti{constructor(e){this.injector=e,this.isNewStructure=t=>!!t._filterOptions,this.initializeDependencies()}initializeDependencies(){}crtOnMetaDataInit(e,t){return Promise.resolve(t)}}class rr extends Ti{_getDependencyFilterConfigsFromViewConfig(e){var t;const i=(t=e._filterOptions.expose)===null||t===void 0?void 0:t.map(o=>o.converters),r=[];return i?.forEach(o=>{o?.forEach(n=>this._addDependencyFilterConfigsFromConverterConfig(n,r))}),r}_addDependencyFilterConfigsFromConverterConfig(e,t){const i=e?.args,r=i?.map(o=>o.target);r?.map(o=>{var n;const a=(n=o.dependencyFilters)===null||n===void 0?void 0:n.filter(s=>s.attributeName);a?.length>0&&t.push(...a)})}_createAttributesForDependencyFilterConfigs(e,t){this._getDependencyFilterConfigsFromViewConfig(e).forEach(r=>this._createViewModelAttributeIfNeed(r,t))}_createViewModelAttributeIfNeed(e,t){t[e.attributeName]||(t[e.attributeName]={modelConfig:{path:e.relationPath}})}crtOnMetaDataInit(e,t){var i,r;if(!this.isNewStructure(e))return Promise.resolve(t);const o=t;(i=(r=o.viewModelConfig).attributes)!==null&&i!==void 0||(r.attributes={});const n=o.viewModelConfig.attributes;return this._createAttributesForDependencyFilterConfigs(e,n),Promise.resolve(t)}}class or extends Ti{_isAllowToSetupComboboxViewConfig(e){const t=e.config;return!this._isShowRecordsInWindows(e)&&!("comboboxViewElementConfig"in t)&&!!t.entitySchemaName}_isShowRecordsInWindows(e){return e.config.showRecordsInWindows}_getEntitySchemaName(e){const t=e.entitySchemaName;return t===v.Rro?v.e3S:t}initializeDependencies(){super.initializeDependencies(),this._comboboxPreprocessorService=this.injector.get(Z)}crtOnMetaDataInit(e,t){var i=this;return(0,m.Z)(function*(){if(!i._isAllowToSetupComboboxViewConfig(e))return Promise.resolve(t);const o=t.viewModelConfig.attributes,n={name:`${e.name}_ComboBox`},a=e.config;return yield i._comboboxPreprocessorService.setupComboboxMetadataByEntitySchema(n,o,i._getEntitySchemaName(a),a.recordsFilter),a.comboboxViewElementConfig={type:"crt.ComboBox",labelPosition:"hidden",useMultiChoice:!0,...n},Promise.resolve(t)})()}}class Ve{constructor(e){this._injector=e}_getQuickFilterAdditionalPreprocessingService(e){switch(e){case v.KYG.Custom:return new rr(this._injector);case v.KYG.Lookup:return new or(this._injector);default:return null}}crtOnMetaDataInit(e,t){const i=this._getQuickFilterAdditionalPreprocessingService(e.filterType);return i?.crtOnMetaDataInit(e,t)||Promise.resolve(t)}}Ve.\u0275fac=function(e){return new(e||Ve)(l.LFG(l.zs3))},Ve.\u0275prov=l.Yz7({token:Ve,factory:Ve.\u0275fac});class Mi{constructor(e){this.injector=e,this.initializeDependencies()}initializeDependencies(){}getAttributeValue(e,t){var i;return((i=this.getViewModelConfigAttributes(e)[t])===null||i===void 0?void 0:i.value)||[]}setAttributeValue(e,t,i){const r=this.getViewModelConfigAttributes(e);r[t]={value:i}}getViewModelConfigAttributes(e){return e.viewModelConfig.attributes}update(e,t,i){var r=this;return(0,m.Z)(function*(){const o=r.getAttributeValue(t,i);if(r.isNotNeedUpdateValue(o))return;const n=yield r.createNewAttributeValue(e,o);r.setAttributeValue(t,i,n)})()}}class nr extends Mi{_createDateRangeQuickFilterValue(e){return this._dateRangeMacrosConverter.convert(e)}_isMacrosEnum(e){return typeof e=="string"}initializeDependencies(){super.initializeDependencies(),this._dateRangeMacrosConverter=this.injector.get(v.Iq9)}isNotNeedUpdateValue(e){return(0,B.Z)(e)||!this._isMacrosEnum(e)&&!e.macros}createNewAttributeValue(e,t){const i=this._isMacrosEnum(t)?t:t.macros;return Promise.resolve(this._createDateRangeQuickFilterValue(i))}}class ar extends Mi{_createLookupQuickFilterValue(e,t){var i=this;return(0,m.Z)(function*(){const r=t.filter(n=>i._isMacrosValueItem(n)),o=t.filter(n=>!i._isMacrosValueItem(n));return[...i._createMacrosLookupQuickFilterValue(r),...yield i._createNotMacrosLookupQuickFilterValue(o,e)]})()}_isMacrosValueItem(e){return Object.values(v.o$e).includes(this._getValueFromValueItem(e))}_createMacrosLookupQuickFilterValue(e){return e.map(t=>this._createMacrosLookupQuickFilterValueItem(t)).filter(Boolean)}_createMacrosLookupQuickFilterValueItem(e){switch(this._getValueFromValueItem(e)){case v.o$e.CurrentUserContact:return this._createLookupQuickFilterValueItemFromPreviousItem(e,this._userInfo.contactId,this._userInfo.contactName);case v.o$e.CurrentUserAccount:return this._createLookupQuickFilterValueItemFromPreviousItem(e,this._userInfo.accountId,this._userInfo.accountName);default:return null}}_createNotMacrosLookupQuickFilterValue(e,t){var i=this;return(0,m.Z)(function*(){return(0,B.Z)(e)?Promise.resolve([]):(yield i._lookupQuickFilterValueRepository.getActualData(e,t)).map(r=>i._mapActualValueItem(e,r)).filter(Boolean)})()}_mapActualValueItem(e,t){const i=e.find(r=>r.value===t.value);return i?this._createLookupQuickFilterValueItemFromPreviousItem(i,t.value,t.displayValue):null}_createLookupQuickFilterValueItemFromPreviousItem(e,t,i){return!this._isValidValue(t)||(0,B.Z)(i)?null:{...e,value:t,displayValue:i,originalValue:this._getValueFromValueItem(e),checkedState:"checkedState"in e?e.checkedState:!1}}_getValueFromValueItem(e){return"originalValue"in e?e.originalValue:e.value}_isValidValue(e){return(0,b.isGuid)(e)&&!(0,b.isEmptyGuid)(e)}initializeDependencies(){super.initializeDependencies(),this._userInfo=this.injector.get(f.aoG),this._lookupQuickFilterValueRepository=this.injector.get(v.PXA)}isNotNeedUpdateValue(e){return(0,B.Z)(e)}createNewAttributeValue(e,t){return this._createLookupQuickFilterValue(e.config,t)}}class Be{constructor(e){this._injector=e}_getQuickFilterValueAttributeUpdater(e){switch(e){case v.KYG.Lookup:return new ar(this._injector);case v.KYG.DateRange:return new nr(this._injector);default:return null}}update(e,t,i){const r=this._getQuickFilterValueAttributeUpdater(e.filterType);return r?.update(e,t,i)||Promise.resolve()}}Be.\u0275fac=function(e){return new(e||Be)(l.LFG(l.zs3))},Be.\u0275prov=l.Yz7({token:Be,factory:Be.\u0275fac});class ri{constructor(){this.isNewStructure=e=>!!e._filterOptions}_getOrCreateModelFilters(e){const t=e.modelConfig;return t.filterAttributes||(t.filterAttributes=[]),t.filterAttributes}_setFilterToModelFilters(e,t,i){const r=this.getAttributeModelFilters(e,t);r.some(n=>n.name===i)||r.push({name:i,loadOnChange:!0})}getFilterAttributeName(e,t){return`${e}_${t}`}getAttributeModelFilters(e,t){const i=e[t];return i?.modelConfig?this._getOrCreateModelFilters(i):[]}createAttributeIfNeed(e,t,i){t in e||(e[t]=i)}setFilterAttribute(e,t,i){const r=this.getFilterAttributeName(t,i),o=e.viewModelConfig.attributes;this.createAttributeIfNeed(o,r,{value:{}}),this._setFilterToModelFilters(o,i,r)}}class ce extends ri{constructor(e,t){super(),this._quickFilterValueAttributeUpdater=e,this._quickFilterAdditionalPreprocessingService=t,this._isTargetExists=i=>{var r;return!!(!((r=i.targets)===null||r===void 0)&&r.length)}}_setValueAttribute(e,t){const i=t?.config;if("value"in t||!i)return;const r=this._getQuickFilterValueAttributeName(t.name);t.value=`$${r}`;const o="defaultValue"in t.config?t.config.defaultValue:null;this._createValueAttributeIfNeed(e,r,o)}_createValueAttributeIfNeed(e,t,i){const r=e.viewModelConfig.attributes;this.createAttributeIfNeed(r,t,{value:i})}_updateValueAttribute(e,t){const i=this._getQuickFilterValueAttributeName(t.name);return this._quickFilterValueAttributeUpdater.update(t,e,i)}_setFilterAttribute(e,t){var i;this.isNewStructure(t)||!this._isTargetExists(t)||(i=t.targets)===null||i===void 0||i.forEach(r=>{this._setFilterConverterAttribute(e,t,r),this.setFilterAttribute(e,t.name,r.viewAttributeName),r.filterAttributeName=this.getFilterAttributeName(t.name,r.viewAttributeName)})}_setFilterConverterAttribute(e,t,i){const r=e.viewModelConfig.attributes,o=this.getFilterAttributeName(t.name,i.viewAttributeName),n=`${o}_Target`,a={from:this._getQuickFilterValueAttributeName(t.name),converter:`crt.QuickFilterAttributeConverter: $${n}`};this.createAttributeIfNeed(r,n,{value:this._createQuickFilterConverterParameters(i,t)}),this.createAttributeIfNeed(r,o,a)}_createQuickFilterConverterParameters(e,t){const i={target:e,quickFilterType:t.filterType};return this._allowAddConfigToConverterParameters(t)&&(i.config=t.config),i}_allowAddConfigToConverterParameters(e){return e.filterType===v.KYG.Custom}_setValueChangeRequest(e){if(e.valueChange||!e.filterType)return;const t=this._getQuickFilterValueAttributeName(e.name);e.valueChange={request:"crt.QuickFilterRequest",params:{valueAttributeName:t,value:"@event"}}}_getQuickFilterValueAttributeName(e){return`${e}_Value`}crtOnMetaDataInit(e,t){var i=this;return(0,m.Z)(function*(){const r=t;return i._setValueAttribute(r,e),yield i._updateValueAttribute(r,e),i._setFilterAttribute(r,e),i._setValueChangeRequest(e),yield i._quickFilterAdditionalPreprocessingService.crtOnMetaDataInit(e,t),Promise.resolve(t)})()}}ce.\u0275fac=function(e){return new(e||ce)(l.LFG(Be),l.LFG(Ve))},ce.\u0275prov=l.Yz7({token:ce,factory:ce.\u0275fac});class Et extends ri{constructor(e){super(),this._quickFilterPreprocessorService=e}_getQuickFilterViewConfigs(e){return f.AXp.getViewConfigInfoByProperty("type","crt.QuickFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){const i=e,r=t._getQuickFilterViewConfigs(i);return yield Promise.all(r.map(function(){var o=(0,m.Z)(function*(n){yield t._quickFilterPreprocessorService.crtOnMetaDataInit(n,e)});return function(n){return o.apply(this,arguments)}}())),Promise.resolve(e)})()}}Et.\u0275fac=function(e){return new(e||Et)(l.LFG(ce))},Et.\u0275prov=l.Yz7({token:Et,factory:Et.\u0275fac});var wi=_(21066),oi=_(4742);class $e{constructor(e){this._resourceFinderService=e,this._dataGridType="crt.DataGrid",this._galleryType="crt.Gallery",this._findAttributeInDataSchema=(t,i)=>{var r;return(r=t?.attributes)===null||r===void 0?void 0:r.find(o=>o.name===i)}}_getBindedViewElementConfigsByAttributeNames(e,t){return f.AXp.getViewConfigInfoByFilter(i=>this._isViewConfigInfoBindedByPropertyValues(i,t.map(r=>`$${r}`)),e.viewConfig).map(i=>i.viewConfig)}_isViewConfigInfoBindedByPropertyValues(e,t){const i=Object.values(e);for(const r of i)if(t.includes(r))return!0;return!1}_getColumnByViewType(e,t,i,r){switch(r.type){case this._dataGridType:return this._getColumnsFromDataGridViewConfig(e,t,i,r);case this._galleryType:return Promise.resolve(this._getColumnsFromGalleryViewConfig(e,t,i,r));default:return Promise.resolve(this._getColumnsFromViewModelConfig(e,t,i))}}_getColumnsFromDataGridViewConfig(e,t,i,r){var o=this;return(0,m.Z)(function*(){const n=[],a=o._getDataSchema(t,i),s=r,u=o._getColumnAttributes(e,i);for(const d of s.columns){const p=d.code,g=u?.[p];yield o._addColumnByResourcesIfNeed(a,t,n,d,g)}return{columns:n,viewName:r.name||i,primaryDisplayName:a.primaryDisplayAttributeName}})()}_addColumnByResourcesIfNeed(e,t,i,r,o){var n=this;return(0,m.Z)(function*(){const a=n._getColumnNameFromAttributeConfigPath(o),s=n._findAttributeInDataSchema(e,a);n._isAllowedToAddColumn(s,i,a)&&i.push(yield n._createColumnByResources(t[f.Zbq],r.caption,a,s?.path))})()}_getColumnsFromGalleryViewConfig(e,t,i,r){const o=[],n=this._getDataSchema(t,i),a=r?.itemConfig,s=this._getColumnAttributes(e,i);return(0,oi.Z)(a?.templateValuesMapping,(u,d)=>{const p=s?.[u];this._addColumnByDataSchemaIfNeed(n,o,p)}),{columns:o,viewName:r.name||i,primaryDisplayName:n.primaryDisplayAttributeName}}_getColumnsFromViewModelConfig(e,t,i){const r=[],o=this._getDataSchema(t,i),n=this._getColumnAttributes(e,i);return(0,oi.Z)(n,(a,s)=>{this._addColumnByDataSchemaIfNeed(o,r,a)}),{columns:r,viewName:i,primaryDisplayName:o.primaryDisplayAttributeName}}_getDataSchema(e,t){return e.getBoundDataSchemaByAttributePath(t)}_getColumnAttributes(e,t){var i;const r=e.viewModelConfig.attributes;return Object.prototype.hasOwnProperty.call(r,t)?((i=r[t].viewModelConfig)===null||i===void 0?void 0:i.attributes)||{}:{}}_addColumnByDataSchemaIfNeed(e,t,i){const r=this._getColumnNameFromAttributeConfigPath(i),o=this._findAttributeInDataSchema(e,r);this._isAllowedToAddColumn(o,t,r)&&t.push(this._createColumnByDataSchema(o,r))}_getColumnNameFromAttributeConfigPath(e){var t,i;if(e&&(0,h.bjw)(e))return(i=(t=e?.modelConfig)===null||t===void 0?void 0:t.path)===null||i===void 0?void 0:i.split(".").slice(1).shift()}_isAllowedToAddColumn(e,t,i){return(0,f.qnt)(e)&&!!i&&!t.some(r=>r.name===i)}_createColumnByResources(e,t,i,r){var o=this;return(0,m.Z)(function*(){return{caption:(yield o._resourceFinderService.findViewModelResourceValue(t,e,t))||i,name:i,path:r||i}})()}_createColumnByDataSchema(e,t){return{caption:e?.caption||t,name:t,path:e?.path||t}}_getUniqueColumns(e){var t,i;const r=[];return e.forEach(o=>{o.columns.forEach(n=>{this._isSearchFilterColumnExist(r,n)||r.push(n)})}),{columns:r,viewName:((t=e.slice().shift())===null||t===void 0?void 0:t.viewName)||"",primaryDisplayName:(i=e.slice().shift())===null||i===void 0?void 0:i.primaryDisplayName}}_isSearchFilterColumnExist(e,t){return e.some(i=>i.caption===t.caption&&i.name===t.name)}getColumnsModelByAttributeName(e,t,i){var r=this;return(0,m.Z)(function*(){const o=r._getBindedViewElementConfigsByAttributeNames(e,[i]);if(o.length===0)return r._getColumnsFromViewModelConfig(e,t,i);const n=yield Promise.all(o.map(a=>r._getColumnByViewType(e,t,i,a)));return r._getUniqueColumns(n)})()}}$e.\u0275fac=function(e){return new(e||$e)(l.LFG(f.xYn))},$e.\u0275prov=l.Yz7({token:$e,factory:$e.\u0275fac});class Vt extends ri{constructor(e,t,i,r){super(),this._featureService=e,this._searchFilterPreprocessorService=t,this._searchFilterQueryAnalyzerService=i,this._translateService=r,this._isTargetAttributesExist=o=>{var n;return((n=o?.targetAttributes)===null||n===void 0?void 0:n.length)>0}}_getSearchFilterViewConfigs(e){return f.AXp.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_getSearchValueViewModelAttributeName(e){return`${e}SearchValue`}_getSearchFilteredColumnViewModelAttributeName(e){return`${e}SearchFilteredColumn`}_getSearchFilteredColumnsGroupsAttributeName(e){return`${e}_FilteredColumnsGroups`}_setDisabledAttribute(e){this._isTargetAttributesExist(e)||(e.disabled=!0)}_setTooltipAttribute(e){e.tooltip||(e.tooltip=this._translateService.instant("Components.SearchFilter.Tooltip"))}_setSearchValueAttribute(e,t){const i=this._getSearchValueViewModelAttributeName(t.name);this._createViewModelAttribute(e,i),t.value=`$${i}`}_setSearchFilteredColumnAttribute(e,t){const i=this._getSearchFilteredColumnViewModelAttributeName(t.name);this._createViewModelAttribute(e,i),t.filteredColumn=`$${i}`}_createViewModelAttribute(e,t){const i=e.viewModelConfig.attributes;Object.prototype.hasOwnProperty.call(i,t)||(i[t]={value:""})}_setFilterAttribute(e,t){!this._isTargetAttributesExist(t)||t.targetAttributes.forEach(i=>{this._setFilterConverterAttribute(e,t,i),this.setFilterAttribute(e,t.name,i)})}_setFilterConverterAttribute(e,t,i){const r=e.viewModelConfig.attributes,o=this.getFilterAttributeName(t.name,i),n=this._getSearchFilteredColumnsGroupsAttributeName(t.name),a={from:[this._getSearchValueViewModelAttributeName(t.name),n],converter:`crt.SearchFilterAttributeConverter: '${i}'`};this.createAttributeIfNeed(r,n,{value:[]}),this.createAttributeIfNeed(r,o,a)}_setSearchFilterColumnsGroupsRequest(e,t,i){var r=this;return(0,m.Z)(function*(){if(i.valueChange||!r._isTargetAttributesExist(i))return;const o=yield r._createSearchFilterTargets(e,t,i),a=(yield r._getIsSearchFilterQueryAnalyzerEnabled())?yield r._getIsNeedShowAllOptionForTargets(e,t,o):!0;r._setSearchFilterConfigIntoView(i,o,a),i.valueChange={request:"crt.SearchFilterColumnsGroupsRequest",params:{value:"@event.value",searchFilterColumnsGroups:"@event.columnsGroups",searchFilterGroups:o.map(s=>({filterAttributeName:s.filterAttributeName,viewAttributeName:s.viewAttribute.name})),searchValueAttributeName:r._getSearchValueViewModelAttributeName(i.name),searchFilteredColumnAttributeName:r._getSearchFilteredColumnViewModelAttributeName(i.name),searchFilteredColumnsGroupsAttributeName:r._getSearchFilteredColumnsGroupsAttributeName(i.name)}}})()}_getIsSearchFilterQueryAnalyzerEnabled(){return this._featureService.getFeatureState("SearchFilterQueryAnalyzerEnabled")}_getIsNeedShowAllOptionForTargets(e,t,i){var r=this;return(0,m.Z)(function*(){for(const o of i)if(yield r._getIsNeedOptimization(e,t,o.viewAttribute.name,o.columnsModel.columns))return!1;return!0})()}_getIsNeedOptimization(e,t,i,r){var o=this;return(0,m.Z)(function*(){var n;if(o._isCollectionAttributeHasFixedFilter(e,t,i))return!1;const a=(n=t.getBoundDataSchemaByAttributePath(i))===null||n===void 0?void 0:n.name,s=r.map(d=>d.path);return!(0,wi.UE)(a)||r.length===0?!1:(yield(0,O.z)(o._searchFilterQueryAnalyzerService.analyze(a,s))).isNeedOptimization})()}_isCollectionAttributeHasFixedFilter(e,t,i){let r=!1;const o=e.viewModelConfig.attributes;if(this._isDataSourceHasDependencies(e,t,i))return!0;const n=this.getAttributeModelFilters(o,i);return(0,oi.Z)(n,a=>(r=this._isPredefineFilterAttribute(o,a.name),!r)),r}_isPredefineFilterAttribute(e,t){var i;const r=e[t],o=(i=r?.value)===null||i===void 0?void 0:i.filterType;return!!o||o===0}_isDataSourceHasDependencies(e,t,i){var r;const o=t.getBoundDataSourceNameByAttributePath(i);return((((r=e.modelConfig)===null||r===void 0?void 0:r.dependencies)||{})[o]||[]).length>0}_createSearchFilterTargets(e,t,i){return Promise.all(i.targetAttributes.map(r=>this._createSearchFilterTarget(e,t,i.name,r)))}_createSearchFilterTarget(e,t,i,r){var o=this;return(0,m.Z)(function*(){const n=yield o._getColumnsModel(e,t,r),a=`${i}_${r}`,s=o._getDisplayValueForViewAttributeName(t,r,n.viewName);return{columnsModel:n,filterAttributeName:a,viewAttribute:{caption:s,name:r}}})()}_getColumnsModel(e,t,i){return this._searchFilterPreprocessorService.getColumnsModelByAttributeName(e,t,i)}_getDisplayValueForViewAttributeName(e,t,i){const r=e.getBoundDataSchemaByAttributePath(t);return r?`${r.name}${(0,wi.UE)(i)?" | "+i:""}`:i}_setSearchFilterConfigIntoView(e,t,i){var r;e.columnsGroupsConfig={showAllOption:i,columnsGroups:t.map(o=>({group:o.viewAttribute,columns:o.columnsModel.columns})),primaryColumnName:(r=t.slice().shift())===null||r===void 0?void 0:r.columnsModel.primaryDisplayName}}crtOnMetaDataInit(e){const t=e;return this._getSearchFilterViewConfigs(t).forEach(r=>{this._setDisabledAttribute(r),this._setTooltipAttribute(r),this._setSearchValueAttribute(t,r),this._setSearchFilteredColumnAttribute(t,r),this._setFilterAttribute(t,r)}),Promise.resolve(e)}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){const o=e,n=i,a=r._getSearchFilterViewConfigs(o);for(const s of a)yield r._setSearchFilterColumnsGroupsRequest(o,n,s);return e})()}}Vt.\u0275fac=function(e){return new(e||Vt)(l.LFG(b.FeatureService),l.LFG($e),l.LFG(v.Hzq),l.LFG($.sK))},Vt.\u0275prov=l.Yz7({token:Vt,factory:Vt.\u0275fac});class Bt{constructor(e){this._exposeAttributeConverterMetadataGenerator=e}_getSelectionElementViewConfigs(e){return f.AXp.getViewConfigInfoByFilter(t=>Boolean(t?._selectionOptions),e).map(t=>t.viewConfig)}_generateSelectionAttributes(e){const t=e._selectionOptions.attribute;if(typeof t=="string")return{};const{from:i,expose:r}=t??{};if((0,B.Z)(i)||(0,B.Z)(r))return{};const o=r.attribute;if(!o)return{};const n=this._exposeAttributeConverterMetadataGenerator.generate(r);return n?{[o]:{from:i,converter:n.converterExpression},...n.converterArgsAttributes}:{[o]:{from:i}}}crtOnMetaDataInit(e){const t=e;return this._getSelectionElementViewConfigs(t.viewConfig).map(i=>this._generateSelectionAttributes(i)).forEach(i=>{var r;t.viewModelConfig.attributes={...(r=t.viewModelConfig.attributes)!==null&&r!==void 0?r:{},...i}}),Promise.resolve(e)}}Bt.\u0275fac=function(e){return new(e||Bt)(l.LFG(N.Ju))},Bt.\u0275prov=l.Yz7({token:Bt,factory:Bt.\u0275fac});class Le{}Le.\u0275fac=function(e){return new(e||Le)},Le.\u0275mod=l.oAB({type:Le}),Le.\u0275inj=l.cJS({providers:[N.Ju,{provide:h.Gp3,useClass:Bt,multi:!0}]});class Oe extends Kt{constructor(){super(...arguments),this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var i=this;return(0,m.Z)(function*(){var r;const o=e.items.slice(1),n=(r=t.getBoundDataSchemaByAttributePath(o))===null||r===void 0?void 0:r.name;if(n!=="SimilarLead")return;const a=t.getBoundDataSourceNameByAttributePath(o),s=yield i.hasEntityEditPage(t,n),u=`$${o}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:"DataGrid.RowToolbar.Open",icon:"edit-row-action",visible:s,disabled:u,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:o,recordId:`$${o}.${a}_Id`},useRelativeContext:!0}}]})()}}Oe.\u0275fac=function(){let c;return function(t){return(c||(c=l.n5z(Oe)))(t||Oe)}}(),Oe.\u0275prov=l.Yz7({token:Oe,factory:Oe.\u0275fac});class $t{constructor(e,t){this._featureService=e,this._profileAttributeService=t,this._tabPanelActionsProcessingDisableFeature="DisableTabPanelPreprocessing",this._useTabPanelContainerFeature="UseTabPanelContainer"}get _useTabPanelContainer(){return(0,C.n)(this._featureService.getFeatureState(this._useTabPanelContainerFeature))}_updateIconPosition(e){if(e.iconPosition)return;const t=!!e.icon;e.iconPosition=t?x.F9O.LeftIcon:x.F9O.OnlyText}_updateTabIconSource(e){v.E2J.updateTabIconSource(e)}_updateTabHint(e){e.hint=e.caption}_convertViewConfigPropToBoolean(e,t,i){return t in e?!!e[t]:i}_getTabContainerHeader(e){var t;const i=this._getTabPanelHeaderItemInputs();return{type:"crt.TabPanelHeader",tabs:(t=e.viewConfig.items)===null||t===void 0?void 0:t.map(r=>({...Object.fromEntries(i.filter(o=>typeof r[o]<"u").map(o=>[o,r[o]])),type:"crt.TabPanelHeaderItem",name:r.name,titleColor:e.viewConfig.tabTitleColor,selectedTitleColor:e.viewConfig.selectedTabTitleColor,undrelineColor:e.viewConfig.underlineSelectedTabColor,styleType:e.viewConfig.styleType}))}}_getTabContainerBody(e){var t;const i=this._convertViewConfigPropToBoolean(e.viewConfig,"allowToggleClose",!0),r=e.viewConfig.mode==="tab"?!1:i;return{type:"crt.ToggleContainer",preserveContent:this._convertViewConfigPropToBoolean(e.viewConfig,"preserveContent",!0),items:(t=e.viewConfig.items)===null||t===void 0?void 0:t.map(o=>({...o,type:"crt.ToggleContainerItem",backgroundColor:e.viewConfig.bodyBackgroundColor,isToggleTabHeaderVisible:this._convertViewConfigPropToBoolean(o,"isToggleTabHeaderVisible",!1),allowToggleClose:r})),visibilityStrategyMode:e.viewConfig.visibilityStrategyMode}}_getTabPanelHeaderItemInputs(){var e;return Object.keys(((e=b.ViewElementRegistry.viewElements.get("crt.TabPanelHeaderItem"))===null||e===void 0?void 0:e.inputs)||{})}get isProcessingDisabled(){return(0,C.n)(this._featureService.getFeatureState(this._tabPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){const i=e;if(!(yield t.isProcessingDisabled)&&(f.AXp.getViewConfigInfoByProperty("type","crt.TabContainer",i.viewConfig).forEach(o=>{t._updateIconPosition(o.viewConfig),t._updateTabIconSource(o.viewConfig),t._updateTabHint(o.viewConfig)}),yield t._useTabPanelContainer)){const o=f.AXp.getViewConfigInfoByProperty("type","crt.TabPanel",i.viewConfig);for(const n of o){yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,n.viewConfig,"selectedTabIndex","","DisableSaveToProfileSelectedTabIndex");const a=t._getTabContainerBody(n),s=t._getTabContainerHeader(n);if(n.viewConfig.mode==="toggle"){const u={...a,name:n.viewConfig.name,visible:n.viewConfig.visible,selectedTab:n.viewConfig.selectedTab,layoutConfig:n.viewConfig.layoutConfig||{},stretch:n.viewConfig.stretch,classes:n.viewConfig.classes,fitContent:n.viewConfig.fitContent},d=t._convertViewConfigPropToBoolean(n.viewConfig,"isToggleTabHeaderVisible",!0);u.items.forEach(p=>{p.isToggleTabHeaderVisible=d}),Object.keys(n.viewConfig).forEach(p=>delete n.viewConfig[p]),Object.assign(n.viewConfig,u)}else n.viewConfig.items=[s,a]}}return e})()}}$t.\u0275fac=function(e){return new(e||$t)(l.LFG(D.UZ),l.LFG(z))},$t.\u0275prov=l.Yz7({token:$t,factory:$t.\u0275fac});class Lt{_getTagSelectViewConfigs(e){return f.AXp.getViewConfigInfoByProperty("type","crt.TagSelect",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processTagSelect(e,t,i){var r=this;return(0,m.Z)(function*(){if(!r._isRecordIdViewModelAttributeExist(e,t)){r._setTagSelectDisabled(t);return}yield r._setTagSelectRecordSchemaName(e,t,i),r._setTagSelectDisabledAttribute(e,t),yield r._setupTagSelect(e,t)})()}_setTagSelectDisabledAttribute(e,t){if(!this._isTagSelectDisabledAttributeFilled(t)){if(!this._isTagSelectRecordSchemaNameFilled(t)){this._setTagSelectDisabled(t);return}this._createAndAddTagSelectViewModelDisabledAttribute(e,t),t.disabled=`$${this._getTagSelectDisabledAttributeName(t)}`}}_setTagSelectDisabled(e){e.disabled=!0}_isTagSelectDisabledAttributeFilled(e){return"disabled"in e}_createAndAddTagSelectViewModelDisabledAttribute(e,t){const i=this._getAttributeName(t.recordId),r={from:i,converter:`crt.TagSelectDisabledAttributeConverter: '${i}'`},o=this._getTagSelectDisabledAttributeName(t);this._addViewModelConfigAttribute(e,o,r)}_setupTagSelect(e,t){var i=this;return(0,m.Z)(function*(){!i._isTagSelectRecordSchemaNameFilled(t)||(yield i._setupTagSelectDataViewModel(e,t),i._setupTagSelectInputs(t),yield i._setupTagSelectRequests(t))})()}_setupTagSelectDataViewModel(e,t){var i=this;return(0,m.Z)(function*(){i._createAndAddTagSelectItemsViewModelAttributeData(e,t),yield i._createAndAddTagSelectListItemsViewModelAttributeData(e,t)})()}_isRecordIdViewModelAttributeExist(e,t){return this._isViewModelAttributeExist(e,t.recordId)}_isViewModelAttributeExist(e,t){var i;if(!t)return!1;const r=Object.keys(((i=e.viewModelConfig)===null||i===void 0?void 0:i.attributes)||{}),o=this._getAttributeName(t);return r.includes(o)}_setupTagSelectRequests(e){var t=this;return(0,m.Z)(function*(){t._setShowListRequest(e),t._setPaginationChangeRequest(e),yield t._setCreateTagRequest(e),t._setEditTagRequest(e),t._setDeleteTagRequest(e),t._setAddTagsInRecordRequest(e),t._setDeleteTagInRecordRequest(e)})()}_setShowListRequest(e){if(e.showList)return;const t=this._getTagSelectListItemsDataSourceName(e),i=this._createLoadDataRequestConfig(t);i.params={...i.params,config:{loadType:"reload"}},e.showList=i}_setPaginationChangeRequest(e){if(e.paginationChange)return;const t=this._getTagSelectListItemsDataSourceName(e);e.paginationChange=this._createLoadDataRequestConfig(t)}_createLoadDataRequestConfig(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:e,parameters:[],primaryDisplayFilterValue:"@event.primaryDisplayFilterValue"},useRelativeContext:!0}}_setCreateTagRequest(e){var t=this;return(0,m.Z)(function*(){if(e.createTag)return;const i=yield t._getTagDataSchema(),r=t._getTagSelectListItemsAttributeName(e);e.createTag={request:"crt.CreateRecordRequest",params:{itemsAttributeName:r,defaultValues:[{attributeName:i.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"},{attributeName:v.trC,value:e.recordSchemaName}],skipUnsavedData:!0}}})()}_setEditTagRequest(e){e.editTag||(e.editTag={request:"crt.UpdateRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this._getTagSelectListItemsAttributeName(e),trackUnsavedData:!1}})}_setDeleteTagRequest(e){e.deleteTag||(e.deleteTag={request:"crt.DeleteRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this._getTagSelectListItemsAttributeName(e)}})}_setAddTagsInRecordRequest(e){if(e.addTagsInRecord)return;const t=this._getTagSelectItemsDataSourceName(e);e.addTagsInRecord={request:"crt.AddTagsInRecordRequest",params:{dataSourceName:t,tagIds:"@event.tagIds",recordId:e.recordId,recordSchemaName:e.recordSchemaName}}}_setDeleteTagInRecordRequest(e){if(e.deleteTagInRecord)return;const t=this._getTagSelectItemsDataSourceName(e);e.deleteTagInRecord={request:"crt.DeleteTagInRecordRequest",params:{dataSourceName:t,id:"@event.id"}}}_getAttributeName(e){return(0,N.Ht)(e)?e.slice(1):e}_setupTagSelectInputs(e){this._setItemsAttributeValue(e),this._setListItemsAttributeValue(e)}_setTagSelectRecordSchemaName(e,t,i){var r=this;return(0,m.Z)(function*(){if(r._isTagSelectRecordSchemaNameFilled(t))return;const o=yield r._getRecordSchemaName(e,t,i);!o||(t.recordSchemaName=o)})()}_isTagSelectRecordSchemaNameFilled(e){return!!e.recordSchemaName}_getRecordSchemaName(e,t,i){var r;if(!(!((r=e?.viewModelConfig)===null||r===void 0)&&r.attributes)||!i?.length)return Promise.resolve(null);const[o,n]=this._getRecordIdAttributeModelPaths(e.viewModelConfig.attributes,t.recordId);return this._getRecordSchemaNameFromModel(o,n,i)}_getRecordIdAttributeModelPaths(e,t){var i;const r=this._getAttributeName(t),o=e[r],n=(i=o?.modelConfig)===null||i===void 0?void 0:i.path,a=n?.split(".");return!a||a.length<2?["",""]:[a[0],a[1]]}_getRecordSchemaNameFromModel(e,t,i){var r=this;return(0,m.Z)(function*(){var o,n,a;if(!e||!t)return null;const s=i.find(y=>y.name===e);if(!s)return null;const u=yield(0,C.n)(s.getSchema()),d=u.findAttributeByName(t),p=(o=d.referenceSchemaName)!==null&&o!==void 0?o:null,g=(a=(n=u.dataSourceConfig)===null||n===void 0?void 0:n.config)===null||a===void 0?void 0:a.entitySchemaName;return p||r._getEntitySchemaNameFromDataSchema(g,d)})()}_getEntitySchemaNameFromDataSchema(e,t){if(t.attributeType===b.DataSchemaAttributeType.OwnAttribute)return Promise.resolve(e);const i=t.path.split(".");return this._findEntitySchemaNameByColumnPath(e,i)}_findEntitySchemaNameByColumnPath(e,t){var i=this;return(0,m.Z)(function*(){if(!e)return null;const r=t.shift();if(!r)return e;const n=(yield(0,C.n)(i._dataSchemaRepository.get(e))).attributes.find(a=>a.name===r);return n?.referenceSchemaName?i._findEntitySchemaNameByColumnPath(n.referenceSchemaName,t):e})()}_setItemsAttributeValue(e){if(e.items)return;const t=this._getTagSelectItemsAttributeName(e);e.items=`$${t}`}_setListItemsAttributeValue(e){if(e.listItems)return;const t=this._getTagSelectListItemsAttributeName(e);e.listItems=`$${t}`}_createAndAddTagSelectItemsViewModelAttributeData(e,t){this._createAndAddTagSelectItemsViewModelAttribute(e,t),this._createAndAddTagSelectItemsViewModelSortingAttribute(e,t),this._createAndAddTagSelectItemsViewModelFilterAttribute(e,t)}_createAndAddTagSelectListItemsViewModelAttributeData(e,t){var i=this;return(0,m.Z)(function*(){yield i._createAndAddTagSelectListItemsViewModelAttribute(e,t),i._createAndAddTagSelectListItemsViewModelSortingAttribute(e,t),i._createAndAddTagSelectListItemsViewModelFilterAttribute(e,t)})()}_createAndAddTagSelectItemsViewModelAttribute(e,t){const i=this._createItemsAttribute(t);this._addItemsAttributeViewModelConfig(i,t),this._addItemsEmbeddedDataSource(i,t),this._addItemsAttributeToViewModelConfig(e,t,i)}_createAndAddTagSelectListItemsViewModelAttribute(e,t){var i=this;return(0,m.Z)(function*(){const r=yield i._getTagDataSchema(),o=i._createListItemsAttribute(t,r);i._addListItemsAttributeViewModelConfig(o,t,r),i._addListItemsEmbeddedDataSource(o,t),i._addListItemsAttributeToViewModelConfig(e,t,o)})()}_createItemsAttribute(e){const t=this._getTagSelectItemsDataSourceName(e),i=this._getTagSelectItemsFilterAttributeName(e);return(0,zt.Z)(this._createCollectionAttribute(t),{modelConfig:{sortingConfig:this._getItemsSortingConfig(e),filterAttributes:[{name:i,loadOnChange:!0}]}})}_getItemsSortingConfig(e){return{default:[{columnName:"CreatedOn",direction:"desc"}],attributeName:this._getTagSelectItemsSortingAttributeName(e)}}_createListItemsAttribute(e,t){const i=this._getTagSelectListItemsDataSourceName(e),r=this._getTagSelectListItemsFilterAttributeName(e),o={sortingConfig:this._getListItemsSortingConfig(e,t),filterAttributes:[{name:r,loadOnChange:!0}],pagingConfig:{rowCount:30}};return(0,zt.Z)(this._createCollectionAttribute(i),{isLookup:!0,modelConfig:o})}_createCollectionAttribute(e){return{isCollection:!0,modelConfig:{path:e}}}_getListItemsSortingConfig(e,t){return{default:[this._getDefaultSortingColumn(t)],attributeName:this._getTagSelectListItemsSortingAttributeName(e)}}_getDefaultSortingColumn(e){return{columnName:e.primaryDisplayAttributeName,direction:"asc"}}_addItemsAttributeViewModelConfig(e,t){const i=this._getTagSelectItemsDataSourceName(t),r="Tag";e.viewModelConfig={attributes:{RelationRecordId:{modelConfig:{path:`${i}.Id`}},Id:{modelConfig:{path:`${i}.${r}.Id`}},Name:{modelConfig:{path:`${i}.${r}.Name`}},Color:{modelConfig:{path:`${i}.${r}.Color`}}}}}_addListItemsAttributeViewModelConfig(e,t,i){const r=this._getTagSelectListItemsDataSourceName(t),o={value:{modelConfig:{path:`${r}.${i.primaryAttributeName}`}},displayValue:{modelConfig:{path:`${r}.${i.primaryDisplayAttributeName}`}}};i.primaryColorAttributeName&&(o.primaryColorValue={modelConfig:{path:`${r}.${i.primaryColorAttributeName}`}}),e.viewModelConfig={attributes:o}}_addItemsEmbeddedDataSource(e,t){const i=this._getTagSelectItemsDataSourceName(t);e.embeddedModel=this._createEmbeddedDataSource(i,v.h88)}_addListItemsEmbeddedDataSource(e,t){const i=this._getTagSelectListItemsDataSourceName(t);e.embeddedModel=this._createEmbeddedDataSource(i,v.e3S)}_createEmbeddedDataSource(e,t){return{name:e,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t},hiddenInPageDesigner:!1}}}_addItemsAttributeToViewModelConfig(e,t,i){this._addViewModelConfigAttribute(e,this._getTagSelectItemsAttributeName(t),i)}_addListItemsAttributeToViewModelConfig(e,t,i){this._addViewModelConfigAttribute(e,this._getTagSelectListItemsAttributeName(t),i)}_addViewModelConfigAttribute(e,t,i){var r;!(!((r=e?.viewModelConfig)===null||r===void 0)&&r.attributes)||e.viewModelConfig.attributes[t]||(e.viewModelConfig.attributes[t]=i)}_createAndAddTagSelectItemsViewModelFilterAttribute(e,t){const r={from:this._getAttributeName(t.recordId),converter:`crt.TagSelectFilterAttributeConverter: '${t.recordSchemaName}'`},o=this._getTagSelectItemsFilterAttributeName(t);this._addViewModelConfigAttribute(e,o,r)}_createAndAddTagSelectListItemsViewModelFilterAttribute(e,t){const i={value:(0,v.DLC)(t.recordSchemaName)},r=this._getTagSelectListItemsFilterAttributeName(t);this._addViewModelConfigAttribute(e,r,i)}_createAndAddTagSelectItemsViewModelSortingAttribute(e,t){const i=this._createSortingAttributeConfig(),r=this._getTagSelectItemsSortingAttributeName(t);this._addViewModelConfigAttribute(e,r,i)}_createAndAddTagSelectListItemsViewModelSortingAttribute(e,t){const i=this._createSortingAttributeConfig(),r=this._getTagSelectListItemsSortingAttributeName(t);this._addViewModelConfigAttribute(e,r,i)}_createSortingAttributeConfig(){return{isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}}}_getTagDataSchema(){return(0,C.n)(this._dataSchemaRepository.get(v.e3S))}_getTagSelectDisabledAttributeName(e){return`${e.name}_Disabled`}_getTagSelectItemsAttributeName(e){return`${e.name}_Items`}_getTagSelectItemsFilterAttributeName(e){return`${this._getTagSelectItemsAttributeName(e)}_Filter`}_getTagSelectItemsDataSourceName(e){return`${this._getTagSelectItemsAttributeName(e)}_DS`}_getTagSelectItemsSortingAttributeName(e){return`${this._getTagSelectItemsAttributeName(e)}_Sorting`}_getTagSelectListItemsAttributeName(e){return`${e.name}_List_Items`}_getTagSelectListItemsDataSourceName(e){return`${this._getTagSelectListItemsAttributeName(e)}_DS`}_getTagSelectListItemsFilterAttributeName(e){return`${this._getTagSelectListItemsAttributeName(e)}_Filter`}_getTagSelectListItemsSortingAttributeName(e){return`${this._getTagSelectListItemsAttributeName(e)}_Sorting`}constructor(e){this._dataSchemaRepository=e}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){const r=e,o=i._getTagSelectViewConfigs(r);return yield Promise.all(o.map(n=>i._processTagSelect(r,n,t))),e})()}}Lt.\u0275fac=function(e){return new(e||Lt)(l.LFG(h.afi))},Lt.\u0275prov=l.Yz7({token:Lt,factory:Lt.\u0275fac});class Ot{constructor(e,t){this._quickFilterPreprocessorService=e,this._translateService=t}_getTimelineViewConfigs(e){return f.AXp.getViewConfigInfoByProperty("type","crt.Timeline",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_getFilterByOwnerConfig(e){const t={caption:this._translateService.instant("Timeline.OwnerFilterCaption"),hint:this._translateService.instant("Timeline.OwnerFilterHint"),icon:"person-button-icon",iconPosition:"left-icon",entitySchemaName:"Contact"};return{filterType:"lookup",name:"ByOwnerQuickFilterIn"+e,type:"crt.QuickFilter",config:t}}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){const i=e,r=t._getTimelineViewConfigs(i);return yield Promise.all(r.map(function(){var o=(0,m.Z)(function*(n){const a=t._getFilterByOwnerConfig(n.name);yield t._quickFilterPreprocessorService.crtOnMetaDataInit(a,e),n.quickFilterByOwnerConfig=a});return function(n){return o.apply(this,arguments)}}())),Promise.resolve(e)})()}}Ot.\u0275fac=function(e){return new(e||Ot)(l.LFG(ce),l.LFG($.sK))},Ot.\u0275prov=l.Yz7({token:Ot,factory:Ot.\u0275fac});class xt{_modifyInputType(e,t,i){var r,o;const n=e.control.replace("$",""),a=(o=(r=t.attributes[n])===null||r===void 0?void 0:r.modelConfig)===null||o===void 0?void 0:o.path;if(a){const s=this._getDataSchemaAttributeByPath(a,i);b.DataValueType.WEB_TEXT&&s?.dataValueType===b.DataValueType.WEB_TEXT&&(e.type="crt.WebInput")}}_getDataSchemaAttributeByPath(e,t){var i;const[r,o]=e.split("."),n=(i=t.dataSchemas[r])===null||i===void 0?void 0:i.attributes;let a;for(const s in n)if(n[s].path===o){a=n[s];break}return a}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){const o=e,n=f.AXp.getViewConfigInfoByProperty("type","crt.Input",o.viewConfig),a=f.AXp.getViewConfigInfoByProperty("type","crt.WebInput",o.viewConfig);return n.forEach(s=>{r._modifyInputType(s.viewConfig,o.viewModelConfig,i)}),a.forEach(s=>{r._modifyInputType(s.viewConfig,o.viewModelConfig,i)}),e})()}}xt.\u0275fac=function(e){return new(e||xt)},xt.\u0275prov=l.Yz7({token:xt,factory:xt.\u0275fac});var sr=_(39553);const lr={type:"string",maxLinesCount:2,maxLineLength:10},cr={type:"number",thousandAbbreviation:{enabled:!0}},ur="DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION";class Gt{constructor(e,t,i){this._entitySchemaService=t,this._entitySchemaProvider=i,this._isAdaptionDisabled=Boolean(e[ur])}_getWidgetViewConfigs(e){return f.AXp.getViewConfigInfoByPropertyForValues("type",["crt.ChartWidget"],e).map(t=>t?.viewConfig)}_adaptAxesFormatting(e){var t=this;return(0,m.Z)(function*(){var i,r;const{scales:o,series:n}=(i=e?.config)!==null&&i!==void 0?i:{},a=(r=o?.xAxis)!==null&&r!==void 0?r:{};!t._isDefaultXAxisFormat(a)||!(yield t._isAllSeriesGroupingByNumericColumn(n))||(a.formatting=cr)})()}_isDefaultXAxisFormat(e){return(0,We.Z)(e?.formatting,lr)}_isAllSeriesGroupingByNumericColumn(e){var t=this;return(0,m.Z)(function*(){if(!e?.length)return!1;for(const i of e)if(!(yield t._isSeriesGroupingByNumericColumn(i)))return!1;return!0})()}_isSeriesGroupingByNumericColumn(e){var t=this;return(0,m.Z)(function*(){var i,r,o,n;const{schemaName:a,grouping:s}=(r=(i=e?.data)===null||i===void 0?void 0:i.providing)!==null&&r!==void 0?r:{};if(s?.type!==sr.P.ByValue)return!1;const u=(n=(o=s.column)===null||o===void 0?void 0:o.expression)===null||n===void 0?void 0:n.columnPath;if(!a||!u)return!1;const d=yield(0,O.z)(t._entitySchemaProvider.getSchemaByName(a)),p=yield(0,O.z)(t._entitySchemaService.getEntitySchemaColumnsInformationByPath(d.uId,u));return f.ydH.includes(p?.dataValueType)})()}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(t._isAdaptionDisabled)return e;const i=e,r=t._getWidgetViewConfigs(i.viewConfig).map(o=>t._adaptAxesFormatting(o));return yield Promise.all(r),e})()}}Gt.\u0275fac=function(e){return new(e||Gt)(l.LFG(f.Sfm),l.LFG(f.t1w),l.LFG(f.$JO))},Gt.\u0275prov=l.Yz7({token:Gt,factory:Gt.\u0275fac});var A=_(93517);const ni=new l.OlP("Represents a factory of widget data providing metadata compressors");var Ri=_(79676);const Ei=new l.OlP("Represents a list of widget element types that support data source");class kt{constructor(e,t,i){this._featureService=e,this._widgetDataProvidingMetadataCompressorFactory=i,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(A.mS2).pipe((0,Ri.P)(),(0,w.U)(Boolean),(0,w.U)(t=>!t));return(0,C.n)(e)}_getWidgetViewConfigs(e){return f.AXp.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>Boolean(t?.name)&&Boolean(t?.config))}_compressWidgetDataProvidingMetadata(e,t){var i;(i=this._widgetDataProvidingMetadataCompressorFactory.create(e.type))===null||i===void 0||i.compress(e.name,t)}crtOnMetaDataChanged(e){var t=this;return(0,m.Z)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const i=e;return t._getWidgetViewConfigs(i.viewConfig).forEach(r=>t._compressWidgetDataProvidingMetadata(r,i)),e})()}}kt.\u0275fac=function(e){return new(e||kt)(l.LFG(D.UZ),l.LFG(Ei,8),l.LFG(ni))},kt.\u0275prov=l.Yz7({token:kt,factory:kt.\u0275fac});function dr(){return k.FactoryProvider.create({token:ni,mappings:[{predicate:A.yZp,injectable:A.R1n},{predicate:A.lWP,injectable:A.bSu},{predicate:A.O7h,injectable:A.bSu}]})}class U{static for(...e){return{ngModule:U,providers:[{provide:h.E5$,useFactory:(t,i)=>new kt(t,e,i),deps:[D.UZ,ni],multi:!0}]}}}U.\u0275fac=function(e){return new(e||U)},U.\u0275mod=l.oAB({type:U}),U.\u0275inj=l.cJS({providers:[dr()],imports:[A.hU6,A.Op8]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.kYT(U,{imports:[A.hU6,A.Op8]})}();const ai=new l.OlP("Represents a factory of widget data providing metadata generators");var mr=_(67144);class qt{constructor(e,t,i){this._featureService=e,this._widgetDataProvidingMetadataGeneratorFactory=i,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(A.mS2).pipe((0,Ri.P)(),(0,w.U)(Boolean),(0,w.U)(t=>!t));return(0,C.n)(e)}_getWidgetViewConfigs(e){return f.AXp.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>Boolean(t?.name)&&Boolean(t?.config))}_generateWidgetDataProvidingMetadata(e,t){return this._widgetDataProvidingMetadataGeneratorFactory.create(e.type).generate(e,t)}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const i=e;return t._getWidgetViewConfigs(i.viewConfig).map(r=>t._generateWidgetDataProvidingMetadata(r,i)).forEach(r=>(0,mr.Z)(i,r)),e})()}}qt.\u0275fac=function(e){return new(e||qt)(l.LFG(D.UZ),l.LFG(Ei,8),l.LFG(ai))},qt.\u0275prov=l.Yz7({token:qt,factory:qt.\u0275fac});function pr(){return k.FactoryProvider.create({token:ai,mappings:[{predicate:A.yZp,injectable:A.Jmt},{predicate:A.O7h,injectable:A.Y9S},{predicate:A.lWP,injectable:A.Y9S}]})}class G{static for(...e){return{ngModule:G,providers:[{provide:h.Gp3,useFactory:(t,i)=>new qt(t,e,i),deps:[D.UZ,ai],multi:!0}]}}}G.\u0275fac=function(e){return new(e||G)},G.\u0275mod=l.oAB({type:G}),G.\u0275inj=l.cJS({providers:[pr()],imports:[A.p$q,A.DNs]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.kYT(G,{imports:[A.p$q,A.DNs]})}();class Zt{constructor(e){this._featureService=e,this._chartWidgetName="crt.ChartWidget",this._indicatorWidgetName="crt.IndicatorWidget",this._gaugeWidgetName="crt.GaugeWidget"}_getWidgetsArray(e){const t=f.AXp.getViewConfigInfoByProperty("type",this._chartWidgetName,e.viewConfig),i=f.AXp.getViewConfigInfoByProperty("type",this._indicatorWidgetName,e.viewConfig),r=f.AXp.getViewConfigInfoByProperty("type",this._gaugeWidgetName,e.viewConfig);return[...t,...i,...r]}_getWidgetName(e){return e.name.replace(/\./g,"_")}_getDataSetSortinAttributeName(e){return`${e.split(" ").join("").replace(/\./g,"_")}_ListDataDSSorting`}get _isDrillDownFeatureEnabled(){return(0,C.n)(this._featureService.getFeatureState(A.LX_))}crtOnModelInit(e,t){var i=this;return(0,m.Z)(function*(){const r=e,o=i._getWidgetsArray(r);for(const n of o){const a=n?.viewConfig;let s=r.viewModelConfig.attributes;s||(s=r.viewModelConfig.attributes={});const u=i._getWidgetName(a),d=`${h.$40}_${u}`,p=i._getDataSetSortinAttributeName(d),g=`${d}_ListData`,y=`${g}_SearchFilter`;s[`${d}_ListConfig`]={value:[]},s[`${d}_UserProfileData`]={value:[]},s[g]={isCollection:!0,modelConfig:{path:`${d}_ListDataDS`,sortingConfig:{attributeName:p},filterAttributes:[{name:y,loadOnChange:!0}]},viewModelConfig:{attributes:{}}},p&&(s[p]={value:[]}),s[y]={value:{}}}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,m.Z)(function*(){const o=e,n=r._getWidgetsArray(o);for(const a of n){const s=a?.viewConfig,u=r._getWidgetName(s),d=`${h.$40}_${u}`,p=`${d}_ListDataDS`,g=`${d}_ListConfig`,y=`${d}_ListData`,S=`${d}_UserProfileData`,P=`${y}_SearchFilter`;s.listData=`$${y}`,s.listConfig=`$${g}`,s.userProfileData=`$${S}`,s.drillDown={request:"crt.WidgetDrilldownRequest",params:{dataSourceName:p,listConfigAttributeName:g,listDataAttributeName:y,parameters:[],config:{schemaName:"@event.schemaName",groupByValue:"@event.groupByValue",pagingConfig:"@event.pagingConfig",sortingConfig:"@event.sortingConfig",groupBy:"@event.groupBy",aggregateBy:"@event.aggregateBy",columns:"@event.columns",filters:"@event.filters",dependencies:"@event.dependencies"}}},s.paginationChange=Ci(p),s.getProfileColumns={request:"crt.AnalyticsDataGridGetColumnsRequest",params:{userProfileDataAttributeName:S,widgetAttributePrefix:d,drilldownConfig:"@event.drilldownConfig",schemaName:"@event.schemaName",isDefault:!1}},s.columnsChange={request:"crt.AnalyticsDataGridSaveToProfileRequest",params:{schemaName:"@event.schemaName",isDefault:!1,dataTableData:"@event.dataTableData",listConfigAttributeName:g}},s.searchFilterChange={request:"crt.SearchFilterRequest",params:{value:"@event.value",searchFilterTargets:[{columns:"@event.columns",viewAttributeName:y,filterAttributeName:P}]}}}return e})()}crtOnMetaDataInit(e){var t=this;return(0,m.Z)(function*(){var i,r,o;if(!(yield t._isDrillDownFeatureEnabled))return e;const n=e,a=t._getWidgetsArray(n);for(const s of a)!s.viewConfig||((i=s.viewConfig)===null||i===void 0?void 0:i.pagingConfig)||(s.viewConfig.pagingConfig=Ai(),(r=(o=s.viewConfig).fullScreenStateChanged)!==null&&r!==void 0||(o.fullScreenStateChanged={request:"crt.WidgetFullScreenStateChangesRequest",params:{widgetName:s.viewConfig.name,fullScreenState:"@event"}}));return e})()}}Zt.\u0275fac=function(e){return new(e||Zt)(l.LFG(D.UZ))},Zt.\u0275prov=l.Yz7({token:Zt,factory:Zt.\u0275fac});class ue{}ue.\u0275fac=function(e){return new(e||ue)},ue.\u0275mod=l.oAB({type:ue}),ue.\u0275inj=l.cJS({providers:[{provide:h.Gp3,useClass:Zt,multi:!0},{provide:h.Gp3,useClass:Gt,multi:!0}],imports:[G.for(A.yZp,A.lWP,A.O7h)]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.kYT(ue,{imports:[G]})}();class Ut{}Ut.\u0275fac=function(e){return new(e||Ut)},Ut.\u0275mod=l.oAB({type:Ut}),Ut.\u0275inj=l.cJS({providers:[v.uoG,F.yL,F.nk,F.mz,{provide:h.Gp3,useClass:oe,multi:!0},{provide:h.Gp3,useClass:tt,multi:!0},{provide:h.Gp3,useClass:it,multi:!0},{provide:h.Gp3,useClass:ot,multi:!0},{provide:h.Gp3,useClass:nt,multi:!0},{provide:h.Gp3,useClass:Ke,multi:!0},{provide:h.Gp3,useClass:rt,multi:!0},{provide:h.Gp3,useClass:et,multi:!0},{provide:h.Gp3,useClass:It,multi:!0},{provide:h.Gp3,useClass:Tt,multi:!0},{provide:h.Gp3,useClass:lt,multi:!0},{provide:h.Gp3,useClass:at,multi:!0},{provide:h.Gp3,useClass:dt,multi:!0},{provide:h.Gp3,useClass:Pe,multi:!0},{provide:h.Gp3,useClass:Ne,multi:!0},{provide:h.Gp3,useClass:Ie,multi:!0},{provide:h.Gp3,useClass:_t,multi:!0},{provide:h.Gp3,useClass:vt,multi:!0},{provide:h.Gp3,useClass:je,multi:!0},{provide:h.Gp3,useClass:St,multi:!0},{provide:h.Gp3,useClass:$t,multi:!0},{provide:h.Gp3,useClass:ke,multi:!0},{provide:h.Gp3,useClass:Ye,multi:!0},{provide:h.Gp3,useClass:mt,multi:!0},ie,Z,Te,re,v.PXA,Ve,Be,$e,z,ce,{provide:h.Gp3,useClass:qe,multi:!0},{provide:h.Gp3,useClass:Ze,multi:!0},{provide:h.Gp3,useClass:pt,multi:!0},{provide:h.Gp3,useClass:st,multi:!0},{provide:h.Gp3,useClass:wt,multi:!0},{provide:h.Gp3,useClass:At,multi:!0},{provide:h.Gp3,useClass:Nt,multi:!0},{provide:h.Gp3,useClass:Mt,multi:!0},{provide:h.Gp3,useClass:Rt,multi:!0},{provide:h.Gp3,useClass:xt,multi:!0},{provide:h.Gp3,useClass:He,multi:!0},{provide:h.Gp3,useClass:yt,multi:!0},{provide:h.Gp3,useClass:Oe,multi:!0},{provide:h.Gp3,useClass:ve,multi:!0},{provide:h.Gp3,useClass:Me,multi:!0},{provide:h.Gp3,useClass:Dt,multi:!0},{provide:h.Gp3,useClass:gt,multi:!0},{provide:h.Gp3,useClass:ft,multi:!0},{provide:h.Gp3,useClass:Et,multi:!0},{provide:h.Gp3,useClass:Ot,multi:!0},{provide:h.Gp3,useClass:Vt,multi:!0},{provide:h.Gp3,useClass:bt,multi:!0},{provide:h.Gp3,useClass:Se,multi:!0},{provide:h.Gp3,useClass:Ct,multi:!0},{provide:h.Gp3,useClass:Lt,multi:!0},{provide:h.Gp3,useClass:ht,multi:!0}],imports:[W.ez,le,Y.withModifiers([["crt.DataGrid",v.uoG]]),ue,Fe,H,Le,j]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.kYT(Ut,{imports:[W.ez,le,Y,ue,Fe,H,Le,j]})}();class Wt{_getHeaders(e){return f.AXp.getViewConfigInfoByProperty("type","crt.HeaderContainer",e.viewConfig)}crtOnModelInit(e,t){var i,r;const o=e,n=(i=o?.viewModelConfig)===null||i===void 0?void 0:i.attributes,a=this._getHeaders(o)[0];if(a){const s="HeaderCaption";n[s]={value:""},a.viewConfig.title=`$${s}`,a.viewConfig.styles={"border-top-left-radius":"8px","border-top-right-radius":"8px"},!((r=o.tag)===null||r===void 0)&&r.includes("BaseGridSectionTemplate")&&(a.viewConfig.styles["margin-bottom"]="0px")}return Promise.resolve(e)}}Wt.\u0275fac=function(e){return new(e||Wt)},Wt.\u0275prov=l.Yz7({token:Wt,factory:Wt.\u0275fac});var V=_(13336),si=_(52663),li=_(87683),fr=_(63052),gr=_.n(fr),Vi=_(25407),q=_(7976),hr=_(55953),vr=_(79641),Bi=_(22063),_r=_(27986),yr=_(66393),br=_(83787),Sr=_(15696),Cr=_(54121),de=_(98168),ci=_(65598),$i=_(54882),Ar=_(11770),me;(function(c){c.Copy="copy",c.Add="add",c.Edit="edit"})(me||(me={}));var Dr=_(87687);class X{constructor(e,t,i,r,o,n,a){this._designerService=e,this._interfaceDesignerFeature=t,this._environment=i,this._featureValues=r,this._injector=o,this._designerDataSourceManager=n,this._browserExtensionsService=a,this._destroyed$=new bi.x,this._notificationDuration=9e3,this._saveEntityDataSourcesCommandName="crt.SaveEntityDataSourcesCommand",this._isSchemaChanged=!1,this._isSchemaCopied=!1,this._saving=!1,this._injectDependencies(),this.sysSettings$=this._sysSettingsService.getByCodes(["CurrentPackageId","CustomPackageUId","SchemaNamePrefix"]).pipe((0,w.U)(s=>s?.values),(0,Ii.B)())}get schemaCaption(){return this._schemaCaption}set schemaCaption(e){this._schemaCaption=e,this._updateDocumentTitle()}get isSchemaChanged(){return this._isSchemaChanged}set isSchemaChanged(e){this._isSchemaChanged=e,this._isSchemaChanged$.next(e)}get _isDesignItemChanged(){return this.isSchemaChanged?!0:this.designItem.schema.addons.some(e=>e.isChanged)}_injectDependencies(){this._activatedRoute=this._injector.get(q.gz),this._notifyService=this._injector.get(ee.c),this._sysSettingsService=this._injector.get(D.lI),this._maskService=this._injector.get(ee.Bm),this._userInfo=this._injector.get(f.aoG),this._dialogService=this._injector.get(ee.xA),this._messageDialogProvider=this._injector.get(v.rBX),this._commandFactoryService=this._injector.get(ne.T9),this._translateService=this._injector.get($.sK),this._appInfoService=this._injector.get(D.zz),this._window=this._injector.get(k.WINDOW_TOKEN),this._interfaceDesignerType=this._injector.get(V.v1l),this._googleTagManager=this._injector.get(D.kK),this._workspaceReloadBroadcastChannel=this._injector.get(k.BroadcastChannelFactory).createInstance(hr.Kp),this._clientSchemaSavedBroadcastChannel=this._injector.get(k.BroadcastChannelFactory).createInstance(f.kxM),this._designerSchemaService=this._injector.get(ne.cj),this._currentPackageService=this._injector.get(yi.RR),this._currentPageSchemaPackageService=this._injector.get(te.Bj),this._designerSyncService=this._injector.get(ne.$Q),this._designerEntityService=this._injector.get(V.b1m),this._changeDetectorRef=this._injector.get(l.sBO),this._ngZone=this._injector.get(l.R0b),this._titleService=this._injector.get(x.yDd),this._isSchemaChanged$=this._injector.get(V.lqK,null),this._errorHandler=this._injector.get(f.m7n)}_updateSchemaCaption(){const{schema:e}=this.designItem;this.schemaCaption=e.caption.getValue(this._userInfo.cultureInfo.sysCultureName)||e.caption.getValue(this._userInfo.defCultureInfo.sysCultureName)}_getCurrentPackageId(e){return e?(0,M.of)(e):this._currentPackageService.getDesignPackageUId(this.schemaUId||this._parentSchemaUId).pipe((0,E.w)(({uId:t,success:i})=>{if(!t||!i){const r="Can`t get current package uId";return this._maskService.hideBodyMask(),(0,yr.D)(this._notifyService.error({message:r,duration:this._notificationDuration})).pipe((0,E.w)(()=>(0,br._)(()=>new Error(r))))}return(0,M.of)(t)}))}_commandExecute(e,t){const i={saveResponse:t,schemaDesignItem:this.designItem,notificationDuration:this._notificationDuration};return this._commandFactoryService.create(e,i).pipe((0,E.w)(r=>r.execute()),(0,he.R)(this._destroyed$))}_saveDesignItem(){return this._designerService.saveDesignItem(this.designItem).pipe((0,E.w)(e=>{if(this._environment&&this._environment.appPath==="/"&&!this._environment.production)return this.isSchemaChanged=!1,this._isSchemaCopied=!1,this._maskService.hideBodyMask(),this._notifyService.show({message:"Saved",translate:!1}).then(),(0,M.of)({success:!0});const i=this._interfaceDesignerFeature.afterDesignerItemSaved;return this._commandExecute(i,e)}),(0,w.U)(e=>{if(this._maskService.hideBodyMask(),e.success){this.schemaUId=this.designItem.schema.uId,this.designItem.extendSchema=!1;const t=Boolean(this.designItem.isNew);return this.designItem.isNew=!1,this.isSchemaChanged=!1,this._isSchemaCopied=!1,this._workspaceReloadBroadcastChannel.publish(),this._clientSchemaSavedBroadcastChannel.publish({uId:this.schemaUId,name:this.designItem.schema.name,caption:this.schemaCaption,isNew:t}),!0}return"message"in e&&this._notifyService.error({message:e.message,duration:0}).then(),!1}),(0,he.R)(this._destroyed$))}_notifyStartSchemaDesign(e){this._window.parent.postMessage({type:"StartSchemaDesign",schemaUId:e.schema.uId},this._window.location.origin)}_sendGTMData(){const e=this._interfaceDesignerType.getPageType(this.designItem),t={moduleName:"ModuleDesigner",schemaName:"InterfaceDesigner",description:e};this._googleTagManager.track(t)}_openClientUnitSchemaDesigner(){const e=this._appInfoService.getClientUnitSchemaDesignerUrl(this.schemaUId);this._window.open(e,"_blank")}_setEntityDataSource(e){const t=this._commandFactoryService;return this._designerSchemaService.schemaLoaded$.pipe((0,E.w)(()=>(0,ne.mk)(t,"crt.SetEntityDataSourceCommand",{entitySchemaName:e})))}_setRelatedPage(e,t,i,r){const o=this._commandFactoryService,n=new V.zKT;return n.action=i,n.roleId=r,n.pageSchemaUId=e,n.entitySchemaName=t,(0,ne.mk)(o,"crt.UpdateEntityRelatedPageAddonCommand",n)}_exitDesigner(){if(this._callbackUrl){this._window.open(this._callbackUrl,"_self");return}this._window.close()}_reloadDesigner(){this._window.location.reload()}_saveWithConfirmation(e){this._confirmSaveSchema("InterfaceDesigner.SaveConfirmationDialog.Message").pipe((0,E.w)(t=>t===v.sBu.SAVE.key?this.onSave().pipe((0,de.b)(i=>{i&&e?.()})):(t===v.sBu.DO_NOT_SAVE.key&&(this.isSchemaChanged=!1,e?.()),(0,M.of)(void 0))),(0,he.R)(this._destroyed$)).subscribe()}_confirmSaveSchema(e,t=!1){const i=t?[v.sBu.CANCEL,v.sBu.SAVE]:[v.sBu.CANCEL,v.sBu.DO_NOT_SAVE,v.sBu.SAVE];return this._messageDialogProvider.open({data:{message:e,actions:i}})}_checkModelCircularDependencies(){const e=this._designerSchemaService.getModelDependencies(),t=(0,f.tlO)(e);if(t.hasCycles){const i=this._translateService.instant("InterfaceDesigner.ModelDependencyCycleDetectedError"),r=Ar.Ld.format(i,t.cycledModelsNames.join(", "));this._notifyService.show({message:r}),console.error(r)}return t.hasCycles}_save(){return this._saving||(this._saving=!0,!this._commandFactoryService.exists(this._saveEntityDataSourcesCommandName))||this._checkModelCircularDependencies()?(0,M.of)(!1):(this._maskService.showBodyMask({delay:500}),this._errorHandler.handleRequestWithAccumulation(this._designerSyncService.complete$().pipe((0,E.w)(()=>this._commandFactoryService.create(this._saveEntityDataSourcesCommandName)),(0,E.w)(e=>e.execute()),(0,E.w)(e=>e.success?this._saveDesignItem():(this._maskService.hideBodyMask(),(0,M.of)(!1))),(0,de.b)(()=>{this._saving=!1}))).pipe((0,he.R)(this._destroyed$)))}_updateDocumentTitle(){const e=this._translateService.instant("InterfaceDesigner.Caption"),t=[this.schemaCaption,e].join(" - ");this._titleService.setTitle(t)}_initDesignItem(e){var t,i,r;this.designItem=e,e.isNew&&((t=this._isSchemaChanged$)===null||t===void 0||t.next(!0)),this._notifyStartSchemaDesign(e);const o=(i=this.designItem.schema)!==null&&i!==void 0?i:{};this.pageProperties={uId:o.uId,name:o.name,caption:o.caption,description:o.description,packageName:((r=o.package)===null||r===void 0?void 0:r.name)||null,extendParent:o.extendParent,schemaNamePrefix:this._schemaNamePrefix},this._updateSchemaCaption()}_listenBrowserExtensions(){this._browserExtensionsService.addListener("interfaceDesigner.getIntermediateConfigJson",()=>{const e=(0,_r.Z)(this.designItem.bundle,"viewConfig","viewModelConfig","modelConfig");return JSON.stringify(e,null,2)})}ngOnInit(){this._maskService.showBodyMask({delay:0}),(0,Sr.a)([this.sysSettings$,this._activatedRoute.paramMap,this._activatedRoute.data,this._activatedRoute.queryParams]).pipe((0,E.w)(([e,t,{operation:i},r])=>{var o,n,a,s;const u=(o=e.SchemaNamePrefix)===null||o===void 0?void 0:o.value;this._schemaNamePrefix=u,this.schemaUId=t.get("id"),this._parentSchemaUId=r.parentSchemaUId;const d=r.workplace,p=r.entitySchemaName,g=r.entitySchemaCaption,y=r.relatedPageAction,S=r.roleId,P=r.isRelatedPage,I=r.callbackUrl;let T=r.useFullHierarchy==="true";this._featureValues.DisableInterfaceDesignerUseFullHierarchy&&(T=!1),this._callbackUrl=I&&decodeURIComponent(I);let K=r.packageUId;return this._featureValues.DoNotUseGetDesignPackageUId&&(K=(a=K??((n=e.CurrentPackageId)===null||n===void 0?void 0:n.value))!==null&&a!==void 0?a:(s=e.CustomPackageUId)===null||s===void 0?void 0:s.value),this._getCurrentPackageId(K).pipe((0,de.b)(Ge=>this._currentPageSchemaPackageService.setCurrentPackageUId(Ge)),(0,w.U)(Ge=>({packageUId:Ge,schemaNamePrefix:u,operation:i,workplace:d,entitySchemaName:p,entitySchemaCaption:g,relatedPageAction:y,roleId:S,isRelatedPage:P,useFullHierarchy:T})))}),(0,E.w)(({packageUId:e,schemaNamePrefix:t,operation:i,workplace:r,entitySchemaName:o,entitySchemaCaption:n,relatedPageAction:a,roleId:s,isRelatedPage:u,useFullHierarchy:d})=>this._designerService.initDesignItem(this.schemaUId,e,d).pipe((0,E.w)(p=>{switch(p.schema.useFullHierarchy=d,i){case me.Copy:return this._isSchemaCopied=!0,this._designerService.copyDesignItem(p,e,t);case me.Add:return this._designerService.setDesignItemDefaultPropertyValues(p.schema,"Page",t,r,n),o&&this._setEntityDataSource(o).pipe((0,E.w)(()=>u?this._setRelatedPage(p.schema.uId,o,a,s).pipe((0,w.U)(()=>p)):(0,M.of)(null)),(0,he.R)(this._destroyed$)).subscribe(),(0,M.of)(p);default:return(0,M.of)(p)}}),(0,de.b)(p=>this._initDesignItem(p)),(0,de.b)(()=>this._sendGTMData())))).subscribe(),this._listenBrowserExtensions()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}onSave(){this._dialogService.closeAll();const e=this.designItem.isNew;return this._save().pipe((0,de.b)(t=>{if(t&&this._callbackUrl&&e){this._callbackUrl=this._callbackUrl+"&createdSchemaUId="+this.schemaUId,this._window.open(this._callbackUrl,f.nNh.Self);return}}),(0,he.R)(this._destroyed$))}onCancel(){this._isDesignItemChanged?this._saveWithConfirmation(()=>this._reloadDesigner()):this._reloadDesigner()}onClose(){if(this._callbackUrl){this._window.open(this._callbackUrl,"_self");return}this._isDesignItemChanged?this._saveWithConfirmation(()=>this._exitDesigner()):this._window.close()}onOpenSchemaProperty(){var e;const{caption:t,name:i,extendParent:r,uId:o,description:n}=this.designItem.schema;this.pageProperties={uId:o,caption:t,name:i,packageName:((e=this.designItem.schema.package)===null||e===void 0?void 0:e.name)||null,description:n,extendParent:r,schemaNamePrefix:this._schemaNamePrefix},this._changeDetectorRef.detectChanges()}onOpenSourceCode(){const e=!this.schemaUId;this._isDesignItemChanged||e?this._confirmSaveSchema("InterfaceDesigner.SaveMessage",e).pipe((0,E.w)(t=>t===v.sBu.SAVE.key?this.onSave():(t===v.sBu.DO_NOT_SAVE.key&&this._openClientUnitSchemaDesigner(),(0,M.of)(null))),(0,de.b)(t=>{t&&this._openClientUnitSchemaDesigner()})).subscribe():this._isSchemaCopied?this.onSave().pipe((0,de.b)(t=>{t&&this._openClientUnitSchemaDesigner()})).subscribe():this._openClientUnitSchemaDesigner()}onPagePropertiesChanged(e){const{name:t,caption:i,description:r}=e,o=this.designItem.schema.name;this.pageProperties={...this.pageProperties,name:t,caption:i,description:r},this.designItem.schema.name=t,this.designItem.schema.caption=i,this.designItem.schema.description=r,this.designItem.schema.updateBodySchemaName(o,t),this._updateSchemaCaption(),this.isSchemaChanged=!0}onSchemaChanged(e){this.designItem.bundle=e,this.isSchemaChanged=!0}onBeforeUnload(){if(this._isDesignItemChanged&&this._environment.production)return!1}openSetupBusinessRulesAddonsDialog(){this._designerDataSourceManager.getDataSources$(b.DataSourceScope.Page).pipe((0,ci.q)(1),(0,$i.z)(e=>{const t=e.filter(i=>i.type===f.Iu0);return t.length===0?(0,M.of)([]):(0,Pi.D)(t.map(i=>i.getSchema().pipe((0,ci.q)(1),(0,$i.z)(r=>this._designerEntityService.getByName(r.name).pipe((0,ci.q)(1),(0,w.U)(o=>({schema:o})))))))}),(0,E.w)(e=>{const t=e.map(i=>({...i,applicabilityType:Bi.tH.DataSource}));return this._dialogService.open(vr.Jx,{data:[{schema:this.designItem.schema,applicabilityType:Bi.tH.Page},...t],panelClass:["business-rules-dialog"],hasBackdrop:!1,width:"100vw",height:"100vh",disableClose:!0,maxWidth:"100vw"})})).subscribe()}}X.\u0275fac=function(e){return new(e||X)(l.Y36(te.Vx),l.Y36(V.OWo),l.Y36("environment"),l.Y36(f.Sfm),l.Y36(l.zs3),l.Y36(V.D_V),l.Y36(f.q2J))},X.\u0275cmp=l.Xpm({type:X,selectors:[["crt-interface-designer"]],hostBindings:function(e,t){e&1&&l.NdJ("beforeunload",function(){return t.onBeforeUnload()},!1,l.Jf7)},features:[l._Bn([{provide:V.lqK,useValue:new Cr.X(!1)}])],decls:1,vars:4,consts:[[1,"interface-designer",3,"ngClass","title","designItem","pageProperties","schemaChanged","save","cancel","closeDesigner","openProperty","openSourceCode","pagePropertiesChanged","openBusinessRuleDesigner"]],template:function(e,t){e&1&&(l.TgZ(0,"crt-base-interface-designer",0),l.NdJ("schemaChanged",function(r){return t.onSchemaChanged(r)})("save",function(){return t.onSave().subscribe()})("cancel",function(){return t.onCancel()})("closeDesigner",function(){return t.onClose()})("openProperty",function(){return t.onOpenSchemaProperty()})("openSourceCode",function(){return t.onOpenSourceCode()})("pagePropertiesChanged",function(r){return t.onPagePropertiesChanged(r)})("openBusinessRuleDesigner",function(){return t.openSetupBusinessRulesAddonsDialog()}),l.qZA()),e&2&&l.Q6J("ngClass","bright-theme")("title",t.schemaCaption)("designItem",t.designItem)("pageProperties",t.pageProperties)},dependencies:[Dr.K,W.mk],styles:[".interface-designer[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100vh}"]});const Fr=[{path:"copy/:id",component:X,data:{operation:me.Copy}},{path:"add",component:X,data:{operation:me.Add}},{path:":id",component:X,data:{operation:me.Edit}},{path:"",component:X,data:{operation:me.Add}}];class pe{}pe.\u0275fac=function(e){return new(e||pe)},pe.\u0275mod=l.oAB({type:pe}),pe.\u0275inj=l.cJS({imports:[q.Bz.forChild(Fr),q.Bz]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.kYT(pe,{imports:[q.Bz],exports:[q.Bz]})}();function Li(){return gr()}let Q=class{};Q.\u0275fac=function(e){return new(e||Q)},Q.\u0275mod=l.oAB({type:Q}),Q.\u0275inj=l.cJS({providers:[x.Jcg,L.kL,f.eGj,V.fx6,f.V1j,yi.RR,te.rN,h.zuO,h.DNu,Qt.h,{provide:A.Jmt,useExisting:A.hzE},{provide:f.laC,useClass:Qt.h},{provide:f.IkY,useClass:Qt.h},f.nDc,{provide:f.m7n,useClass:li.vH},{provide:f.ZsW,useFactory:c=>c,deps:[f.m7n]}],imports:[V.y54,A.zlN,te.zU,W.ez,v.MV_,A.Kxl,si.EW,A.IVQ,A.o_E,pe,x._yf,ee._M,fi.yu,gi.yj,hi.wp,vi.x4,ee.cB,pi.UX,_i.Kq,V.VNZ,$.aw.forChild({defaultLanguage:"en-US",loader:{provide:$.Zw,useFactory:(c,e)=>new ki.w(c,e),deps:[mi.eN,f.AC6]}}),Vi.CT.forRoot({player:Li}),Xt.je,ye,_e,H,j,be,V.TkB,G.for(A.yZp,A.lWP,A.O7h),U.for(A.yZp,A.lWP,A.O7h)]}),Q=(0,Gi.gn)([(0,b.CrtModule)({includes:[x.kLW,v.MV_,A.zlN,A.IVQ,A.o_E,A.Kxl,si.EW,V.y54]})],Q),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.kYT(Q,{declarations:[X],imports:[V.y54,A.zlN,te.zU,W.ez,v.MV_,A.Kxl,si.EW,A.IVQ,A.o_E,pe,x._yf,ee._M,fi.yu,gi.yj,hi.wp,vi.x4,ee.cB,pi.UX,_i.Kq,V.VNZ,$.aw,Vi.CT,Xt.je,ye,_e,H,j,be,V.TkB,G,U]})}();var ui=_(85193),Oi=_(82909);const Nr=new Map([["Dashboard","HomePageDesigner"],["Page","PageDesigner"],["Desktop","DesktopPageDesigner"],["MiniPage","ModalPageDesigner"]]);var J;(function(c){c.Copy="copy",c.Create="create",c.Open="open"})(J||(J={}));class fe{constructor(e,t,i,r,o,n,a,s,u,d){this._route=e,this._router=t,this._maskService=i,this._clientUnitSchemaDesignerAPI=r,this._workspaceOpenCreateDialogService=o,this._snackBar=n,this._googleTagManagerService=a,this._titleService=s,this._translateService=u,this._window=d,this._defaultDesigner="HomePageDesigner",this._navigationBehaviorOptions={replaceUrl:!0}}_getCurrentRouteSnapshot(e){let t=e;for(;t.firstChild;)t=t.firstChild;return t}_track(e,t){this._googleTagManagerService.track({action:e,schemaName:t,moduleName:"InterfaceDesigner"})}_navigateToDesigner(e,t,i,r){var o;const n=(o=Nr.get(t))!==null&&o!==void 0?o:this._defaultDesigner;switch(this._track(i,n),i){case J.Copy:this._router.navigate([n,"copy",e],this._navigationBehaviorOptions);break;case J.Open:this._router.navigate([n,e],{...this._navigationBehaviorOptions,queryParams:r});break;case J.Create:this._router.navigate([n],{...this._navigationBehaviorOptions,queryParams:r});break}}_setRedirectWithUId(e,t,i={}){((0,b.isGuid)(e)?this._clientUnitSchemaDesignerAPI.getSchemaInfo({schemaUId:e}):this._clientUnitSchemaDesignerAPI.getSchemaInfoByName(e)).pipe((0,w.U)(o=>{const n=o.schemaInfo;if(!n){this._navigateToTemplates(`Not found schema: ${e}`).then();return}const a=(0,b.isGuid)(e)?e:n.schemaUId,{group:s,schemaType:u}=n;u===f.Rbd.AngularSchema?this._navigateToDesigner(a,s,t,i):this._navigateClientUnitSchemaDesigner(a)})).subscribe()}_navigateToTemplates(e=""){var t=this;return(0,m.Z)(function*(){t._maskService.hideBodyMask(),e&&(yield(0,C.n)(t._snackBar.open(e,"OK").afterDismissed()));const i=yield t._workspaceOpenCreateDialogService.selectTemplate();if(i){const o={...t._getCurrentRouteSnapshot(t._route.snapshot).queryParams,parentSchemaUId:i};t._setRedirectWithUId(i,J.Create,o)}else return t._window.close(),Promise.resolve()})()}_navigateClientUnitSchemaDesigner(e){this._router.navigate([`ClientUnitSchemaDesigner/${e}`],this._navigationBehaviorOptions).then()}ngOnInit(){this._maskService.showBodyMask();const e=this._getCurrentRouteSnapshot(this._route.snapshot),{params:t,queryParams:i,data:{operation:r}}=e,o=t.id||i.parentSchemaUId;o?this._setRedirectWithUId(o,r,i):this._navigateToTemplates().then();const n=this._translateService.instant("InterfaceDesigner.Caption");this._titleService.setTitle(n)}ngOnDestroy(){this._maskService.hideBodyMask()}}fe.\u0275fac=function(e){return new(e||fe)(l.Y36(q.gz),l.Y36(q.F0),l.Y36(ee.Bm),l.Y36(te.yc),l.Y36(Oi.S),l.Y36(ui.pl),l.Y36(D.kK),l.Y36(x.yDd),l.Y36($.sK),l.Y36(k.WINDOW_TOKEN))},fe.\u0275cmp=l.Xpm({type:fe,selectors:[["crt-interface-designer-proxy"]],decls:1,vars:0,consts:[[1,"interface-designer-proxy"]],template:function(e,t){e&1&&l._UZ(0,"div",0)},styles:[".interface-designer-proxy[_ngcontent-%COMP%]{width:100vw;height:100vh}"]});const Pr=[{path:"copy/:id",data:{operation:J.Copy},component:fe},{path:":id",data:{operation:J.Open},component:fe},{path:"",data:{operation:J.Create},component:fe}];class ge{}ge.\u0275fac=function(e){return new(e||ge)},ge.\u0275mod=l.oAB({type:ge}),ge.\u0275inj=l.cJS({imports:[q.Bz.forChild(Pr),q.Bz]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.kYT(ge,{imports:[q.Bz],exports:[q.Bz]})}();class xe{}xe.\u0275fac=function(e){return new(e||xe)},xe.\u0275mod=l.oAB({type:xe}),xe.\u0275inj=l.cJS({providers:[Oi.S,{provide:f.ngC,useClass:f.f5Y},li.oP,{provide:f.m7n,useClass:li.vH},{provide:f.ZsW,useFactory:c=>c,deps:[f.m7n]}],imports:[W.ez,ge,te.zU,ui.y]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&l.kYT(xe,{declarations:[fe],imports:[W.ez,ge,te.zU,ui.y]})}()}}]);
