"use strict";(self.webpackChunkapp_studio_enterprise_system_designer=self.webpackChunkapp_studio_enterprise_system_designer||[]).push([[58],{3058:(ve,J,o)=>{o.r(J),o.d(J,{LicenseManagerModule:()=>f});var g=o(88692),d=o(20092),O=o(83331),v=o(15756),L=o(37697),A=o(95236),q=o(74817),S=o(72990),B=o(73514),r=o(56707),m=o(26522),u=o(80542),k=o(69877),c=o(75378),Y=o(31177),l;(function(s){s[s.Personal=0]="Personal",s[s.Concurrent=1]="Concurrent",s[s.Server=2]="Server"})(l||(l={}));var e=o(64537);class h{constructor(t){this.translateService=t,this._licTypeFormatter=n=>{switch(n){case l.Personal:return this.translateService.instant("LicenseManager.TypePersonal");case l.Concurrent:return this.translateService.instant("LicenseManager.TypeConcurrent");case l.Server:return this.translateService.instant("LicenseManager.TypeServer")}},this._isActiveColumnFormatter=n=>n?this.translateService.instant("LicenseManager.LicenseIsActive"):this.translateService.instant("LicenseManager.LicenseIsNotActive")}get dataSchema(){return(0,Y.Z)({columns:[{name:"packageName",caption:this.translateService.instant("LicenseManager.PackageNameColumn"),valueType:c.DataValueType.Text},{name:"type",caption:this.translateService.instant("LicenseManager.TypeColumn"),valueType:c.DataValueType.Text,formatter:this._licTypeFormatter},{name:"startDate",caption:this.translateService.instant("LicenseManager.StartDateColumn"),valueType:c.DataValueType.Date},{name:"dueDate",caption:this.translateService.instant("LicenseManager.DueDateColumn"),valueType:c.DataValueType.Date},{name:"isActive",caption:this.translateService.instant("LicenseManager.StatusColumn"),valueType:c.DataValueType.Text,formatter:this._isActiveColumnFormatter},{name:"count",caption:this.translateService.instant("LicenseManager.CountColumn"),valueType:c.DataValueType.Integer}]})}}h.\u0275fac=function(t){return new(t||h)(e.LFG(r.sK))},h.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac});var _;(function(s){s[s.All=0]="All",s[s.Personal=1]="Personal",s[s.Server=2]="Server"})(_||(_={}));var F=o(35732),D=o(36619),V=o(27969);class Le{}class p{constructor(t,n){this._httpClient=t,this._environment=n,this._serviceUrl="ServiceModel/LicenseService.svc/"}getLicenses(){return this._httpClient.post(this._serviceUrl+"GetLicenses",null).pipe((0,V.U)(t=>({success:t.success,errorInfo:t.errorInfo,licenses:(0,D.Z3u)(t.licenses,{startDate:c.DataValueType.Date,dueDate:c.DataValueType.DateTime})})))}uploadLicenses(t){const n=this._serviceUrl+"UploadLicenses";return this._httpClient.post(n,{licData:t})}getLicenseData(t){return this._httpClient.post(this._serviceUrl+"GetLicenseData",JSON.stringify(t),{headers:new F.WM({"Content-Type":"application/json"})}).pipe((0,V.U)(n=>({success:n.success,errorInfo:n.errorInfo,licenses:(0,D.Z3u)(n.licenses,{startDate:c.DataValueType.Date,dueDate:c.DataValueType.DateTime,packageName:c.DataValueType.Text,count:c.DataValueType.Integer,isActive:c.DataValueType.Boolean}),users:n.users})))}saveLicenseData(t){const n=this._serviceUrl+"SaveLicenseData";return this._httpClient.post(n,t)}getUsersList(){return this._httpClient.post(this._serviceUrl+"GetUsersList",null)}getCustomerId(){return this._httpClient.post(this._serviceUrl+"GetCustomerId",null)}getAssemblyVersion(){return this._httpClient.post(this._serviceUrl+"GetAssemblyVersion",null)}licenseRequest(t,n){const i=document.createElement("a"),a=location.href.indexOf("mode=login")>-1?"LicenseManagerProxyService.svc":"LicenseService.svc";i.href=(0,D.Vo9)(this._environment.workspaceBaseUrl,"ServiceModel",a,`CreateVersionedLicenseRequest?customerId=${t}&licVersion=${n}`),i.download="LicenseRequest.tlr",document.body.appendChild(i),i.click(),document.body.removeChild(i)}deleteLicenses(){return this._httpClient.post(this._serviceUrl+"DeleteLicenses",null)}}p.\u0275fac=function(t){return new(t||p)(e.LFG(F.eN),e.LFG("environment"))},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac});var T=o(7976);function R(s,t){if(s&1&&(e.TgZ(0,"div",1)(1,"a",2),e._uU(2),e.qZA()()),s&2){const n=e.oxw();e.xp6(1),e.Q6J("routerLink",n.record.packageId),e.xp6(1),e.Oqu(n.record.packageName)}}class y extends u.vau{constructor(t){super(),this._translateService=t}isLicensePersonal(){return this.record.type===l.Personal}getTooltipMessage(){const t=this.record.type===l.Server?"LicenseSection.ServerLicenseTooltip":"LicenseSection.ConcurrentLicenseTooltip";return this._translateService.instant(t)}}y.\u0275fac=function(t){return new(t||y)(e.Y36(r.sK))},y.\u0275cmp=e.Xpm({type:y,selectors:[["ts-license-name-cell"]],features:[e.qOj],decls:1,vars:1,consts:[["class","license-name-wrapper",4,"ngIf"],[1,"license-name-wrapper"],[1,"license-name",3,"routerLink"]],template:function(t,n){t&1&&e.YNc(0,R,3,2,"div",0),t&2&&e.Q6J("ngIf",!n.isEmpty())},dependencies:[g.O5,T.rH],styles:[".license-name-wrapper[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:row;align-items:center;line-height:22px}.license-name-wrapper[_ngcontent-%COMP%]   .license-name[_ngcontent-%COMP%]{display:block}.license-name-wrapper[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(:first-child){margin-left:10px}"]});function j(s,t){s&1&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),s&2&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"LicenseRequestDialog.InvalidVersionFormat")))}class b{constructor(t){this._licService=t,this.customerId="",this.assemblyVersion="",this.versionControl=new d.NI("",[d.kI.pattern(/^\d+\.\d+\.\d+$/)])}ngOnInit(){this._licService.getCustomerId().subscribe(t=>{this.customerId=t.customerId}),this._licService.getAssemblyVersion().subscribe(t=>{this.assemblyVersion=t.assemblyVersion})}onRequestButtonClick(){this._licService.licenseRequest(this.customerId,this.assemblyVersion)}}b.\u0275fac=function(t){return new(t||b)(e.Y36(p))},b.\u0275cmp=e.Xpm({type:b,selectors:[["ts-license-request-dialog"]],decls:30,vars:23,consts:[[1,"license-request-dialog"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"customer-id"],["matInput","","type","text",3,"ngModel","ngModelChange"],[1,"field-description"],[1,"license-version"],["matInput","","type","text",3,"ngModel","formControl","ngModelChange"],[4,"ngIf"],["mat-dialog-actions",""],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"],["mat-flat-button","","color","primary",1,"action-button",3,"mat-dialog-close","disabled","click"]],template:function(t,n){t&1&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"div",2)(6,"mat-form-field",3)(7,"input",4),e.NdJ("ngModelChange",function(a){return n.customerId=a}),e.qZA()(),e.TgZ(8,"span",5),e._uU(9),e.ALo(10,"translate"),e.qZA(),e._UZ(11,"br")(12,"br"),e.TgZ(13,"div",1)(14,"span"),e._uU(15),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"mat-form-field",6)(18,"input",7),e.NdJ("ngModelChange",function(a){return n.assemblyVersion=a}),e.qZA(),e.YNc(19,j,3,3,"mat-error",8),e.qZA(),e.TgZ(20,"span",5),e._uU(21),e.ALo(22,"translate"),e.qZA()(),e.TgZ(23,"div",9)(24,"button",10),e._uU(25),e.ALo(26,"translate"),e.qZA(),e.TgZ(27,"button",11),e.NdJ("click",function(){return n.onRequestButtonClick()}),e._uU(28),e.ALo(29,"translate"),e.qZA()()()),t&2&&(e.xp6(3),e.Oqu(e.lcZ(4,11,"LicenseRequestDialog.Title")),e.xp6(4),e.Q6J("ngModel",n.customerId),e.xp6(2),e.Oqu(e.lcZ(10,13,"LicenseRequestDialog.InputFieldDescription")),e.xp6(6),e.Oqu(e.lcZ(16,15,"LicenseRequestDialog.LicenseVersionTitle")),e.xp6(3),e.Q6J("ngModel",n.assemblyVersion)("formControl",n.versionControl),e.xp6(1),e.Q6J("ngIf",n.versionControl.errors==null?null:n.versionControl.errors.pattern),e.xp6(2),e.Oqu(e.lcZ(22,17,"LicenseRequestDialog.LicenseVersionDescription")),e.xp6(4),e.Oqu(e.lcZ(26,19,"BasePageComponent.Cancel")),e.xp6(2),e.Q6J("disabled",!n.customerId||!n.assemblyVersion||n.versionControl.errors),e.xp6(1),e.hij(" ",e.lcZ(29,21,"LicenseRequestDialog.RequestButtonCaption")," "))},dependencies:[g.O5,v.eB,L.aO,L.YS,L.Rb,L.ev,A.nI,A.v_,q.k0,d.Fj,d.JJ,d.On,d.oH,r.X$],styles:["[_nghost-%COMP%]{padding:4px 10px;height:140px;width:460px}.license-request-dialog[_ngcontent-%COMP%]   [mat-dialog-actions][_ngcontent-%COMP%]{float:right;margin-bottom:6px}.license-request-dialog[_ngcontent-%COMP%]   [mat-dialog-content][_ngcontent-%COMP%]   .customer-id[_ngcontent-%COMP%], .license-request-dialog[_ngcontent-%COMP%]   [mat-dialog-content][_ngcontent-%COMP%]   .license-version[_ngcontent-%COMP%]{width:100%}.license-request-dialog[_ngcontent-%COMP%]   [mat-dialog-content][_ngcontent-%COMP%]   .field-description[_ngcontent-%COMP%]{color:#999;font-size:13px}.license-request-dialog[_ngcontent-%COMP%]   [mat-dialog-title][_ngcontent-%COMP%]{margin-bottom:4px}"]});var E=o(60527),Q=o(58143),I=o(41867),w=o(78464),z=o(67023);const K=["licUploadElement"];function G(s,t){s&1&&e._UZ(0,"ts-mask")}function W(s,t){s&1&&(e.ynx(0),e._UZ(1,"mat-icon",22),e.TgZ(2,"div",23)(3,"span"),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"div",24)(7,"span"),e._uU(8),e.ALo(9,"translate"),e.qZA()(),e.BQk()),s&2&&(e.xp6(4),e.Oqu(e.lcZ(5,2,"LicenseSection.BlankslateTitle")),e.xp6(4),e.Oqu(e.lcZ(9,4,"LicenseSection.BlankslateDescription")))}function X(s,t){s&1&&(e._UZ(0,"mat-icon",25),e.TgZ(1,"div",23)(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"div",24)(6,"span"),e._uU(7),e.ALo(8,"translate"),e.qZA()()),s&2&&(e.xp6(3),e.Oqu(e.lcZ(4,2,"BaseSection.BlankslateTitleWithFilters")),e.xp6(4),e.Oqu(e.lcZ(8,4,"BaseSection.BlankslateDescriptionWithFilters")))}function H(s,t){if(s&1&&(e.TgZ(0,"div",19),e.YNc(1,W,10,6,"ng-container",20),e.YNc(2,X,9,6,"ng-template",null,21,e.W1O),e.qZA()),s&2){const n=e.MAs(3),i=e.oxw();e.xp6(1),e.Q6J("ngIf",i.areFiltersEmpty())("ngIfElse",n)}}class x extends u.bMH{constructor(t,n,i,a){super(t),this._licService=n,this._router=i,this._dataSchemaProvider=a,this.filteredLicenseType=_.Personal,this.licenseTypesMenuConfig={options:[{value:_.All,caption:this.translateInstant("LicenseSection.AllTypesCaption"),svgIconName:"all-license-type-section-filter"},{value:_.Personal,caption:this.translateInstant("LicenseSection.PersonalTypeCaption"),svgIconName:"personal-license-type-section-filter"},{value:_.Server,caption:this.translateInstant("LicenseSection.ServerTypeCaption"),svgIconName:"server-license-type-section-filter-icon"}]},this.getProfileDataKey=()=>"LicenseSectionComponent",this.getGtmSchemaName=()=>"LicenseSection",this.getStaticSearchColumns=()=>["packageName"]}_customizePackageNameColumn(t){const n=t.columns,i=n.find(a=>a.name==="packageName");n.splice(n.indexOf(i),1,{...i,cellComponentClass:y})}getVisibleLicenseTypes(t){switch(t){case _.Personal:return[l.Personal,l.Concurrent];case _.Server:return[l.Server];default:return[]}}requestPageData(){return this._licService.getLicenses()}getModelFromLoadResponse(t){return t.licenses}getDefaultSelectMode(){return"none"}licenseUploaded(t){const i=!t.errorInfo&&t.success?"UploadLicensesCompleteMessage":"UploadLicensesErrorMessage",a=this.model.length===0;this.openInfoDialog(this.translateInstant("LicenseSection."+i)).subscribe(()=>{t.success&&a&&this._router.navigate([this._router.url.split("?")[0]],{queryParams:{mode:"login"},replaceUrl:!0,queryParamsHandling:"merge"}).then(()=>{this.window.location.reload()})}),t.success&&!a&&this.reloadPageData()}preProcessLoadedPageModel(t){t=super.preProcessLoadedPageModel(t);const n=this.getVisibleLicenseTypes(this.filteredLicenseType);return n.length===0?t:t.filter(i=>n.includes(i.type))}getProfileData(){return{...super.getProfileData(),licenseTypeFilter:this.filteredLicenseType}}applyProfileData(t){super.applyProfileData(t),t.licenseTypeFilter!==void 0&&(this.filteredLicenseType=t.licenseTypeFilter)}getDefaultDataSchema(){const t=this._dataSchemaProvider.dataSchema;return this._customizePackageNameColumn(t),t}uploadLicenses(){this.licUploadElementRef.nativeElement.click()}requestLicenses(){this.openDialog(b)}onFilesSelected(t){if(t.length===0)return;const n=t.item(0),i=new FileReader;i.onload=()=>{this._licService.uploadLicenses(i.result).subscribe(this.licenseUploaded.bind(this))},i.readAsText(n)}deleteLicenses(){const t=this.translateInstant("LicenseSection.DeleteLicensesConfirmation");this.openConfirmationDialog(t,()=>{const n=this.translateInstant("LicenseSection.DeleteLicensesSuccess");this.handleRequest(this._licService.deleteLicenses(),{successMessage:n}).subscribe(()=>this.reloadPageData())})}onFilteredLicenseTypeChanged(){this.saveUserProfileData(),this.reloadPageData()}}x.\u0275fac=function(t){return new(t||x)(e.Y36(e.zs3),e.Y36(p),e.Y36(T.F0),e.Y36(h))},x.\u0275cmp=e.Xpm({type:x,selectors:[["ts-license-section"]],viewQuery:function(t,n){if(t&1&&e.Gf(K,5),t&2){let i;e.iGM(i=e.CRH())&&(n.licUploadElementRef=i.first)}},features:[e.qOj],decls:35,vars:24,consts:[[4,"ngIf"],[1,"base-section-wrap"],[1,"header"],[1,"pane"],[3,"title"],["mat-flat-button","","color","primary",1,"action-button",3,"click"],["mat-button","",1,"action-button",3,"matMenuTriggerFor"],[1,"mat-select-arrow-wrapper"],[1,"mat-select-arrow"],["actionsButtonMenu","matMenu"],["mat-menu-item","",3,"click"],["type","file","accept",".tls",2,"display","none",3,"change"],["licUploadElement",""],[1,"filters"],[3,"config","value","valueChange"],[3,"value","valueChange"],[1,"table-wrapper"],["sortColumn","packageName"],["class","blank-slate-wrapper",4,"ngIf"],[1,"blank-slate-wrapper"],[4,"ngIf","ngIfElse"],["blankslateWithFilters",""],["svgIcon","license-section-blank-slate"],[1,"blank-slate-title"],[1,"blank-slate-description"],["svgIcon","table-filter-blank-slate"]],template:function(t,n){if(t&1&&(e.YNc(0,G,1,0,"ts-mask",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"ts-header",4),e.ALo(5,"translate"),e.TgZ(6,"button",5),e.NdJ("click",function(){return n.close()}),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"button",6)(10,"div"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"div",7),e._UZ(14,"div",8),e.qZA()(),e.TgZ(15,"mat-menu",null,9)(17,"button",10),e.NdJ("click",function(){return n.requestLicenses()}),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"button",10),e.NdJ("click",function(){return n.uploadLicenses()}),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"button",10),e.NdJ("click",function(){return n.deleteLicenses()}),e._uU(24),e.ALo(25,"translate"),e.qZA()(),e.TgZ(26,"input",11,12),e.NdJ("change",function(a){return n.onFilesSelected(a.target.files)}),e.qZA()(),e.TgZ(28,"div",13)(29,"ts-select-menu",14),e.NdJ("valueChange",function(a){return n.filteredLicenseType=a})("valueChange",function(){return n.onFilteredLicenseTypeChanged()}),e.qZA(),e.TgZ(30,"ts-search-input",15),e.NdJ("valueChange",function(a){return n.searchKey=a}),e.qZA()()()(),e.TgZ(31,"div",16)(32,"div",3),e._UZ(33,"ts-table",17),e.YNc(34,H,4,2,"div",18),e.qZA()()()),t&2){const i=e.MAs(16);e.Q6J("ngIf",n.isLoading),e.xp6(4),e.Q6J("title",e.lcZ(5,12,"LicenseSection.Title")),e.xp6(3),e.hij(" ",e.lcZ(8,14,"BasePageComponent.Close")," "),e.xp6(2),e.Q6J("matMenuTriggerFor",i),e.xp6(2),e.Oqu(e.lcZ(12,16,"BasePageComponent.Actions")),e.xp6(7),e.hij(" ",e.lcZ(19,18,"LicenseSection.RequestLicensesButtonCaption")," "),e.xp6(3),e.hij(" ",e.lcZ(22,20,"LicenseSection.UploadButtonCaption")," "),e.xp6(3),e.hij(" ",e.lcZ(25,22,"LicenseSection.DeleteLicensesButtonCaption")," "),e.xp6(5),e.Q6J("config",n.licenseTypesMenuConfig)("value",n.filteredLicenseType),e.xp6(1),e.Q6J("value",n.searchKey),e.xp6(4),e.Q6J("ngIf",n.isEmpty())}},dependencies:[g.O5,E.G,Q.J,I.a,w.g,v.eB,O.Hw,S.W0,S.tN,S.D8,z.d,r.X$],styles:[`ts-license-section .base-section-wrap .header .pane .filters{gap:10px;align-items:center}ts-license-section .base-section-wrap .header .pane .filters ts-select-menu{min-width:100px;line-height:16px}ts-license-section table tr{display:flex}ts-license-section table tr td,ts-license-section table tr th{display:block;width:calc((100% - (20px * 2) - ((6 - 1) * 5px * 2)) / 6)!important}ts-license-section table tr td.mat-column-packageName,ts-license-section table tr th.mat-column-packageName{width:450px!important;overflow:hidden}ts-license-section table tr th{height:18px!important;margin-top:16px}ts-license-section table tr td ts-table-cell>*,ts-license-section table tr td ts-license-name-cell>*{line-height:36px!important}ts-license-section table tr td .license-name-wrapper .license-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
`],encapsulation:2});var $=o(11770);class Z extends u.POq{constructor(t,n){super(),this.translateService=t,this.dataSchema=n.dataSchema}}Z.\u0275fac=function(t){return new(t||Z)(e.Y36(r.sK),e.Y36(h))},Z.\u0275cmp=e.Xpm({type:Z,selectors:[["ts-license-detail"]],features:[e.qOj],decls:7,vars:5,consts:[[1,"detail-wrapper"],[1,"detail-title"],[1,"detail-table-wrapper"],["sortColumn","packageName",3,"dataSource","dataSchema"]],template:function(t,n){t&1&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"div",2),e._UZ(6,"ts-table",3),e.qZA()()),t&2&&(e.xp6(3),e.Oqu(e.lcZ(4,3,"LicenseDetail.Title")),e.xp6(3),e.Q6J("dataSource",n.tableDataSource)("dataSchema",n.dataSchema))},dependencies:[I.a,r.X$],styles:[".detail-wrapper[_ngcontent-%COMP%]{padding-top:19px}.detail-wrapper[_ngcontent-%COMP%]   .detail-title[_ngcontent-%COMP%]{font-size:22px}"]});function ee(s,t){s&1&&e._UZ(0,"ts-mask")}function te(s,t){s&1&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.BQk()),s&2&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"LicensedUsersDetail.Blankslate")))}function ne(s,t){s&1&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),s&2&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BaseTableDetail.BlankslateWithFilters")))}function se(s,t){if(s&1&&(e.TgZ(0,"div",13),e.YNc(1,te,4,3,"ng-container",14),e.YNc(2,ne,3,3,"ng-template",null,15,e.W1O),e.qZA()),s&2){const n=e.MAs(3),i=e.oxw();e.xp6(1),e.Q6J("ngIf",!i.searchKey)("ngIfElse",n)}}function ie(s,t){if(s&1){const n=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(n);const a=e.oxw();return e.KtG(a.onDeleteSelected())}),e._UZ(1,"mat-icon",17),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA()()}if(s&2){const n=e.oxw();e.xp6(3),e.AsE("",e.lcZ(4,2,"LicensedUsersDetail.Delete")," (",n.table.selected.length,")")}}const ae=function(s){return{click:s}},oe=function(s){return{delete:s}};class U extends u.POq{get searchKey(){return this._searchKey}set searchKey(t){this._searchKey=t,this.tableDataSource.filter=t.trim().toLowerCase()}constructor(t,n,i,a){super(),this._licService=t,this.dialogService=n,this.translateService=i,this.scrollToBottomObserverFactory=a,this._licensedUsersDataSchema={columns:[{name:"sysAdminUnit",caption:this.translateService.instant("LicensedUsersDetail.UserNameColumn"),valueType:c.DataValueType.Lookup},{name:"email",caption:this.translateService.instant("LicensedUsersDetail.EmailColumn"),valueType:c.DataValueType.Text},{name:"jobTitle",caption:this.translateService.instant("LicensedUsersDetail.JobTitleColumn"),valueType:c.DataValueType.Text}]},this._licensedUsersDetailDataSchema={columns:this._licensedUsersDataSchema.columns.concat({name:"delete",cellComponentClass:u.xox})},this._searchColumns=["email","jobTitle",N=>N.sysAdminUnit.displayValue],this._searchKey="",this.dataSchema=this._licensedUsersDetailDataSchema,this.tableDataSource.filterPredicate=this._createSearchPredicate()}_createSearchPredicate(){return(0,D.$V)(this._searchColumns)}createTableDataSource(){return new u.o6y}filterExistUsers(t,n){return t.filter(i=>n.findIndex(a=>a.sysAdminUnit.value===i.sysAdminUnit.value)===-1)}getUsersDialogData(t){return{title:this.translateService.instant("LicensedUsersDetail.UsersDialogCaption"),dataSchema:this._licensedUsersDataSchema,data:this.filterExistUsers(t,this.data),sortColumn:"sysAdminUnit",searchColumns:this._searchColumns}}openAddUsersDialog(t){this.dialogService.open(u.iQ4,{data:this.getUsersDialogData(t)}).subscribe(n=>{n&&this.onAddRows(...n)})}ngAfterViewInit(){const t=this.detailTableWrapper.nativeElement;t&&(this._scrollToBottomObserver=this.scrollToBottomObserverFactory.createObserver(t,()=>this.tableDataSource.loadNext()))}ngOnDestroy(){this._scrollToBottomObserver.destroy()}addUsers(){this._availableUsers?this.openAddUsersDialog(this._availableUsers):(this.isLoading=!0,this._licService.getUsersList().subscribe(t=>{this.isLoading=!1,this._availableUsers=t.users,this.openAddUsersDialog(this._availableUsers)}))}}U.\u0275fac=function(t){return new(t||U)(e.Y36(p),e.Y36(m.xA),e.Y36(r.sK),e.Y36(D.OZI))},U.\u0275cmp=e.Xpm({type:U,selectors:[["ts-licensed-users-detail"]],features:[e.qOj],decls:19,vars:17,consts:[[4,"ngIf"],[1,"detail-wrapper"],[1,"detail-title"],[1,"filters"],[3,"value","valueChange"],[1,"detail-table-wrapper"],["detailTableWrapper",""],["selectMode","multi","sortColumn","sysAdminUnit","headerSticky","true",3,"dataSource","dataSchema","eventHandlers"],["class","detail-blank-slate",4,"ngIf"],[1,"detail-bottom-action"],["mat-button","",1,"default",3,"click"],["svgIcon","add-button"],["class","default mat-button mat-button-base","mat-button","",3,"click",4,"ngIf"],[1,"detail-blank-slate"],[4,"ngIf","ngIfElse"],["blankslateWithFilters",""],["mat-button","",1,"default","mat-button","mat-button-base",3,"click"],["svgIcon","trash"]],template:function(t,n){t&1&&(e.YNc(0,ee,1,0,"ts-mask",0),e.TgZ(1,"div",1)(2,"div",2)(3,"span"),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"div",3)(7,"ts-search-input",4),e.NdJ("valueChange",function(a){return n.searchKey=a}),e.qZA()(),e.TgZ(8,"div",5,6),e._UZ(10,"ts-table",7),e.YNc(11,se,4,2,"div",8),e.qZA(),e.TgZ(12,"div",9)(13,"button",10),e.NdJ("click",function(){return n.addUsers()}),e._UZ(14,"mat-icon",11),e.TgZ(15,"span"),e._uU(16),e.ALo(17,"translate"),e.qZA()(),e.YNc(18,ie,5,4,"button",12),e.qZA()()),t&2&&(e.Q6J("ngIf",n.isLoading),e.xp6(4),e.Oqu(e.lcZ(5,9,"LicensedUsersDetail.Title")),e.xp6(3),e.Q6J("value",n.searchKey),e.xp6(3),e.Q6J("dataSource",n.tableDataSource)("dataSchema",n.dataSchema)("eventHandlers",e.VKq(15,oe,e.VKq(13,ae,n.onDeleteRow.bind(n)))),e.xp6(1),e.Q6J("ngIf",n.isEmpty()),e.xp6(5),e.Oqu(e.lcZ(17,11,"BaseTableDetail.Add")),e.xp6(2),e.Q6J("ngIf",n.isDeleteSelectedButtonVisible()))},dependencies:[g.O5,Q.J,I.a,w.g,v.eB,O.Hw,r.X$],styles:[`ts-licensed-users-detail .detail-wrapper{margin-top:40px}ts-licensed-users-detail .detail-wrapper .detail-title{font-size:22px!important}ts-licensed-users-detail .detail-wrapper .filters{margin-top:15px}ts-licensed-users-detail .detail-wrapper .detail-table-wrapper table thead .mat-column-sysAdminUnit,ts-licensed-users-detail .detail-wrapper .detail-table-wrapper table thead .mat-column-email,ts-licensed-users-detail .detail-wrapper .detail-table-wrapper table thead .mat-column-jobTitle{width:35%}ts-licensed-users-detail .detail-wrapper .detail-table-wrapper table thead .mat-column-delete{width:36px;text-align:right}
`],encapsulation:2});function ce(s,t){s&1&&(e.ynx(0),e.TgZ(1,"div",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.BQk()),s&2&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"UsedLicensesCounterChart.UsedLicensesCountTitle")))}const le=function(s){return{"limit-warning-legend":s}};function re(s,t){if(s&1&&(e.TgZ(0,"div",11)(1,"div",12)(2,"span",13),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"span",14),e._uU(6),e.qZA()(),e.TgZ(7,"div",15)(8,"span",13),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"span",16),e._uU(12),e.qZA()()()),s&2){const n=e.oxw(2);e.Q6J("ngClass",e.VKq(9,le,n.isConcurrentLicenseLimitExceeded())),e.xp6(3),e.Oqu(e.lcZ(4,5,"UsedLicensesCounterChart.DistributedLicensesLegend")),e.xp6(3),e.Oqu(n.usedLicensesCount),e.xp6(3),e.Oqu(e.lcZ(10,7,"UsedLicensesCounterChart.AvailableLicensesLegend")),e.xp6(3),e.Oqu(n.totalLicensesCount)}}function ue(s,t){if(s&1&&(e.ynx(0),e.TgZ(1,"div",4),e._UZ(2,"canvas",5),e.qZA(),e.TgZ(3,"div",6)(4,"div",7),e._uU(5),e.qZA(),e.TgZ(6,"div",8),e._uU(7),e.ALo(8,"translate"),e.qZA()(),e.YNc(9,ce,4,3,"ng-container",2),e.YNc(10,re,13,11,"ng-template",null,9,e.W1O),e.BQk()),s&2){const n=e.MAs(11),i=e.oxw();e.xp6(2),e.Q6J("options",i.pieChartOptions)("data",i.chartData)("colors",i.pieChartColors),e.xp6(3),e.Oqu(i.usedLicensesCount),e.xp6(2),e.AsE(" ",e.lcZ(8,8,"UsedLicensesCounterChart.UsedLicensesCountSeparatorLabel")," ",i.totalLicensesCount," "),e.xp6(2),e.Q6J("ngIf",!i.isConcurrentLicenseLegendVisible())("ngIfElse",n)}}function de(s,t){if(s&1&&(e.TgZ(0,"div",20)(1,"span",6)(2,"div",7),e._uU(3),e.qZA()(),e.TgZ(4,"div",10),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"div",21),e._uU(8),e.ALo(9,"translate"),e.qZA()()),s&2){const n=e.oxw(2);e.xp6(3),e.Oqu(n.usedLicensesCount),e.xp6(2),e.Oqu(e.lcZ(6,4,"UsedLicensesCounterChart.UnlimitedCountLabel")),e.xp6(3),e.AsE(" ",e.lcZ(9,6,"UsedLicensesCounterChart.LimitOfLicensesLabel")," ",n.totalLicensesCount," ")}}function pe(s,t){if(s&1&&(e.TgZ(0,"div",17),e._UZ(1,"span",18),e.qZA(),e.YNc(2,de,10,8,"div",19)),s&2){const n=e.oxw();e.xp6(2),e.Q6J("ngIf",!n.isServerLicense())}}class P{set licenseType(t){this._licenseType=t,this._updatePieChartColors()}get licenseType(){return this._licenseType}set usedLicensesCount(t){this._usedLicensesCount=t,this._updatePieChartColors()}get usedLicensesCount(){return this._usedLicensesCount}constructor(t){this._translateService=t,this._defaultBackgroundColors=["#39A0CC","#E6E6E6"],this._concurrentBackgroundColors=["#39A0CC","#D7ECF5"],this.totalLicensesCount=0,this.chartData=[],this.pieChartOptions={maintainAspectRatio:!1,legend:{display:!1},tooltips:{enabled:!1},cutoutPercentage:80},this.pieChartColors=[{backgroundColor:this._defaultBackgroundColors,borderColor:["#ffff","#ffff"],borderWidth:0}]}_updatePieChartColors(){this.pieChartColors[0].backgroundColor=this.isConcurrentLicenseLimitExceeded()?this._concurrentBackgroundColors:this._defaultBackgroundColors}_getUsedLicensesChartData(){const t=this.totalLicensesCount,n=this.usedLicensesCount;if(this.isConcurrentLicenseLimitExceeded())return[t,n-t];const i=n<=t?t-n:0;return[n,i]}isConcurrentLicenseLimitExceeded(){return this.licenseType===l.Concurrent&&this.totalLicensesCount<this.usedLicensesCount}getChartTitle(){return this.licenseType===l.Concurrent?this._translateService.instant("UsedLicensesCounterChart.ConcurrentLicenseTitle"):this._translateService.instant("UsedLicensesCounterChart.ActiveLicensesTitle")}isConcurrentLicenseLegendVisible(){return this.licenseType===l.Concurrent}isServerLicense(){return this.licenseType===l.Server}ngOnChanges(){this.chartData=this._getUsedLicensesChartData()}}P.\u0275fac=function(t){return new(t||P)(e.Y36(r.sK))},P.\u0275cmp=e.Xpm({type:P,selectors:[["ts-used-licenses-counter-chart"]],inputs:{licenseType:"licenseType",usedLicensesCount:"usedLicensesCount",totalLicensesCount:"totalLicensesCount"},features:[e.TTD],decls:6,vars:3,consts:[[1,"used-licenses-counter"],[1,"title"],[4,"ngIf","ngIfElse"],["serverLicenseBlock",""],[1,"chart"],["baseChart","","chartType","doughnut",1,"licenses-chart",3,"options","data","colors"],[1,"counter"],[1,"used"],[1,"total"],["concurrentLicenseLegend",""],[1,"counter-label"],[1,"chart-legend",3,"ngClass"],[1,"distributed-licenses"],[1,"legend-label"],[1,"distributed-licenses-value"],[1,"available-licenses"],[1,"available-licenses-value"],[1,"infinity-icon-wrapper"],[1,"infinity-icon"],["class","server-counter-wrapper",4,"ngIf"],[1,"server-counter-wrapper"],[1,"server-license-legend-label"]],template:function(t,n){if(t&1&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2),e.qZA(),e.YNc(3,ue,12,10,"ng-container",2),e.YNc(4,pe,3,1,"ng-template",null,3,e.W1O),e.qZA()),t&2){const i=e.MAs(5);e.xp6(2),e.Oqu(n.getChartTitle()),e.xp6(1),e.Q6J("ngIf",!n.isServerLicense())("ngIfElse",i)}},dependencies:[g.mk,g.O5,k.jh,r.X$],styles:[".used-licenses-counter[_ngcontent-%COMP%]{margin:0 0 auto;display:flex;justify-content:center;flex-direction:column}.used-licenses-counter[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:22px;text-align:center;margin:0;font-family:Bpmonline Open Sans Light,serif}.used-licenses-counter[_ngcontent-%COMP%]   .counter-label[_ngcontent-%COMP%]{font-size:14px;text-align:center;margin:0 0 16px}.used-licenses-counter[_ngcontent-%COMP%]   .counter[_ngcontent-%COMP%]{font-size:24px;text-align:center;margin-top:-155px;margin-bottom:80px}.used-licenses-counter[_ngcontent-%COMP%]   .counter[_ngcontent-%COMP%]   .used[_ngcontent-%COMP%]{font-size:32px;color:#444;margin-bottom:10px}.used-licenses-counter[_ngcontent-%COMP%]   .counter[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]{font-size:16px;color:#999}.used-licenses-counter[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]{height:160px;margin:44px 0 51px}.used-licenses-counter[_ngcontent-%COMP%]   .chart-legend[_ngcontent-%COMP%]   .legend-label[_ngcontent-%COMP%]{font-size:13px;display:inline-block;width:220px}.used-licenses-counter[_ngcontent-%COMP%]   .chart-legend[_ngcontent-%COMP%]   .distributed-licenses[_ngcontent-%COMP%], .used-licenses-counter[_ngcontent-%COMP%]   .chart-legend[_ngcontent-%COMP%]   .available-licenses[_ngcontent-%COMP%]{margin-top:5px;display:flex;align-items:center;justify-content:space-between}.used-licenses-counter[_ngcontent-%COMP%]   .chart-legend[_ngcontent-%COMP%]   .distributed-licenses-value[_ngcontent-%COMP%], .used-licenses-counter[_ngcontent-%COMP%]   .chart-legend[_ngcontent-%COMP%]   .available-licenses-value[_ngcontent-%COMP%]{width:auto;height:18px;padding:2px 5px 4px;font-size:11px;border-radius:10px;text-align:center;display:inline-block}.used-licenses-counter[_ngcontent-%COMP%]   .chart-legend[_ngcontent-%COMP%]   .distributed-licenses-value[_ngcontent-%COMP%]{background-color:#39a0cc;color:#fff}.used-licenses-counter[_ngcontent-%COMP%]   .chart-legend[_ngcontent-%COMP%]   .available-licenses-value[_ngcontent-%COMP%]{background-color:#e6e6e6;color:#000}.used-licenses-counter[_ngcontent-%COMP%]   .infinity-icon-wrapper[_ngcontent-%COMP%]{margin:44px 0 51px;display:flex;justify-content:center}.used-licenses-counter[_ngcontent-%COMP%]   .infinity-icon-wrapper[_ngcontent-%COMP%]   .infinity-icon[_ngcontent-%COMP%]{display:inline-block;background:url(infinity.eb919d535702474f.svg) no-repeat center;width:163px;height:79px}.used-licenses-counter[_ngcontent-%COMP%]   .server-counter-wrapper[_ngcontent-%COMP%]{text-align:center}.used-licenses-counter[_ngcontent-%COMP%]   .server-counter-wrapper[_ngcontent-%COMP%]   .server-license-legend-label[_ngcontent-%COMP%]{padding:0 5px 2px;display:inline-block;background-color:#f2f5ff;color:#757575;border-radius:10px;font-size:13px}.used-licenses-counter[_ngcontent-%COMP%]   .limit-warning-legend[_ngcontent-%COMP%]   .distributed-licenses-value[_ngcontent-%COMP%]{background-color:#d7ecf5;color:#000}.used-licenses-counter[_ngcontent-%COMP%]   .limit-warning-legend[_ngcontent-%COMP%]   .available-licenses-value[_ngcontent-%COMP%]{background-color:#39a0cc;color:#fff}"]});function ge(s,t){s&1&&e._UZ(0,"ts-mask")}function me(s,t){if(s&1){const n=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(n);const a=e.oxw();return e.KtG(a.save())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}s&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"BasePageComponent.Apply")," "))}function he(s,t){if(s&1){const n=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(n);const a=e.oxw();return e.KtG(a.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}s&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"BasePageComponent.Cancel")," "))}function _e(s,t){if(s&1){const n=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(n);const a=e.oxw();return e.KtG(a.close())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}s&2&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"BasePageComponent.Close")," "))}function Ce(s,t){if(s&1){const n=e.EpF();e.TgZ(0,"ts-licensed-users-detail",15),e.NdJ("dataChange",function(){e.CHM(n);const a=e.oxw();return e.KtG(a.setIsChanged())}),e.qZA()}if(s&2){const n=e.oxw();e.Q6J("data",n.model.users)("isLoading",n.isLoading)}}class M extends u.neP{get isServerLicense(){return this.getLicenseType()===l.Server}constructor(t,n){super(t),this.licenseService=n,this._totalLicenseCount=null,this.getGtmSchemaName=()=>"LicensePage",this.packageId=this.activateRoute.snapshot.params.packageId}_getUserDifference(t,n){const i=[];return t.forEach(a=>{n.find(N=>N.sysAdminUnit.value===a.sysAdminUnit.value)||i.push(a.sysAdminUnit.value)}),i}initPageTitle(t){const n=this.translateInstant("LicensePage.TitleFormat"),i=t&&t.licenses.length>0&&t.licenses[0];this.pageTitle=$.Ld.Format(n,i.packageName)}preProcessLoadedPageModel(t){return t=super.preProcessLoadedPageModel(t),this.initPageTitle(t),t}getSaveData(){const t=this.model.users,n=this.modelSnap.users,i=this._getUserDifference(n,t),a=this._getUserDifference(t,n);return{deletedUsers:i,addedUsers:a,packageId:this.packageId}}savePageData(t){const n=this.getSaveData();return this.licenseService.saveLicenseData(n)}getModelFromLoadResponse(t){return{licenses:t.licenses,users:t.users}}requestPageData(){return this.licenseService.getLicenseData(this.packageId)}getLicenseType(){var t;return((t=this.model.licenses)===null||t===void 0?void 0:t.length)>0?this.model.licenses[0].type:void 0}getTotalLicensesCount(){if(!this.model||!this.model.licenses)return 0;if(!this._totalLicenseCount){let t=0;this.model.licenses.forEach(n=>{n.isActive&&(t+=n.count)}),this._totalLicenseCount=t}return this._totalLicenseCount}getUsedLicensesCount(){var t,n,i;return(i=(n=(t=this.model)===null||t===void 0?void 0:t.users)===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0}}M.\u0275fac=function(t){return new(t||M)(e.Y36(e.zs3),e.Y36(p))},M.\u0275cmp=e.Xpm({type:M,selectors:[["ts-license-page"]],features:[e.qOj],decls:15,vars:10,consts:[[4,"ngIf"],[1,"base-page-wrap"],[1,"header"],[1,"pane"],[3,"title"],["class","action-button","mat-flat-button","","color","accent",3,"click",4,"ngIf"],["class","action-button","mat-flat-button","","color","primary",3,"click",4,"ngIf"],[1,"page-content-wrapper"],[1,"left-bar"],[3,"usedLicensesCount","totalLicensesCount","licenseType"],[1,"main-content","pane"],[3,"data","dataChange"],[3,"data","isLoading","dataChange",4,"ngIf"],["mat-flat-button","","color","accent",1,"action-button",3,"click"],["mat-flat-button","","color","primary",1,"action-button",3,"click"],[3,"data","isLoading","dataChange"]],template:function(t,n){t&1&&(e.YNc(0,ge,1,0,"ts-mask",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"ts-header",4),e.YNc(5,me,3,3,"button",5),e.YNc(6,he,3,3,"button",6),e.YNc(7,_e,3,3,"button",6),e.qZA()()(),e.TgZ(8,"div",7)(9,"div",8)(10,"div",3),e._UZ(11,"ts-used-licenses-counter-chart",9),e.qZA()(),e.TgZ(12,"div",10)(13,"ts-license-detail",11),e.NdJ("dataChange",function(){return n.setIsChanged()}),e.qZA(),e.YNc(14,Ce,1,2,"ts-licensed-users-detail",12),e.qZA()()()),t&2&&(e.Q6J("ngIf",n.isLoading),e.xp6(4),e.Q6J("title",n.pageTitle),e.xp6(1),e.Q6J("ngIf",n.saveButtonVisible()),e.xp6(1),e.Q6J("ngIf",n.cancelButtonVisible()),e.xp6(1),e.Q6J("ngIf",n.closeButtonVisible()),e.xp6(4),e.Q6J("usedLicensesCount",n.getUsedLicensesCount())("totalLicensesCount",n.getTotalLicensesCount())("licenseType",n.getLicenseType()),e.xp6(2),e.Q6J("data",n.model.licenses),e.xp6(1),e.Q6J("ngIf",!n.isServerLicense))},dependencies:[g.O5,E.G,w.g,v.eB,Z,U,P,r.X$],styles:[".page-content-wrapper[_ngcontent-%COMP%]   .left-bar[_ngcontent-%COMP%]{width:298px;margin:0 0 auto}.page-content-wrapper[_ngcontent-%COMP%]   .left-bar[_ngcontent-%COMP%]   .pane[_ngcontent-%COMP%]{padding:29px 21px 21px;display:flex;justify-content:center;flex-direction:column}.page-content-wrapper[_ngcontent-%COMP%]   .main-content.pane[_ngcontent-%COMP%]{margin-left:6px}"]});const fe=[{path:"",component:x,data:{shouldReuse:!0}},{path:":packageId",component:M,data:{shouldReuse:!0}}];class C{}C.\u0275fac=function(t){return new(t||C)},C.\u0275mod=e.oAB({type:C}),C.\u0275inj=e.cJS({imports:[T.Bz.forChild(fe),T.Bz]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&e.kYT(C,{imports:[T.Bz],exports:[T.Bz]})}();class f{}f.\u0275fac=function(t){return new(t||f)},f.\u0275mod=e.oAB({type:f}),f.\u0275inj=e.cJS({providers:[u.Pnv,h,p,{provide:u.thQ,useValue:"LicenseManagerModule"},u.i3c],imports:[g.ez,u.kLW,k.m9,m.Su,C,m._M,v.yu,B.U5,O.Ps,m.z8,r.aw,L.yj,A.wp,q.x4,S.jT,d.u5,d.UX,m.sm]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&e.kYT(f,{declarations:[x,M,Z,U,y,b,P],imports:[g.ez,u.kLW,k.m9,m.Su,C,m._M,v.yu,B.U5,O.Ps,m.z8,r.aw,L.yj,A.wp,q.x4,S.jT,d.u5,d.UX,m.sm]})}()}}]);
