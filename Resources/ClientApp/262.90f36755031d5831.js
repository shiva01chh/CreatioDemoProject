"use strict";(self.webpackChunkapp_studio_enterprise_system_designer=self.webpackChunkapp_studio_enterprise_system_designer||[]).push([[262],{28262:(B,x,o)=>{o.d(x,{ZR:()=>G,jn:()=>ne,ml:()=>ge,ZS:()=>F,vM:()=>ee,$W:()=>oe,qj:()=>w,wm:()=>ce,p4:()=>te,kb:()=>L,G8:()=>R,mM:()=>Q,HL:()=>Z,q1:()=>C.q1,Z_:()=>Y,t2:()=>C.t2,Pu:()=>C.Pu,gT:()=>W,o4:()=>z,E_:()=>C.E_,H0:()=>C.H0,AH:()=>C.AH,lw:()=>C.lw,Wr:()=>$,J9:()=>K});var s=o(88692),t=o(83331),f=o(79510),S=o(15756),v=o(95236),y=o(74817),k=o(72990),P=o(85193),I=o(55799),A=o(18849),T=o(56707),O=o(79641),m=o(80542),E=o(86200),p=o(87683),c=o(36619),d=o(7976),i=o(75378),a=o(11465),l=o(55953),h=o(22063),g=o(84945),H=o(79676),U=o(84967),X=o(61528),V=o(27969),ie=o(54882),ae=o(13528),re=o(98168),J=o(26903),C=o(90950),ve=o(46198),Ie=o(66393),Me=o(29352),de=o(41803);class ge{constructor(e){this.translateService=e.get(T.sK),this._lczToStringPipe=e.get(c.OWj),this._userInfo=e.get(c.aoG),this.featureService=e.get(a.UZ)}getTranslation(e){const n=this.translationPrefix?".":"",r=`${this.translationPrefix}${n}${e}`;return this.translateService.instant(r)}createSchemaStructureElement(e){return Me.l.create(e)}getColumnTypeIcon(e){var n,r,u;const M=(n=c.aG7[e.type])!==null&&n!==void 0?n:{},N=(r=M.icon)!==null&&r!==void 0?r:null,b=(u=M.autonumberIcon)!==null&&u!==void 0?u:N;return e.isAutonumberColumn?b:M.icon}getSchemaVisibleAddons(e){return(0,g.of)([])}createBusinessRuleStructureElement(e,n=!0){const r=[de.E.createDeleteAction()],u=this.createSchemaStructureElement({uId:e.uId,actions:r,canSelected:!0});return u.selected=n,u}getIsReadOnly(e){return e.isReadOnly}getStructureData(e,n=null){const r=this.getModelStructureData(e)||[];return(0,U.D)({showChildRules:(0,Ie.D)(this.featureService.getFeatureState("BRules-ShowChildRules")),visibleAddons:this.getSchemaVisibleAddons(e)}).pipe((0,ie.z)(({showChildRules:u,visibleAddons:M})=>{if(M&&M.length>0){const N=M.map(b=>{let fe=(0,g.of)(null);const Se=[];if(b.addonName===c.nM_.BusinessRule){const le=[];e.isReadOnly||(Se.push(de.E.createAddAction()),le.push(de.E.createDeleteAction())),fe=b.addonConfig.pipe((0,V.U)(Pe=>Pe.rules.filter(ue=>u||!ue.parentUId).map(ue=>this.createSchemaStructureElement({caption:this._lczToStringPipe.transform((0,c.tWQ)(b.resources,ue,this._userInfo.cultureInfo.sysCultureName)),uId:ue.uId,canSelected:!0,actions:le}))))}return fe.pipe((0,V.U)(le=>this.createSchemaStructureElement({caption:this.getTranslation(`Addons.${b.addonName}`),icon:`${(0,ve.Z)(b.addonName)}-addon-icon.svg`,uId:b.id,canSelected:b.addonName!==c.nM_.BusinessRule,children:le,actions:Se,selected:n===b.addonName})))});return(0,U.D)(N).pipe((0,V.U)(b=>[...r,...b]))}return(0,g.of)(r)}))}}var se=o(65149),q=o(26522),me=o(74970);class oe{get getCurrentLanguage(){return this.translateService.currentLang}constructor(e){this.injector=e,this.translateService=e.get(T.sK)}validateName(e,n,r){const u=this.getExistMetaItemNames(n,r);return C.Pu.validateRequiredName(e,this.getTranslation("Validations.RequiredNameCaption"))||C.Pu.validatePatternName(e,this.getTranslation("Validations.PatternNameCaption"))||C.Pu.validateDuplicateName(e,u,this.getTranslation("Validations.DuplicateNameCaption"))}getTranslation(e){const n=this.translationPrefix?".":"",r=`${this.translationPrefix}${n}${e}`;return this.translateService.instant(r)}getExistMetaItemNames(e,n){return e.filter(r=>r.uId!==n).map(r=>r.name)}getMetaItemsGroup(e){return e.schema.findGroup(e.metaItemsUid)}}class he extends oe{get translationPrefix(){return"LocalizableStringsDialog"}constructor(e){super(e),this._dialogService=e.get(q.xA)}_getMiniCardConfig(e){const n={title:this.getTranslation("Title"),cancelBtnTitle:this.getTranslation("Cancel"),dynamicForm:m.jlq.create(e),useValidation:!0};return this.getIsApplyButtonVisible()&&(n.okBtnTitle=this.getApplyButtonTitle()),n}_getDynamicFormConfig(e,n,r){return[{columns:[{formComponents:[new m.kSE({controlType:m.$5M.TextBox,key:"name",label:this.getTranslation("NameTitle"),value:e.name,required:!0,isDisabled:this.getIsControlsDisabled()||!r,validators:[M=>this.validateName(M,n,e.uId)]}),new m.kSE({controlType:m.$5M.LocalizableText,key:"values",label:this.getTranslation("ValueTitle"),value:e.values.clone(),isDisabled:this.getIsControlsDisabled()})]}]}]}openMiniCard(e,n,r){const u=this._getDynamicFormConfig(e,n,r),M=this._getMiniCardConfig(u);return this._dialogService.open(m.Eqq,{data:M})}getIsControlsDisabled(){return!1}getApplyButtonTitle(){return this.getTranslation("Apply")}getIsApplyButtonVisible(){return!0}openLocalizableStringMiniCard(e,n,r=!0){return this.openMiniCard(e,n,r).pipe((0,me.h)(u=>u!==void 0),(0,V.U)(u=>(u.applyChangesInModel(e),e)),(0,J.B)())}}var _=o(64537);class G extends he{constructor(e){super(e)}_createNewLocalizableString(e){const n=new se.xV;return n.uId=(0,i.generateGuid)(),n.name="",n.parentSchemaUId=e,n.values=new c.CjD,n.values.push({cultureName:this.getCurrentLanguage,value:""}),n}getApplyButtonTitle(){return this.getTranslation("Add")}execute(e){const n=this._createNewLocalizableString(e.schema.uId),r=this.getMetaItemsGroup(e);return this.openLocalizableStringMiniCard(n,r).pipe((0,re.b)(u=>r.addItem(u)),(0,J.B)())}}G.\u0275fac=function(e){return new(e||G)(_.LFG(_.zs3))},G.\u0275prov=_.Yz7({token:G,factory:G.\u0275fac});class Q extends he{constructor(e){super(e)}execute(e){const n=this.getMetaItemsGroup(e),r=n.findItem(e.itemUId),u=e.schema.getIsOwnMetaItem(r);return this.openLocalizableStringMiniCard(r,n,u)}}Q.\u0275fac=function(e){return new(e||Q)(_.LFG(_.zs3))},Q.\u0275prov=_.Yz7({token:Q,factory:Q.\u0275fac});class $ extends he{constructor(e){super(e)}getIsControlsDisabled(){return!0}getIsApplyButtonVisible(){return!1}execute(e){const n=this.getMetaItemsGroup(e),r=n.findItem(e.itemUId),u=e.schema.getIsOwnMetaItem(r);return this.openLocalizableStringMiniCard(r,n,u)}}$.\u0275fac=function(e){return new(e||$)(_.LFG(_.zs3))},$.\u0275prov=_.Yz7({token:$,factory:$.\u0275fac});class j extends oe{constructor(e){super(e),this.dialogService=e.get(q.xA),this._maskService=e.get(q.Bm),this._workspaceEntityApiService=e.get(l.W1)}_checkSchemaParameterExists(e,n){return this.parameters.filter(r=>r[e]===!0&&r!==n).length>0}_validateName(e){return C.Pu.validateRequiredName(e,this.getTranslation("Validations.RequiredNameCaption"))||C.Pu.validatePatternName(e,this.getTranslation("Validations.PatternNameCaption"))}_alphabeticalSorting(e,n){return e.value<n.value?-1:e.value>n.value?1:0}_getDataValueTypeOptions(e){let n=[i.DataValueType.Date,i.DataValueType.Time,i.DataValueType.DateTime,i.DataValueType.Text,i.DataValueType.METADATA_TEXT,i.DataValueType.Integer,i.DataValueType.FLOAT1,i.DataValueType.FLOAT2,i.DataValueType.FLOAT3,i.DataValueType.FLOAT4,i.DataValueType.FLOAT8,i.DataValueType.Guid,i.DataValueType.Lookup,i.DataValueType.Boolean,i.DataValueType.Money,i.DataValueType.Float,i.DataValueType.COMPOSITE_OBJECT_LIST,i.DataValueType.COMPOSITE_OBJECT_LIST,i.DataValueType.OBJECT_LIST,i.DataValueType.ENTITY_COLLECTION,i.DataValueType.ENTITY];return e&&(n=[e,...n]),Object.keys(c.aG7).filter(r=>{const u=c.aG7[r];return n.includes(u.type)}).map(r=>{const u=c.aG7[r];return{value:this.translateService.instant(u.translateKey),key:u.type}}).sort(this._alphabeticalSorting)}_getSelectedType(e){return this._getDataValueTypeOptions(e).find(n=>n.key===e)}_getSelectedLookup(e){return this._availableSchemas.find(n=>n.key===e)}_createParameterModel(){const e=new se.O4;return e.name="",e}_updateDataTypeIcon(e){const n=c.aG7[e.type];e.icon=n&&n.icon}_getDynamicFormConfig(e){return[{columns:[{formComponents:this.getControls(e)}]}]}_getMiniCardConfig(e){return{title:this.getTranslation("CardTitle"),cancelBtnTitle:this.getTranslation("Cancel"),dynamicForm:m.jlq.create(e),useValidation:!0,okBtnTitle:this.getOkBtnTitleTranslation()}}_validateListContainsValue(e,n){const r=e.value;return!r||n.find(u=>u.key===r.key)?null:{message:this.getTranslation("Validations.DataValueTypeListContainsMessage")}}_typeChanged(e,n){const r=(0,c.aBE)(e.option.value.key),u=n.formGroup.controls.schema,M=n.formGroup.controls.lookup,N=n.formGroup.controls.containsPerformerId;r?(u.enable(),M.enable(),N.enable()):(u.disable(),M.disable(),N.setValue(!1),N.disable())}getControls(e){return[new m.kSE({controlType:m.$5M.TextBox,key:"name",label:this.getTranslation("Title"),value:e.name,required:!0,validators:[n=>this._validateName(n)]}),new m.kSE({controlType:m.$5M.LocalizableText,key:"caption",label:this.getTranslation("Caption"),value:e.caption,required:!0}),new m.kSE({controlType:m.$5M.Autocomlete,key:"type",value:this._getSelectedType(e.type),label:this.getTranslation("Type"),required:!0,options:this._getDataValueTypeOptions(e.type),validators:[n=>this._validateListContainsValue(n,this._getDataValueTypeOptions(e.type))],changeValue:(n,r)=>this._typeChanged(n,r)}),new m.kSE({controlType:m.$5M.Autocomlete,key:"lookup",value:this._getSelectedLookup(e.lookup),label:this.getTranslation("Lookup"),options:this._availableSchemas,isDisabled:!(0,c.aBE)(e.type)}),new m.kSE({controlType:m.$5M.TextBox,key:"schema",label:this.getTranslation("Schema"),value:e.schema,isDisabled:!(0,c.aBE)(e.type)}),new m.kSE({controlType:m.$5M.CheckBox,key:"required",value:e.required,label:this.getTranslation("Required"),required:!1}),new m.kSE({controlType:m.$5M.CheckBox,key:"resulting",value:e.resulting,label:this.getTranslation("Resulting"),required:!1,changeValue:(n,r)=>this.resultingChanged(n,r,e)}),new m.kSE({controlType:m.$5M.CheckBox,key:"containsPerformerId",value:e.containsPerformerId,label:this.getTranslation("ContainsPerformerId"),required:!1,changeValue:(n,r)=>this.containsPerformerIdChanged(n,r,e),isDisabled:!(0,c.aBE)(e.type)}),new m.kSE({controlType:m.$5M.CheckBox,key:"lazyLoad",value:e.lazyLoad,label:this.getTranslation("LazyLoad"),required:!1}),new m.kSE({controlType:m.$5M.CheckBox,key:"serializable",value:e.serializable,label:this.getTranslation("Serializable"),required:!1}),new m.kSE({controlType:m.$5M.CheckBox,key:"copyValue",value:e.copyValue,label:this.getTranslation("CopyValue"),required:!1})]}openSchemaParameterCard(e){e=e||this._createParameterModel();const n=this._getDynamicFormConfig(e),r=this._getMiniCardConfig(n);return this.dialogService.open(m.Eqq,{data:r}).pipe((0,me.h)(u=>u!==void 0),(0,V.U)(u=>{const M=this._createParameterModel();return u.applyChangesInModel(M),e.updateDescription(M),this._updateDataTypeIcon(e),e}),(0,J.B)())}get translationPrefix(){return"SchemaDesigners.SchemaParameterMiniPage"}prepareAvailableEntitySchemas(){return this._maskService.showBodyMask(),this._workspaceEntityApiService.getAvailableEntitySchemas(this.schema.package.uId).pipe((0,V.U)(e=>{e.success||(this._availableSchemas=[]),this._availableSchemas=e.items.map(n=>({value:n.name,key:n.uId})),this._maskService.hideBodyMask()}))}getOkBtnTitleTranslation(){return this.getTranslation("Create")}resultingChanged(e,n,r){e.checked&&this._checkSchemaParameterExists("resulting",r)&&(n.formGroup.controls.resulting.setValue(!1,{emitEvent:!1}),this.dialogService.openInfoDialog(this.getTranslation("ProperyExistMessage")))}containsPerformerIdChanged(e,n,r){e.checked&&this._checkSchemaParameterExists("containsPerformerId",r)&&(n.formGroup.controls.containsPerformerId.setValue(!1,{emitEvent:!1}),this.dialogService.openInfoDialog(this.getTranslation("ProperyExistMessage")))}}j.\u0275fac=function(e){return new(e||j)(_.LFG(_.zs3))},j.\u0275prov=_.Yz7({token:j,factory:j.\u0275fac});class L extends j{constructor(e){super(e)}execute(e){return this.schema=e.schema,this.schema.parameters=this.schema.parameters||new se.Ts,this.parameters=this.schema.findNestedParametersGroup(e.itemUId),this.prepareAvailableEntitySchemas().pipe((0,ie.z)(n=>this.openSchemaParameterCard()),(0,re.b)(n=>{this.parameters.push(n)}))}}L.\u0275fac=function(e){return new(e||L)(_.LFG(_.zs3))},L.\u0275prov=_.Yz7({token:L,factory:L.\u0275fac});class Z extends j{constructor(e){super(e)}getOkBtnTitleTranslation(){return this.getTranslation("Save")}getControls(e){const n=super.getControls(e);if(e.value){const r=new m.kSE({controlType:m.$5M.TextBox,key:"value",label:this.getTranslation("Value"),value:e.value});n.splice(5,0,r)}return n}execute(e){return this.schema=e.schema,this.schema.parameters=this.schema.parameters||new se.Ts,this.parameters=e.schema.parameters,this.prepareAvailableEntitySchemas().pipe((0,ie.z)(()=>{const n=this.schema.findParameterByUId(e.itemUId);return this.openSchemaParameterCard(n)}))}}Z.\u0275fac=function(e){return new(e||Z)(_.LFG(_.zs3))},Z.\u0275prov=_.Yz7({token:Z,factory:Z.\u0275fac});class K extends Z{getControls(e){const n=super.getControls(e);return n.forEach(r=>r.isDisabled=!0),n}execute(e){const n=super.execute(e).pipe((0,J.B)());return n.subscribe(r=>{}),n}}K.\u0275fac=function(){let D;return function(n){return(D||(D=_.n5z(K)))(n||K)}}(),K.\u0275prov=_.Yz7({token:K,factory:K.\u0275fac});class R{static _internalExecute(e){const r=e.schema.findGroup(e.metaItemsUid).deleteItemByUId(e.itemUId);return(0,g.of)(r)}execute(e){return R._internalExecute(e).pipe((0,me.h)(n=>n),(0,J.B)())}}R.\u0275fac=function(e){return new(e||R)},R.\u0275prov=_.Yz7({token:R,factory:R.\u0275fac});class F extends oe{constructor(e){super(e),this._dialogService=e.get(q.xA)}get translationPrefix(){return""}get pageMode(){return this._designerPageMode}static _getIsValuesValid(e){return e&&e.values}_validateName(e,n){return C.Pu.validateRequiredName(e,this.translateService.instant("SchemaDesigners.BaseDesignerStructureService.MiniPage.Validations.RequiredNameCaption"))||C.Pu.validatePatternName(e,this.translateService.instant("SchemaDesigners.BaseDesignerStructureService.MiniPage.Validations.PatternNameCaption"))||C.Pu.validatePrefixName(e,n,(0,c.WUZ)(this.translateService.instant("SchemaDesigners.BaseDesignerStructureService.MiniPage.Validations.PatternPrefixTemplate"),[n]))}_getMiniCardConfig(e){return{title:this.getTranslation(this.editDescriptionCaptionKey),okBtnTitle:"SchemaDesigners.BaseDesignerStructureService.MiniPage.Apply",cancelBtnTitle:"SchemaDesigners.BaseDesignerStructureService.MiniPage.Cancel",dynamicForm:m.jlq.create(e),useValidation:!0}}openMiniCard(e){return this._dialogService.open(m.Eqq,{data:e})}getIsReadOnly(e){return e.isReadOnly}getMiniCardControls(e){return[new m.kSE({controlType:m.$5M.TextBox,key:"name",label:this.translateService.instant("SchemaDesigners.BaseDesignerStructureService.MiniPage.NameTitle"),value:e.model.name,required:!0,isDisabled:this.getIsReadOnly(e.model),validators:[n=>this._validateName(n,e.schemaNamePrefix)]})]}getPackageNameToFormConfig(e){return new m.kSE({controlType:m.$5M.TextBox,key:"package.name",label:this.translateService.instant("SchemaDesigners.BaseDesignerStructureService.MiniPage.PackageTitle"),isDisabled:!0,value:e.package.name,required:!0})}addValues(e,n){return Object.assign({uId:n.uId,id:n.id,package:n.package},e)}changeDescription(e,n){return e.updateDescription(n),(0,g.of)(!0)}execute(e){const n=e.model;this._designerPageMode=e.schemaDesignerMode;const u=[{columns:[{formComponents:this.getMiniCardControls(e)}]}],M=this._getMiniCardConfig(u);return this.openMiniCard(M).pipe((0,X.w)(N=>{if(!F._getIsValuesValid(N))return(0,g.of)(!1);const b=this.addValues(N.values,n);return this.changeDescription(n,b)}))}}F.\u0275fac=function(e){return new(e||F)(_.LFG(_.zs3))},F.\u0275prov=_.Yz7({token:F,factory:F.\u0275fac});class ee extends F{constructor(e){super(e)}_captionValidators(e){const r=e.value.find(u=>u.cultureName===this.translateService.currentLang);return r?.value?null:{valid:!1}}getMiniCardControls(e){const n=super.getMiniCardControls(e),r=e.model;return n.push(this.getCaptionNameToFormConfig(r),this.getPackageNameToFormConfig(r),this.getDescriptionToFormConfig(r)),n}getCaptionNameToFormConfig(e){return new m.kSE({controlType:m.$5M.LocalizableText,key:"caption",label:this.translateService.instant("SchemaDesigners.BaseDesignerStructureService.MiniPage.Caption"),value:e.caption.clone(),required:!0,validators:[n=>this._captionValidators(n)],isDisabled:this.getIsReadOnly(e)})}getDescriptionToFormConfig(e){return new m.kSE({controlType:m.$5M.LocalizableText,key:"description",label:this.translateService.instant("SchemaDesigners.BaseDesignerStructureService.MiniPage.Description"),value:e.description.clone(),isDisabled:this.getIsReadOnly(e)})}}ee.\u0275fac=function(e){return new(e||ee)(_.LFG(_.zs3))},ee.\u0275prov=_.Yz7({token:ee,factory:ee.\u0275fac});class Ae{_getDialogService(e){return{open(n,r){const u=new DynamicFormGridModel;return u.formGroup={value:e},of(u)}}}_getTranslateService(){return{instant(e,n){return e}}}_getDialogServiceMock(e){const n=this._getDialogService(e);return{provide:DialogService,useValue:n}}_getTranslateServiceMock(){const e=this._getTranslateService();return{provide:TranslateService,useValue:e}}getProviders(){const e=this._getDialogServiceMock(this.getCommandModel()),n=this._getTranslateServiceMock();return[e,n]}getDialogServiceMock(e){return this._getDialogServiceMock(e)}getTranslationServiceMok(){return this._getTranslateServiceMock()}}class ce extends ge{static _getLocalizableStringsActionsConfig(){const e=new C.H0;return e.editCommandType=Q,e.deleteCommandType=R,e.showCommandType=$,e}getLocalizableStringSchemaStructureElement(e){const n=ce._getLocalizableStringsActionsConfig(),r=C.lw.create({caption:this.getTranslation("LocalizableStringsCaption"),icon:"base-schema-localizable-strings-icon.svg",uId:e.localizableStrings.uId,actions:this.getActions(this.getIsReadOnly(e),G),newChildActions:this.getChildrenActions(this.getIsReadOnly(e),n)});return e.localizableStrings.forEach(u=>{const M=C.lw.create({caption:u.name,uId:u.uId,parentUId:r.uId,actions:this.getChildrenActions(this.getIsReadOnly(e),n,e.getIsOwnMetaItem(u))});r.addChild(M)}),r}getActions(e,n){return e?[]:[C.E_.createAddAction(n)]}getChildrenActions(e,n,r=!0){const u=[];return e?(u.push(C.E_.createShowAction(n.showCommandType)),u):(u.push(C.E_.createNestedEditAction(n.editCommandType)),r&&u.push(C.E_.createDeleteAction(n.deleteCommandType)),u)}}class te extends ce{_createChildParameters(e,n,r,u){var M;const N=[];return(M=n.itemProperties)===null||M===void 0||M.forEach(b=>{N.push(C.lw.create({caption:b.name,uId:b.uId,parentUId:r,actions:[...this._getParameterActions(this.getIsReadOnly(e),b),...u],icon:(0,c.Qud)(b.type),children:this._createChildParameters(e,b,b.uId,u),newChildActions:u}))}),N}_getParameterActions(e,n){return this._getIsCollections(n)?this.getActions(e,L):[]}_getIsCollections(e){return e.type===i.DataValueType.COMPOSITE_OBJECT_LIST}constructor(e){super(e)}getParametersSchemaStructureElement(e){const n=this.getIsReadOnly(e)?[C.E_.createShowAction(K)]:[C.E_.createNestedEditAction(Z),C.E_.createDeleteAction(R)],r=C.lw.create({caption:this.getTranslation("ParametersCaption"),icon:"schema-parameters-icon.svg",uId:e.parameters.uId,actions:this.getActions(this.getIsReadOnly(e),L),newChildActions:n});return e.parameters.forEach(u=>{const M=C.lw.create({caption:u.name,uId:u.uId,parentUId:r.uId,actions:[...this._getParameterActions(this.getIsReadOnly(e),u),...n],icon:(0,c.Qud)(u.type),children:this._createChildParameters(e,u,u.uId,n),newChildActions:n});r.children.push(M)}),r}}te.\u0275fac=function(e){return new(e||te)(_.LFG(_.zs3))},te.\u0275prov=_.Yz7({token:te,factory:te.\u0275fac});var pe=o(33177);class W{constructor(e,n){this._window=e,this._appInfoService=n}openMetaData(e){const n=this._appInfoService.getSchemaMetaDataUrl(e.uId,e.type,e.packageUId);this._window.open(n,"_blank")}}W.\u0275fac=function(e){return new(e||W)(_.LFG(pe.WINDOW_TOKEN),_.LFG(a.zz))},W.\u0275prov=_.Yz7({token:W,factory:W.\u0275fac});class z{constructor(e,n){this._window=e,this._appInfoService=n}openSourceCode(e){const n=this._appInfoService.getMetaItemsSourceCodeUrl(e);this._window.open(n,"_blank")}openClientUnitSourceCode(e){const n=this._appInfoService.getClientUnitSchemaDesignerUrl(e);this._window.open(n,"_blank")}}z.\u0275fac=function(e){return new(e||z)(_.LFG(pe.WINDOW_TOKEN),_.LFG(a.zz))},z.\u0275prov=_.Yz7({token:z,factory:z.\u0275fac});var De=o(7206),_e=o(15748);class ne extends m.neP{constructor(e){super(e),this.closePageAfterSave=!1,this.notifierHandler=()=>this.publishMessage(),this._titleService=e.get(m.yDd),this.processRouting()}get _modelCaption(){return(this.model?this.model.name:"")||this.createEmptyModel().DefaultName}get _designerCaption(){return this.isChanged?`${this.changedSchemaPrefix}${this._modelCaption}`:this._modelCaption}get changedSchemaPrefix(){return"*"}get isSearchEnabled(){return!0}get isNewMode(){return this._pageMode===C.t2.new}get isReadOnlyMode(){return this.model.isReadOnly}get getPageState(){return this._pageMode}_updateTabTitle(){this._titleService.setTitle(this._designerCaption)}_buildSchemaStructure(){this.designerStructureService.getStructureData(this.model,this.selectedAction).subscribe(e=>{this.schemaStructure=e})}_setPageMode(){this.isNewMode&&(this._pageMode=C.t2.edit)}_initWorkspaceExplorerReloadChannel(){this.workspaceReloadBroadcastService=this.injector.get(pe.BroadcastChannelFactory).createInstance(l.Kp)}_decorateUntilDestroyed(e){return e.pipe((0,ae.R)(this.destroyed$))}_createCommand(e){return this.injector.get(e)}_getCommand(e){const n=e.designerCommandType;return this._createCommand(n)}_getActions(e,n){return e?[]:[C.E_.createAddAction(n)]}_addItem(e){const n=this._getCommand(e),r={metaItemsUid:e.item.uId,itemUId:e.item.uId,schema:this.model};n.execute(r).pipe((0,H.P)()).subscribe(u=>{const M=u.length?[...u]:[u];return this.onAddedItem(e,M)})}_editItem(e){const n=this._getCommand(e),r={metaItemsUid:e.item.parentUId,itemUId:e.item.uId,schema:this.model};this._decorateUntilDestroyed(n.execute(r)).subscribe(u=>{this.onItemEditComplete(u,e)})}_deleteItem(e){const n=this._getCommand(e),r={metaItemsUid:e.item.parentUId,itemUId:e.item.uId,schema:this.model};this._decorateUntilDestroyed(n.execute(r)).subscribe(()=>{this.removeItemFromStructure(e.item),this.setIsChanged()})}_showItem(e){const n=this._getCommand(e),r={metaItemsUid:e.item.parentUId,itemUId:e.item.uId,schema:this.model};this._decorateUntilDestroyed(n.execute(r))}_getSaveValidationErrorGtmData(){return(0,De.Z)(this.getDefaultSaveGtmData(),{action:"SaveValidationError"})}showCompilationErrors(e){e&&this._errorListDialogService.showCompilationErrors(e)}showSuccessMessage(e){this.notifyService.show({message:e}).then()}onItemEditComplete(e,n){n.item.caption=e.name,n.item.newChildActions.length>0&&(n.item.actions=[...this.getCreateParameterActions(e.type),...n.item.newChildActions]),e.type!==i.DataValueType.COMPOSITE_OBJECT_LIST&&(n.item.children=[]),this.editItemIntoStructure(n.item),this.setIsChanged()}injectDependencies(){super.injectDependencies(),this.router=this.injector.get(d.F0),this.notifyService=this.injector.get(q.c),this._errorListDialogService=this.injector.get(p.oP),this._maskService=this.injector.get(q.Bm),this._editDescriptionCommand=this.injector.get(F),this._titleService=this.injector.get(m.yDd),this._initWorkspaceExplorerReloadChannel()}getSaveSuccessMessage(){return this.translateInstant("SchemaDesigners.BaseDesignerPage.SaveSuccessMessage")}getModelFromLoadResponse(e){return e.schema}makeSaveRequest(e){return this.apiDataService.saveSchema(e)}savePageData(e){return this.makeSaveRequest(e)}applySaveSuccessfulResponse(e,n){super.applySaveSuccessfulResponse(e,n),this._updateTabTitle()}removeItemFromStructure(e){this.schemaDesignerStructureComponent.removeItemFromStructure(e)}editItemIntoStructure(e){this.schemaDesignerStructureComponent.editItemIntoStructure(e)}addNewItemIntoStructure(e,n){n.forEach(r=>{this.schemaDesignerStructureComponent.addNewItemIntoStructure(e.item.uId,r)})}getFlatSchemaStructure(e){const n=[...e];return e.filter(r=>r.hasChildren()).forEach(r=>{n.push(...this.getFlatSchemaStructure(r.children))}),n}findStructureElementByUId(e){return this.getFlatSchemaStructure(this.schemaStructure).find(r=>r.uId===e)}updateStructureElementCaption(e,n){const r=this.findStructureElementByUId(e);r.caption=n}getNeedEditDescription(){return this.getPageState===C.t2.new}onModelSet(e){super.onModelSet(e),this.isModelLoaded&&this.onModelSetInternal()}onModelSetInternal(){this._updateTabTitle(),this.designerStructureService&&this._buildSchemaStructure(),this.getNeedEditDescription()&&this.editSchemaDescriptor()}getNewSchema(){return(0,g.of)(this.generateDataForCreateSchema())}requestPageData(){return this.isNewMode?(this.setIsChanged(),this.getNewSchema()):this.apiDataService.getSchema(this.getSchemaRequestData())}getSchemaRequestData(){return{schemaUId:this.uId}}createEmptyModel(){const e=this.modelType,n=new e;return n.name="",n.body="",n.package=new se.GL,n}publishMessage(){this.workspaceReloadBroadcastService.publish()}recordSaved(e){super.recordSaved(e),e?.success&&(this.showSuccessMessage(this.getSaveSuccessMessage()),this._setPageMode()),this.notifierHandler()}getQueryParam(){return this.activateRoute.snapshot.queryParams}createTempDesignItem(e){const n=this.createEmptyModel();return n.uId=(0,i.generateGuid)(),n.package.name=e.packageName,n.package.uId=e.packageId,n}generateDataForCreateSchema(){const e=this.getQueryParam();return{success:!0,schema:this.createTempDesignItem(e)}}getEditDescriptionArgs(){return{model:this.model,schemaDesignerMode:this.getPageState}}changeDescription(){return this._editDescriptionCommand.execute(this.getEditDescriptionArgs()).pipe((0,ae.R)(this.destroyed$),(0,J.B)())}editSchemaDescriptor(){this.changeDescription().subscribe(e=>{e&&this.setIsChanged()})}applyPageLoadResponse(e){this.isModelLoaded=e&&e.success,super.applyPageLoadResponse(e)}showBodyMask(){super.showBodyMask(),this._maskService.showBodyMask({delay:0})}hideBodyMask(){super.hideBodyMask(),this._maskService.hideBodyMask()}updateSchemaStructure(){this._buildSchemaStructure()}onAddedItem(e,n){const r=e.item.uId;n.forEach(u=>{const M=C.lw.create({caption:u.name,actions:[...this.getCreateParameterActions(u.type),...e.item.newChildActions],newChildActions:e.item.newChildActions,model:u.model,icon:u.icon,uId:u.uId,parentUId:r});this.addNewItemIntoStructure(e,[M]),this.setIsChanged()})}getCreateParameterActions(e){return e===i.DataValueType.COMPOSITE_OBJECT_LIST?this._getActions(this.model.isReadOnly,L):[]}processRouting(){const e=this.activateRoute.snapshot.params.uId;e?(this.uId=e,this._pageMode=C.t2.edit):this._pageMode=C.t2.new}applySaveUnsuccessfulResponse(e,n){var r;n&&((r=n.validationErrors)===null||r===void 0?void 0:r.length)>0?this.sendGtmAction(this._getSaveValidationErrorGtmData()):super.applySaveUnsuccessfulResponse(e,n)}setIsChanged(){this.isReadOnlyMode||(super.setIsChanged(),this._updateTabTitle())}cancel(){if(this.isNewMode){this.close();return}super.cancel()}onStructureItemClick(e){switch(e.tag){case C.AH.edit:this.editSchemaDescriptor();break;case C.AH.add:this._addItem(e);break;case C.AH.nestedEdit:this._editItem(e);break;case C.AH.show:this._showItem(e);break;case C.AH.delete:this._deleteItem(e);break}}}ne.\u0275fac=function(e){return new(e||ne)(_.Y36(_.zs3))},ne.\u0275dir=_.lG2({type:ne,viewQuery:function(e,n){if(e&1&&_.Gf(_e.h,7),e&2){let r;_.iGM(r=_.CRH())&&(n.schemaDesignerStructureComponent=r.first)}},features:[_.qOj]});class w extends ne{get schemaInfo(){var e;return{schemaUId:this.model.uId,schema:this.model,packageUId:(e=this.model.package)===null||e===void 0?void 0:e.uId}}constructor(e){super(e),this._sysSettings={},this._allowStandaloneAssembly=!1,this._structureClickHandlerMap=new Map,this._schemaNamePrefixSettingsSysCode="SchemaNamePrefix",this._publishing=!1,this.showBusinessRules=!1,this.showChildRules=!1,this.activatedRoute=e.get(d.gz),this._businessRulePropertiesPanelService=e.get(O.jy),this._initUserCulture()}_initUserCulture(){var e;this.userCulture=(e=this.userInfo.cultureInfo)===null||e===void 0?void 0:e.sysCultureName}_getNewLocalizableItem(){const e=new c.CjD;return e.push({cultureName:this.userCulture,value:""}),e}_getRequestData(){const e=this.getQueryParam();return this.getRequestDataFromParameters(e)}_loadSchemaNamePrefix(){if(this._sysSettings&&this._sysSettings[this._schemaNamePrefixSettingsSysCode])return(0,g.of)(!0);const e=[this._schemaNamePrefixSettingsSysCode];return this._sysSettingsService.getByCodes(e).pipe((0,X.w)(n=>(this._sysSettings=n?.values,(0,g.of)(!0))))}_buildConfiguration(){return this.restErrorHandler.handleRequest(this._workspaceCompilationService.buildConfiguration()).pipe((0,X.w)(e=>this._runODataBuild(e)))}_runODataBuild(e){return this.restErrorHandler.handleRequest(this._workspaceCompilationService.runODataBuild()).pipe((0,X.w)(n=>this.onRunODataBuildFinished(e,n)))}_restartApp(e){return this.restErrorHandler.handleRequest(this._workspaceRestartService.restartApp()).pipe((0,V.U)(()=>(this.hideBodyMask(),e)))}_getStructureClickHandlerKey(e,n){return`${e}_${n}`}_initAddonActionsHandlers(){var e;(e=this.model.addons)===null||e===void 0||e.forEach(n=>{this.canInitAddonActionHandlers(n.addonName).pipe((0,H.P)()).subscribe({next:r=>{r&&this.initAddonActionsHandlers(n)}})})}setBusinessRuleElementClickHandlers(e,n,r){this.setStructureClickHandler(r,C.AH.show,this.openBusinessRuleAction.bind(this,e,n,r,!1)),this.setStructureClickHandler(r,C.AH.delete,this.removeBusinessRuleAction.bind(this,e,n,r))}_initBusinessRuleAddonActionsHandlers(e){e.addonName===c.nM_.BusinessRule&&e.addonConfig.subscribe(n=>{n.rules.forEach(r=>{this.setBusinessRuleElementClickHandlers(e,n,r.uId)}),this.setStructureClickHandler(e.id,C.AH.add,this.addBusinessRuleAction.bind(this,e,n))})}injectDependencies(){super.injectDependencies(),this._workspaceFeatureService=this.injector.get(l._3),this._workspaceCompilationService=this.injector.get(l.gs),this._workspaceRestartService=this.injector.get(l.lD),this.restErrorHandler=this.injector.get(m.Jcg),this._schemaMetaDataService=this.injector.get(W),this._schemaSourceCodeService=this.injector.get(z),this.userInfo=this.injector.get(c.aoG),this.featureService=this.injector.get(a.UZ),this._sysSettingsService=this.injector.get(a.lI),this.lczToStringPipe=this.injector.get(c.OWj)}getRequestDataFromParameters(e){return{packageUId:e.packageId}}getNewSchema(){return this.featureService.getFeatureState("UseSchemaNameGeneration").pipe((0,ie.z)(e=>e?this.apiDataService.createSchema(this._getRequestData()):super.getNewSchema()))}createTempDesignItem(e){const n=super.createTempDesignItem(e);return n.caption=this._getNewLocalizableItem(),n.description=this._getNewLocalizableItem(),n}onPublishSuccess(e,n){return n&&this.showSuccessMessage(this.translateInstant("SchemaDesigners.BaseDesignerPage.PublishSuccessMessage")),e?.success?this._restartApp(e):(this.hideBodyMask(),(0,g.of)(e))}onPublishFinished(e){return this.showCompilationErrors(e.errors),e?.success?this.onPublishSuccess(e,!0):(this.hideBodyMask(),(0,g.of)(e))}executeCompile(){const e=this.model.package,n=this._allowStandaloneAssembly&&e.type===l.yR.Assembly?this._workspaceCompilationService.buildPackage(e.name):this._workspaceCompilationService.compile();return this.restErrorHandler.handleRequest(n).pipe((0,X.w)(r=>this.onPublishFinished(r)))}onRunODataBuildFinished(e,n){return e.success&&n.success&&this.showSuccessMessage(this.translateInstant("SchemaDesigners.BaseDesignerPage.PublishSuccessMessage")),this.hideBodyMask(),(0,g.of)(n)}setStructureClickHandler(e,n,r){const u=this._getStructureClickHandlerKey(e,n);this._structureClickHandlerMap.set(u,r)}getStructureClickHandler(e,n){const r=this._getStructureClickHandlerKey(e,n);return this._structureClickHandlerMap.get(r)}addActionMenuItem(e){w._actionMenuItems.push(e)}enableOpenMetaDataMenuItem(){this.addActionMenuItem({caption:this.translateInstant("WorkspaceExplorer.Section.Actions.OpenMetaData"),code:"OpenMetadata",hidden:!1,handler:()=>this.openMetaData()})}enableOpenSourceCodeMenuItem(){this.addActionMenuItem({caption:this.translateInstant("WorkspaceExplorer.Section.Actions.OpenSourceCode"),code:"OpenSourceCode",hidden:!1,handler:()=>this.openSourceCode()})}onAdditionalResourcesLoaded(){this.hideBodyMask()}canInitAddonActionHandlers(e){return(0,g.of)(!1)}openBusinessRuleAction(e,n,r,u){this.currentBusinessRuleUId=r,this.businessRulesAddonMetadata=n,this.currentAddon=e,this.showBusinessRules=!0}addBusinessRuleAction(e,n){const r=(0,i.generateGuid)(),u=(0,h.FP)(),M={typeName:"Terrasoft.Core.BusinessRules.BusinessRule",uId:r,cases:[],triggers:[],name:u,enabled:!0};n.rules.push(M),e.addonConfig=(0,g.of)(n),this.schemaDesignerStructureComponent.addNewItemIntoStructure(e.id,this.designerStructureService.createBusinessRuleStructureElement(M)),this.openBusinessRuleAction(e,n,r,!0),this._businessRulePropertiesPanelService.changeBusinessRulePropertiesPanelExpandedState(!0),this.setBusinessRuleElementClickHandlers(e,n,r),this.setIsChanged()}removeBusinessRuleAction(e,n,r){const u=n.rules.findIndex(M=>M.uId===r);n.rules.splice(u,1),this.businessRulesAddonMetadata=n,e.addonConfig=(0,g.of)(this.businessRulesAddonMetadata),e.removeResource(`${r}.Caption`),this.currentAddon=e,this.showBusinessRules=!1,this.removeItemFromStructure({parentUId:e.id,uId:r}),this.setIsChanged()}initAddonActionsHandlers(e){this._initBusinessRuleAddonActionsHandlers(e)}onBusinessRuleChanged(e){const n=this.businessRulesAddonMetadata.rules.findIndex(r=>r.uId===e.uId);this.businessRulesAddonMetadata.rules[n]=e.toMetadata(),this.currentAddon.addonConfig=(0,g.of)(this.businessRulesAddonMetadata),this.currentAddon.createOrUpdateResource({key:`${e.uId}.Caption`,value:e.caption.map(r=>({key:r.cultureName,value:r.value}))}),(this.showChildRules||!e.parentUId)&&this.updateStructureElementCaption(e.uId,this.lczToStringPipe.transform(e.caption)),this.setIsChanged()}onModelSetInternal(){this.showBodyMask(),this._initAddonActionsHandlers(),this.loadAdditionalResources().subscribe(()=>{super.onModelSetInternal(),this.onAdditionalResourcesLoaded()})}loadAdditionalResources(){if(this.model.isReadOnly)return this.initEmptyAdditionalResources(),(0,g.of)([!0]);const e=this.getAdditionalResourceQueries();return(0,U.D)(e).pipe((0,ae.R)(this.destroyed$))}initEmptyAdditionalResources(){this._sysSettings={}}getAdditionalResourceQueries(){return[this._loadSchemaNamePrefix()]}getSchemaNamePrefix(){var e;return this._sysSettings&&((e=this._sysSettings[this._schemaNamePrefixSettingsSysCode])===null||e===void 0?void 0:e.value)||""}getEditDescriptionArgs(){const e=super.getEditDescriptionArgs();return e.schemaNamePrefix=this.getSchemaNamePrefix(),e}requestInitialPageData(){return(0,U.D)([super.requestInitialPageData(),this._workspaceFeatureService.getAllowStandaloneAssembly()]).pipe((0,re.b)(([e,n])=>this._allowStandaloneAssembly=n.value),(0,V.U)(([e])=>e))}getUseFullHierarchy(){const e=this.activatedRoute.snapshot.queryParams;return e?.useFullHierarchy==="true"}makeSaveRequest(e){return e.useFullHierarchy=this.getUseFullHierarchy(),super.makeSaveRequest(e)}getSchemaRequestData(){return{schemaUId:this.uId,useFullHierarchy:this.getUseFullHierarchy()}}getOpenDesignerEditModeUrl(){return null}openDesignerEditMode(){const e=this.getOpenDesignerEditModeUrl();e&&this.location.replaceState(e)}publish(e=!1){this.publishAsync(e).subscribe()}publishAsync(e=!1){this.notifierHandler=()=>{},this._publishing=!0;let n=this.isNewMode&&!this.closePageAfterSave;return this.save().pipe((0,X.w)(r=>r.success?(this.showBodyMask(),this.notifierHandler=()=>this.publishMessage(),e?this._buildConfiguration():this.executeCompile()):(n=!1,(0,g.of)(r))),(0,re.b)(()=>{this.publishMessage(),this._publishing=!1,n&&this.openDesignerEditMode()}),(0,ae.R)(this.destroyed$),(0,J.B)())}onStructureItemClick(e){const n=e.tag||C.AH.show;if(e.item){const r=e.item.parentUId||e.item.uId,u=this.getStructureClickHandler(r,n);if(u){u(e);return}}super.onStructureItemClick(e)}save(){const e=!this._publishing&&this.isNewMode&&!this.closePageAfterSave,n=super.save();return n.subscribe(r=>{r.addonsErrors&&this.dialogService.openInfoDialog(r.addonsErrors.join(`
`)),r.success&&e&&this.openDesignerEditMode()}),n}openMetaData(){const e={uId:this.model.uId,packageUId:this.model.package.uId,type:this.workspaceItemType};this._schemaMetaDataService.openMetaData(e)}openSourceCode(){this._schemaSourceCodeService.openSourceCode(this.model.uId)}getActionsConfig(){return w._actionMenuItems.length===0?null:{menuItems:[...w._actionMenuItems],trigger:{caption:this.translateInstant("BasePageComponent.Actions")}}}ngOnInit(){this.featureService.getFeatureState("BRules-ShowChildRules").subscribe(e=>{this.showChildRules=e}),super.ngOnInit(),w._actionMenuItems=[]}}w._actionMenuItems=new Array,w.\u0275fac=function(e){return new(e||w)(_.Y36(_.zs3))},w.\u0275dir=_.lG2({type:w,features:[_.qOj]});var Ce=o(65304),Ee=o(43723),Te=o(57209),ye=o(77544),xe=o(2552),ke=o(96202);class Y{}Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275mod=_.oAB({type:Y}),Y.\u0275inj=_.cJS({providers:[p.oP,m.Jcg,W,z,O.jy,c.V1j,{provide:c.ZsW,useClass:p.vH}],imports:[s.ez,m.kLW,t.Ps,S.yu,v.wp,A.dp,y.x4,f.D8,k.jT,P.y,T.aw,m.Nwg,m.s41,I.AA,E.abR,E.HHI]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&_.kYT(Y,{declarations:[_e.h,Te.S,Ee.i,Ce.a,ke.t,ye.x,xe.p],imports:[s.ez,m.kLW,t.Ps,S.yu,v.wp,A.dp,y.x4,f.D8,k.jT,P.y,T.aw,m.Nwg,m.s41,I.AA,E.abR,E.HHI],exports:[_e.h,Ce.a]})}()},65304:(B,x,o)=>{o.d(x,{a:()=>E});var s=o(64537),t=o(26522),f=o(36619),S=o(88692),v=o(11367),y=o(60527),k=o(15756),P=o(56707);function I(p,c){if(p&1){const d=s.EpF();s.TgZ(0,"button",6),s.NdJ("click",function(){s.CHM(d);const a=s.oxw();return s.KtG(a.save())}),s.ALo(1,"translate"),s._uU(2),s.ALo(3,"translate"),s.qZA()}if(p&2){const d=s.oxw();s.Q6J("disabled",!d.saveButtonEnabled)("title",s.lcZ(1,3,"BasePageComponent.Save")+" (Ctrl+S)"),s.xp6(2),s.Oqu(s.lcZ(3,5,"BasePageComponent.Save"))}}function A(p,c){if(p&1){const d=s.EpF();s.TgZ(0,"button",7),s.NdJ("click",function(){s.CHM(d);const a=s.oxw();return s.KtG(a.cancel())}),s._uU(1),s.ALo(2,"translate"),s.qZA()}p&2&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"BasePageComponent.Cancel")))}function T(p,c){if(p&1){const d=s.EpF();s.TgZ(0,"button",7),s.NdJ("click",function(){s.CHM(d);const a=s.oxw();return s.KtG(a.close())}),s._uU(1),s.ALo(2,"translate"),s.qZA()}p&2&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"BasePageComponent.Close")))}function O(p,c){if(p&1&&s._UZ(0,"ts-actions-menu",8),p&2){const d=s.oxw();s.Q6J("config",d.actionMenuItemsConfig)}}const m=["*"];class E{constructor(c){this._dialogService=c,this.saveButtonVisible=!1,this.saveButtonEnabled=!0,this.saveClick=new s.vpe,this.cancelClick=new s.vpe,this.closeClick=new s.vpe}save(){this.saveClick.emit()}cancel(){this.cancelClick.emit()}close(){this.closeClick.emit()}onKeyDown(c){(0,f.bOI)(c)&&(c.preventDefault(),this.saveButtonVisible&&!this._dialogService.hasOpenDialogs()&&this.save())}}E.\u0275fac=function(c){return new(c||E)(s.Y36(t.xA))},E.\u0275cmp=s.Xpm({type:E,selectors:[["ts-schema-designer-page-header"]],hostBindings:function(c,d){c&1&&s.NdJ("keydown",function(a){return d.onKeyDown(a)},!1,s.Jf7)},inputs:{saveButtonVisible:"saveButtonVisible",saveButtonEnabled:"saveButtonEnabled",actionMenuItemsConfig:"actionMenuItemsConfig"},outputs:{saveClick:"saveClick",cancelClick:"cancelClick",closeClick:"closeClick"},ngContentSelectors:m,decls:9,vars:4,consts:[[1,"header"],[1,"pane"],["header","",1,"header-action"],["mat-flat-button","","color","accent","class","action-button",3,"disabled","title","click",4,"ngIf"],["class","action-button","color","primary","mat-flat-button","",3,"click",4,"ngIf"],["class","mat-button",3,"config",4,"ngIf"],["mat-flat-button","","color","accent",1,"action-button",3,"disabled","title","click"],["color","primary","mat-flat-button","",1,"action-button",3,"click"],[1,"mat-button",3,"config"]],template:function(c,d){c&1&&(s.F$t(),s.TgZ(0,"div",0)(1,"div",1)(2,"ts-header")(3,"div",2),s.YNc(4,I,4,7,"button",3),s.YNc(5,A,3,3,"button",4),s.YNc(6,T,3,3,"button",4),s.Hsn(7),s.YNc(8,O,1,1,"ts-actions-menu",5),s.qZA()()()()),c&2&&(s.xp6(4),s.Q6J("ngIf",d.saveButtonVisible),s.xp6(1),s.Q6J("ngIf",d.saveButtonVisible),s.xp6(1),s.Q6J("ngIf",!d.saveButtonVisible),s.xp6(2),s.Q6J("ngIf",d.actionMenuItemsConfig))},dependencies:[S.O5,v.rV,y.G,k.eB,P.X$],styles:[".header[_ngcontent-%COMP%]{position:absolute;height:67px!important}.header[_ngcontent-%COMP%]   .pane[_ngcontent-%COMP%]{height:55px;border-radius:3px!important}.header[_ngcontent-%COMP%]   .pane[_ngcontent-%COMP%]   ts-header[_ngcontent-%COMP%]{padding-bottom:12px}"]})},77544:(B,x,o)=>{o.d(x,{x:()=>P});var s=o(72310),t=o(64537),f=o(88692),S=o(15756),v=o(43315);function y(I,A){if(I&1){const T=t.EpF();t.TgZ(0,"div")(1,"crt-button",1),t.NdJ("clicked",function(){t.CHM(T);const m=t.oxw();return t.KtG(m.btnClick(m.actionInfo))}),t.qZA()()}if(I&2){const T=t.oxw();t.xp6(1),t.Udp("display",T.isVisible?"block":"none"),t.Q6J("icon",T.actionInfo.icon)}}function k(I,A){if(I&1){const T=t.EpF();t.TgZ(0,"div")(1,"button",2),t.NdJ("click",function(){t.CHM(T);const m=t.oxw();return t.KtG(m.btnClick(m.actionInfo))}),t._UZ(2,"img",3),t.qZA()()}if(I&2){const T=t.oxw();t.xp6(2),t.Q6J("src",T.getBackgroundImage(T.actionInfo.icon),t.LSH)}}class P extends s.X{}P.\u0275fac=function(){let I;return function(T){return(I||(I=t.n5z(P)))(T||P)}}(),P.\u0275cmp=t.Xpm({type:P,selectors:[["ts-action-button"]],features:[t.qOj],decls:2,vars:2,consts:[[4,"ngIf"],[3,"icon","clicked"],["mat-icon-button","",3,"click"],["alt","node button icon",3,"src"]],template:function(A,T){A&1&&(t.YNc(0,y,2,3,"div",0),t.YNc(1,k,3,1,"div",0)),A&2&&(t.Q6J("ngIf",T.useFreedomComponents),t.xp6(1),t.Q6J("ngIf",!T.useFreedomComponents))},dependencies:[f.O5,S.eB,v.i],styles:[".mat-icon-button[_ngcontent-%COMP%]{height:30px;width:30px;line-height:0}"]})},2552:(B,x,o)=>{o.d(x,{p:()=>d});var s=o(72310),t=o(64537),f=o(88692),S=o(15756),v=o(72990),y=o(47531),k=o(3685),P=o(10367),I=o(43315);function A(i,a){if(i&1&&(t.TgZ(0,"div"),t._UZ(1,"crt-button",1,2)(3,"crt-menu",3,4),t.qZA()),i&2){const l=t.MAs(2),h=t.MAs(4),g=t.oxw();t.xp6(1),t.Udp("display",g.isVisible||(l==null?null:l.menuOpen)?"block":"none"),t.Q6J("crtMenuTriggerFor",h)("icon",g.menuIcon)("tsDataItemMarker","schema-designer-structure-action-menu-"+g.actionInfo.tag),t.xp6(2),t.Q6J("panelClass","schema-designer-structure-menu")("menuItems",g.menuItems)}}function T(i,a){i&1&&t._UZ(0,"span")}function O(i,a){if(i&1){const l=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){const H=t.CHM(l).$implicit,U=t.oxw(4);return t.KtG(U.btnClick(H))}),t._UZ(1,"img",14),t.TgZ(2,"span"),t._uU(3),t.qZA()()}if(i&2){const l=a.$implicit,h=t.oxw(4);t.Q6J("tsDataItemMarker","sub_menu_"+l.title),t.xp6(1),t.Q6J("src",h.getBackgroundImage(l.icon),t.LSH),t.xp6(2),t.Oqu(l.title)}}function m(i,a){if(i&1&&(t.TgZ(0,"button",13),t._UZ(1,"img",14),t._uU(2),t.qZA(),t.TgZ(3,"mat-menu",null,15),t.YNc(5,O,4,3,"button",16),t.qZA()),i&2){const l=t.MAs(4),h=t.oxw().$implicit,g=t.oxw(2);t.Q6J("matMenuTriggerFor",l)("ngClass",h.isDisabled?"btn-menu-disabled":"btn-menu")("tsDataItemMarker","menu_"+h.title),t.xp6(1),t.Q6J("src",g.getBackgroundImage(h.icon),t.LSH),t.xp6(1),t.hij(" ",h.title," "),t.xp6(3),t.Q6J("ngForOf",h.items)}}function E(i,a){if(i&1){const l=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){t.CHM(l);const g=t.oxw().$implicit,H=t.oxw(2);return t.KtG(H.btnClick(g))}),t._UZ(1,"img",14),t._uU(2),t.qZA()}if(i&2){const l=t.oxw().$implicit,h=t.oxw(2);t.Q6J("tsDataItemMarker","menu_"+l.title),t.xp6(1),t.Q6J("src",h.getBackgroundImage(l.icon),t.LSH),t.xp6(1),t.hij(" ",l.title," ")}}function p(i,a){if(i&1&&(t.ynx(0),t.YNc(1,T,1,0,"span",10),t.YNc(2,m,6,6,"ng-template",null,11,t.W1O),t.YNc(4,E,3,3,"ng-template",null,12,t.W1O),t.BQk()),i&2){const l=a.$implicit,h=t.MAs(3),g=t.MAs(5);t.xp6(1),t.Q6J("ngIf",(l.items==null?null:l.items.length)>0)("ngIfThen",h)("ngIfElse",g)}}function c(i,a){if(i&1&&(t.TgZ(0,"div")(1,"button",5),t._UZ(2,"img",6),t.qZA(),t.TgZ(3,"mat-menu",7,8),t.YNc(5,p,6,3,"ng-container",9),t.qZA()()),i&2){const l=t.MAs(4),h=t.oxw();t.xp6(1),t.Q6J("matMenuTriggerFor",l),t.xp6(1),t.Q6J("src",h.getBackgroundImage(h.actionInfo.icon),t.LSH),t.xp6(3),t.Q6J("ngForOf",h.actionInfo.menuItems)}}class d extends s.X{_initMenu(){!this.useFreedomComponents||(this.menuIcon=this.actionInfo.icon,this.menuItems=this.actionInfo.menuItems.map(a=>({caption:a.title,icon:a.icon,type:"action",disabled:a.isDisabled,handler:()=>{this.btnClick({tag:a.tag})}})))}onActionItemChanged(){super.onActionItemChanged(),this._initMenu()}onUseFreedomComponentsChanged(){super.onUseFreedomComponentsChanged(),this._initMenu()}}d.\u0275fac=function(){let i;return function(l){return(i||(i=t.n5z(d)))(l||d)}}(),d.\u0275cmp=t.Xpm({type:d,selectors:[["ts-action-menu"]],features:[t.qOj],decls:2,vars:2,consts:[[4,"ngIf"],[3,"crtMenuTriggerFor","icon","tsDataItemMarker"],["trigger","crtMenuTrigger"],[3,"panelClass","menuItems"],["menu",""],["mat-icon-button","",3,"matMenuTriggerFor"],["alt","node button icon",3,"src"],[1,"schema-designer-structure-menu"],["menu","matMenu"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfThen","ngIfElse"],["btnMenu",""],["btn",""],["mat-menu-item","",3,"matMenuTriggerFor","ngClass","tsDataItemMarker"],["alt","menu button icon",1,"btn-menu-icon",3,"src"],["sub_menu","matMenu"],["mat-menu-item","","class","btn-menu",3,"tsDataItemMarker","click",4,"ngFor","ngForOf"],["mat-menu-item","",1,"btn-menu",3,"tsDataItemMarker","click"]],template:function(a,l){a&1&&(t.YNc(0,A,5,7,"div",0),t.YNc(1,c,6,3,"div",0)),a&2&&(t.Q6J("ngIf",l.useFreedomComponents),t.xp6(1),t.Q6J("ngIf",!l.useFreedomComponents))},dependencies:[f.mk,f.sg,f.O5,S.eB,v.W0,v.tN,v.D8,y.O,k.R9,P.W,I.i],styles:[".mat-icon-button[_ngcontent-%COMP%]{height:30px;width:30px;line-height:0}.btn-menu[_ngcontent-%COMP%]{display:flex;align-items:center}.btn-menu-icon[_ngcontent-%COMP%]{padding-right:10px}"]})},72310:(B,x,o)=>{o.d(x,{X:()=>t});var s=o(64537);class t{constructor(){this.buttonClick=new s.vpe,this._useFreedomComponents=!1,this.isVisible=!1}get useFreedomComponents(){return this._useFreedomComponents}set useFreedomComponents(S){this._useFreedomComponents=S,this.onUseFreedomComponentsChanged()}get actionInfo(){return this._actionInfo}set actionInfo(S){this._actionInfo=S,this.onActionItemChanged()}onActionItemChanged(){}onUseFreedomComponentsChanged(){}getBackgroundImage(S){return S?"./assets/schema-designers/"+S:""}btnClick(S){S.isDisabled||this.buttonClick.emit(S)}}t.\u0275fac=function(S){return new(S||t)},t.\u0275dir=s.lG2({type:t,outputs:{buttonClick:"buttonClick"}})},96202:(B,x,o)=>{o.d(x,{t:()=>k});var s=o(64537),t=o(38023),f=o(13528),S=o(90950),v=o(77544),y=o(2552);class k{set isHovered(I){!this.componentRef||(this.componentRef.instance.isVisible=I)}constructor(I){this.container=I,this._destroyed=new t.x,this.useFreedomComponents=!1,this.actionClick=new s.vpe}ngOnInit(){const I=k._components[this.structureAction.actionControlType];!I||(this.componentRef=this.container.createComponent(I),this.componentRef.instance.actionInfo=this.structureAction,this.componentRef.instance.useMaterialIcons=this.useMaterialIcons,this.componentRef.instance.useFreedomComponents=this.useFreedomComponents,this.componentRef.instance.buttonClick.pipe((0,f.R)(this._destroyed)).subscribe(A=>{this.actionClick.emit(A)}))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}}k._components={[S.q1.Button]:v.x,[S.q1.Menu]:y.p},k.\u0275fac=function(I){return new(I||k)(s.Y36(s.s_b))},k.\u0275dir=s.lG2({type:k,selectors:[["","tsActionsDesignerStructure",""]],inputs:{structureAction:"structureAction",useMaterialIcons:"useMaterialIcons",useFreedomComponents:"useFreedomComponents",isHovered:"isHovered"},outputs:{actionClick:"actionClick"}})},15748:(B,x,o)=>{o.d(x,{h:()=>c});var s=o(55211),t=o(64537),f=o(18849),S=o(36619),v=o(90950),y=o(88692),k=o(47531),P=o(57209),I=o(43723),A=o(56707);const T=["schemaDesignerStructureWrapper"];function O(d,i){if(d&1){const a=t.EpF();t.TgZ(0,"div",8)(1,"ts-schema-designer-node",9),t.NdJ("nodeActionClick",function(h){t.CHM(a);const g=t.oxw();return t.KtG(g.onTreeItemActionClick(h))})("nodeClick",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onEditSchema())}),t.qZA()()}if(d&2){const a=t.oxw();t.xp6(1),t.ekj("schema-structure-item-hover",a.schemaDescriptor.canSelected)("schema-structure-item-selected",a.schemaDescriptor.selected),t.Q6J("node",a.schemaDescriptor)("control",a.treeControl)("useMaterialIcons",a.useMaterialIcons)}}function m(d,i){if(d&1){const a=t.EpF();t.TgZ(0,"div",10)(1,"ts-schema-designer-search",11),t.NdJ("selectedValue",function(h){t.CHM(a);const g=t.oxw();return t.KtG(g.onFilteredStructureElementSelected(h))})("clearValue",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onFilteredStructureElementClear())}),t.ALo(2,"translate"),t.qZA()()}if(d&2){const a=t.oxw();t.xp6(1),t.Q6J("placeholder",t.lcZ(2,2,"SelectSysAdminUnitDialog.Search"))("dataStructureElements",a.treeDataSource.data)}}function E(d,i){if(d&1){const a=t.EpF();t.TgZ(0,"mat-tree-node",12)(1,"ts-schema-designer-node",13),t.NdJ("nodeClick",function(h){t.CHM(a);const g=t.oxw();return t.KtG(g.onTreeItemClick(h))})("nodeActionClick",function(h){t.CHM(a);const g=t.oxw();return t.KtG(g.onTreeItemActionClick(h))}),t.qZA()()}if(d&2){const a=i.$implicit,l=t.oxw();t.ekj("schema-structure-item-hover",a.canSelected)("schema-structure-item-selected",a.selected),t.Q6J("tsDataItemMarker",a.caption),t.xp6(1),t.Q6J("node",a)("control",l.treeControl)("useMaterialIcons",l.useMaterialIcons)("useFreedomComponents",l.useFreedomComponents)}}function p(d,i){if(d&1){const a=t.EpF();t.TgZ(0,"mat-nested-tree-node",14)(1,"ts-schema-designer-node",15),t.NdJ("nodeClick",function(h){t.CHM(a);const g=t.oxw();return t.KtG(g.onTreeItemClick(h))})("nodeActionClick",function(h){t.CHM(a);const g=t.oxw();return t.KtG(g.onTreeItemActionClick(h))})("groupNodeClick",function(h){t.CHM(a);const g=t.oxw();return t.KtG(g.onTreeGroupClick(h))})("expandNode",function(h){t.CHM(a);const g=t.oxw();return t.KtG(g.onExpandNode(h))}),t.qZA(),t.TgZ(2,"div",16),t.GkF(3,17),t.qZA()()}if(d&2){const a=i.$implicit,l=t.oxw();t.ekj("schema-structure-item-hover",a.canSelected)("schema-structure-item-selected",a.selected),t.Q6J("tsDataItemMarker",a.caption),t.xp6(1),t.Q6J("node",a)("control",l.treeControl)("useExpandButton",!0)("suppressExpandOnClick",l.suppressExpandGroupOnClick)("canSelectRootTreeNode",l.canSelectRootTreeNode)("useMaterialIcons",l.useMaterialIcons),t.xp6(1),t.ekj("schema-structure-item-invisible",!l.treeControl.isExpanded(a)),t.Q6J("tsDataItemMarker",a.caption)}}class c{constructor(){this.isHeaderVisibled=!0,this.suppressExpandGroupOnClick=!1,this.canSelectRootTreeNode=!1,this.useMaterialIcons=!1,this.useFreedomComponents=!1,this._schemaDescription=v.lw.create({icon:"",caption:"",actions:[v.E_.createEditAction()],selected:!1}),this._expandsNodeUIds=new Set,this.treeControl=new s.VY(c._getChildren),this.treeDataSource=new f.WX,this.itemClick=new t.vpe,this.groupClick=new t.vpe,this.itemActionClick=new t.vpe}set dataSource(i){this._dataSource=i||[],this._refreshTree(),this._markSelectItem(),this._expandNodes()}set caption(i){this._schemaDescription.caption=i}set designerTypeCaptionImage(i){this._schemaDescription.icon=i}set canSelectSchemaDescriptor(i){this._schemaDescription.canSelected=i}set hideSchemaDescriptorActions(i){!i||(this._schemaDescription.actions=[])}get schemaDescriptor(){return this._schemaDescription}static _setElementSelectedValue(i,a){i&&(i.selected=a)}static _getChildren(i){return i.hasChildren()?i.children:null}_markSelectItem(){const{itemForSelect:i,parentItem:a}=this._findItemForSelect(this._dataSource)||{};let l=i;this._schemaDescription.canSelected&&(l?a&&this.treeControl.expand(a):l=this._schemaDescription),this._selectStructureElement(l)}_findItemForSelect(i){if(!i)return null;let a=null,l=null;for(const h of i)if(h.hasChildren()?(l=h,a=this._findItemForSelect(h.children).itemForSelect):a=h.canSelected&&h.selected?h:null,a)break;return{itemForSelect:a,parentItem:l}}_unMarkNestedStructureElement(){c._setElementSelectedValue(this._selectedNestedStructureElement,!1),this._selectedNestedStructureElement=null}_markNestedStructureElement(i){this._selectedNestedStructureElement=i,c._setElementSelectedValue(this._selectedNestedStructureElement,!0)}_unMarkRootStructureElement(){c._setElementSelectedValue(this._selectedRootStructureElement,!1),this._selectedRootStructureElement=null}_markRootStructureElement(i){!i.canSelected||(this._selectedRootStructureElement=i,c._setElementSelectedValue(this._selectedRootStructureElement,!0))}_selectFoundNode(i){this._unMarkNestedStructureElement();const a=this._findNode(i.parentUId,this.treeDataSource.data);if(a){const l=a.children.find(h=>h.caption===i.caption);this._markNestedStructureElement(l)}}_selectStructureElement(i){i?.canSelected&&(this._unMarkNestedStructureElement(),this._unMarkRootStructureElement(),i.parentUId?this._markNestedStructureElement(i):this._markRootStructureElement(i))}_scrollToSelectedItem(){setTimeout(()=>{const a=this.treeControlWrapper.nativeElement.querySelector(".schema-structure-item-selected");a&&a.scrollIntoView()},0)}_refreshTree(){this.treeDataSource.data=null,this.treeDataSource.data=this._dataSource}_findNode(i,a){return(0,S.ZSx)(a,l=>l.uId===i,l=>l.children)}_expandNodes(){this._expandsNodeUIds.size!==0&&this._expandsNodeUIds.forEach(i=>{const a=this._findNode(i,this._dataSource);!a||this.treeControl.expand(a)})}onExpandNode(i){this._expandsNodeUIds.has(i)?this._expandsNodeUIds.delete(i):this._expandsNodeUIds.add(i)}trackByFn(i,a){return a.uId}onEditSchema(){if(!this._schemaDescription.canSelected)return;const i=new v.uC;i.tag=v.AH.edit,i.item=this._schemaDescription,this._selectStructureElement(this._schemaDescription),this.itemActionClick.emit(i)}hasChild(i,a){return a&&a.hasChildren()}onTreeItemActionClick(i){this._unMarkNestedStructureElement(),this.itemActionClick.emit(i)}onTreeItemClick(i){this._selectStructureElement(i.item),this.itemClick.emit(i)}onTreeGroupClick(i){this.groupClick.emit(i)}getBackgroundImage(i){return i?"./assets/schema-designers/"+i:""}onFilteredStructureElementSelected(i){const a=this.treeDataSource.data,l=i.parentUId;let h=this._findNode(l,a);if(!!h){for(;h;)this.treeControl.expand(h),h=this._findNode(h.parentUId,a);this._selectFoundNode(i),this._scrollToSelectedItem()}}onFilteredStructureElementClear(){this._unMarkNestedStructureElement()}addNewItemIntoStructure(i,a,l=!0){const h=this._findNode(i,this._dataSource);h.children.unshift(a),this._refreshTree(),this.treeControl.expand(h),l&&this._selectStructureElement(a)}editItemIntoStructure(i){const a=this._findNode(i.parentUId,this._dataSource),l=a.children.findIndex(h=>h.uId===i.uId);l>=0&&(a.children[l]=i),this._refreshTree(),this.treeControl.expand(a),this._selectStructureElement(i)}removeItemFromStructure(i){const a=this._findNode(i.parentUId,this._dataSource),l=a.children.findIndex(h=>h.uId===i.uId);l>=0&&(a.children.splice(l,1),this._refreshTree())}ngAfterViewInit(){this._scrollToSelectedItem()}}c.\u0275fac=function(i){return new(i||c)},c.\u0275cmp=t.Xpm({type:c,selectors:[["ts-schema-designer-structure"]],viewQuery:function(i,a){if(i&1&&t.Gf(T,7),i&2){let l;t.iGM(l=t.CRH())&&(a.treeControlWrapper=l.first)}},inputs:{dataSource:"dataSource",caption:"caption",designerTypeCaptionImage:"designerTypeCaptionImage",canSelectSchemaDescriptor:"canSelectSchemaDescriptor",hideSchemaDescriptorActions:"hideSchemaDescriptorActions",isHeaderVisibled:"isHeaderVisibled",suppressExpandGroupOnClick:"suppressExpandGroupOnClick",canSelectRootTreeNode:"canSelectRootTreeNode",useMaterialIcons:"useMaterialIcons",useFreedomComponents:"useFreedomComponents",isSearchEnabled:"isSearchEnabled"},outputs:{itemClick:"itemClick",groupClick:"groupClick",itemActionClick:"itemActionClick"},decls:8,vars:6,consts:[[1,"schema-designer-structure"],["class","designer-type",4,"ngIf"],["class","search-container",4,"ngIf"],[1,"tree-wrapper"],["schemaDesignerStructureWrapper",""],[3,"dataSource","treeControl","trackBy"],["matTreeNodeToggle","",3,"tsDataItemMarker","schema-structure-item-hover","schema-structure-item-selected",4,"matTreeNodeDef"],[3,"tsDataItemMarker","schema-structure-item-hover","schema-structure-item-selected",4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"designer-type"],[3,"node","control","useMaterialIcons","nodeActionClick","nodeClick"],[1,"search-container"],[3,"placeholder","dataStructureElements","selectedValue","clearValue"],["matTreeNodeToggle","",3,"tsDataItemMarker"],[3,"node","control","useMaterialIcons","useFreedomComponents","nodeClick","nodeActionClick"],[3,"tsDataItemMarker"],[3,"node","control","useExpandButton","suppressExpandOnClick","canSelectRootTreeNode","useMaterialIcons","nodeClick","nodeActionClick","groupNodeClick","expandNode"],[1,"mat-nested-tree-node-properties",3,"tsDataItemMarker"],["matTreeNodeOutlet",""]],template:function(i,a){i&1&&(t.TgZ(0,"div",0),t.YNc(1,O,2,7,"div",1),t.YNc(2,m,3,4,"div",2),t.TgZ(3,"div",3,4)(5,"mat-tree",5),t.YNc(6,E,2,9,"mat-tree-node",6),t.YNc(7,p,4,14,"mat-nested-tree-node",7),t.qZA()()()),i&2&&(t.xp6(1),t.Q6J("ngIf",a.isHeaderVisibled),t.xp6(1),t.Q6J("ngIf",a.isSearchEnabled),t.xp6(3),t.Q6J("dataSource",a.treeDataSource)("treeControl",a.treeControl)("trackBy",a.trackByFn),t.xp6(2),t.Q6J("matTreeNodeDefWhen",a.hasChild))},dependencies:[y.O5,f.GZ,f.fQ,f.eu,f.gi,f.uo,f.Ar,k.O,P.S,I.i,A.X$],styles:[`ts-schema-designer-structure{display:block;width:100%}.schema-designer-structure .schema-structure-item-selected{background-color:#e3e9f9}.schema-designer-structure .designer-type{background:#ffffff 0% 0% no-repeat padding-box;border-bottom:1px solid #e6e6e6;width:100%;display:flex;align-items:center;height:42px}.schema-designer-structure .designer-type ts-schema-designer-node{width:100%;font-size:14px}.schema-designer-structure .search-container{margin-left:15px;margin-top:10px;margin-bottom:10px;height:32px}.schema-designer-structure .tree-wrapper{display:block;overflow:auto;max-height:initial;height:calc(100vh - 172px)}.schema-designer-structure .tree-wrapper>.mat-tree .mat-tree-node{line-height:19px;min-height:36px;height:36px;white-space:nowrap}.schema-designer-structure .tree-wrapper>.mat-tree>.mat-tree-node{font-size:16px}.schema-designer-structure .tree-wrapper>.mat-tree>.mat-nested-tree-node{font-size:16px}.schema-designer-structure .tree-wrapper .mat-nested-tree-node .schema-structure-item{line-height:19px;height:36px;white-space:nowrap}.schema-designer-structure .tree-wrapper .mat-nested-tree-node .schema-structure-item-invisible{display:none}.schema-designer-structure .tree-wrapper .mat-nested-tree-node .schema-structure-item-selected{background-color:#e3e9f9}.schema-designer-structure .tree-wrapper .mat-nested-tree-node .schema-structure-item-selected>ts-schema-designer-node>.schema-structure-item>.schema-structure-item-selected-ground{display:block}.schema-designer-structure .tree-wrapper .mat-nested-tree-node .mat-tree-node{font-size:14px}.schema-designer-structure .tree-wrapper .mat-nested-tree-node .mat-tree-node ts-schema-designer-node .schema-structure-actions.hover-action-block{display:none}.schema-designer-structure .tree-wrapper .mat-nested-tree-node .mat-tree-node:hover{cursor:pointer}.schema-designer-structure .tree-wrapper .mat-nested-tree-node .mat-tree-node:hover>ts-schema-designer-node>.schema-structure-item>.schema-structure-item-selected-ground{display:block;background-color:#f2f5ff}.schema-designer-structure .tree-wrapper .mat-nested-tree-node .mat-tree-node:hover>ts-schema-designer-node .schema-structure-actions.hover-action-block{display:flex}.schema-designer-structure .tree-wrapper ts-schema-designer-node{width:100%;height:100%}.schema-designer-structure .tree-wrapper .mat-nested-tree-node-properties{padding-left:14px}.schema-structure-icon{margin-left:16px;display:inline-block;width:16px;min-width:16px;height:16px;margin-right:8px}
`],encapsulation:2})},43723:(B,x,o)=>{o.d(x,{i:()=>c});var s=o(64537),t=o(90950),f=o(88692),S=o(83331),v=o(15756),y=o(18849),k=o(47531),P=o(96202);function I(d,i){if(d&1&&s._UZ(0,"img",13),d&2){const a=s.oxw();s.Q6J("src",a.getBackgroundImage(a.node.icon),s.LSH)}}function A(d,i){if(d&1&&s._UZ(0,"mat-icon",14),d&2){const a=s.oxw();s.Q6J("svgIcon",a.node.icon)}}function T(d,i){d&1&&(s.TgZ(0,"div",15)(1,"span",16),s._uU(2,"*"),s.qZA()())}function O(d,i){if(d&1){const a=s.EpF();s.TgZ(0,"div",17),s.ynx(1,18),s.NdJ("actionClick",function(h){const H=s.CHM(a).$implicit,U=s.oxw();return s.KtG(U.onNodeActionItemClick(U.node,H,h))}),s.BQk(),s.qZA()}if(d&2){const a=i.$implicit,l=s.oxw();s.Q6J("tsDataItemMarker",a.tag+"-"+l.node.caption),s.xp6(1),s.Q6J("useFreedomComponents",l.useFreedomComponents)("structureAction",a)("isHovered",l.isNodeHovered)}}function m(d,i){if(d&1&&s._UZ(0,"img",21),d&2){const a=s.oxw(2);s.Q6J("src",a.getGroupActionImagePath(a.node),s.LSH)}}function E(d,i){if(d&1&&s._UZ(0,"mat-icon",14),d&2){const a=s.oxw(2);s.Q6J("svgIcon",a.getGroupActionImagePath(a.node))}}function p(d,i){if(d&1){const a=s.EpF();s.TgZ(0,"button",19),s.NdJ("click",function(){s.CHM(a);const h=s.oxw();return s.KtG(h.expandTreeNode(h.node.uId))}),s.YNc(1,m,1,1,"img",20),s.YNc(2,E,1,1,"mat-icon",5),s.qZA()}if(d&2){const a=s.oxw();s.Q6J("tsDataItemMarker",a.getExpandedDataItemMarker(a.node)),s.uIk("aria-label","toggle "+a.node.caption),s.xp6(1),s.Q6J("ngIf",!a.useMaterialIcons),s.xp6(1),s.Q6J("ngIf",a.useMaterialIcons)}}class c{constructor(){this._imagePath="./assets/schema-designers/",this.useExpandButton=!1,this.suppressExpandOnClick=!1,this.canSelectRootTreeNode=!1,this.useFreedomComponents=!1,this.nodeActionClick=new s.vpe,this.nodeClick=new s.vpe,this.groupNodeClick=new s.vpe,this.expandNode=new s.vpe}_setNodeState(){this.control.isExpanded(this.node)?this.control.collapse(this.node):this.control.expand(this.node)}_getIconName(i){return this.control.isExpanded(i)?"up-arrows-icon":"down-arrows-icon"}_setIsNodeHovered(i){!this.useFreedomComponents||(this.isNodeHovered=i)}onNodeActionItemClick(i,a,l){const h=new t.uC;h.item=i,h.tag=a.tag,a.actionControlType===t.q1.Menu&&(h.menuItemType=l.type,h.tag=l.tag||a.tag),h.designerCommandType=a.designerCommandType,this.nodeActionClick.emit(h)}onNodeClick(){if(!this.node.canSelected){this._setNodeState();return}this.useExpandButton&&!this.suppressExpandOnClick&&this._setNodeState();const i=new t.uC;if(i.item=this.node,!this.node.hasChildren()||this.canSelectRootTreeNode){this.nodeClick.emit(i);return}this.groupNodeClick.emit(i)}getBackgroundImage(i){return i?`${this._imagePath}${i}`:""}getExpandedDataItemMarker(i){return`${i.caption}-${this.control.isExpanded(i)?"up":"down"}`}getGroupActionImagePath(i){const a=this._getIconName(i);return this.useMaterialIcons?a:`${this._imagePath}${a}.svg`}expandTreeNode(i){this.expandNode.emit(i)}mouseover(){this._setIsNodeHovered(!0)}mouseout(){this._setIsNodeHovered(!1)}}c.\u0275fac=function(i){return new(i||c)},c.\u0275cmp=s.Xpm({type:c,selectors:[["ts-schema-designer-node"]],hostBindings:function(i,a){i&1&&s.NdJ("mouseover",function(){return a.mouseover()})("mouseout",function(){return a.mouseout()})},inputs:{node:"node",control:"control",useExpandButton:"useExpandButton",suppressExpandOnClick:"suppressExpandOnClick",canSelectRootTreeNode:"canSelectRootTreeNode",useMaterialIcons:"useMaterialIcons",useFreedomComponents:"useFreedomComponents"},outputs:{nodeActionClick:"nodeActionClick",nodeClick:"nodeClick",groupNodeClick:"groupNodeClick",expandNode:"expandNode"},decls:14,vars:13,consts:[[1,"schema-structure-item"],[1,"schema-structure-item-selected-ground"],[1,"schema-structure-item-left",3,"click"],[1,"schema-structure-icon"],["alt","node caption icon",3,"src",4,"ngIf"],[3,"svgIcon",4,"ngIf"],[1,"schema-structure-caption"],[3,"title"],["class","schema-structure-required",4,"ngIf"],[1,"schema-structure-item-right"],[1,"schema-structure-actions"],[3,"tsDataItemMarker",4,"ngFor","ngForOf"],["mat-icon-button","","matTreeNodeToggle","","class","expandable",3,"tsDataItemMarker","click",4,"ngIf"],["alt","node caption icon",3,"src"],[3,"svgIcon"],[1,"schema-structure-required"],["tsDataItemMarker","required_node",1,"required"],[3,"tsDataItemMarker"],["tsActionsDesignerStructure","",3,"useFreedomComponents","structureAction","isHovered","actionClick"],["mat-icon-button","","matTreeNodeToggle","",1,"expandable",3,"tsDataItemMarker","click"],["alt","node button icon",3,"src",4,"ngIf"],["alt","node button icon",3,"src"]],template:function(i,a){i&1&&(s.TgZ(0,"div",0),s._UZ(1,"div",1),s.TgZ(2,"div",2),s.NdJ("click",function(){return a.onNodeClick()}),s.TgZ(3,"div",3),s.YNc(4,I,1,1,"img",4),s.YNc(5,A,1,1,"mat-icon",5),s.qZA(),s.TgZ(6,"div",6)(7,"span",7),s._uU(8),s.qZA()(),s.YNc(9,T,3,0,"div",8),s.qZA(),s.TgZ(10,"div",9)(11,"div",10),s.YNc(12,O,2,4,"div",11),s.YNc(13,p,3,4,"button",12),s.qZA()()()),i&2&&(s.ekj("schema-structure-item-hover",a.node.canSelected)("schema-structure-item-selected",a.node.selected),s.xp6(4),s.Q6J("ngIf",!a.useMaterialIcons&&a.node.icon),s.xp6(1),s.Q6J("ngIf",a.useMaterialIcons&&a.node.icon),s.xp6(2),s.Q6J("title",a.node.caption),s.xp6(1),s.Oqu(a.node.caption),s.xp6(1),s.Q6J("ngIf",a.node.required),s.xp6(2),s.ekj("hover-action-block",!a.useFreedomComponents),s.xp6(1),s.Q6J("ngForOf",a.node.actions),s.xp6(1),s.Q6J("ngIf",a.useExpandButton))},dependencies:[f.sg,f.O5,S.Hw,v.eB,y.eu,k.O,P.t],styles:[".schema-structure-item[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;position:relative;z-index:1}.schema-structure-item-left[_ngcontent-%COMP%]{overflow:hidden;width:100%;height:100%;display:flex;align-items:center;z-index:inherit}.schema-structure-item-left[_ngcontent-%COMP%]   .schema-structure-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.schema-structure-item-left[_ngcontent-%COMP%]   .schema-structure-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{padding-bottom:1px}.schema-structure-item-left[_ngcontent-%COMP%]   .schema-structure-caption[_ngcontent-%COMP%]{display:inline-block;overflow:hidden;text-overflow:ellipsis}.schema-structure-item-left[_ngcontent-%COMP%]   .schema-structure-required[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.schema-structure-item-right[_ngcontent-%COMP%]{display:inline-block}.schema-structure-item-right[_ngcontent-%COMP%]   .schema-structure-actions[_ngcontent-%COMP%]{display:flex;margin-right:8px;margin-left:auto;justify-content:flex-end}.schema-structure-item-right[_ngcontent-%COMP%]   .schema-structure-actions[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{height:30px;width:30px;line-height:0}.schema-structure-item-selected-ground[_ngcontent-%COMP%]{display:none;height:inherit;width:1000%;right:0;position:absolute}"]})},57209:(B,x,o)=>{o.d(x,{S:()=>m});var s=o(64537),t=o(38023),f=o(88692),S=o(83331),v=o(15756),y=o(95236),k=o(74817),P=o(79510),I=o(95411),A=o(47531);function T(E,p){if(E&1&&(s.TgZ(0,"mat-option",10),s._uU(1),s.qZA()),E&2){const c=p.$implicit;s.Q6J("value",c),s.xp6(1),s.hij(" ",c.caption," ")}}function O(E,p){if(E&1&&(s.TgZ(0,"mat-optgroup",8),s.YNc(1,T,2,2,"mat-option",9),s.qZA()),E&2){const c=p.$implicit;s.Q6J("label",c.caption),s.xp6(1),s.Q6J("ngForOf",c.children)}}class m{constructor(){this.selectedValue=new s.vpe,this.clearValue=new s.vpe,this.searchValue="",this.foundStructureElements$=new t.x}_createFoundElement(p,c){return{caption:p,uId:c}}_createChildFoundElement(p,c){const d=this._createFoundElement(p.caption.toString(),p.uId);return d.parentUId=p.parentUId||c,d}_createGroupFoundElements(p,c){const d=this._createFoundElement(p.caption.toString(),p.uId);return d.children=this._elementChildrenFilter(p,c),d}_createListGroup(p){const c=[p],d=[];for(;c.length!==0;){const i=c.shift();this._visitNode(i,d),i.hasChildren()&&i.children.forEach(a=>{c.push(a)})}return d}_visitNode(p,c){c.find(i=>i.uId===p.uId)||c.push(p)}_elementChildrenFilter(p,c){const d=c.toLowerCase(),i=[];return p.children.forEach(a=>{i.push(...this._createListGroup(a))}),i.filter(a=>a.caption.toString().toLowerCase().indexOf(d)!==-1).map(a=>this._createChildFoundElement(a,p.uId))}getElementCaption(p){return p?p.caption.toString():""}search(p){if(this.searchValue=p,!p){this.foundStructureElements$.next([]);return}p=p.toLocaleLowerCase(),this.foundStructureElements$.next(this.dataStructureElements.filter(c=>c.hasChildren()).map(c=>this._createGroupFoundElements(c,p)).filter(c=>c.children.length>0))}onClear(){this.search(""),this.clearValue.emit()}filterSelected(p){this.selectedValue.emit(p.option.value)}}m.\u0275fac=function(p){return new(p||m)},m.\u0275cmp=s.Xpm({type:m,selectors:[["ts-schema-designer-search"]],inputs:{placeholder:"placeholder",dataStructureElements:"dataStructureElements"},outputs:{selectedValue:"selectedValue",clearValue:"clearValue"},decls:9,vars:9,consts:[["svgIcon","search"],["floatLabel","never"],["matInput","","type","text","tsDataItemMarker","search-in-structure","spellcheck","false",1,"search-input-field",3,"value","placeholder","matAutocomplete","input","focus"],["matSuffix","","mat-icon-button","","aria-label","Clear",1,"close",3,"click"],["svgIcon","close"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"label",4,"ngFor","ngForOf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(p,c){if(p&1&&(s._UZ(0,"mat-icon",0),s.TgZ(1,"mat-form-field",1)(2,"input",2),s.NdJ("input",function(i){return c.search(i.target.value)})("focus",function(i){return c.search(i.target.value)}),s.qZA(),s.TgZ(3,"button",3),s.NdJ("click",function(){return c.onClear()}),s._UZ(4,"mat-icon",4),s.qZA()(),s.TgZ(5,"mat-autocomplete",5,6),s.NdJ("optionSelected",function(i){return c.filterSelected(i)}),s.YNc(7,O,2,2,"mat-optgroup",7),s.ALo(8,"async"),s.qZA()),p&2){const d=s.MAs(6);s.xp6(2),s.Q6J("value",c.searchValue)("placeholder",c.placeholder)("matAutocomplete",d),s.xp6(1),s.Udp("visibility",c.searchValue?"inherit":"hidden"),s.xp6(2),s.Q6J("displayWith",c.getElementCaption),s.xp6(2),s.Q6J("ngForOf",s.lcZ(8,7,c.foundStructureElements$))}},dependencies:[f.sg,S.Hw,v.eB,y.v_,y.nX,k.k0,P.VN,P.QJ,I.CK,I.NA,A.O,f.Ov],styles:["[_nghost-%COMP%]{display:flex;line-height:18px}[_nghost-%COMP%]   .search-input-field[_ngcontent-%COMP%]{line-height:18px!important}[_nghost-%COMP%]   mat-icon[svgicon=search][_ngcontent-%COMP%]{width:16px;height:16px;margin-right:6px;padding-top:8px}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-wrapper[_ngcontent-%COMP%]{display:inline}[_nghost-%COMP%]   button.close[_ngcontent-%COMP%]{position:relative;bottom:2px;height:21px;width:21px}"]})},81590:(B,x,o)=>{o.d(x,{o:()=>s});var s;(function(t){t.editIcon="schema-descriptor-edit-icon.svg",t.showIcon="structure-item-show-icon.svg",t.addIcon="add-structure-item.svg",t.deleteIcon="structure-item-delete-icon.svg"})(s||(s={}))},90950:(B,x,o)=>{o.d(x,{q1:()=>T.q,t2:()=>s,Pu:()=>A,E_:()=>v.E,H0:()=>k,uC:()=>f,AH:()=>S.A,lw:()=>t.l});var s;(function(O){O[O.edit=0]="edit",O[O.new=1]="new"})(s||(s={}));var t=o(29352);class f{constructor(m){Object.assign(this,m)}}var S=o(87543),v=o(41803),y=o(81590);class k{}var P=o(75378),I=o(36619);class A{static validateRequiredName(m,E){const p=m.value;return!p||(0,P.isEmptyGuid)(p)?{message:E}:null}static validatePatternName(m,E){const p=m.value,c=new RegExp("^[a-zA-Z]+[a-zA-Z0-9._]*$");return p.match(c)?null:{message:E}}static validateDuplicateName(m,E,p){return I.dNr.duplicate(E)(m)?{message:p}:null}static validatePrefixName(m,E,p){var c;const i=I.dNr.prefix(E)(m);return!((c=i?.prefix)===null||c===void 0)&&c.requiredPrefix?{message:p}:null}}var T=o(51008)},51008:(B,x,o)=>{o.d(x,{q:()=>s});var s;(function(t){t[t.Button=0]="Button",t[t.Menu=1]="Menu"})(s||(s={}))},29352:(B,x,o)=>{o.d(x,{l:()=>f});var s=o(75378),t=o.n(s);class f{constructor(v){this.actions=[],this.newChildActions=[],this.children=[],Object.assign(this,v),this.uId=this.uId||(0,s.generateGuid)(),this.actions=this.actions||[],this.newChildActions=this.newChildActions||[],this.children=this.children||[]}static create(v){return new f(v)}_createChildren(v){return f.create({caption:v.name,uId:v.uId,parentUId:this.uId,actions:this.newChildActions,newChildActions:this.newChildActions})}addChildren(v){!v||v.length===0||v.forEach(y=>{const k=this._createChildren(y);this.children.push(k)})}hasChildren(){return this.children&&this.children.length>0}addChild(v){this.children.push(v)}}},87543:(B,x,o)=>{o.d(x,{A:()=>s});var s;(function(t){t[t.show=0]="show",t[t.add=1]="add",t[t.delete=2]="delete",t[t.edit=3]="edit",t[t.nestedEdit=4]="nestedEdit"})(s||(s={}))},41803:(B,x,o)=>{o.d(x,{E:()=>S});var s=o(81590),t=o(51008),f=o(87543);class S{constructor(y){this.actionControlType=t.q.Button,this.menuItems=[],this.isDisabled=!1,Object.assign(this,y)}static createAddAction(y=null){return new S({tag:f.A.add,icon:s.o.addIcon,designerCommandType:y})}static createNestedEditAction(y=null){return new S({tag:f.A.nestedEdit,icon:s.o.editIcon,designerCommandType:y})}static createShowAction(y=null){return new S({tag:f.A.show,icon:s.o.showIcon,designerCommandType:y})}static createDeleteAction(y=null){return new S({tag:f.A.delete,icon:s.o.deleteIcon,designerCommandType:y})}static createEditAction(){return new S({tag:f.A.edit,icon:"schema-descriptor-edit-icon.svg"})}}}}]);
