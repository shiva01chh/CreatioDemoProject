(self.webpackChunkapp_studio_enterprise_system_designer=self.webpackChunkapp_studio_enterprise_system_designer||[]).push([[966],{33966:(le,oe,s)=>{"use strict";s.r(oe),s.d(oe,{BasePrintablesService:()=>ge,CustomDataSource:()=>ve,FastReportAnalyticsPrintableService:()=>U,FastReportDataSource:()=>ue,FastReportDataSourceEntityConverterService:()=>k,FastReportDataSourceService:()=>q,FastReportDataSourceType:()=>re,FastReportPrintable:()=>pe,FastReportPrintableEntityConverterService:()=>F,FastReportPrintablesService:()=>R,FastReportTemplate:()=>de,FastReportTemplateEntityConverterService:()=>Z,FastReportTemplateService:()=>V,LookupQuery:()=>fe,LookupService:()=>B,Printable:()=>ie,PrintableEditPageWrapComponent:()=>G,PrintableEntityConverterService:()=>w,PrintableSectionService:()=>W,PrintableServiceProviderService:()=>H,PrintableType:()=>S,PrintablesEditPageComponent:()=>$,PrintablesModule:()=>te,PrintablesSectionComponent:()=>X,PrintablesSectionUserProfile:()=>Ce,WordPrintable:()=>me,WordPrintableEditPageComponent:()=>ee,WordPrintableEntityConverterService:()=>E,WordPrintableService:()=>A,WordPrintableTablePart:()=>he,WordPrintableTablePartEntityConverterService:()=>O,WordPrintableTablePartService:()=>J});var P=s(88692),_=s(20092),j=s(83331),I=s(79510),Y=s(15756),N=s(49460),C=s(74817),D=s(72990),z=s(93254),c=s(73514),p=s(56558),f=s(56707),u=s(26522),m=s(69403),x=s(80542),r=s(75378),ne=s(49457),v=s(84945),g=s(27969),K=s(26903),ce=s(98168),b=s(44551),L=s(33568),S;(function(o){o.DevExpress="32f72c9c-72c7-44e0-8c84-34c9ed17ca50",o.MSWord="8bc259ef-4276-4906-b7a6-23dc59be7fe2",o.FastReport="8def0f6d-b075-41dd-bcad-ca660c29f2e2"})(S||(S={}));class ie{get type(){switch(this.typeId){case S.FastReport:return S.FastReport;case S.MSWord:return S.MSWord;default:throw new Error("Item not found exception")}}}class Ce{}class pe extends ie{}class ue{}class de{}class ve{}var re;(function(o){o.ESQ="BEFB209D-C2B2-46CA-A914-4F9EA0CA223B",o.Custom="A3DCDD77-152E-4602-A711-69A434181818"})(re||(re={}));class me extends ie{constructor(){super(...arguments),this.tableParts=[]}}class he{}var d=s(36619),t=s(64537);class w{createEntity(){return new ie}getEntity(e){const a=e.SysModule,n=e.Type,i=this.createEntity();return i.id=e.Id,i.caption=e.Caption,i.moduleId=a.value,i.moduleName=a.displayValue,i.typeId=n.value,i.typeName=n.displayValue,i.showInSection=e.ShowInSection,i.showInCard=e.ShowInCard,i.templateId=e.SysReportSchemaUId,i}getEntityColumns(e){return[new d._H7("Id",e.id,r.DataValueType.Guid),new d._H7("Caption",e.caption,r.DataValueType.Text),new d._H7("SysModule",e.moduleId,r.DataValueType.Lookup),new d._H7("Type",e.typeId,r.DataValueType.Lookup),new d._H7("SysReportSchemaUId",e.templateId,r.DataValueType.Guid),new d._H7("ShowInSection",e.showInSection,r.DataValueType.Boolean),new d._H7("ShowInCard",e.showInCard,r.DataValueType.Boolean)]}}w.\u0275fac=function(e){return new(e||w)},w.\u0275prov=t.Yz7({token:w,factory:w.\u0275fac});class F extends w{createEntity(){return new pe}getEntity(e){const a=super.getEntity(e);return a.template=null,a.dataSources=[],a}}F.\u0275fac=function(){let o;return function(a){return(o||(o=t.n5z(F)))(a||F)}}(),F.\u0275prov=t.Yz7({token:F,factory:F.\u0275fac});class k{constructor(){}getEntity(e){const a=e.Template,n=e.Type,i=new ue;return i.id=e.Id,i.name=e.Name,i.templateId=a.value,i.templateName=a.displayValue,i.typeId=n.value,i.typeName=n.displayValue,i.data=e.Data,i}getEntityColumns(e){return[new d._H7("Id",e.id,r.DataValueType.Guid),new d._H7("Name",e.name,r.DataValueType.Text),new d._H7("Data",e.data,r.DataValueType.Text),new d._H7("Template",e.templateId,r.DataValueType.Lookup),new d._H7("Type",e.typeId,r.DataValueType.Lookup)]}}k.\u0275fac=function(e){return new(e||k)},k.\u0275prov=t.Yz7({token:k,factory:k.\u0275fac});class Z{getEntity(e){const a=new de;return a.id=e.Id,a.data=e.Data,a}getEntityColumns(e){return[new d._H7("Id",e.id,r.DataValueType.Guid),new d._H7("Data",e.data,r.DataValueType.Text)]}}Z.\u0275fac=function(e){return new(e||Z)},Z.\u0275prov=t.Yz7({token:Z,factory:Z.\u0275fac});class E extends w{createEntity(){return new me}getEntity(e){const a=super.getEntity(e);return a.macrosList=e.MacrosList,a.macrosSettings=e.MacrosSettings,a.convertInPDF=e.ConvertInPDF,a.tableParts=null,a}getEntityColumns(e){return[...super.getEntityColumns(e),new d._H7("ConvertInPDF",e.convertInPDF,r.DataValueType.Boolean),new d._H7("MacrosList",e.macrosList,r.DataValueType.Text),new d._H7("MacrosSettings",e.macrosSettings,r.DataValueType.Text)]}}E.\u0275fac=function(){let o;return function(a){return(o||(o=t.n5z(E)))(a||E)}}(),E.\u0275prov=t.Yz7({token:E,factory:E.\u0275fac});class O{getEntity(e){const a=new he;return a.isNew=!1,a.isDeleted=!1,a.id=e.Id,a.sysModuleReportId=e.SysModuleReport&&e.SysModuleReport.value,a.name=e.Name,a.caption=e.Caption,a.objectId=e.ObjectId,a.macrosList=e.MacrosList,a.macrosSettings=e.MacrosSettings,a.referenceColumn=e.ReferenceColumn,a.referenceColumnCaption=e.ReferenceColumnCaption,a.filter=e.Filter,a.filterSettings=e.FilterSettings,a.objectColumnPath=e.ObjectColumnPath,a.objectColumnCaption=e.ObjectColumnCaption,a.isEmptyTableHide=e.IsEmptyTableHide,a}getEntityColumns(e){return[new d._H7("Id",e.id,r.DataValueType.Guid),new d._H7("Name",e.name,r.DataValueType.Text),new d._H7("SysModuleReport",e.sysModuleReportId,r.DataValueType.Guid),new d._H7("Caption",e.caption,r.DataValueType.Text),new d._H7("ObjectId",e.objectId,r.DataValueType.Guid),new d._H7("MacrosList",e.macrosList,r.DataValueType.Text),new d._H7("MacrosSettings",e.macrosSettings,r.DataValueType.Text),new d._H7("ReferenceColumn",e.referenceColumn,r.DataValueType.Text),new d._H7("ReferenceColumnCaption",e.referenceColumnCaption,r.DataValueType.Text),new d._H7("Filter",e.filter,r.DataValueType.Blob),new d._H7("FilterSettings",e.filterSettings,r.DataValueType.Text),new d._H7("ObjectColumnPath",e.objectColumnPath,r.DataValueType.Text),new d._H7("ObjectColumnCaption",e.objectColumnCaption,r.DataValueType.Text),new d._H7("IsEmptyTableHide",e.isEmptyTableHide,r.DataValueType.Boolean)]}}O.\u0275fac=function(e){return new(e||O)},O.\u0275prov=t.Yz7({token:O,factory:O.\u0275fac});class ge extends m.UE{constructor(e,a,n){super(e,a,n),this.newReportCaptionResourceName="Printables.Page.NewReportCaption",this.entitySchemaName="SysModuleReport"}}class U{constructor(e){this.queryExecutor=e,this._optionsSchemaColumnUId="SysOptionsPageSchemaUId",this.entitySchemaName="SysModuleAnalyticsReport"}_catchErrorResponse(e){return(0,v.of)({success:!1,errorInfo:{errorCode:null,message:e.message,stackTrace:e.stack},result:null})}_getSelectAnalyticsEsq(e){const a=new r.EntitySchemaQuery(this.entitySchemaName);return a.addSchemaColumn("Id"),a.addSchemaColumn(this._optionsSchemaColumnUId),a.addSchemaColumn("[VwSysSchemaInfo:UId:SysOptionsPageSchemaUId].Caption","OptionsSchemaName"),a.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"SysSchemaUId",e.templateId),a.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"SysModule",e.moduleId),a}_getUpdateQuery(e){const a=new r.UpdateQuery(this.entitySchemaName);return a.addColumn(this._optionsSchemaColumnUId,e.optionsSchemaUId,r.DataValueType.Guid),a.addColumn("Caption",e.caption,r.DataValueType.Text),a.addColumn("SysModule",e.moduleId,r.DataValueType.Lookup),a.addColumn("ModuleSchemaName",e.moduleSchemaName,r.DataValueType.Text),a.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"Id",e.sectionAnalyticsId),a}_getInsertQuery(e){const a=new r.InsertQuery(this.entitySchemaName);return a.addColumn("Id",e.sectionAnalyticsId,r.DataValueType.Guid),a.addColumn("SysSchemaUId",e.templateId,r.DataValueType.Guid),a.addColumn("SysModule",e.moduleId,r.DataValueType.Lookup),a.addColumn("Caption",e.caption,r.DataValueType.Text),a.addColumn("Type",S.FastReport,r.DataValueType.Lookup),a.addColumn("ModuleSchemaName",e.moduleSchemaName,r.DataValueType.Text),e.optionsSchemaUId&&a.addColumn(this._optionsSchemaColumnUId,e.optionsSchemaUId,r.DataValueType.Guid),a}_getDeleteQuery(e){const a=new r.DeleteQuery(this.entitySchemaName);return a.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"SysSchemaUId",e.templateId),a.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"SysModule",e.moduleId),a}_needInsertRecord(e){return e.showInSectionAnalyticsOldValue===!1&&e.showInSectionAnalytics===!0}_needDeleteRecord(e){return e.showInSectionAnalyticsOldValue===!0&&e.showInSectionAnalytics===!1}_needUpdateRecord(e){return e.showInSectionAnalytics===!0&&e.showInSectionAnalyticsOldValue===!0}_getUpdateAnalyticsQuery(e){return this._needInsertRecord(e)?this._getInsertQuery(e):this._needDeleteRecord(e)?this._getDeleteQuery(e):this._needUpdateRecord(e)?this._getUpdateQuery(e):null}_getResponse(e){return{success:!0,errorInfo:null,result:this._getSectionAnalyticsData(e)}}_getSectionAnalyticsData(e){return e.length===0?[{sectionAnalyticsId:(0,r.generateGuid)(),optionsSchemaUId:"",optionsSchemaName:"",showInSectionAnalytics:!1}]:[{sectionAnalyticsId:e[0].Id,optionsSchemaUId:e[0][this._optionsSchemaColumnUId],optionsSchemaName:e[0].OptionsSchemaName,showInSectionAnalytics:!0}]}_executeQuery(e){return this.queryExecutor.execute(e).pipe((0,g.U)(()=>({success:!0,errorInfo:null,result:[]})),(0,L.K)(a=>this._catchErrorResponse(a)))}getSectionAnalyticsData(e){const a=this._getSelectAnalyticsEsq(e);return this.queryExecutor.executeSelectQuery(a).pipe((0,g.U)(n=>this._getResponse(n)),(0,L.K)(n=>this._catchErrorResponse(n)))}updateSectionAnalyticsData(e){const a=this._getUpdateAnalyticsQuery(e);return a?this._executeQuery(a):(0,v.of)({success:!0,errorInfo:null,result:[]})}deleteSectionAnalyticsData(e){const a=this._getDeleteQuery(e);return this._executeQuery(a)}}U.\u0275fac=function(e){return new(e||U)(t.LFG(m.oq))},U.\u0275prov=t.Yz7({token:U,factory:U.\u0275fac});class q extends m.UE{constructor(e,a,n){super(e,a,n),this.entitySchemaName="FastReportDataSource"}getTemplateDataSources(e){const a=this.createGetAllItemsEsq();return a.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"Template",e),this.queryExecutor.executeSelectQuery(a).pipe((0,g.U)(n=>({success:!0,errorInfo:null,result:n.map(i=>this.entityConverter.getEntity(i))})),(0,L.K)(n=>this.getBaseErrorResponse(n)))}deleteByTemplateId(e){const a=new r.DeleteQuery(this.entitySchemaName);a.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"Template",e);const n=this.queryExecutor.executeDeleteQuery(a);return this.handleResponse(n)}getItems(){throw new Error("NotImplemented")}getItem(e){throw new Error("NotImplemented")}}q.\u0275fac=function(e){return new(e||q)(t.LFG(m.oq),t.LFG(f.sK),t.LFG(k))},q.\u0275prov=t.Yz7({token:q,factory:q.\u0275fac});var Te=s(83787),Ie=s(35732);class V extends m.UE{constructor(e,a,n,i){super(e,a,n),this._httpClient=i,this.entitySchemaName="FastReportTemplate"}downloadTemplate(e){const a=`rest/FastReportService/DownloadReportTemplate/${e}`;return this._httpClient.get(a,{responseType:"text"}).pipe((0,g.U)(n=>n),(0,L.K)(n=>{throw console.error(n),new Error("Error file download")}))}uploadTemplate(e,a){const n="rest/FastReportService/UploadReportTemplate",i=new FormData;i.append("file",a);const l={params:{templateId:e}};return this._httpClient.post(n,i,l).pipe((0,L.K)(h=>{if(h.error instanceof ErrorEvent)return console.error(h.error.message),(0,Te._)(h)}),(0,ce.b)(h=>{h.success||console.error(h)}))}}V.\u0275fac=function(e){return new(e||V)(t.LFG(m.oq),t.LFG(f.sK),t.LFG(Z),t.LFG(Ie.eN))},V.\u0275prov=t.Yz7({token:V,factory:V.\u0275fac});class R extends ge{constructor(e,a,n,i,l,h){super(e,a,n),this._dataSourceService=i,this._templateService=l,this._sectionAnalyticsService=h}get fastReportVersion(){return"2020.1.0.0"}get emptyTemplate(){return`<?xml version="1.0" encoding="utf-8"?>
<Report ScriptLanguage="CSharp" ReportInfo.Created="{0}" ReportInfo.Modified="{0}" ReportInfo.CreatorVersion="{1}">
	<Dictionary/>
	<ReportPage Name="Page1" Watermark.Font="Arial, 60pt">
		<ReportTitleBand Name="ReportTitle1" Width="718.2" Height="37.8"/>
		<PageHeaderBand Name="PageHeader1" Top="41.8" Width="718.2" Height="28.35"/>
		<DataBand Name="Data1" Top="74.15" Width="718.2" Height="75.6"/>
		<PageFooterBand Name="PageFooter1" Top="153.75" Width="718.2" Height="18.9"/>
	</ReportPage>
</Report>
`}get emptyReportTemplate(){const e="MM/dd/yyyy HH:mm:ss",a=(0,P.p6)(new Date,e,"en-US");return this.emptyTemplate.replace(/\{0\}/g,a).replace(/\{1\}/g,this.fastReportVersion)}get defaultDataSource(){return{ProviderName:"ProviderName",Schemas:{TableName1:{GuidColumnName:{DataValueType:0},TextColumnName:{DataValueType:1},IntegerColumnName:{DataValueType:4},FloatColumnName:{DataValueType:5},DateTimeColumnName:{DataValueType:7},DateColumnName:{DataValueType:8},TimeColumnName:{DataValueType:9},BooleanColumnName:{DataValueType:12}}}}}_createEmptyFastReportPrintable(){const e=new pe;return e.id=(0,r.generateGuid)(),e.caption=this._translateService.instant(this.newReportCaptionResourceName),e.moduleName="",e.showInSection=!1,e.showInCard=!1,e.sectionAnalyticsId=(0,r.generateGuid)(),e.showInSectionAnalytics=!1,e.showInSectionAnalyticsOldValue=!1,e.typeId=S.FastReport,e.typeName="FastReport",e}_createEmptyFastReportTemplate(e){const a=new de;return a.id=(0,r.generateGuid)(),a.data=this.emptyReportTemplate,e.templateId=a.id,e.template=a,a}_createEmptyFastReportDataSource(e){const a=new ue;return a.id=(0,r.generateGuid)(),a.name="Creatio",a.data=JSON.stringify(this.defaultDataSource,null,"	"),a.typeId=re.Custom,a.templateId=e.templateId,e.dataSources=[a],a}_loadModuleSchemaName(e){const a=new r.EntitySchemaQuery(this.entitySchemaName),n="SysModule.[SysModuleEntity:Id:SysModuleEntity].[VwSysEntitySchemaInWorkspace:UId:SysEntitySchemaUId].Name";return a.addSchemaColumn(n,"ModuleSchemaName"),a.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"Id",e.id),this.queryExecutor.executeSelectQuery(a).pipe((0,g.U)(i=>(e.moduleSchemaName=i[0].ModuleSchemaName,!0)))}_loadTemplate(e){return this._templateService.getItem(e.templateId).pipe((0,g.U)(a=>(e.template=a.result[0],a)))}_loadDataSources(e){return this._dataSourceService.getTemplateDataSources(e.templateId).pipe((0,g.U)(a=>(e.dataSources=a.result,a)))}_insertTemplate(e){return this._templateService.insertItem(e.template)}_insertDataSources(e){return this._dataSourceService.insertItem(e.dataSources[0])}_updateTemplate(e){return this._templateService.updateItem(e.template)}_updateDataSources(e){return this._dataSourceService.updateItem(e.dataSources[0])}_deleteTemplate(e){return this._templateService.deleteById(e.templateId)}_deleteDataSources(e){return this._dataSourceService.deleteByTemplateId(e.templateId)}_loadSectionAnalyticsData(e){return this._sectionAnalyticsService.getSectionAnalyticsData(e).pipe((0,ce.b)(a=>{const n=a.result[0];e.sectionAnalyticsId=n.sectionAnalyticsId,e.showInSectionAnalytics=n.showInSectionAnalytics,e.showInSectionAnalyticsOldValue=n.showInSectionAnalytics,e.optionsSchemaUId=n.optionsSchemaUId,e.optionsSchemaName=n.optionsSchemaName}))}_updateSectionAnalyticsData(e){return this._sectionAnalyticsService.updateSectionAnalyticsData(e)}_deleteSectionAnalyticsData(e){return this._sectionAnalyticsService.deleteSectionAnalyticsData(e)}createGetAllItemsEsq(){const e=super.createGetAllItemsEsq();return e.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"Type",S.FastReport),e}create(){const e=this._createEmptyFastReportPrintable();return this._createEmptyFastReportTemplate(e),this._createEmptyFastReportDataSource(e),e}insertItem(e){return super.insertItem(e).pipe((0,b.b)(a=>this._insertTemplate(e).pipe((0,b.b)(()=>this._insertDataSources(e)),(0,b.b)(()=>this._updateSectionAnalyticsData(e)),(0,g.U)(()=>a))))}getItem(e){return super.getItem(e).pipe((0,b.b)(a=>{const n=a.result[0];return this._loadModuleSchemaName(n).pipe((0,b.b)(()=>this._loadTemplate(n)),(0,b.b)(()=>this._loadDataSources(n)),(0,b.b)(()=>this._loadSectionAnalyticsData(n)),(0,g.U)(()=>a))}))}updateItem(e){return super.updateItem(e).pipe((0,b.b)(a=>this._updateDataSources(e).pipe((0,b.b)(()=>this._updateTemplate(e)),(0,b.b)(()=>this._updateSectionAnalyticsData(e)),(0,g.U)(()=>a))))}deleteItem(e){return super.deleteItem(e).pipe((0,b.b)(a=>this._deleteDataSources(e).pipe((0,b.b)(()=>this._deleteTemplate(e)),(0,b.b)(()=>this._deleteSectionAnalyticsData(e)),(0,g.U)(()=>a))))}uploadTemplate(e,a){return this._templateService.uploadTemplate(e,a)}downloadTemplate(e){return this._templateService.downloadTemplate(e)}}R.\u0275fac=function(e){return new(e||R)(t.LFG(m.oq),t.LFG(f.sK),t.LFG(F),t.LFG(q),t.LFG(V),t.LFG(U))},R.\u0275prov=t.Yz7({token:R,factory:R.\u0275fac});var we=s(31177),Me=s(53550),xe=s(46523),Fe=s(70549);class J extends m.UE{constructor(e,a,n){super(e,a,n),this.entitySchemaName="SysModuleReportTable"}_needInsertRecord(e){return e.isNew&&!e.isDeleted}_needDeleteRecord(e){return!e.isNew&&e.isDeleted}_needUpdateRecord(e){return!e.isNew&&!e.isDeleted}_updateTablePart(e){return this._needInsertRecord(e)?this.insertItem(e):this._needDeleteRecord(e)?this.deleteItem(e):this._needUpdateRecord(e)?this.updateItem(e):(0,v.of)({success:!0,errorInfo:null,result:[]})}getTableParts(e){const a=this.createGetAllItemsEsq();return a.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"SysModuleReport",e),this.queryExecutor.executeSelectQuery(a).pipe((0,g.U)(n=>({success:!0,errorInfo:null,result:n.map(i=>this.entityConverter.getEntity(i))})),(0,L.K)(n=>this.getBaseErrorResponse(n)))}updateTableParts(e){return e.length===0?(0,v.of)({success:!0,errorInfo:null,result:[]}):(0,Me.x)(e.map(a=>this._updateTablePart(a)),xe.z).pipe((0,Fe.J)())}deleteByPrintableId(e){const a=new r.DeleteQuery(this.entitySchemaName);a.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"SysModuleReport",e);const n=this.queryExecutor.executeDeleteQuery(a);return this.handleResponse(n)}getItems(){throw new Error("NotImplemented")}getItem(e){throw new Error("NotImplemented")}}J.\u0275fac=function(e){return new(e||J)(t.LFG(m.oq),t.LFG(f.sK),t.LFG(O))},J.\u0275prov=t.Yz7({token:J,factory:J.\u0275fac});class A extends ge{constructor(e,a,n,i){super(e,a,n),this._tablePartService=i}_insertTableParts(e){return this._tablePartService.updateTableParts(e.tableParts)}_loadTableParts(e){return this._tablePartService.getTableParts(e.id).pipe((0,g.U)(a=>(e.tableParts=a.result,a)))}_updateTableParts(e){return this._tablePartService.updateTableParts(e.tableParts)}_deleteTableParts(e){return this._tablePartService.deleteByPrintableId(e.id)}create(){const e=new me;return e.id=(0,r.generateGuid)(),e.caption=this._translateService.instant(this.newReportCaptionResourceName),e.moduleName="",e.showInSection=!1,e.showInCard=!1,e.typeId=S.MSWord,e.typeName="MS Word",e.convertInPDF=!1,e.macrosList="",e.tableParts=[],e}copy(e){const a=we.Z(e);return a.id=(0,r.generateGuid)(),a.caption+=this._translateService.instant("Printables.Page.CopyPostfixCaption"),a.tableParts.map(n=>{n.id=(0,r.generateGuid)(),n.isNew=!0,n.sysModuleReportId=a.id}),a}insertItem(e){return super.insertItem(e).pipe((0,b.b)(a=>this._insertTableParts(e).pipe((0,g.U)(()=>a))))}getItem(e){return super.getItem(e).pipe((0,b.b)(a=>{const n=a.result[0];return this._loadTableParts(n).pipe((0,g.U)(()=>a))}))}updateItem(e){return super.updateItem(e).pipe((0,b.b)(a=>this._updateTableParts(e).pipe((0,g.U)(()=>a))))}deleteItem(e){return this._deleteTableParts(e).pipe((0,b.b)(()=>super.deleteItem(e)))}uploadTemplate(e,a){throw new Error("Not implemented")}downloadTemplate(e){throw new Error("Not implemented")}}A.\u0275fac=function(e){return new(e||A)(t.LFG(m.oq),t.LFG(f.sK),t.LFG(E),t.LFG(J))},A.\u0275prov=t.Yz7({token:A,factory:A.\u0275fac});class H{constructor(e,a){this._services=new Map,this._services.set(S.FastReport,e),this._services.set(S.MSWord,a)}get(e){return this._services.get(e)}}H.\u0275fac=function(e){return new(e||H)(t.LFG(R),t.LFG(A))},H.\u0275prov=t.Yz7({token:H,factory:H.\u0275fac});var _e=s(61528);class W extends m.UE{constructor(e,a,n,i){super(e,a,n),this._serviceProvider=i,this.entitySchemaName="SysModuleReport"}createGetAllItemsEsq(){const e=super.createGetAllItemsEsq();return e.filters.logicalOperation=r.LogicalOperatorType.Or,e.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"Type",S.FastReport),e.filters.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"Type",S.MSWord),e}deleteItem(e){return this._serviceProvider.get(e.type).deleteItem(e)}deleteById(e){return this.getItem(e).pipe((0,_e.w)(a=>this.deleteItem(a.result[0])))}insertItem(e){return this._serviceProvider.get(e.type).insertItem(e)}updateItem(e){return this._serviceProvider.get(e.type).updateItem(e)}}W.\u0275fac=function(e){return new(e||W)(t.LFG(m.oq),t.LFG(f.sK),t.LFG(w),t.LFG(H))},W.\u0275prov=t.Yz7({token:W,factory:W.\u0275fac});class fe{constructor(e,a="Id",n="Name",i=[],l){this.entitySchemaName=e,this.valueColumnPath=a,this.displayValueColumnPath=n,this.additionalColumns=i,this.filters=l,r.ValidationUtilities.checkArgumentEmpty("entitySchemaName",e)}}class B{constructor(e){this._queryExecutor=e}getItems(e){r.ValidationUtilities.checkArgumentEmpty("lookupQuery",e);const{entitySchemaName:a,valueColumnPath:n,displayValueColumnPath:i,filters:l}=e,h=new r.EntitySchemaQuery(a);return h.addSchemaColumn(n),h.addSchemaColumn(i).withOrdering(r.OrderDirection.Asc,0),e.additionalColumns.forEach(y=>{h.addSchemaColumn(y.path,y.alias)}),l&&h.filters.add(l),this._queryExecutor.executeSelectQuery(h).pipe((0,g.U)(y=>y.map(T=>{const ae={value:T[n],displayValue:T[i]};return e.additionalColumns.forEach(Pe=>{ae[Pe.alias]=T[Pe.alias]}),ae})))}}B.\u0275fac=function(e){return new(e||B)(t.LFG(m.oq))},B.\u0275prov=t.Yz7({token:B,factory:B.\u0275fac});class be{static parseJson(e){try{return JSON.parse(e)}catch{return null}}static checkProperty(e,a,n,i){return e.hasOwnProperty(a)?null:{[n]:i[n]}}static _getSchemaColumnValidationResult(e,a,n,i){const l=this.checkProperty(e,"DataValueType","dataSourceAbsentDataValueTypeProperty",i);if(l){const h=l.dataSourceAbsentDataValueTypeProperty;l.dataSourceAbsentDataValueTypeProperty=h.replace(/\{columnName\}/,n).replace(/\{schemaName\}/,a)}return[l]}static _getSchemasValidationResult(e,a){if(!e.Schemas)return[];const n=[],i=Object.keys(e.Schemas);return i.length===0?[{dataSourceSchemasIsEmpty:a.dataSourceSchemasIsEmpty}]:(i.forEach(l=>{const h=e.Schemas[l],y=Object.keys(h);if(y.length===0){const T=a.dataSourceSchemasHasNoColumns.replace(/\{schemaName\}/,l);n.push({dataSourceSchemasHasNoColumns:T})}else y.forEach(T=>{const ae=h[T];n.push(...this._getSchemaColumnValidationResult(ae,l,T,a))})}),n)}static getJsonValidator(e){return a=>a.value?this.parseJson(a.value)?null:{isJson:e.isJson}:null}static getJsonSchemaValidator(e){return a=>{const n=this.parseJson(a.value);if(!n)return null;const l=[this.checkProperty(n,"ProviderName","dataSourceAbsentProviderNameProperty",e),this.checkProperty(n,"Schemas","dataSourceAbsentSchemasProperty",e),...this._getSchemasValidationResult(n,e)].filter(y=>y).reduce((y,T)=>({...y,...T}),{});return Object.keys(l).length===0?null:l}}}var Ee=s(11770);class Re{static getLengthValidator(e,a){return n=>n.value&&n.value.length>e?{maxLength:Ee.Ld.Format(a.maxLength,n.value.length,e)}:null}}var M=s(7976),Se=s(78464),ye=s(60527),Ae=s(27025),se=s(95236),Ne=s(95411);const De=["reportTemplateUploadElement"];function Le(o,e){o&1&&t._UZ(0,"ts-mask")}function ke(o,e){if(o&1){const a=t.EpF();t.TgZ(0,"button",49),t.NdJ("click",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.save())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}o&2&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"BasePageComponent.Apply")," "))}function Ze(o,e){if(o&1){const a=t.EpF();t.TgZ(0,"button",50),t.NdJ("click",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.cancelPrintableEdit())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}o&2&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"BasePageComponent.Cancel")," "))}function Oe(o,e){if(o&1){const a=t.EpF();t.TgZ(0,"button",51),t.NdJ("click",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.close())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}o&2&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"BasePageComponent.Close")," "))}function Ue(o,e){if(o&1&&(t.TgZ(0,"mat-error"),t._uU(1),t.qZA()),o&2){const a=t.oxw();t.xp6(1),t.hij("",a.getValidationMessage("printableCaption")," ")}}function qe(o,e){if(o&1&&(t.TgZ(0,"mat-option",52),t._uU(1),t.qZA()),o&2){const a=e.$implicit;t.Q6J("value",a.displayValue),t.xp6(1),t.hij(" ",a.displayValue," ")}}function Ve(o,e){if(o&1&&(t.TgZ(0,"mat-error"),t._uU(1),t.qZA()),o&2){const a=t.oxw();t.xp6(1),t.hij(" ",a.getValidationMessage("printableSection")," ")}}function Je(o,e){if(o&1&&(t.TgZ(0,"mat-option",52),t._uU(1),t.qZA()),o&2){const a=e.$implicit;t.Q6J("value",a.displayValue),t.xp6(1),t.hij(" ",a.displayValue," ")}}function He(o,e){if(o&1){const a=t.EpF();t.TgZ(0,"mat-form-field",53)(1,"mat-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"input",54,16),t.NdJ("focus",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.onFilterPageFieldFocus())})("focusout",function(){t.CHM(a);const i=t.MAs(5),l=t.oxw();return t.KtG(l.onFilterPageFieldFocusOut(i.value))}),t.qZA(),t.TgZ(6,"div",17),t._UZ(7,"div",18),t.qZA(),t.TgZ(8,"mat-autocomplete",19,20),t.NdJ("optionSelected",function(i){t.CHM(a);const l=t.oxw();return t.KtG(l.onFilterPageSelected(i))})("closed",function(){t.CHM(a);const i=t.MAs(5),l=t.oxw();return t.KtG(l.onFilterPageAutocompleteClosed(i.value))}),t.YNc(10,Je,2,2,"mat-option",21),t.qZA()()}if(o&2){const a=t.MAs(9),n=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,3,"Printables.FilterPage")),t.xp6(2),t.Q6J("matAutocomplete",a),t.xp6(6),t.Q6J("ngForOf",n.filteredFilterPageList)}}function We(o,e){if(o&1&&t._UZ(0,"li",55),o&2){const a=e.$implicit,n=t.oxw();t.Q6J("innerHTML",n.getResourceMarkup(a),t.oJD)}}function Be(o,e){if(o&1&&(t.TgZ(0,"mat-error"),t._uU(1),t.qZA()),o&2){const a=t.oxw();t.xp6(1),t.hij(" ",a.getValidationMessage("printableDataSource")," ")}}class $ extends x.neP{constructor(e,a,n,i){super(e),this.route=a,this._lookupService=n,this._formBuilder=i,this._captionMaxLength=50,this._failUploadReportTemplateResourceName="Printables.Page.Template.Upload.Error.MessageBoxCaption",this._infoBlockStepsResourceName="Printables.Page.InfoBlock.Steps",this._dataSourceValidationMessages="Printables.Page.Validation",this._reportUploadedMessageResourceName="Printables.Page.Template.Upload.ReportUploadedMessage",this._reportCaptionNoWhitespacesValidationRegex="^.*\\S+.*$",this._reportCaptionNoWhitespacesResourceName="Printables.Page.Validation.noWhitespaces",this._reportCaptionRequireResourceName="Printables.Page.Validation.required",this._reportCaptionMaxLengthResourceName="Printables.Page.Validation.maxLength",this._dataSourceDescriptionResourceName="Printables.Page.DataSource.Custom.Description",this.sectionList=[],this.filteredSectionList=[],this.filterPageList=[],this.filteredFilterPageList=[],this.getGtmSchemaName=()=>"ReportSetupPage"}get filterPage(){return{value:this.model.optionsSchemaUId,displayValue:this.model.optionsSchemaName}}set filterPage(e){const{value:a,displayValue:n}=e||{value:null,displayValue:""};this.model.optionsSchemaUId=a,this.model.optionsSchemaName=n,this.setIsChanged(),this.printableForm.patchValue({printableFilterPage:this.model.optionsSchemaName})}get section(){return{value:this.model.moduleId,displayValue:this.model.moduleName,entitySchemaName:this.model.moduleSchemaName}}set section(e){const{value:a,displayValue:n,entitySchemaName:i}=e||{value:null,displayValue:"",entitySchemaName:""};this.model.moduleId!==a&&(this.model.moduleId=a,this.model.moduleName=n,this.model.moduleSchemaName=i,this.setIsChanged()),this.printableForm.patchValue({printableSection:this.section.displayValue})}get sectionList$(){if(!this._sectionList$){const e=new fe("SysModule","Id","Caption",[{path:"[SysModuleEntity:Id:SysModuleEntity].>[SysModuleEntityInPortal:SysModuleEntity:Id].Id",alias:"SysModuleEntityInPortal"},{path:"[SysModuleEntity:Id:SysModuleEntity].[VwSysEntitySchemaInWorkspace:UId:SysEntitySchemaUId].Name",alias:"entitySchemaName"}]);this._sectionList$=this._lookupService.getItems(e).pipe((0,g.U)(a=>a.filter(n=>!n.SysModuleEntityInPortal)),(0,K.B)())}return this._sectionList$}get filterPageList$(){if(!this._filterPageList$){const e=new r.FilterGroup;e.addSchemaColumnFilterWithParameter(r.ComparisonType.Equal,"ManagerName","ClientUnitSchemaManager");const a=new fe("VwSysSchemaInfo","UId","Caption",[],e);this._filterPageList$=this._lookupService.getItems(a)}return this._filterPageList$}get dataSource(){return this.model.dataSources&&this.model.dataSources.length>0?this.model.dataSources[0]:null}get InfoBlockSteps(){return this.translateInstant(this._infoBlockStepsResourceName)}_getFakeSuccessResponse(){return(0,v.of)({success:!0,errorInfo:null,result:[]})}_filterSectionList(e){e?this.filteredSectionList=this.sectionList.filter(a=>a.displayValue.toLowerCase().indexOf(e.toLowerCase())>=0):this.filteredSectionList=this.sectionList}_filterFilterPageList(e){e?this.filteredFilterPageList=this.filterPageList.filter(a=>a.displayValue.toLowerCase().indexOf(e.toLowerCase())>=0):this.filteredFilterPageList=this.filterPageList}_getCaptionByControlKey(e){switch(e){case"printableCaption":return this.translateInstant("Printables.Caption");case"printableSection":return this.translateInstant("Printables.ModuleName");case"printableDataSource":return this.translateInstant("Printables.Page.DataSource.Caption");case"printableFilterPage":return this.translateInstant("Printables.FilterPage")}return e}_getErrorMessageByErrorKey(e,a){const n=e[a];if(typeof n=="string")return n;let i=a;switch(a){case"pattern":n.requiredPattern===this._reportCaptionNoWhitespacesValidationRegex&&(i=this._reportCaptionNoWhitespacesResourceName);break;case"required":i=this._reportCaptionRequireResourceName;break;case"maxLength":i=this._reportCaptionMaxLengthResourceName;break;default:return n}return this.translateInstant(i)}_getFormValidationErrors(){const e=[];return Object.keys(this.printableForm.controls).forEach(a=>{const n=this.printableForm.get(a).errors;if(n!=null){const i=this._getCaptionByControlKey(a),h=Object.keys(n).map(y=>`${i}: ${this._getErrorMessageByErrorKey(n,y)}`);e.push(...h)}}),e.join(`
`)}_validate(){return this.printableForm.updateValueAndValidity(),{success:this.printableForm.valid,errorMessage:this._getFormValidationErrors()}}_downloadReportTemplateInternal(){return this.printablesService.downloadTemplate(this.model.templateId).pipe((0,g.U)(e=>{const a=`${this.model.caption}.frx`,n=new Blob([e],{type:"application/xml"});ne.saveAs(n,a)}))}_getIsSimpleResource(e){return typeof e=="string"}_getParametrizedResourceMarkup(e){return e.Text.replace(/\{parameter:(\w+)\}/,function(a,n){const i=e.Parameters[n].Caption;return`<a href="${e.Parameters[n].Value}" target="_blank">${i}</a>`})}_onPrintableSaved(){this.isLoading=!1,this.isSaveButtonVisible=!1}_internalSave(){return this.executeSave().pipe((0,ce.b)(e=>{if(e&&e.success)this.isNew=!1,this._onPrintableSaved();else throw new Error(e.errorInfo.message)}))}_buildFormGroup(){const e=this.translateInstant(this._dataSourceValidationMessages);return this._formBuilder.group({printableCaption:["",[_.kI.required,_.kI.pattern(this._reportCaptionNoWhitespacesValidationRegex),Re.getLengthValidator(this._captionMaxLength,e)]],printableSection:["",[_.kI.required]],printableDataSource:["",[_.kI.required,be.getJsonValidator(e),be.getJsonSchemaValidator(e)]],printableFilterPage:["",[]]})}_initFormGroup(e){this.printableForm.get("printableSection").valueChanges.subscribe(a=>{this._filterSectionList(a)}),this.printableForm.get("printableCaption").valueChanges.subscribe(a=>{this.model.caption=a,this.setIsChanged()}),this.printableForm.get("printableDataSource").valueChanges.subscribe(a=>{this.dataSource.data=a,this.setIsChanged()}),this.printableForm.get("printableFilterPage").valueChanges.subscribe(a=>{this._filterFilterPageList(a)})}injectDependencies(){super.injectDependencies(),this.printablesService=this.injector.get(R)}savePageData(e){return this.isChanged?this.isNew?this.printablesService.insertItem(e):this.printablesService.updateItem(e):this._getFakeSuccessResponse()}getPageCreateNewRecordGtmData(){return{action:"Create"}}executePageDataLoading(e){return this.isNew?(this.sendGtmAction(this.getPageCreateNewRecordGtmData()),this.preProcessLoadedPageModel(this.model),this.isLoading=!1,this._getFakeSuccessResponse()):super.executePageDataLoading(e)}requestPageData(){return this.printablesService.getItem(this.id)}getModelFromLoadResponse(e){return e.result[0]}createEmptyModel(){return this.printablesService.create()}onModelSet(e){this.printableForm.patchValue({printableCaption:e.caption,printableSection:e.moduleName,printableDataSource:e.dataSources[0].data,printableFilterPage:e.optionsSchemaName})}ngOnInit(){this.printableForm=this._buildFormGroup(),this.route.paramMap.subscribe(e=>{this.isNew=e.get("id")==="New",this.isNew?this.model=this.createEmptyModel():this.id=e.get("id"),this.sectionList$&&this.sectionList$.pipe((0,g.U)(a=>this.sectionList=a)).subscribe(),this.filterPageList$&&this.filterPageList$.pipe((0,g.U)(a=>this.filterPageList=a)).subscribe(),super.ngOnInit(),this._initFormGroup(e)})}onSectionSelected(e){const a=e.option.value;this.section=this.sectionList.find(n=>n.displayValue.toLowerCase()===a.toLowerCase())}onFilterPageSelected(e){const a=e.option.value;this.filterPage=this.filterPageList.find(n=>n.displayValue.toLowerCase()===a.toLowerCase()),this.filterPage.value&&(this.model.optionsSchemaUId=this.filterPage.value,this.model.optionsSchemaName=this.filterPage.displayValue),this.setCanSave()}onSectionFieldFocus(){this.filteredSectionList=this.sectionList,this.setCanSave()}onFilterPageFieldFocus(){this.filteredFilterPageList=this.filterPageList,this.setCanSave()}onFilterPageFieldFocusOut(e){e===""&&(this.filterPage=null)}onSectionAutocompleteClosed(e){this.printableForm.patchValue({printableSection:e}),this._filterSectionList("")}onFilterPageAutocompleteClosed(e){this.printableForm.patchValue({printableFilterPage:e}),this._filterSectionList("")}onShowInSectionChange(e){this.model.showInSection=e,this.setIsChanged(),this.setCanSave()}onShowInCardChange(e){this.model.showInCard=e,this.setIsChanged(),this.setCanSave()}onShowInSectionAnalyticsChange(e){this.model.showInSectionAnalytics=e,e||(this.filterPage=null),this.setIsChanged(),this.setCanSave()}cancelPrintableEdit(){this.isSaveButtonVisible=!1,this.cancel()}setCanSave(){this.isSaveButtonVisible=!0}getResourceMarkup(e){return this._getIsSimpleResource(e)?e:this._getParametrizedResourceMarkup(e)}getDataSourceDescription(){const e=this.translateInstant(this._dataSourceDescriptionResourceName);return this.getResourceMarkup(e)}save(){const{success:e,errorMessage:a}=this._validate();return e?super.save():(this.openInfoDialog(a).subscribe(),this._getFakeSuccessResponse())}downloadReportTemplate(){if(this.isNew||this.isChanged){const{success:e,errorMessage:a}=this._validate();e?(this.isLoading=!0,this._internalSave().pipe((0,b.b)(()=>this._downloadReportTemplateInternal()),(0,L.K)(({message:n})=>(this.openInfoDialog(n).subscribe(),(0,v.of)(void 0)))).subscribe()):this.openInfoDialog(a).subscribe()}else this.isLoading=!0,this._downloadReportTemplateInternal().subscribe(()=>{this._onPrintableSaved()})}uploadReportTemplate(){if(this.isNew||this.isChanged){const{success:e,errorMessage:a}=this._validate();e?(this.isLoading=!0,this._internalSave().pipe((0,b.b)(()=>(0,v.of)(this._reportTemplateUploadElementRef.nativeElement.click())),(0,L.K)(({message:n})=>(this.openInfoDialog(n).subscribe(),(0,v.of)(void 0)))).subscribe()):this.openInfoDialog(a).subscribe()}else this._onPrintableSaved(),this._reportTemplateUploadElementRef.nativeElement.click()}onFilesSelected(e){if(e.length===0)return;const a=e.item(0);this.printablesService.uploadTemplate(this.model.templateId,a).subscribe(n=>{if(this._reportTemplateUploadElementRef.nativeElement.value="",n.success)this.openInfoDialog(this.translateInstant(this._reportUploadedMessageResourceName)).subscribe();else{const l=`${this.translateInstant(this._failUploadReportTemplateResourceName)}
${n.errorInfo.message}`;this.openInfoDialog(l).subscribe()}})}isInvalid(e){return this.printableForm.get(e).invalid}getValidationMessage(e){const a=this.printableForm.get(e);if(!a&&!a.errors)return"";const n=a.errors,i=Object.keys(a.errors)[0];return this._getErrorMessageByErrorKey(n,i)}}$.\u0275fac=function(e){return new(e||$)(t.Y36(t.zs3),t.Y36(M.gz),t.Y36(B),t.Y36(_.qu))},$.\u0275cmp=t.Xpm({type:$,selectors:[["ts-printables-edit-page"]],viewQuery:function(e,a){if(e&1&&t.Gf(De,5),e&2){let n;t.iGM(n=t.CRH())&&(a._reportTemplateUploadElementRef=n.first)}},features:[t.qOj],decls:85,vars:59,consts:[[4,"ngIf"],[1,"flex-wrapper"],[1,"base-page-wrap","printable"],[1,"header"],[1,"pane"],[3,"title"],["class","action-button save","mat-flat-button","","color","accent","type","button","data-qa","apply-button",3,"click",4,"ngIf"],["class","action-button apply","mat-flat-button","","color","primary","type","button","data-qa","cancel-button",3,"click",4,"ngIf"],["class","action-button","mat-flat-button","","color","primary","type","button","data-qa","close-button",3,"click",4,"ngIf"],[1,"page-content-wrapper",3,"formGroup"],[1,"left-panel"],[1,"pane","sys-module-settings"],["floatLabel","always",1,"printable-field","caption"],["formControlName","printableCaption","matInput","","required","","type","text","spellcheck","false","data-qa","caption-input",3,"focus"],["floatLabel","always",1,"printable-field","section"],["type","text","matInput","","required","","formControlName","printableSection","spellcheck","false",3,"matAutocomplete","focus"],["input",""],["matSuffix","",1,"mat-select-arrow-wrapper"],[1,"mat-select-arrow"],[3,"optionSelected","closed"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["data-qa","show-in-section",1,"printable-field","show-in-section",3,"checked","change"],["data-qa","show-in-card",1,"printable-field","show-in-card",3,"checked","change"],["data-qa","show-in-sections-analytics",1,"printable-field","show-in-sections-analytics",3,"checked","change"],["class","printable-field filter-page","floatLabel","always",4,"ngIf"],[1,"pane","info-block"],[1,"title"],["svgIcon","important-info",1,"icon"],[1,"caption"],[1,"info-block-text"],[1,"steps"],[3,"innerHTML",4,"ngFor","ngForOf"],[1,"main-content","pane"],[1,"main-content-header","action-block"],[1,"main-content-caption","data-source-caption"],[1,"main-content-description","data-source-description",3,"innerHTML"],[1,"action-block","data-source"],["matAutosize","true",1,"data-source-json"],["matInput","","cdkTextareaAutosize","","formControlName","printableDataSource","spellcheck","false","cdkAutosizeMinRows","15","cdkAutosizeMaxRows","15",3,"focus"],["autosize","cdkTextareaAutosize"],[1,"action-block","template-action","download-template"],[1,"main-content-caption"],[1,"main-content-description"],["mat-flat-button","","color","primary","type","button","data-qa","download-report-template",1,"action-button",3,"click"],[1,"action-block","template-action","upload-template"],["type","file","accept",".frx",2,"display","none",3,"change"],["reportTemplateUploadElement",""],["mat-flat-button","","color","primary","type","button","data-qa","upload-report-template",1,"action-button",3,"click"],["mat-flat-button","","color","accent","type","button","data-qa","apply-button",1,"action-button","save",3,"click"],["mat-flat-button","","color","primary","type","button","data-qa","cancel-button",1,"action-button","apply",3,"click"],["mat-flat-button","","color","primary","type","button","data-qa","close-button",1,"action-button",3,"click"],[3,"value"],["floatLabel","always",1,"printable-field","filter-page"],["type","text","matInput","","formControlName","printableFilterPage","spellcheck","false",3,"matAutocomplete","focus","focusout"],[3,"innerHTML"]],template:function(e,a){if(e&1){const n=t.EpF();t.YNc(0,Le,1,0,"ts-mask",0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"ts-header",5),t.YNc(6,ke,3,3,"button",6),t.YNc(7,Ze,3,3,"button",7),t.YNc(8,Oe,3,3,"button",8),t.qZA()()(),t.TgZ(9,"form",9)(10,"div",10)(11,"div",11)(12,"mat-form-field",12)(13,"mat-label"),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"input",13),t.NdJ("focus",function(){return a.setCanSave()}),t.qZA(),t.YNc(17,Ue,2,1,"mat-error",0),t.qZA(),t.TgZ(18,"mat-form-field",14)(19,"mat-label"),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"input",15,16),t.NdJ("focus",function(){return a.onSectionFieldFocus()}),t.qZA(),t.TgZ(24,"div",17),t._UZ(25,"div",18),t.qZA(),t.TgZ(26,"mat-autocomplete",19,20),t.NdJ("optionSelected",function(l){return a.onSectionSelected(l)})("closed",function(){t.CHM(n);const l=t.MAs(23);return t.KtG(a.onSectionAutocompleteClosed(l.value))}),t.YNc(28,qe,2,2,"mat-option",21),t.qZA(),t.YNc(29,Ve,2,1,"mat-error",0),t.qZA(),t.TgZ(30,"mat-checkbox",22),t.NdJ("change",function(l){return a.onShowInSectionChange(l.checked)}),t._uU(31),t.ALo(32,"translate"),t.qZA(),t.TgZ(33,"mat-checkbox",23),t.NdJ("change",function(l){return a.onShowInCardChange(l.checked)}),t._uU(34),t.ALo(35,"translate"),t.qZA(),t.TgZ(36,"mat-checkbox",24),t.NdJ("change",function(l){return a.onShowInSectionAnalyticsChange(l.checked)}),t._uU(37),t.ALo(38,"translate"),t.qZA(),t.YNc(39,He,11,5,"mat-form-field",25),t.qZA(),t.TgZ(40,"div",26)(41,"div",27),t._UZ(42,"mat-icon",28),t.TgZ(43,"span",29),t._uU(44),t.ALo(45,"translate"),t.qZA()(),t.TgZ(46,"div",30)(47,"span"),t._uU(48),t.ALo(49,"translate"),t.qZA(),t.TgZ(50,"ol",31),t.YNc(51,We,1,1,"li",32),t.qZA()()()(),t.TgZ(52,"div",33)(53,"div",34)(54,"label",35),t._uU(55),t.ALo(56,"translate"),t.qZA(),t._UZ(57,"label",36),t.qZA(),t.TgZ(58,"div",37)(59,"mat-form-field",38)(60,"textarea",39,40),t.NdJ("focus",function(){return a.setCanSave()}),t.qZA(),t.YNc(62,Be,2,1,"mat-error",0),t.qZA()(),t.TgZ(63,"div",41)(64,"label",42),t._uU(65),t.ALo(66,"translate"),t.qZA(),t.TgZ(67,"label",43),t._uU(68),t.ALo(69,"translate"),t.qZA(),t.TgZ(70,"button",44),t.NdJ("click",function(){return a.downloadReportTemplate()}),t._uU(71),t.ALo(72,"translate"),t.qZA()(),t.TgZ(73,"div",45)(74,"label",42),t._uU(75),t.ALo(76,"translate"),t.qZA(),t.TgZ(77,"label",43),t._uU(78),t.ALo(79,"translate"),t.qZA(),t.TgZ(80,"input",46,47),t.NdJ("change",function(l){return a.onFilesSelected(l.target.files)}),t.qZA(),t.TgZ(82,"button",48),t.NdJ("click",function(){return a.uploadReportTemplate()}),t._uU(83),t.ALo(84,"translate"),t.qZA()()()()()()}if(e&2){const n=t.MAs(27);t.Q6J("ngIf",a.isLoading),t.xp6(5),t.Q6J("title",a.model.caption),t.xp6(1),t.Q6J("ngIf",a.isSaveButtonVisible),t.xp6(1),t.Q6J("ngIf",a.isSaveButtonVisible),t.xp6(1),t.Q6J("ngIf",!a.isSaveButtonVisible),t.xp6(1),t.Q6J("formGroup",a.printableForm),t.xp6(5),t.Oqu(t.lcZ(15,31,"Printables.Caption")),t.xp6(3),t.Q6J("ngIf",a.isInvalid("printableCaption")),t.xp6(3),t.Oqu(t.lcZ(21,33,"Printables.ModuleName")),t.xp6(2),t.Q6J("matAutocomplete",n),t.xp6(6),t.Q6J("ngForOf",a.filteredSectionList),t.xp6(1),t.Q6J("ngIf",a.isInvalid("printableSection")),t.xp6(1),t.Q6J("checked",a.model.showInSection),t.xp6(1),t.hij(" ",t.lcZ(32,35,"Printables.ShowInSection")," "),t.xp6(2),t.Q6J("checked",a.model.showInCard),t.xp6(1),t.hij(" ",t.lcZ(35,37,"Printables.ShowInCard")," "),t.xp6(2),t.Q6J("checked",a.model.showInSectionAnalytics),t.xp6(1),t.hij(" ",t.lcZ(38,39,"Printables.ShowInAnalytics")," "),t.xp6(2),t.Q6J("ngIf",a.model.showInSectionAnalytics),t.xp6(5),t.Oqu(t.lcZ(45,41,"Printables.Page.InfoBlock.Title")),t.xp6(4),t.Oqu(t.lcZ(49,43,"Printables.Page.InfoBlock.StepsTitle")),t.xp6(3),t.Q6J("ngForOf",a.InfoBlockSteps),t.xp6(4),t.Oqu(t.lcZ(56,45,"Printables.Page.DataSource.Custom.Caption")),t.xp6(2),t.Q6J("innerHTML",a.getDataSourceDescription(),t.oJD),t.xp6(5),t.Q6J("ngIf",a.isInvalid("printableDataSource")),t.xp6(3),t.Oqu(t.lcZ(66,47,"Printables.Page.Template.Download.Caption")),t.xp6(3),t.Oqu(t.lcZ(69,49,"Printables.Page.Template.Download.Description")),t.xp6(3),t.hij(" ",t.lcZ(72,51,"Printables.Page.Template.Download.ButtonCaption")," "),t.xp6(4),t.Oqu(t.lcZ(76,53,"Printables.Page.Template.Upload.Caption")),t.xp6(3),t.Oqu(t.lcZ(79,55,"Printables.Page.Template.Upload.Description")),t.xp6(5),t.hij(" ",t.lcZ(84,57,"Printables.Page.Template.Upload.ButtonCaption")," ")}},dependencies:[Se.g,P.sg,P.O5,ye.G,Y.eB,N.FC,j.Hw,Ae.IC,se.nI,se.v_,se.$V,se.nX,C.k0,Ne.CK,I.VN,I.QJ,_._Y,_.Fj,_.JJ,_.JL,_.Q7,_.sg,_.u,f.X$],styles:[".flex-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.left-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;margin-right:5px}.left-panel[_ngcontent-%COMP%]   .pane[_ngcontent-%COMP%]{padding:20px;width:298px;margin-top:5px}.left-panel[_ngcontent-%COMP%]   .pane[_ngcontent-%COMP%]:first-child{margin-top:0}.left-panel[_ngcontent-%COMP%]   .pane.sys-module-settings[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch}.left-panel[_ngcontent-%COMP%]   .pane.sys-module-settings[_ngcontent-%COMP%]   .printable-field[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%], .left-panel[_ngcontent-%COMP%]   .pane.sys-module-settings[_ngcontent-%COMP%]   .printable-field[_ngcontent-%COMP%]   .filter-page[_ngcontent-%COMP%]{width:100%}.left-panel[_ngcontent-%COMP%]   .pane.sys-module-settings[_ngcontent-%COMP%]   .printable-field.filter-page[_ngcontent-%COMP%]{margin-top:10px}.left-panel[_ngcontent-%COMP%]   .pane.sys-module-settings[_ngcontent-%COMP%]   .printable-field.mat-checkbox[_ngcontent-%COMP%]:not(:first-of-type){margin-top:10px}.left-panel[_ngcontent-%COMP%]   .pane.info-block[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.left-panel[_ngcontent-%COMP%]   .pane.info-block[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{height:32px;width:32px}.left-panel[_ngcontent-%COMP%]   .pane.info-block[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{margin-left:12px}.left-panel[_ngcontent-%COMP%]   .pane.info-block[_ngcontent-%COMP%]   .info-block-text[_ngcontent-%COMP%]{display:block;margin-top:14px;white-space:pre-wrap}.left-panel[_ngcontent-%COMP%]   .pane.info-block[_ngcontent-%COMP%]   .info-block-text[_ngcontent-%COMP%]   .steps[_ngcontent-%COMP%]{margin:0;list-style-position:outside;padding-left:2ex}.main-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch}.main-content[_ngcontent-%COMP%]   .action-block[_ngcontent-%COMP%]{margin-top:5px}.main-content[_ngcontent-%COMP%]   .action-block[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block}.main-content[_ngcontent-%COMP%]   .action-block[_ngcontent-%COMP%]   .main-content-description[_ngcontent-%COMP%]{margin-top:8px}.main-content[_ngcontent-%COMP%]   .action-block.template-action.download-template[_ngcontent-%COMP%]{margin-top:20px}.main-content[_ngcontent-%COMP%]   .action-block.template-action.upload-template[_ngcontent-%COMP%]{margin-top:32px}.main-content[_ngcontent-%COMP%]   .action-block.template-action[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{margin-top:13px}.main-content[_ngcontent-%COMP%]   .action-block.data-source[_ngcontent-%COMP%]{margin-top:28px}.main-content[_ngcontent-%COMP%]   .action-block.data-source[_ngcontent-%COMP%]   .data-source-json[_ngcontent-%COMP%]{width:100%}"]});var Ge=s(11465),Qe=s(74970),je=s(58143);function Ye(o,e){o&1&&t._UZ(0,"ts-mask")}function ze(o,e){if(o&1&&(t.TgZ(0,"button",29),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"mat-icon",30),t.qZA()),o&2){t.oxw();const a=t.MAs(3);t.Q6J("matMenuTriggerFor",a),t.xp6(1),t.hij(" ",t.lcZ(2,2,"Printables.Section.Add")," ")}}function Ke(o,e){if(o&1){const a=t.EpF();t.ynx(0),t.YNc(1,ze,4,4,"button",25),t.TgZ(2,"mat-menu",null,26)(4,"button",27),t.NdJ("click",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.addPrintable(i.printableTypeEnum.FastReport))}),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"button",28),t.NdJ("click",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.addPrintable(i.printableTypeEnum.MSWord))}),t._uU(8),t.ALo(9,"translate"),t.qZA()(),t.BQk()}if(o&2){const a=t.oxw();t.xp6(1),t.Q6J("ngIf",a.canAdd()),t.xp6(4),t.hij(" ",t.lcZ(6,3,"Printables.Section.AddFastReport")," "),t.xp6(3),t.hij(" ",t.lcZ(9,5,"Printables.Section.AddMSWord")," ")}}function $e(o,e){if(o&1){const a=t.EpF();t.TgZ(0,"button",32),t.NdJ("click",function(){t.CHM(a);const i=t.oxw(2);return t.KtG(i.addPrintable(i.printableTypeEnum.MSWord))}),t._uU(1),t.ALo(2,"translate"),t.qZA()}o&2&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Printables.Section.Add")," "))}function Xe(o,e){if(o&1&&t.YNc(0,$e,3,3,"button",31),o&2){const a=t.oxw();t.Q6J("ngIf",a.canAdd())}}function et(o,e){if(o&1){const a=t.EpF();t.TgZ(0,"button",33),t.NdJ("click",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.copyPrintable())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}o&2&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Printables.Section.Copy")," "))}function tt(o,e){if(o&1){const a=t.EpF();t.TgZ(0,"button",34),t.NdJ("click",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.deletePrintable())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}o&2&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Printables.Section.Delete")," "))}function at(o,e){o&1&&(t.TgZ(0,"th",35)(1,"label"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),o&2&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"Printables.Caption")))}const nt=function(){return{isOpenedFromSection:!0}};function ot(o,e){if(o&1&&(t.TgZ(0,"td",36)(1,"a",37),t._uU(2),t.qZA()()),o&2){const a=e.$implicit;t.xp6(1),t.hYB("routerLink","/Printables/",a.typeId,"/",a.id,""),t.Q6J("state",t.DdM(4,nt)),t.xp6(1),t.Oqu(a.caption)}}function it(o,e){o&1&&(t.TgZ(0,"th",38)(1,"label"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),o&2&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"Printables.ModuleName")))}function rt(o,e){if(o&1&&(t.TgZ(0,"td",36),t._uU(1),t.qZA()),o&2){const a=e.$implicit;t.xp6(1),t.Oqu(a.moduleName)}}function st(o,e){o&1&&(t.TgZ(0,"th",39)(1,"label"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),o&2&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"Printables.TypeName")))}function lt(o,e){if(o&1&&(t.TgZ(0,"td",36),t._uU(1),t.qZA()),o&2){const a=e.$implicit;t.xp6(1),t.Oqu(a.typeName)}}function ct(o,e){o&1&&t._UZ(0,"tr",40)}const pt=function(o,e){return{"even-row":o,selected:e}};function ut(o,e){if(o&1){const a=t.EpF();t.TgZ(0,"tr",41),t.NdJ("click",function(){const l=t.CHM(a).$implicit,h=t.oxw();return t.KtG(h.onRowClick(l))}),t.qZA()}if(o&2){const a=e.$implicit,n=e.even,i=t.oxw();t.Q6J("ngClass",t.WLB(3,pt,!n,i.isSelectedRow(a))),t.uIk("data-qa",a.caption)("data-item-marker",a.caption)}}function dt(o,e){o&1&&(t.TgZ(0,"div",42),t._UZ(1,"mat-icon",43),t.TgZ(2,"div",44)(3,"span",45),t._uU(4),t.ALo(5,"translate"),t.qZA()(),t.TgZ(6,"div",46)(7,"span",47),t._uU(8),t.ALo(9,"translate"),t.qZA()()()),o&2&&(t.xp6(4),t.Oqu(t.lcZ(5,2,"Printables.Section.BlankslateTitle")),t.xp6(4),t.Oqu(t.lcZ(9,4,"Printables.Section.BlankslateDescription")))}class X extends x.OMD{get enableFastReport(){return this.featureService.getFeatureState("EnableFastReport")}constructor(e,a,n,i,l,h){super(e),this.printableSectionService=a,this.router=n,this.featureService=i,this.titleService=l,this.translateService=h,this.printableTypeEnum=S,this.displayedColumns=["caption","moduleName","typeName"],this.getStaticSearchColumns=()=>this.displayedColumns,this.getProfileDataKey=()=>"PrintablesSectionSettingsProfile",this.getGtmSchemaName=()=>"ReportSetupSection"}requestPageData(){return this.printableSectionService.getItems()}getModelFromLoadResponse(e){return e.result}initTableDataSource(){super.initTableDataSource(),this.tableDataSource.sortingDataAccessor=(e,a)=>e[a].toLocaleLowerCase()}createEqualityPredicate(){return(e,a)=>e.id===a.id}onRecordChanged(e,a){super.onRecordChanged(e,a),e||this.addRecord(a)}resetSelection(){this.selectedPrintable=void 0}addRecord(e){this.model=this.model.concat(e),this.selectedPrintable=e}onRowClick(e){this.selectedPrintable=e}isSelectedRow(e){return this.selectedPrintable===e}trackById(e,a){return[a.id,a.caption,a.moduleId,a.typeId].join(" ")}canDelete(){return this.selectedPrintable!==void 0}canCopy(){var e;return((e=this.selectedPrintable)===null||e===void 0?void 0:e.typeId)===S.MSWord}canAdd(){return!0}deletePrintable(){const e=this.translateInstant("BaseSection.DeleteRecordConfirmation");this.openConfirmationDialog(e).pipe((0,_e.w)(a=>a!==u.Zz.result?(0,v.of)(null):this.printableSectionService.deleteItem(this.selectedPrintable)),(0,Qe.h)(a=>a?.success)).subscribe(()=>{this.model=this.model.filter(a=>a.id!==this.selectedPrintable.id),this.resetSelection()})}copyPrintable(){this.router.navigate(["Printables/",this.selectedPrintable.typeId],{state:{isOpenedFromSection:!0,operation:"copy",printableIdToCopy:this.selectedPrintable.id}})}addPrintable(e){this.router.navigate(["Printables/",e,"New"],{state:{isOpenedFromSection:!0}})}ngOnInit(){super.ngOnInit();const e=this.translateService.instant("Printables.Section.Title");this.titleService.setTitle(e)}}X.\u0275fac=function(e){return new(e||X)(t.Y36(t.zs3),t.Y36(W),t.Y36(M.F0),t.Y36(Ge.UZ),t.Y36(x.yDd),t.Y36(f.sK))},X.\u0275cmp=t.Xpm({type:X,selectors:[["ts-printables-section"]],features:[t.qOj],decls:33,vars:21,consts:[[4,"ngIf"],["data-item-marker","printables-section","data-qa","printables-section",1,"base-section-wrap","printable-section"],[1,"header"],[1,"pane"],[3,"title"],["data-qa","close-printables","mat-flat-button","","color","primary",1,"action-button",3,"click"],[4,"ngIf","ngIfElse"],["onlyWordReport",""],["data-item-marker","copy-printable","class","action-button","mat-button","",3,"click",4,"ngIf"],["data-qa","delete-printable","data-item-marker","delete-printable","class","action-button","mat-button","",3,"click",4,"ngIf"],[1,"filters"],[3,"value","valueChange"],[1,"flex-wrapper"],[1,"table-wrapper"],["mat-table","","matSort","","matSortActive","caption","matSortDirection","asc","matSortDisableClear","",3,"dataSource","trackBy"],["matColumnDef","caption"],["mat-header-cell","","mat-sort-header","","data-qa","printables-grid-caption",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","moduleName"],["mat-header-cell","","mat-sort-header","","data-qa","printables-grid-module-name",4,"matHeaderCellDef"],["matColumnDef","typeName"],["mat-header-cell","","mat-sort-header","","data-qa","printables-grid-type",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],["class","blank-slate-wrapper","data-qa","printables-blank-slate-wrapper",4,"ngIf"],["data-qa","add-printable","data-item-marker","add-printable","class","action-button add-button button-with-menu","mat-flat-button","","color","accent",3,"matMenuTriggerFor",4,"ngIf"],["addPrintableMenu","matMenu"],["mat-menu-item","","data-qa","add-fast-report-printable",3,"click"],["mat-menu-item","","data-qa","add-ms-word-printable","data-item-marker","add-ms-word-printable",3,"click"],["data-qa","add-printable","data-item-marker","add-printable","mat-flat-button","","color","accent",1,"action-button","add-button","button-with-menu",3,"matMenuTriggerFor"],["svgIcon","arrow-down",1,"arrow-icon"],["data-qa","add-printable","data-item-marker","add-printable","class","action-button add-button","mat-flat-button","","color","accent",3,"click",4,"ngIf"],["data-qa","add-printable","data-item-marker","add-printable","mat-flat-button","","color","accent",1,"action-button","add-button",3,"click"],["data-item-marker","copy-printable","mat-button","",1,"action-button",3,"click"],["data-qa","delete-printable","data-item-marker","delete-printable","mat-button","",1,"action-button",3,"click"],["mat-header-cell","","mat-sort-header","","data-qa","printables-grid-caption"],["mat-cell",""],[3,"routerLink","state"],["mat-header-cell","","mat-sort-header","","data-qa","printables-grid-module-name"],["mat-header-cell","","mat-sort-header","","data-qa","printables-grid-type"],["mat-header-row",""],["mat-row","",3,"ngClass","click"],["data-qa","printables-blank-slate-wrapper",1,"blank-slate-wrapper"],["svgIcon","table-filter-blank-slate"],[1,"blank-slate-title"],["data-qa","printables-blank-slate-title"],[1,"blank-slate-description"],["data-qa","printables-blank-slate-description"]],template:function(e,a){if(e&1&&(t.YNc(0,Ye,1,0,"ts-mask",0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"ts-header",4),t.ALo(5,"translate"),t.TgZ(6,"button",5),t.NdJ("click",function(){return a.close()}),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.YNc(9,Ke,10,7,"ng-container",6),t.ALo(10,"async"),t.YNc(11,Xe,1,1,"ng-template",null,7,t.W1O),t.YNc(13,et,3,3,"button",8),t.YNc(14,tt,3,3,"button",9),t.qZA(),t.TgZ(15,"div",10)(16,"ts-search-input",11),t.NdJ("valueChange",function(i){return a.searchKey=i}),t.qZA()()()(),t.TgZ(17,"div",12)(18,"div",13)(19,"div",3)(20,"table",14),t.ynx(21,15),t.YNc(22,at,4,3,"th",16),t.YNc(23,ot,3,5,"td",17),t.BQk(),t.ynx(24,18),t.YNc(25,it,4,3,"th",19),t.YNc(26,rt,2,1,"td",17),t.BQk(),t.ynx(27,20),t.YNc(28,st,4,3,"th",21),t.YNc(29,lt,2,1,"td",17),t.BQk(),t.YNc(30,ct,1,0,"tr",22),t.YNc(31,ut,1,6,"tr",23),t.qZA(),t.YNc(32,dt,10,6,"div",24),t.qZA()()()()),e&2){const n=t.MAs(12);t.Q6J("ngIf",a.isLoading),t.xp6(4),t.Q6J("title",t.lcZ(5,15,"Printables.Section.Title")),t.xp6(3),t.hij(" ",t.lcZ(8,17,"BasePageComponent.Close")," "),t.xp6(2),t.Q6J("ngIf",t.lcZ(10,19,a.enableFastReport))("ngIfElse",n),t.xp6(4),t.Q6J("ngIf",a.canCopy()),t.xp6(1),t.Q6J("ngIf",a.canDelete()),t.xp6(2),t.Q6J("value",a.searchKey),t.xp6(4),t.Udp("visibility",a.isEmpty()?"hidden":"visible"),t.Q6J("dataSource",a.tableDataSource)("trackBy",a.trackById),t.xp6(10),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(1),t.Q6J("ngIf",a.isEmpty())}},dependencies:[Se.g,P.mk,P.O5,ye.G,je.J,Y.eB,j.Hw,D.W0,D.tN,D.D8,p.YE,p.nU,c.ty,c.wO,c.S4,c.t3,c.R3,c.Al,c.L7,c.ML,c.fg,c.Zw,M.rH,P.Ov,f.X$],styles:["ts-search-input[_ngcontent-%COMP%]{margin-bottom:1em}.flex-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.action-button.add-button[_ngcontent-%COMP%]{padding:0 12px}.action-button.add-button.button-with-menu[_ngcontent-%COMP%]{padding-right:6px}"]});var mt=s(33177),ht=s(5557),gt=s(5998);const ft=["wordPrintablePage"];class ee{constructor(e,a,n,i,l,h,y){this.route=n,this._wordPrintable=i,this.location=l,this._router=h,this._window=y,this._wordPrintableEditPage="WordPrintablePageLoader",this._channelName="word-printable",this._initializeMessageName="initialize",this._messageHandler=this._onMessage.bind(this),this._initialized$=new ht.t(1);const ae=`${P.Ye.joinWithSlash(a.workspaceBaseUrl,a.defaultApplicationUrl)}?vm=${this._wordPrintableEditPage}`;this.uri=e.bypassSecurityTrustResourceUrl(ae),this._isOpenedFromSection=y.history.state.isOpenedFromSection||!1}get operation(){return this._window.history.state.operation||null}_checkMessageChannel(e){return e.data.channel===this._channelName}_sendHandshakeMessage(e){this._sendMessage(e.data.payload.handshakeMessage)}_onMessage(e){if(!!this._checkMessageChannel(e)){if(e.data.name===this._initializeMessageName){this._sendHandshakeMessage(e);return}this._processMessage(e)}}_processMessage(e){switch(e.data.name){case"RequestSysModuleReport":this._requestWordPrintable();break;case"RequestSysModuleReportSave":this._save(e.data.payload.printable);break;case"RequestSysModuleReportDiscard":this._wordPrintable.getItem(this.id).subscribe(n=>{this.model=n.result[0],this._sendMessage("ReturnSysModuleReportDiscardResult",this.model)});break;case"RequestClosePage":this._isOpenedFromSection?this.location.back():this._router.navigate(["Printables"]);break}}_getCardMode(){return this.isNew?this.isCopyMode()?"copy":"add":"edit"}_requestWordPrintable(){this._sendMessage("ReturnSysModuleReport",{operation:this._getCardMode(),printable:this.model,sourceReportId:this._window.history.state.printableIdToCopy})}_updateModel(e){this.model.id=e.id,this.model.caption=e.caption,this.model.moduleId=e.moduleId,this.model.moduleName=e.moduleName,this.model.moduleSchemaName=e.moduleSchemaName,this.model.typeId=e.typeId,this.model.typeName=e.typeName,this.model.showInSection=e.showInSection,this.model.showInCard=e.showInCard,this.model.convertInPDF=e.convertInPDF,this.model.macrosList=e.macrosList,this.model.macrosSettings=e.macrosSettings,this.model.tableParts=[],e.tableParts.forEach(a=>{const n=new he;n.isNew=a.isNew,n.isDeleted=a.isDeleted,n.id=a.id,n.sysModuleReportId=a.sysModuleReportId,n.name=a.name,n.caption=a.caption,n.objectId=a.objectId,n.macrosList=a.macrosList,n.macrosSettings=a.macrosSettings,n.referenceColumn=a.referenceColumn,n.referenceColumnCaption=a.referenceColumnCaption,n.filter=a.filter,n.filterSettings=a.filterSettings,n.objectColumnPath=a.objectColumnPath,n.objectColumnCaption=a.objectColumnCaption,n.isEmptyTableHide=a.isEmptyTableHide,this.model.tableParts.push(n)})}_saveWordPrintable(){return this.isNew?this._wordPrintable.insertItem(this.model):this._wordPrintable.updateItem(this.model)}_save(e){this._updateModel(e),this._saveWordPrintable().subscribe(a=>{a.success&&(this.isNew=!1,this.id=e.id),this._sendMessage("ReturnSysModuleReportSaveResult",{success:a.success,errorInfo:a.errorInfo})})}_sendMessage(e,a){this.wordPrintablePageIFrameRef.nativeElement.contentWindow.postMessage({channel:this._channelName,name:e,payload:a},window.location.origin)}_copyHandler(e){return this._wordPrintable.copy(e)}isCopyMode(){return this.operation==="copy"}loadPrintables(e,a){this._wordPrintable.getItem(e).subscribe(n=>{const i=n.result[0];this.model=a?a.call(this,i):i,this._initialized$.next(),this._initialized$.complete()})}ngOnInit(){this.route.paramMap.subscribe(e=>{const a=e.get("id"),n=this.isCopyMode();if(!a&&!n){this._router.navigate(["Printables"]);return}if(this.isNew=e.get("id")==="New",this.isNew)this.model=this._wordPrintable.create(),this._initialized$.next(),this._initialized$.complete();else if(n){const i=this._window.history.state.printableIdToCopy;this.loadPrintables(i,this._copyHandler),this.isNew=!0}else this.id=a,this.loadPrintables(this.id)})}ngAfterViewInit(){this._initialized$.subscribe(()=>{window.addEventListener("message",this._messageHandler,!1)})}ngOnDestroy(){window.removeEventListener("message",this._messageHandler,!1)}}ee.\u0275fac=function(e){return new(e||ee)(t.Y36(gt.H7),t.Y36("environment"),t.Y36(M.gz),t.Y36(A),t.Y36(P.Ye),t.Y36(M.F0),t.Y36(mt.WINDOW_TOKEN))},ee.\u0275cmp=t.Xpm({type:ee,selectors:[["ts-word-printable-edit-page"]],viewQuery:function(e,a){if(e&1&&t.Gf(ft,5),e&2){let n;t.iGM(n=t.CRH())&&(a.wordPrintablePageIFrameRef=n.first)}},decls:3,vars:1,consts:[[1,"word-printable-edit-page-main-container"],["title","word-printable-edit-page-iframe",1,"word-printable-edit-page-iframe",3,"src"],["wordPrintablePage",""]],template:function(e,a){e&1&&(t.TgZ(0,"div",0),t._UZ(1,"iframe",1,2),t.qZA()),e&2&&(t.xp6(1),t.Q6J("src",a.uri,t.uOi))},styles:[".word-printable-edit-page-main-container[_ngcontent-%COMP%]{height:100vh;overflow:hidden}.word-printable-edit-page-iframe[_ngcontent-%COMP%]{border:none;width:100%;height:100%}"]});function _t(o,e){o&1&&t._UZ(0,"ts-printables-edit-page")}function bt(o,e){o&1&&t._UZ(0,"ts-word-printable-edit-page")}class G{constructor(e){this._route=e,this.printableTypeEnum=S}ngOnInit(){this._route.paramMap.subscribe(e=>{this.type=e.get("type")})}}G.\u0275fac=function(e){return new(e||G)(t.Y36(M.gz))},G.\u0275cmp=t.Xpm({type:G,selectors:[["ts-printable-edit-page-wrap"]],decls:3,vars:3,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"]],template:function(e,a){e&1&&(t.ynx(0,0),t.YNc(1,_t,1,0,"ts-printables-edit-page",1),t.YNc(2,bt,1,0,"ts-word-printable-edit-page",1),t.BQk()),e&2&&(t.Q6J("ngSwitch",a.type),t.xp6(1),t.Q6J("ngSwitchCase",a.printableTypeEnum.FastReport),t.xp6(1),t.Q6J("ngSwitchCase",a.printableTypeEnum.MSWord))},dependencies:[P.RF,P.n9,$,ee],encapsulation:2});const St=[{path:"",component:X,data:{shouldReuse:!1}},{path:":type",component:G},{path:":type/:id",component:G}];class Q{}Q.\u0275fac=function(e){return new(e||Q)},Q.\u0275mod=t.oAB({type:Q}),Q.\u0275inj=t.cJS({imports:[M.Bz.forChild(St),M.Bz]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&t.kYT(Q,{imports:[M.Bz],exports:[M.Bz]})}();class te{}te.\u0275fac=function(e){return new(e||te)},te.\u0275mod=t.oAB({type:te}),te.\u0275inj=t.cJS({providers:[H,W,A,J,w,E,O,F,k,Z,R,q,V,U,B,x.Pnv,{provide:x.thQ,useValue:"PrintablesModule"}],imports:[u.Su,u._M,u.z8,P.ez,x.kLW,Y.yu,N.Zh,j.Ps,C.x4,D.jT,z.uw,p.JX,c.U5,Q,f.aw,I.D8,_.u5,_.UX,m.nD]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&t.kYT(te,{declarations:[X,$,G,ee],imports:[u.Su,u._M,u.z8,P.ez,x.kLW,Y.yu,N.Zh,j.Ps,C.x4,D.jT,z.uw,p.JX,c.U5,Q,f.aw,I.D8,_.u5,_.UX,m.nD]})}()},49457:function(le,oe){var s,P,_;(function(j,I){P=[],s=I,_=typeof s=="function"?s.apply(oe,P):s,_!==void 0&&(le.exports=_)})(this,function(){"use strict";function j(c,p){return typeof p>"u"?p={autoBom:!1}:typeof p!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),p={autoBom:!p}),p.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c}function I(c,p,f){var u=new XMLHttpRequest;u.open("GET",c),u.responseType="blob",u.onload=function(){z(u.response,p,f)},u.onerror=function(){console.error("could not download file")},u.send()}function Y(c){var p=new XMLHttpRequest;p.open("HEAD",c,!1);try{p.send()}catch{}return 200<=p.status&&299>=p.status}function N(c){try{c.dispatchEvent(new MouseEvent("click"))}catch{var p=document.createEvent("MouseEvents");p.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),c.dispatchEvent(p)}}var C=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,D=C.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),z=C.saveAs||(typeof window!="object"||window!==C?function(){}:"download"in HTMLAnchorElement.prototype&&!D?function(c,p,f){var u=C.URL||C.webkitURL,m=document.createElement("a");p=p||c.name||"download",m.download=p,m.rel="noopener",typeof c=="string"?(m.href=c,m.origin===location.origin?N(m):Y(m.href)?I(c,p,f):N(m,m.target="_blank")):(m.href=u.createObjectURL(c),setTimeout(function(){u.revokeObjectURL(m.href)},4e4),setTimeout(function(){N(m)},0))}:"msSaveOrOpenBlob"in navigator?function(c,p,f){if(p=p||c.name||"download",typeof c!="string")navigator.msSaveOrOpenBlob(j(c,f),p);else if(Y(c))I(c,p,f);else{var u=document.createElement("a");u.href=c,u.target="_blank",setTimeout(function(){N(u)})}}:function(c,p,f,u){if(u=u||open("","_blank"),u&&(u.document.title=u.document.body.innerText="downloading..."),typeof c=="string")return I(c,p,f);var m=c.type==="application/octet-stream",x=/constructor/i.test(C.HTMLElement)||C.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent);if((r||m&&x||D)&&typeof FileReader<"u"){var ne=new FileReader;ne.onloadend=function(){var K=ne.result;K=r?K:K.replace(/^data:[^;]*;/,"data:attachment/file;"),u?u.location.href=K:location=K,u=null},ne.readAsDataURL(c)}else{var v=C.URL||C.webkitURL,g=v.createObjectURL(c);u?u.location=g:location.href=g,u=null,setTimeout(function(){v.revokeObjectURL(g)},4e4)}});C.saveAs=z.saveAs=z,le.exports=z})}}]);
