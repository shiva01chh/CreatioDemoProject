(self.webpackChunkapp_studio_enterprise_system_designer=self.webpackChunkapp_studio_enterprise_system_designer||[]).push([[172],{13408:(ue,pe,u)=>{var Q={"./entity-column-pick-default-value-icon.svg":94844};function v(h){var x=n(h);return u(x)}function n(h){if(!u.o(Q,h)){var x=new Error("Cannot find module '"+h+"'");throw x.code="MODULE_NOT_FOUND",x}return Q[h]}v.keys=function(){return Object.keys(Q)},v.resolve=n,ue.exports=v,v.id=13408},78172:(ue,pe,u)=>{"use strict";u.r(pe),u.d(pe,{AVAILABLE_SCHEMAS:()=>de,BaseEntityColumnEditorService:()=>w,BaseEntitySchemaDesignerStructureService:()=>V,BaseEntitySchemaFormService:()=>O,BooleanEntityColumnEditorService:()=>Z,DefaultEntityColumnEditorService:()=>L,EntityEventsEditorService:()=>b,EntityIndexEditorService:()=>A,EntitySchemaDesignerEditableStructureService:()=>E,EntitySchemaDesignerModule:()=>N,EntitySchemaDesignerReadOnlyStructureService:()=>k,EntitySchemaEditorService:()=>I,EntitySchemaFormsManagerService:()=>y,LookupEntityColumnEditorService:()=>P,SpecialTextEntityColumnEditorService:()=>H,TextEntityColumnEditorService:()=>U});var Q=u(84911),v=u(88692),n=u(64537),h=u(20092),x=u(17914),z=u(83331),X=u(15756),ve=u(49460),Y=u(37697),G=u(95236),ce=u(74817),ie=u(72990),ge=u(93254),s=u(75378),g=u(56707),_=u(26522),C=u(44228),Ce=u(55953),j=u(79641),r=u(80542),ye=u(86200),se=u(35864),p=u(28262),Fe=u(87683),Te=u(82909),d=u(36619),De=u(8239),oe=u(7976),Ie=u(11465),Ee=u(22063),Re=u(33569),fe=u(38023),T=u(84945),Ne=u(57445),be=u(84967),S=u(27969),M=u(61528),W=u(13528),J=u(98168),F=u(74970),Be=u(75955),Ge=u(32085),xe=u(28499);function ke(o){return(0,Ge.e)((e,t)=>{let a,i=!1,l;const c=()=>{a=e.subscribe((0,xe.x)(t,void 0,void 0,m=>{l||(l=new fe.x,(0,Be.Xf)(o(l)).subscribe((0,xe.x)(t,()=>a?c():i=!0))),l&&l.next(m)})),i&&(a.unsubscribe(),a=null,i=!1,c())};c()})}var we=u(95990),Ve=u(65598),Ue=u(11770);const de=new n.OlP("AVAILABLE_SCHEMAS"),Le="EntityColumnTypes";function me(o){return`${Le}.${o}`}function re(o){const e=d.aG7[o];return{icon:e.icon,type:o,title:e.translateKey}}const Ze=[s.DataValueType.SHORT_TEXT,s.DataValueType.MEDIUM_TEXT,s.DataValueType.LONG_TEXT,s.DataValueType.RICH_TEXT,s.DataValueType.MAXSIZE_TEXT,s.DataValueType.PHONE_TEXT,s.DataValueType.WEB_TEXT,s.DataValueType.EMAIL_TEXT,s.DataValueType.SECURE_TEXT,s.DataValueType.HASH_TEXT].map(o=>re(o)),He=[{type:null,title:me("TextCaption"),icon:"data-type-text-icon.svg",items:Ze}],$e=[s.DataValueType.Integer,s.DataValueType.FLOAT1,s.DataValueType.FLOAT2,s.DataValueType.FLOAT3,s.DataValueType.FLOAT4,s.DataValueType.FLOAT8,s.DataValueType.Money].map(o=>re(o)),Ye=[{type:null,title:me("NumberCaption"),icon:"data-type-number-icon.svg",items:$e}],Je=[s.DataValueType.DateTime,s.DataValueType.Date,s.DataValueType.Time].map(o=>re(o)),qe=[{type:null,title:me("DateTimeCaption"),icon:"data-type-datetime-icon.svg",items:Je}],Ke=[s.DataValueType.Boolean,s.DataValueType.Image,s.DataValueType.IMAGELOOKUP,s.DataValueType.FILE,s.DataValueType.Color,s.DataValueType.Guid,s.DataValueType.Blob].map(o=>re(o)),Qe=[{type:null,title:me("OtherCaption"),icon:"data-type-other-icon.svg",items:Ke}],ze=[...He,...Ye,...qe,...Qe,re(s.DataValueType.Lookup)];class V extends p.ml{constructor(e){super(e)}get translationPrefix(){return"SchemaDesigners.EntitySchemaDesigner"}static get SourceCodeItemUId(){return"73e16bcb-8439-4cb8-93c6-8cda28df880b"}_getStructureTranslate(e){return this.getTranslation(`EntitySchemaDesignerStructure.${e}`)}getSchemaVisibleAddons(e){return(0,T.of)(e.addons)}createStructureElement(e,t,a){return super.createSchemaStructureElement({caption:e.name,icon:this.getColumnTypeIcon(e),uId:e.uId,parentUId:t,actions:a,canSelected:!0,required:e.requirementType===C.TL.YES})}createIndexElement(e,t,a){return super.createSchemaStructureElement({uId:e.uId,caption:e.name,icon:"entity-schema-index-item-icon.svg",parentUId:t,actions:a,canSelected:!0})}createSchemaColumns(e){const t=e.uId,a=super.createSchemaStructureElement({uId:t,caption:this._getStructureTranslate("ColumnsCaption"),icon:"entity-schema-column-icon.svg",actions:this.getColumnGroupActions()}),i=this.getElementActions();return e.forEach(l=>{const c=this.createStructureElement(l,t,i);a.children.push(c)}),a}createInheritedColumns(e){const t=e.uId,a=super.createSchemaStructureElement({uId:t,caption:this._getStructureTranslate("InheritedColumnsCaption"),icon:"entity-schema-column-icon.svg"}),i=[];return e.forEach(l=>{const c=this.createStructureElement(l,t,i);a.children.push(c)}),a}createSchemaIndexes(e){const t=this.getElementActions(),a=e.indexes.uId,i=super.createSchemaStructureElement({caption:this._getStructureTranslate("IndexesCaption"),icon:"entity-schema-indexes-icon.svg",uId:a,actions:this.getIndexGroupActions(),newChildActions:t});return e.indexes.forEach(l=>{const c=this.createIndexElement(l,a,t);i.children.push(c)}),i}createColumnStructureElement(e,t){const a=this.getElementActions(),i=this.createStructureElement(t,e,a);return i.selected=!0,i}createIndexStructureElement(e,t){const a=this.getElementActions(),i=this.createIndexElement(t,e,a);return i.selected=!0,i}getModelStructureData(e){const t=[],a=this.createSchemaColumns(e.columns),i=this.createInheritedColumns(e.inheritedColumns),l=this.createSchemaIndexes(e),c=super.createSchemaStructureElement({uId:e.events.uId,caption:this._getStructureTranslate("EventsCaption"),icon:"entity-schema-events-icon.svg",model:e.events,canSelected:!0}),m=super.createSchemaStructureElement({caption:this._getStructureTranslate("SourceCodeCaption"),icon:"entity-schema-sourcecode-icon.svg",uId:V.SourceCodeItemUId,canSelected:!0});return t.push(i,a,l,c,m),t}}V.\u0275fac=function(e){return new(e||V)(n.LFG(n.zs3))},V.\u0275prov=n.Yz7({token:V,factory:V.\u0275fac});class E extends V{constructor(e){super(e),this._columnTypes=ze}static _createActionMenuItem(e,t){return{title:t,icon:e.icon,type:e.type,items:[]}}_createActionMenu(e){var t;let a;if(e.items){const i=this.getTranslation(e.title);a=E._createActionMenuItem(e,i),(t=e.items)===null||t===void 0||t.forEach(l=>{const c=this.translateService.instant(l.title);a.items.push(E._createActionMenuItem(l,c))})}else{const i=this.translateService.instant(e.title);a=E._createActionMenuItem(e,i)}return a}getColumnGroupActions(){const e=p.E_.createAddAction();return e.actionControlType=p.q1.Menu,this._columnTypes.forEach(t=>{const a=this._createActionMenu(t);e.menuItems.push(a)}),[e]}getElementActions(){return[p.E_.createDeleteAction()]}getIndexGroupActions(){return[p.E_.createAddAction()]}}E.\u0275fac=function(e){return new(e||E)(n.LFG(n.zs3))},E.\u0275prov=n.Yz7({token:E,factory:E.\u0275fac});class k extends V{constructor(e){super(e)}getElementActions(){return[]}getColumnGroupActions(){return[]}getIndexGroupActions(){return[]}}k.\u0275fac=function(e){return new(e||k)(n.LFG(n.zs3))},k.\u0275prov=n.Yz7({token:k,factory:k.\u0275fac});var R=u(33177);class O extends r.e1f{constructor(e,t){super(),this.translateService=e,this.customEventService=t}_getNamePrefixValidator(e){return{message:(0,d.WUZ)(this.getTranslation("Validations.PatternPrefixTemplate"),[e]),name:"prefix",validator:d.dNr.prefix(e)}}getTranslation(e){const t=this.translationPrefix?".":"",a=`${this.translationPrefix}${t}${e}`;return this.translateService.instant(a)}getCaptionValue(e){return new d.CjD(e).getValue(this.translateService.currentLang)}createNameControl(e){const t=r.D9$.createInputFieldConfig({name:"name",label:this.getTranslation("GeneralGroup.NameCaption"),validations:[{message:this.getTranslation("Validations.RequiredNameCaption"),name:"required",validator:h.kI.required},{message:this.getTranslation("Validations.PatternNameCaption"),name:"pattern",validator:h.kI.pattern(/^[a-zA-Z]+[a-zA-Z0-9._]*$/)}]});return e&&t.validations.push(this._getNamePrefixValidator(e)),t}}O.\u0275fac=function(e){return new(e||O)(n.LFG(g.sK),n.LFG(R.CustomEventService))},O.\u0275prov=n.Yz7({token:O,factory:O.\u0275fac});var Pe=u(31177),Xe=u(88659),je=u(14813),We=u(69403),et=u(87241),tt=u(5490),nt=u(54882),at=u(6729),it=u(14360),st=u(95411);function ot(o,e){if(o&1&&(n.TgZ(0,"mat-option",12),n._uU(1),n.ALo(2,"translate"),n.qZA()),o&2){const t=e.$implicit,a=n.oxw();n.Q6J("value",t),n.xp6(1),n.Oqu(n.lcZ(2,2,"SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueTypes."+a.defValueSources[t]))}}function rt(o,e){if(o&1){const t=n.EpF();n.TgZ(0,"button",17),n.NdJ("click",function(){n.CHM(t);const i=n.oxw(2);return n.KtG(i.openSelectSysSettingDialog())}),n._UZ(1,"mat-icon",18),n.qZA()}}function lt(o,e){o&1&&n._UZ(0,"mat-icon",19)}function ut(o,e){if(o&1&&(n.TgZ(0,"mat-form-field",13)(1,"mat-label"),n._uU(2),n.ALo(3,"translate"),n.qZA(),n._UZ(4,"input",14),n.YNc(5,rt,2,0,"button",15),n.YNc(6,lt,1,0,"mat-icon",16),n.qZA()),o&2){const t=n.oxw();n.xp6(2),n.Oqu(n.lcZ(3,4,"SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueTypes.Settings")),n.xp6(2),n.Q6J("value",t.selectedValue.valueSource),n.xp6(1),n.Q6J("ngIf",!t.readOnly),n.xp6(1),n.Q6J("ngIf",t.readOnly)}}function ct(o,e){if(o&1&&(n.TgZ(0,"mat-option",22),n._uU(1),n.qZA()),o&2){const t=e.$implicit;n.Q6J("value",t.value),n.xp6(1),n.Oqu(t.displayValue)}}function dt(o,e){if(o&1){const t=n.EpF();n.TgZ(0,"mat-form-field",13)(1,"mat-label"),n._uU(2),n.ALo(3,"translate"),n.qZA(),n.TgZ(4,"mat-select",20),n.NdJ("valueChange",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.selectedValue.valueSource=i)}),n.YNc(5,ct,2,2,"mat-option",21),n.qZA()()}if(o&2){const t=n.oxw();n.xp6(2),n.Oqu(n.lcZ(3,4,"SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueTypes.SystemValue")),n.xp6(2),n.Q6J("value",t.selectedValue.valueSource)("disabled",t.readOnly),n.xp6(1),n.Q6J("ngForOf",t.sysVariables)}}function mt(o,e){if(o&1){const t=n.EpF();n.TgZ(0,"ts-entity-column-value-input",23),n.NdJ("ngModelChange",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.constValue=i)}),n.ALo(1,"translate"),n.qZA()}if(o&2){const t=n.oxw();n.Q6J("column",t.entitySchemaColumn)("label",n.lcZ(1,4,"SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueDialog.ValueCaption"))("ngModel",t.constValue)("disabled",t.readOnly)}}function ht(o,e){o&1&&n._UZ(0,"mat-icon",19)}function pt(o,e){o&1&&n._UZ(0,"mat-icon",19)}function gt(o,e){if(o&1){const t=n.EpF();n.ynx(0),n.TgZ(1,"mat-form-field",13)(2,"mat-label"),n._uU(3),n.ALo(4,"translate"),n.qZA(),n.TgZ(5,"input",24),n.NdJ("ngModelChange",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.sequencePrefix=i)}),n.qZA(),n.YNc(6,ht,1,0,"mat-icon",16),n.qZA(),n.TgZ(7,"mat-form-field",13)(8,"mat-label"),n._uU(9),n.ALo(10,"translate"),n.qZA(),n.TgZ(11,"ts-number-input",25),n.NdJ("ngModelChange",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.sequenceNumberOfChars=i)}),n.qZA(),n.YNc(12,pt,1,0,"mat-icon",16),n.qZA(),n.BQk()}if(o&2){const t=n.oxw();n.xp6(3),n.Oqu(n.lcZ(4,8,"SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueDialog.sequencePrefix")),n.xp6(2),n.Q6J("ngModel",t.sequencePrefix)("disabled",t.readOnly),n.xp6(1),n.Q6J("ngIf",t.readOnly),n.xp6(3),n.Oqu(n.lcZ(10,10,"SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueDialog.sequenceNumberOfChars")),n.xp6(2),n.Q6J("ngModel",t.sequenceNumberOfChars)("disabled",t.readOnly),n.xp6(1),n.Q6J("ngIf",t.readOnly)}}class ee{get displayedDefValueSources(){return this._displayedDefValueSources}get sysVariables(){return this._sysVariables}get entitySchemaColumn(){return this._dialogData.column}get constValue(){return this._constValue}set constValue(e){switch(this._constValue=e,this.entitySchemaColumn.dataValueType){case s.DataValueType.Lookup:this.selectedValue.value=e?.value;break;case s.DataValueType.Date:case s.DataValueType.Time:case s.DataValueType.DateTime:this.selectedValue.value=(0,s.toLocalISOString)(e);break;default:this.selectedValue.value=e}}get sequencePrefix(){return this._sequencePrefix}set sequencePrefix(e){this._sequencePrefix=e,this.selectedValue.sequencePrefix=e}get sequenceNumberOfChars(){return this._sequenceNumberOfChars}set sequenceNumberOfChars(e){this._sequenceNumberOfChars=e,this.selectedValue.sequenceNumberOfChars=e}get readOnly(){return this._dialogData.readOnly}constructor(e,t,a,i,l,c,m,B){this._dialogData=e,this._lookupDialogService=t,this._entitySchemaDesignerApiService=a,this._maskService=i,this._entitySchemaService=l,this._restErrorHandler=c,this._queryExecutor=m,this._translateService=B,this._sysSettingsSchemaUId="27AEADD6-D508-4572-8061-5B55B667C902",this._sysSettingValueTypeBlobName="Binary",this._constDataValueTypes=[s.DataValueType.Boolean,s.DataValueType.Lookup,s.DataValueType.Text,s.DataValueType.SHORT_TEXT,s.DataValueType.PHONE_TEXT,s.DataValueType.WEB_TEXT,s.DataValueType.EMAIL_TEXT,s.DataValueType.MEDIUM_TEXT,s.DataValueType.LONG_TEXT,s.DataValueType.MAXSIZE_TEXT,s.DataValueType.Color,s.DataValueType.RICH_TEXT].concat(d.wQM.DateTime).concat(d.wQM.Number),this._autonumberDataValueTypes=[s.DataValueType.Text,s.DataValueType.SHORT_TEXT,s.DataValueType.MEDIUM_TEXT,s.DataValueType.LONG_TEXT,s.DataValueType.MAXSIZE_TEXT],this._colorValueTypes=[s.DataValueType.SHORT_TEXT,s.DataValueType.MEDIUM_TEXT],this._floatValueTypes=[s.DataValueType.FLOAT1,s.DataValueType.FLOAT2,s.DataValueType.FLOAT3,s.DataValueType.FLOAT4,s.DataValueType.FLOAT8,s.DataValueType.Money],this.defValueSources=s.DefaultValueSource,this.selectedValue=(0,Pe.Z)(e.value),this._initDisplayedDefValueSources(),this._initSequenceValues(),this._maskService.showBodyMask(),(0,be.D)([this._initSysVariables(),this._initConstValue()]).pipe((0,tt.x)(()=>this._maskService.hideBodyMask())).subscribe()}_initSequenceValues(){var e,t;const a=this._dialogData.value;a?.valueSourceType===s.DefaultValueSource.Sequence&&(this._sequencePrefix=(e=a.sequencePrefix)!==null&&e!==void 0?e:"",this._sequenceNumberOfChars=(t=a.sequenceNumberOfChars)!==null&&t!==void 0?t:C.N8)}_initDisplayedDefValueSources(){const e=Object.keys(s.DefaultValueSource).map(t=>s.DefaultValueSource[t]).filter(t=>typeof t=="number");this._constDataValueTypes.includes(this.entitySchemaColumn.dataValueType)||e.splice(e.indexOf(s.DefaultValueSource.Const),1),this._autonumberDataValueTypes.includes(this.entitySchemaColumn.dataValueType)||e.splice(e.indexOf(s.DefaultValueSource.Sequence),1),this._displayedDefValueSources=e}_getEmptyObservable(){return new et.y(e=>{e.next(),e.complete()})}_initSysVariables(){const e=d.aG7[this.entitySchemaColumn.dataValueType];return Boolean(e&&e.id)&&(!this.readOnly||this.selectedValue.valueSourceType===s.DefaultValueSource.SystemValue)?this._entitySchemaDesignerApiService.getSystemValues(e.id).pipe((0,S.U)(a=>{this._sysVariables=a.items})):(this._sysVariables=[],this._getEmptyObservable())}_getEntitySchema(){return this._restErrorHandler.handleRequest(this._entitySchemaService.getEntitySchemaByUId(this.entitySchemaColumn.referenceSchemaUId)).pipe((0,S.U)(e=>e.entitySchema))}_getConstLookupDisplayValue(){const e=new s.EntitySchemaQuery(this.entitySchemaColumn.referenceSchemaName),t="DisplayValue";return e.addMacrosFunctionColumn(s.QueryMacrosType.PrimaryDisplayColumn,t),e.filters.add(new s.CompareFilter(s.ComparisonType.Equal,new s.MacrosFunctionExpression({macrosType:s.QueryMacrosType.PrimaryColumn}),new s.ParameterExpression({value:this._dialogData.value.value}))),this._queryExecutor.executeSelectQuery(e).pipe((0,S.U)(a=>{const i=a[0];if(i)return i[t];{const l="SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueDialog.LookupValueRecordDeletedCaption";return`(${this._translateService.instant(l)})`}}))}_initConstLookupValue(){return this._getEntitySchema().pipe((0,S.U)(e=>Boolean(e.getPrimaryDisplayColumn())),(0,nt.z)(e=>e?this._getConstLookupDisplayValue():(0,T.of)(null)),(0,S.U)(e=>{this._constValue={value:this._dialogData.value.value,displayValue:e}}))}_initConstValue(){const e=this._dialogData.value;let t=this._getEmptyObservable();return!e||e.valueSourceType!==s.DefaultValueSource.Const||(this.entitySchemaColumn.dataValueType===s.DataValueType.Lookup?t=this._initConstLookupValue():d.wQM.DateTime.includes(this.entitySchemaColumn.dataValueType)?this._constValue=(0,d.sGo)(e.value):this._constValue=e.value),t}_createSysSettingsTypeFilter(){const e=this.entitySchemaColumn,t=e.dataValueType,a=d.aG7[t],i=this._getValueTypeNamesForSysSettingsTypeFilter(),l=new s.FilterGroup;return l.addSchemaColumnInFilterWithParameters(s.ComparisonType.Equal,"ValueTypeName",i),a.type===s.DataValueType.Lookup&&e.referenceSchemaUId&&l.addSchemaColumnFilterWithParameter(s.ComparisonType.Equal,"ReferenceSchemaUId",e.referenceSchemaUId),l}_getValueTypeNamesForSysSettingsTypeFilter(){let t=this.entitySchemaColumn.dataValueType;return this._floatValueTypes.indexOf(t)!==-1&&(t=s.DataValueType.Float),t===s.DataValueType.Blob?[this._sysSettingValueTypeBlobName]:t===s.DataValueType.Color?this._colorValueTypes.map(i=>d.aG7[i].name):[d.aG7[t].name]}defValueTypeChanged(){d.wQM.Number.includes(this.entitySchemaColumn.dataValueType)&&this.selectedValue.valueSourceType===s.DefaultValueSource.Const?(this.selectedValue.value=0,this._constValue=0):(this.selectedValue.value="",this._constValue=null),this.selectedValue.valueSourceType===s.DefaultValueSource.Sequence?this.sequenceNumberOfChars=C.N8:this.sequenceNumberOfChars=0,this.sequencePrefix="",this.selectedValue.valueSource=""}openSelectSysSettingDialog(){const e={entitySchema:this._sysSettingsSchemaUId,displayedColumns:["Name","Code"],filter:this._createSysSettingsTypeFilter()};this._lookupDialogService.open(e).subscribe(t=>{t.selectedRecord&&(this.selectedValue.valueSource=t.selectedRecord.Code)})}isCurrentValueValid(){const e=this.selectedValue.valueSourceType;if([s.DefaultValueSource.Settings,s.DefaultValueSource.SystemValue].includes(e))return Boolean(this.selectedValue.valueSource);if(e===s.DefaultValueSource.Sequence)return!0;const t=this.selectedValue.value;return e===s.DefaultValueSource.None||Boolean(t)||t===!1||t===0}}ee.\u0275fac=function(e){return new(e||ee)(n.Y36(Y.eJ),n.Y36(r.FCr),n.Y36(C.WK),n.Y36(_.Bm),n.Y36(d.t1w),n.Y36(d.ZsW),n.Y36(We.oq),n.Y36(g.sK))},ee.\u0275cmp=n.Xpm({type:ee,selectors:[["ts-entity-column-default-value-dialog"]],decls:24,vars:21,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["floatLabel","always",1,"default-value-type-field"],["mat-basic","","disableOptionCentering","","required","",3,"value","disabled","valueChange","selectionChange"],["class","default-value-type-select-option",3,"value",4,"ngFor","ngForOf"],[1,"default-value-field-wrapper"],["floatLabel","always",4,"ngIf"],["required","",3,"column","label","ngModel","disabled","ngModelChange",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions",""],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"],["mat-flat-button","","color","primary",3,"mat-dialog-close","disabled"],[1,"default-value-type-select-option",3,"value"],["floatLabel","always"],["matInput","","type","text","disabled","",3,"value"],["class","lookup-button","matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],["matSuffix","","svgIcon","read-only",4,"ngIf"],["matSuffix","","mat-icon-button","",1,"lookup-button",3,"click"],["svgIcon","search"],["matSuffix","","svgIcon","read-only"],["mat-basic","","disableOptionCentering","","required","",3,"value","disabled","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["required","",3,"column","label","ngModel","disabled","ngModelChange"],["matInput","","type","text",3,"ngModel","disabled","ngModelChange"],[3,"ngModel","disabled","ngModelChange"]],template:function(e,t){e&1&&(n.TgZ(0,"div",0)(1,"div")(2,"span"),n._uU(3),n.ALo(4,"translate"),n.qZA()()(),n.TgZ(5,"div",1)(6,"mat-form-field",2)(7,"mat-label"),n._uU(8),n.ALo(9,"translate"),n.qZA(),n.TgZ(10,"mat-select",3),n.NdJ("valueChange",function(i){return t.selectedValue.valueSourceType=i})("selectionChange",function(){return t.defValueTypeChanged()}),n.YNc(11,ot,3,4,"mat-option",4),n.qZA()(),n.TgZ(12,"div",5),n.YNc(13,ut,7,6,"mat-form-field",6),n.YNc(14,dt,6,6,"mat-form-field",6),n.YNc(15,mt,2,6,"ts-entity-column-value-input",7),n.YNc(16,gt,13,12,"ng-container",8),n.qZA()(),n.TgZ(17,"div",9)(18,"button",10),n._uU(19),n.ALo(20,"translate"),n.qZA(),n.TgZ(21,"button",11),n._uU(22),n.ALo(23,"translate"),n.qZA()()),e&2&&(n.xp6(3),n.Oqu(n.lcZ(4,13,"SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueDialog.Title")),n.xp6(5),n.Oqu(n.lcZ(9,15,"SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueDialog.ValueTypeCaption")),n.xp6(2),n.Q6J("value",t.selectedValue.valueSourceType)("disabled",t.readOnly),n.xp6(1),n.Q6J("ngForOf",t.displayedDefValueSources),n.xp6(2),n.Q6J("ngIf",t.selectedValue.valueSourceType===t.defValueSources.Settings),n.xp6(1),n.Q6J("ngIf",t.selectedValue.valueSourceType===t.defValueSources.SystemValue),n.xp6(1),n.Q6J("ngIf",t.selectedValue.valueSourceType===t.defValueSources.Const),n.xp6(1),n.Q6J("ngIf",t.selectedValue.valueSourceType===t.defValueSources.Sequence),n.xp6(3),n.hij(" ",n.lcZ(20,17,"SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueDialog.Cancel")," "),n.xp6(2),n.Q6J("mat-dialog-close",t.selectedValue)("disabled",!t.isCurrentValueValid()),n.xp6(1),n.hij(" ",n.lcZ(23,19,"SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueDialog.Ok")," "))},dependencies:[at.j,v.sg,v.O5,h.Fj,h.JJ,h.Q7,h.On,z.Hw,it.f,Y.aO,Y.YS,Y.Rb,Y.ev,X.eB,G.v_,G.$V,G.nX,ge.x8,st.CK,ce.k0,g.X$],styles:["[_nghost-%COMP%]{width:360px;box-sizing:border-box}[mat-dialog-content][_ngcontent-%COMP%]   .default-value-type-field[_ngcontent-%COMP%], [mat-dialog-content][_ngcontent-%COMP%]   .default-value-field-wrapper[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}[mat-dialog-content][_ngcontent-%COMP%]   .default-value-field-wrapper[_ngcontent-%COMP%]{margin-top:5px;min-height:57px}[mat-dialog-content][_ngcontent-%COMP%]   .default-value-field-wrapper[_ngcontent-%COMP%]   button[matsuffix][_ngcontent-%COMP%]{height:25px;width:25px}[mat-dialog-content][_ngcontent-%COMP%]   .default-value-field-wrapper[_ngcontent-%COMP%]   button[matsuffix][_ngcontent-%COMP%]   mat-icon[svgicon=search][_ngcontent-%COMP%]{height:16px;width:16px}[mat-dialog-actions][_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-end}"]});var Ct=u(5998);function yt(o,e){if(o&1){const t=n.EpF();n.TgZ(0,"button",4),n.NdJ("click",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.openPickValueDialog())}),n._UZ(1,"mat-icon",5),n.qZA()}}function ft(o,e){o&1&&n._UZ(0,"mat-icon",6)}class q{get _value(){return this._formGroup.controls[this._fieldConfig.name].value}set _value(e){this._formGroup.controls[this._fieldConfig.name].setValue(e),this._setDisplayValue(e)}get lookupFormControl(){return this._formGroup.controls.lookup}get label(){return this._fieldConfig.label}get displayValue(){return this._displayValue}constructor(e,t,a,i,l,c){this._dialogService=e,this._translateService=t,this._fieldConfig=a,this._formGroup=i,this._matIconRegistry=l,this._domSanitizer=c,this._subscriptions=new je.w0,this._registerIcons(),this._setDisplayValue(this._value),this._initEntitySchemaColumn(),this._subscribeOnReferenceSchemaChange(),this._subscribeDefaultValueChange()}_registerIcons(){["entity-column-pick-default-value-icon"].forEach(e=>{this._matIconRegistry.addSvgIconLiteral(e,this._domSanitizer.bypassSecurityTrustHtml(u(13408)("./"+e+".svg")))})}_setDisplayValue(e){const t=e?e.valueSourceType:s.DefaultValueSource.None,l=`SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DefaultValueTypes.${s.DefaultValueSource[t]}`,c=this._translateService.instant(l);this._displayValue=`(${c})`}_initEntitySchemaColumn(){const e=this._fieldConfig.model,t=new d.Buv;t.name=e.name,t.dataValueType=e.dataValueType;const a=e.referenceSchema;if(t.referenceSchemaName=a?.name,t.referenceSchemaUId=a?.uId,t.isLookupType){const i=this.lookupFormControl.value;i&&(t.referenceSchemaName=i.name,t.referenceSchemaUId=i.value)}this._entitySchemaColumn=t}_resetValue(){this._value={valueSourceType:s.DefaultValueSource.None}}_subscribeOnReferenceSchemaChange(){const e=this._entitySchemaColumn;!e.isLookupType||this._subscriptions.add(this.lookupFormControl.valueChanges.subscribe(t=>{t?.value!==e.referenceSchemaUId&&this._resetValue(),e.referenceSchemaName=t?.name,e.referenceSchemaUId=t?.value}))}_subscribeDefaultValueChange(){const e=this._formGroup.controls[this._fieldConfig.name];this._subscriptions.add(e.valueChanges.subscribe(t=>this._setDisplayValue(t)))}canPickValue(){const e=this._entitySchemaColumn;return!e.isLookupType||Boolean(e.referenceSchemaUId)}openPickValueDialog(){this._dialogService.open(ee,{data:{value:this._value,readOnly:Boolean(this._fieldConfig.disabled),column:this._entitySchemaColumn}}).pipe((0,F.h)(e=>Boolean(e))).subscribe(e=>this._value=e)}ngOnDestroy(){this._subscriptions.unsubscribe()}}q.\u0275fac=function(e){return new(e||q)(n.Y36(_.xA),n.Y36(g.sK),n.Y36(r.aCx),n.Y36(h.cw),n.Y36(z.jv),n.Y36(Ct.H7))},q.\u0275cmp=n.Xpm({type:q,selectors:[["ts-entity-column-default-value-picker"]],features:[n._Bn([{provide:Xe.Eo,useExisting:q}])],decls:7,vars:5,consts:[["floatLabel","always"],["matInput","","type","text",3,"disabled","value"],["matSuffix","","mat-icon-button","",3,"click",4,"ngIf","ngIfElse"],["readonlyIcon",""],["matSuffix","","mat-icon-button","",3,"click"],["svgIcon","entity-column-pick-default-value-icon"],["matSuffix","","svgIcon","read-only"]],template:function(e,t){if(e&1&&(n.TgZ(0,"mat-form-field",0)(1,"mat-label"),n._uU(2),n.qZA(),n._UZ(3,"input",1),n.YNc(4,yt,2,0,"button",2),n.YNc(5,ft,1,0,"ng-template",null,3,n.W1O),n.qZA()),e&2){const a=n.MAs(6);n.xp6(2),n.Oqu(t.label),n.xp6(1),n.Q6J("disabled",!0)("value",t.displayValue),n.xp6(1),n.Q6J("ngIf",t.canPickValue())("ngIfElse",a)}},dependencies:[v.O5,z.Hw,X.eB,G.v_,G.$V,G.nX,ce.k0],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]   button[matsuffix][_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;top:3px}mat-form-field[_ngcontent-%COMP%]   button[matsuffix][_ngcontent-%COMP%]   [svgicon=entity-column-pick-default-value-icon][_ngcontent-%COMP%]{height:16px;width:16px;display:block}"]});class w extends O{constructor(e,t,a){super(e,t),this._entityFormsManagerService=a}get translationPrefix(){return"SchemaDesigners.EntitySchemaDesigner.ColumnEditor"}static _isForeignColumnColumn(e){return e.isForeignColumn}_createOption(e,t){return{name:this.translateService.instant(e),value:t}}_getDataValueTypeOption(e){const t=d.aG7[e];return this._createOption(t.translateKey,t.type)}_getDataValueTypesToOptions(e){return e.map(t=>this._getDataValueTypeOption(t))}_getRequirementTypeOption(e){const t=C.BX[e],i=`SchemaDesigners.EntitySchemaDesigner.ColumnEditor.RequirementType.${t.name}Caption`;return this._createOption(i,t.type)}_getRequirementTypeOptions(){return[C.TL.NO,C.TL.YES].map(e=>this._getRequirementTypeOption(e))}_getUsageTypeOptions(){return[d.Qif.General,d.Qif.Advanced,d.Qif.None].map(e=>this._getUsageTypeOption(e))}_getUsageTypeOption(e){const t=d.BX6[e],a=`SchemaDesigners.EntitySchemaDesigner.ColumnEditor.UsageType.${t.name}Caption`;return this._createOption(a,t.type)}isReplacementColumn(e){return e.isReplacementColumn}getDefValueControlConfig(e){return{name:"defValue",type:r.C2W.Custom,component:q,label:this.getTranslation("GeneralGroup.DefaultValueCaption"),disabled:e.isDisabled,model:e}}getIsValueCloneableControlConfig(){return r.D9$.createCheckBoxFieldConfig({name:"isValueCloneable",label:this.getTranslation("GeneralGroup.CanMakeCopyCaption")})}getRequiredControlConfig(){return r.D9$.createSelectFieldConfig({name:"requirementType",label:this.getTranslation("GeneralGroup.RequiredCaption"),options:this._getRequirementTypeOptions()})}getDescriptionControlConfig(e){return r.D9$.createLocalizableTextFieldConfig({name:"description",label:this.getTranslation("GeneralGroup.DescriptionCaption"),disabled:this.isReplacementColumn(e)})}getTypeControlConfig(e){return r.D9$.createSelectFieldConfig({name:"dataValueType",label:this.getTranslation("GeneralGroup.DataTypeCaption"),options:this._getDataValueTypesToOptions(e)})}getNameControlConfig(e){const t=w._isForeignColumnColumn(e),a=super.createNameControl(t?"":e.columnNamePrefix);return a.disabled=t,a}getCaptionControlConfig(){return r.D9$.createLocalizableTextFieldConfig({name:"caption",label:this.getTranslation("GeneralGroup.TitleCaption"),validations:[{message:this.getTranslation("Validations.RequiredNameCaption"),name:"required",validator:h.kI.required}]})}addBehaviorSection(e,t){r.D9$.addField(t,this.getBehaviorSectionConfig(e))}getBehaviorSectionConfig(e){return{name:r.zKh.Behavior,label:this.getTranslation("BehaviorGroup.Caption"),type:r.C2W.FieldsGroup,children:[r.D9$.createCheckBoxFieldConfig({name:"indexed",label:this.getTranslation("BehaviorGroup.IndexedCaption"),disabled:this.isReplacementColumn(e)}),r.D9$.createCheckBoxFieldConfig({name:"isTrackChangesInDB",label:this.getTranslation("BehaviorGroup.UpdateChangeLogCaption")}),r.D9$.createCheckBoxFieldConfig({name:"isSensitiveData",label:this.getTranslation("BehaviorGroup.SensitiveDataCaption")}),r.D9$.createSelectFieldConfig({name:"usageType",label:this.getTranslation("BehaviorGroup.UsageModeCaption"),options:this._getUsageTypeOptions()})]}}addGeneralSection(e,t){r.D9$.addField(t,{name:r.zKh.General,label:this.getTranslation("GeneralGroup.Caption"),type:r.C2W.FieldsGroup,children:[...this.getGeneralGroupControls(e)]})}convertToFormModel(e,t){return(0,Pe.Z)(e)}getElementModel(e,t){const a=t.schema,i=a.isReadOnly,c=t.schema.isReadOnly||e.isForeignColumn?"":t.schemaNamePrefix;return{...this.convertToFormModel(e,a),isDisabled:i,dataValueType:e.type,isForeignColumn:e.isForeignColumn,isReplacementColumn:e.isReplacementColumn,columnNamePrefix:c,validationConfig:{maxColumnNameLength:50,maxColumnCaptionLength:50,schemaNamePrefix:"",schemaColumnsNames:[],isInherited:e.isInherited}}}getFields(e){const t=super.getFields(e);return this.addGeneralSection(e,t),this.addBehaviorSection(e,t),t}getModel(e){return this._entityFormsManagerService.modelEntity.pipe((0,S.U)(t=>this.getElementModel(e,t)))}}var _t=u(54121),Oe=u(79676);class y{constructor(){this._modelEntity=new _t.X(null)}get modelEntity(){return this._modelEntity.asObservable().pipe((0,Oe.P)(e=>Boolean(e&&e.schema)))}setFormModel(e){this._modelEntity.next(e)}}y.\u0275fac=function(e){return new(e||y)},y.\u0275prov=n.Yz7({token:y,factory:y.\u0275fac});class P extends w{constructor(e,t,a){super(e,t,a)}static _getLookupElementModel(e,t){return{uId:e?.uId||null,caption:e?.name||null,allowEdit:t}}static _getCanChangeReferenceSchema(e,t){return!(e||t===s.DataValueType.IMAGELOOKUP)}convertToFormModel(e,t){const a=super.convertToFormModel(e,t);return a.canChangeReferenceSchema=P._getCanChangeReferenceSchema(e.isReplacementColumn,e.type),a.referenceSchemaConfig=P._getLookupElementModel(a.referenceSchema,e.isOwnColumn||t?.isParentVirtual),a}getGeneralGroupControls(e){return[super.getNameControlConfig(e),super.getCaptionControlConfig(),super.getDescriptionControlConfig(e),super.getRequiredControlConfig(),super.getDefValueControlConfig(e),super.getIsValueCloneableControlConfig()]}}P.\u0275fac=function(e){return new(e||P)(n.LFG(g.sK),n.LFG(R.CustomEventService),n.LFG(y))},P.\u0275prov=n.Yz7({token:P,factory:P.\u0275fac});class U extends w{constructor(e,t,a){super(e,t,a)}_getIsMultiLineTextControlConfig(e){return r.D9$.createCheckBoxFieldConfig({name:"isMultiLineText",label:this.getTranslation("GeneralGroup.IsMultiLineTextCaption"),disabled:this.isReplacementColumn(e)})}_getIsLocalizableTextControlConfig(){return r.D9$.createCheckBoxFieldConfig({name:"isLocalizableText",label:this.getTranslation("GeneralGroup.IsLocalizableTextCaption")})}_getIsMaskedControlConfig(e){return r.D9$.createCheckBoxFieldConfig({name:"isMasked",label:this.getTranslation("GeneralGroup.IsMaskedCaption"),disabled:this.isReplacementColumn(e)||e.type===s.DataValueType.PHONE_TEXT})}_getIsFormatValidatedControlConfig(e){return r.D9$.createCheckBoxFieldConfig({name:"isFormatValidated",label:this.getTranslation("GeneralGroup.IsFormatValidationCaption")})}getGeneralGroupControls(e){return[super.getNameControlConfig(e),super.getCaptionControlConfig(),super.getDescriptionControlConfig(e),super.getRequiredControlConfig(),super.getDefValueControlConfig(e),super.getIsValueCloneableControlConfig(),this._getIsMultiLineTextControlConfig(e),this._getIsLocalizableTextControlConfig(),this._getIsMaskedControlConfig(e),this._getIsFormatValidatedControlConfig(e)]}}U.\u0275fac=function(e){return new(e||U)(n.LFG(g.sK),n.LFG(R.CustomEventService),n.LFG(y))},U.\u0275prov=n.Yz7({token:U,factory:U.\u0275fac});class L extends w{constructor(e,t,a){super(e,t,a)}getGeneralGroupControls(e){return[super.getNameControlConfig(e),super.getCaptionControlConfig(),super.getDescriptionControlConfig(e),super.getRequiredControlConfig(),super.getDefValueControlConfig(e),super.getIsValueCloneableControlConfig()]}}L.\u0275fac=function(e){return new(e||L)(n.LFG(g.sK),n.LFG(R.CustomEventService),n.LFG(y))},L.\u0275prov=n.Yz7({token:L,factory:L.\u0275fac});class Z extends w{constructor(e,t,a){super(e,t,a)}getGeneralGroupControls(e){return[super.getNameControlConfig(e),super.getCaptionControlConfig(),super.getTypeControlConfig([s.DataValueType.Boolean]),super.getDescriptionControlConfig(e),super.getDefValueControlConfig(e),super.getIsValueCloneableControlConfig()]}}Z.\u0275fac=function(e){return new(e||Z)(n.LFG(g.sK),n.LFG(R.CustomEventService),n.LFG(y))},Z.\u0275prov=n.Yz7({token:Z,factory:Z.\u0275fac});class H extends w{constructor(e,t,a){super(e,t,a)}getGeneralGroupControls(e){return[super.getNameControlConfig(e),super.getCaptionControlConfig(),super.getDescriptionControlConfig(e),super.getRequiredControlConfig(),super.getIsValueCloneableControlConfig()]}}H.\u0275fac=function(e){return new(e||H)(n.LFG(g.sK),n.LFG(R.CustomEventService),n.LFG(y))},H.\u0275prov=n.Yz7({token:H,factory:H.\u0275fac});class b extends O{get translationPrefix(){return"SchemaDesigners.EntitySchemaDesigner.EventsEditor"}constructor(e,t,a){super(e,t),this.translateService=e,this.customEventService=t,this.entityFormsManagerService=a}static getEventFormGroupName(e){return`${e}Event`}static getEventNameFieldName(e){return`${e}EventName`}_createEventFields(e,t){const a=[{name:e.code,disabled:t.isReadOnly,type:r.C2W.CheckBox,value:e.hasEventHandler,label:this.getTranslation(`Events.${e.code}`),validations:[]}];return e.hasEventHandler&&a.push({name:b.getEventNameFieldName(e.code),value:`${t.entityName}${e.code}`,disabled:!0,type:r.C2W.Input,validations:[]}),a}_createEventsGroup(e,t,a,i){r.D9$.addField(i,{name:r.zKh.General,label:this.getTranslation(t),type:r.C2W.FieldsGroup,children:a.events.events.filter(l=>l.groupType===e).map(l=>({name:b.getEventFormGroupName(l.code),type:r.C2W.FormGroup,nestedItems:this._createEventFields(l,a)}))})}getFields(e){const t=[];return this._createEventsGroup(C.U.Add,"EventGroupType.Add",e,t),this._createEventsGroup(C.U.Saving,"EventGroupType.Saving",e,t),this._createEventsGroup(C.U.Updating,"EventGroupType.Updating",e,t),this._createEventsGroup(C.U.Delete,"EventGroupType.Delete",e,t),this._createEventsGroup(C.U.Loading,"EventGroupType.Loading",e,t),t}getModel(){return this.entityFormsManagerService.modelEntity.pipe((0,Oe.P)(e=>Boolean(e)),(0,S.U)(e=>{const t=e.schema;return{...t.events.eventsCodes,events:t.events,entityName:t.name,isReadOnly:t.isReadOnly,validationConfig:{}}}))}}b.\u0275fac=function(e){return new(e||b)(n.LFG(g.sK),n.LFG(R.CustomEventService),n.LFG(y))},b.\u0275prov=n.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"});var St=u(44350),vt=u(67023);class te extends r.fSA{constructor(e){super(),this._translateService=e}onSortOrderChanged(e){this.setValue(e.value)}getSelectMenuConfig(){return{options:[{value:d.REs.Asc,caption:this._translateService.instant("OrderDirectionStrict.Ascending")},{value:d.REs.Desc,caption:this._translateService.instant("OrderDirectionStrict.Descending")}]}}}te.\u0275fac=function(e){return new(e||te)(n.Y36(g.sK))},te.\u0275cmp=n.Xpm({type:te,selectors:[["ts-entity-index-column-sort-order-table-cell"]],features:[n.qOj],decls:1,vars:3,consts:[[3,"config","value","disabled","valueChange"]],template:function(e,t){e&1&&(n.TgZ(0,"ts-select-menu",0),n.NdJ("valueChange",function(i){return t.setValue(i)}),n.qZA()),e&2&&n.Q6J("config",t.getSelectMenuConfig())("value",t.record==null?null:t.record.orderDirection)("disabled",t.record==null?null:t.record.isReadOnly)},dependencies:[vt.d],encapsulation:2,changeDetection:0});var Tt=u(41867),Dt=u(78464);function It(o,e){o&1&&n._UZ(0,"ts-mask")}function Et(o,e){o&1&&(n.TgZ(0,"div",11)(1,"span"),n._uU(2),n.ALo(3,"translate"),n.qZA()()),o&2&&(n.xp6(2),n.Oqu(n.lcZ(3,1,"SchemaDesigners.EntitySchemaDesigner.IndexEditor.IndexColumns.Blankslate")))}class he extends C.eR{static create(e,t,a=!1){const i=new he;return Object.assign(i,t),Object.assign(i,e),i.isReadOnly=a,i}}class ne extends r.POq{get _indexColumns(){return this._indexModel.columns||[]}get isReadOnly(){return this._isReadOnly}constructor(e,t,a,i,l){super(),this.dialogService=e,this.translateService=t,this._fieldConfig=a,this._formGroup=i,this._destroyed$=new fe.x,this._resourcePrefix="SchemaDesigners.EntitySchemaDesigner.IndexEditor.IndexColumns",this._entitySchemaColumnDataSchema={columns:[{name:"caption",caption:this.translateService.instant(`${this._resourcePrefix}.TitleCaption`),valueType:s.DataValueType.LOCALIZABLE_STRING}]},this._addEntitySchemaColumnDataSchema={columns:this._entitySchemaColumnDataSchema.columns.concat({name:"name",caption:this.translateService.instant(`${this._resourcePrefix}.ColumnName`),valueType:s.DataValueType.Text})},this.userCulture=l.cultureInfo.sysCultureName,this._indexModel=a.model.index,this._allColumns=a.model.columns,this._isReadOnly=Boolean(a.model.isDisabled),this.dataSchema=this._getDataSchema()}_getDataSchema(){const e=this._entitySchemaColumnDataSchema.columns.concat({name:"orderDirection",caption:this.translateService.instant(`${this._resourcePrefix}.SortingOrder`),cellComponentClass:te});return this._isReadOnly||e.push(new r.OxE({name:"dragDropIcon"},"drag-drop"),{name:"delete",cellComponentClass:r.xox}),{columns:e,rowCssClass:"index-columns-detail-row"}}_setValueToForm(){this._formGroup.controls[this._fieldConfig.name].setValue(this._indexModel.columns)}createTableDataSource(){return new r.o6y}getAvailableColumns(e){return this._allColumns.filter(t=>e.find(a=>a.columnUId===t.uId)==null).map(t=>he.create({uId:(0,s.generateGuid)(),columnUId:t.uId,orderDirection:d.REs.Asc},t,this._isReadOnly))}openAddColumnDialog(){return this.dialogService.open(r.iQ4,{data:{title:this.translateService.instant(`${this._resourcePrefix}.AddIndexColumnsDialogCaption`),dataSchema:this._addEntitySchemaColumnDataSchema,data:this.getAvailableColumns(this.data),sortColumn:"caption",searchColumns:["name",e=>e.caption.getValue(this.userCulture)]}}).pipe((0,W.R)(this._destroyed$))}ngOnInit(){this.data=this._indexColumns.map(e=>{const t=this._allColumns.find(a=>a.uId===e.columnUId);return he.create(e,t,this._isReadOnly)}),super.ngOnInit()}getDetailEventHandlers(){const e={};return this._isReadOnly||(e.delete={click:this.onDeleteRow.bind(this)}),e}onDeleteRow(e){super.onDeleteRow(e);const t=this._indexModel.columns.findIndex(a=>a.columnUId===e.columnUId);t!==-1&&(this._indexModel.columns.splice(t,1),this._formGroup.controls[this._fieldConfig.name].setValue(this._indexModel.columns))}addColumns(){this.openAddColumnDialog().pipe((0,F.h)(e=>e!=null),(0,J.b)(e=>{this.onAddRows(...e)}),(0,S.U)(e=>e.map(t=>{const a=new C.eR;return a.uId=t.uId,a.columnUId=t.columnUId,a.name=`IndexColumn_${t.name}`,a.orderDirection=d.REs.Asc,a}))).subscribe(e=>{this._indexModel.columns.push(...e),this._setValueToForm()})}onCellValueChange(e){const t=this._indexModel.columns.find(a=>a.columnUId===e.record.columnUId);t.orderDirection=e.record.orderDirection,this._setValueToForm()}onOrderChange(e){(0,St.bA)(this._indexModel.columns,e.prevIndex,e.newIndex),this._setValueToForm()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}}ne.\u0275fac=function(e){return new(e||ne)(n.Y36(_.xA),n.Y36(g.sK),n.Y36(r.aCx),n.Y36(h.cw),n.Y36(d.aoG))},ne.\u0275cmp=n.Xpm({type:ne,selectors:[["ts-index-columns-detail-form"]],features:[n.qOj],decls:18,vars:15,consts:[[4,"ngIf"],[1,"index-columns-detail"],[3,"expanded"],[1,"detail-wrapper"],[1,"detail-table-wrapper"],["detailTableWrapper",""],["headerSticky","true",1,"indexed-columns-detail",3,"dataSource","dataSchema","enableOrdering","dragBoundarySelector","eventHandlers","recordPositionChange","cellValueChange"],["class","detail-blank-slate",4,"ngIf"],[1,"detail-bottom-action"],["mat-button","",1,"default",3,"disabled","click"],["svgIcon","add-button"],[1,"detail-blank-slate"]],template:function(e,t){e&1&&(n.YNc(0,It,1,0,"ts-mask",0),n.TgZ(1,"mat-accordion",1)(2,"mat-expansion-panel",2)(3,"mat-expansion-panel-header")(4,"mat-panel-title"),n._uU(5),n.ALo(6,"translate"),n.qZA()(),n.TgZ(7,"div",3)(8,"div",4,5)(10,"ts-table",6),n.NdJ("recordPositionChange",function(i){return t.onOrderChange(i)})("cellValueChange",function(i){return t.onCellValueChange(i)}),n.qZA(),n.YNc(11,Et,4,3,"div",7),n.qZA(),n.TgZ(12,"div",8)(13,"button",9),n.NdJ("click",function(){return t.addColumns()}),n._UZ(14,"mat-icon",10),n.TgZ(15,"span"),n._uU(16),n.ALo(17,"translate"),n.qZA()()()()()()),e&2&&(n.Q6J("ngIf",t.isLoading),n.xp6(2),n.Q6J("expanded",!0),n.xp6(3),n.hij(" ",n.lcZ(6,11,"SchemaDesigners.EntitySchemaDesigner.IndexEditor.IndexColumns.Caption")," "),n.xp6(5),n.Q6J("dataSource",t.tableDataSource)("dataSchema",t.dataSchema)("enableOrdering",!t.isReadOnly)("dragBoundarySelector",".indexed-columns-detail")("eventHandlers",t.getDetailEventHandlers()),n.xp6(1),n.Q6J("ngIf",t.isEmpty()),n.xp6(2),n.Q6J("disabled",t.isReadOnly),n.xp6(3),n.Oqu(n.lcZ(17,13,"BaseTableDetail.Add")))},dependencies:[Tt.a,v.O5,z.Hw,Dt.g,X.eB,x.pp,x.ib,x.yz,x.yK,g.X$],encapsulation:2,changeDetection:0});class A extends O{get translationPrefix(){return"SchemaDesigners.EntitySchemaDesigner.IndexEditor"}constructor(e,t,a){super(e,t),this.translateService=e,this.customEventService=t,this.entityFormsManagerService=a}static _getIndexColumnDetailSection(e,t){r.D9$.addField(t,{name:"IndexColumnDetail",type:r.C2W.Custom,component:ne,model:{index:e.index,columns:e.columns,validationConfig:{},isDisabled:e.isDisabled}})}_getGeneralSection(e){r.D9$.addField(e,{name:r.zKh.General,label:this.getTranslation("GeneralGroup.Caption"),type:r.C2W.FieldsGroup,children:[r.D9$.createInputFieldConfig({name:"name",label:this.getTranslation("GeneralGroup.NameCaption"),validations:[{message:this.getTranslation("Validations.RequiredNameCaption"),name:"required",validator:h.kI.required},{message:this.getTranslation("Validations.PatternNameCaption"),name:"pattern",validator:h.kI.pattern(/^[a-zA-Z]+[a-zA-Z0-9._]*$/)}]}),r.D9$.createCheckBoxFieldConfig({name:"isUnique",label:this.getTranslation("GeneralGroup.UniqueCaption")})]})}getFields(e){const t=[];return this._getGeneralSection(t),A._getIndexColumnDetailSection(e,t),t}getModel(e){return this.entityFormsManagerService.modelEntity.pipe((0,S.U)(t=>{const a=t.schema;return{...e,index:e,columns:[...a.columns,...a.inheritedColumns],isDisabled:a.isReadOnly,validationConfig:{maxColumnNameLength:50,maxColumnCaptionLength:50,schemaNamePrefix:"",schemaColumnsNames:[],isInherited:!1}}}))}}A.\u0275fac=function(e){return new(e||A)(n.LFG(g.sK),n.LFG(R.CustomEventService),n.LFG(y))},A.\u0275prov=n.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"});var bt=u(26903);class I extends O{constructor(e,t,a,i){super(t,a),this.entityFormsManagerService=e,this.translateService=t,this.customEventService=a,this._entitySchemaDesignerApiService=i,this._baseEntityUId="1bab9dcf-17d5-49f8-9536-8e0064f1dce0",this._baseLookupEntityUId="11ab4bcb-9b23-4b6d-9c86-520fae925d75"}get _guidColumns(){const e=t=>t.type===s.DataValueType.Guid;return this._prepareOptionFromColumns(e)}get _imageColumns(){const e=[s.DataValueType.Image,s.DataValueType.IMAGELOOKUP],t=a=>e.includes(a.type);return this._prepareOptionFromColumns(t)}get _textColumns(){const e=[s.DataValueType.Text,s.DataValueType.SHORT_TEXT,s.DataValueType.PHONE_TEXT,s.DataValueType.WEB_TEXT,s.DataValueType.EMAIL_TEXT,s.DataValueType.MEDIUM_TEXT,s.DataValueType.LONG_TEXT],t=a=>e.includes(a.type);return this._prepareOptionFromColumns(t)}get _dateTimeColumns(){const e=t=>t.type===s.DataValueType.DateTime;return this._prepareOptionFromColumns(e)}get _lookupColumns(){const e=t=>t.type===s.DataValueType.Lookup;return this._prepareOptionFromColumns(e)}get translationPrefix(){return"SchemaDesigners.EntitySchemaDesigner.EntityEditor"}static _getNameOrNull(e){return e?.name||null}static _columnInfoMapper(e){return new Map([["modifiedOnColumn",e.modifiedOnColumn],["primaryColumn",e.primaryColumn],["primaryImageColumn",e.primaryImageColumn],["primaryColorColumn",e.primaryColorColumn],["primaryDisplayColumn",e.primaryDisplayColumn],["primaryOrderColumn",e.primaryOrderColumn],["hierarchyColumn",e.hierarchyColumn],["ownerColumn",e.ownerColumn],["masterRecordColumn",e.masterRecordColumn],["createdByColumn",e.createdByColumn],["createdOnColumn",e.createdOnColumn],["modifiedByColumn",e.modifiedByColumn]])}static _convertParentSchemaToAutocompleteModel(e){return e==null?null:{name:e.name,value:e.uId}}static _getParentSchemaKey(){return"parentSchema"}_moveSchemaItemToBeginning(e,t){const a=e.findIndex(l=>l.value.toLowerCase()===t);if(a<1)return;const i=e[a];e.splice(a,1),e.unshift(i)}_getParentEntitySchemas(e,t,a,i=!1){return t?(0,T.of)([]):this._entitySchemaDesignerApiService.getAvailableParentSchemas(a,i).pipe((0,bt.B)(),(0,S.U)(l=>{const c=l.items.filter(m=>m.uId!==e).map(m=>({name:m.name,value:m.uId}));return this._moveSchemaItemToBeginning(c,this._baseLookupEntityUId),this._moveSchemaItemToBeginning(c,this._baseEntityUId),c}))}_prepareOptionFromColumns(e){return(e?this._columns.filter(e):this._columns).map(a=>this._convertToOption(a))}_addGeneralSection(e,t){r.D9$.addField(e,{name:r.zKh.General,label:this.getTranslation("GeneralGroup.Caption"),type:r.C2W.FieldsGroup,children:[this.createNameControl(t),this._createTitleControl(),this._createPackageControl(),this._createDescriptionControl()]})}_createDescriptionControl(){return r.D9$.createLocalizableTextFieldConfig({name:"description",label:this.getTranslation("GeneralGroup.DescriptionCaption")})}_createPackageControl(){return{name:"package",type:r.C2W.FormGroup,nestedItems:[r.D9$.createInputFieldConfig({name:"name",label:this.getTranslation("GeneralGroup.PackageCaption"),disabled:!0})]}}_createTitleControl(){return r.D9$.createLocalizableTextFieldConfig({name:"caption",label:this.getTranslation("GeneralGroup.TitleCaption"),validations:[{message:this.getTranslation("Validations.RequiredNameCaption"),name:"required",validator:h.kI.required}]})}_addObjectSettingsSection(e){const t={name:r.zKh.ObjectSettings,label:this.getTranslation("ObjectSettings.Caption"),type:r.C2W.FieldsGroup,children:[r.D9$.createAutocompleteFieldConfig({name:"primaryColumn",label:this.getTranslation("ObjectSettings.IdCaption"),options:this._guidColumns,validations:[{message:this.getTranslation("Validations.RequiredNameCaption"),name:"required",validator:h.kI.required}]}),r.D9$.createAutocompleteFieldConfig({name:"primaryImageColumn",label:this.getTranslation("ObjectSettings.ImageCaption"),options:this._imageColumns}),r.D9$.createAutocompleteFieldConfig({name:"primaryColorColumn",label:this.getTranslation("ObjectSettings.ColorCaption"),options:this._colorColumns}),r.D9$.createAutocompleteFieldConfig({name:"primaryDisplayColumn",label:this.getTranslation("ObjectSettings.DisplayedValueCaption"),options:this._textColumns}),r.D9$.createAutocompleteFieldConfig({name:"hierarchyColumn",label:this.getTranslation("ObjectSettings.ParentInHierarchyCaption"),options:this._lookupColumns}),r.D9$.createAutocompleteFieldConfig({name:"ownerColumn",label:this.getTranslation("ObjectSettings.OwnerCaption"),options:this._lookupColumns}),r.D9$.createInputFieldConfig({name:"trackChangesSchemaName",label:this.getTranslation("ObjectSettings.ChangeLogObjectNameCaption")}),r.D9$.createInputFieldConfig({name:"rightSchemaName",label:this.getTranslation("ObjectSettings.PermissionObjectNameCaption")}),r.D9$.createInputFieldConfig({name:"localizationSchemaName",label:this.getTranslation("ObjectSettings.LocalizationObjectNameCaption")})]};r.D9$.addField(e,t)}_addInheritanceSection(e,t){r.D9$.addField(t,{name:r.zKh.Inheritance,label:this.getTranslation("InheritanceGroup.Caption"),type:r.C2W.FieldsGroup,children:[r.D9$.createAutocompleteFieldConfig({name:"parentSchema",label:this.getTranslation("InheritanceGroup.ParentObjectCaption"),options:this._getParentEntitySchemas(e.uId,e.isDisabled,e.packageUId,e.useFullHierarchy||!1),validations:e.extendParent?[{message:this.getTranslation("Validations.RequiredNameCaption"),name:"required",validator:h.kI.required}]:[]}),{name:"extendParent",disabled:!0,type:r.C2W.CheckBox,label:this.getTranslation("InheritanceGroup.ExtendParent")}]})}_addBehaviorSection(e){r.D9$.addField(e,{name:r.zKh.Behavior,label:this.getTranslation("BehaviorGroup.Caption"),type:r.C2W.FieldsGroup,children:[r.D9$.createCheckBoxFieldConfig({name:"isDBView",label:this.getTranslation("BehaviorGroup.isDBViewCaption")}),r.D9$.createCheckBoxFieldConfig({name:"isSSPAvailable",label:this.getTranslation("BehaviorGroup.isSSPAvailable")}),r.D9$.createCheckBoxFieldConfig({name:"isVirtual",label:this.getTranslation("BehaviorGroup.isVirtualCaption")}),r.D9$.createCheckBoxFieldConfig({name:"useRecordDeactivation",label:this.getTranslation("BehaviorGroup.useRecordDeactivationCaption")}),r.D9$.createCheckBoxFieldConfig({name:"useLiveEditing",label:this.getTranslation("BehaviorGroup.useLiveEditingCaption")}),r.D9$.createCheckBoxFieldConfig({name:"isTrackChangesInDB",label:this.getTranslation("BehaviorGroup.isTrackChangesInDBCaption")}),r.D9$.createCheckBoxFieldConfig({name:"showInAdvancedMode",label:this.getTranslation("BehaviorGroup.showInAdvancedModeCaption")})]})}_addAccessRight(e){r.D9$.addField(e,{name:r.zKh.AccessRights,label:this.getTranslation("AccessRights.Caption"),type:r.C2W.FieldsGroup,children:[r.D9$.createCheckBoxFieldConfig({name:"administratedByOperations",label:this.getTranslation("AccessRights.OperationsCaption")}),r.D9$.createCheckBoxFieldConfig({name:"administratedByRecords",label:this.getTranslation("AccessRights.RecordsCaption")}),r.D9$.createCheckBoxFieldConfig({name:"administratedByColumns",label:this.getTranslation("AccessRights.ColumnsCaption")}),r.D9$.createAutocompleteFieldConfig({name:"masterRecordColumn",label:this.getTranslation("AccessRights.MasterRecordCaption"),options:this._lookupColumns})]})}_addHistoryColumns(e){const t=this._lookupColumns,a=this._dateTimeColumns;r.D9$.addField(e,{name:r.zKh.HistoryColumns,label:this.getTranslation("HistoryColumns.Caption"),type:r.C2W.FieldsGroup,children:[r.D9$.createAutocompleteFieldConfig({name:"createdByColumn",label:this.getTranslation("HistoryColumns.CreatedByCaption"),options:t}),r.D9$.createAutocompleteFieldConfig({name:"createdOnColumn",label:this.getTranslation("HistoryColumns.CreatedOnCaption"),options:a}),r.D9$.createAutocompleteFieldConfig({name:"modifiedByColumn",label:this.getTranslation("HistoryColumns.ModifiedByCaption"),options:t}),r.D9$.createAutocompleteFieldConfig({name:"modifiedOnColumn",label:this.getTranslation("HistoryColumns.ModifiedOnCaption"),options:a})]})}_getAutocompleteModel(e){return{value:e?.uId||null,name:e?this.getCaptionValue(e.caption):null}}_convertToOption(e){return{name:e.caption.getValue(this.translateService.currentLang),value:e.uId}}_convertToFormModel(e){var t;const a=e.clone();a.package={name:I._getNameOrNull(e.package)},a.packageUId=(t=e.package)===null||t===void 0?void 0:t.uId;const i=I._getParentSchemaKey();return a[i]=I._convertParentSchemaToAutocompleteModel(e.parentSchema),I._columnInfoMapper(e).forEach((c,m)=>{a[m]=this._getAutocompleteModel(c)}),a}get _colorColumns(){const e=[s.DataValueType.Color],t=a=>e.includes(a.type);return this._prepareOptionFromColumns(t)}getFields(e){var t;const a=super.getFields(e);return this._columns=[...e.columns,...e.inheritedColumns],this._addGeneralSection(a,(t=e.validationConfig)===null||t===void 0?void 0:t.schemaNamePrefix),this._addInheritanceSection(e,a),this._addObjectSettingsSection(a),this._addBehaviorSection(a),this._addAccessRight(a),this._addHistoryColumns(a),a}getModel(e){const t=e.extendParent||e.isReadOnly;return this.entityFormsManagerService.modelEntity.pipe((0,S.U)(a=>{const i=a.schema;return{...this._convertToFormModel(i),isDisabled:i.isReadOnly,validationConfig:{maxColumnNameLength:50,maxColumnCaptionLength:50,schemaNamePrefix:t?"":a.schemaNamePrefix,schemaColumnsNames:[],isInherited:!1}}}))}}I.\u0275fac=function(e){return new(e||I)(n.LFG(y),n.LFG(g.sK),n.LFG(R.CustomEventService),n.LFG(C.WK))},I.\u0275prov=n.Yz7({token:I,factory:I.\u0275fac});var Ae=u(43340);class K extends r.YuO{get referenceSchemaList(){return(0,T.of)(this.availableSchemas)}constructor(e,t,a){super(t,a),this.availableSchemas=e,this._doNotControlIntegrityControlName="doNotControlIntegrity",this._typeControlName="dataValueType"}get isCascadeDisabled(){return this.model.isReplacementColumn}_setDataSourceEnabled(){const e=r.D9$.findFieldByName(this.fields,this.lookupControlName);e.disabled=!this.model.referenceSchemaConfig.allowEdit}_addDoNotControlIntegrityControl(){r.D9$.addFieldToGroup(this.fields,r.zKh.DataSource,r.D9$.createCheckBoxFieldConfig({name:this._doNotControlIntegrityControlName,label:this.translateService.instant("SchemaDesigners.EntitySchemaDesigner.ColumnEditor.DataSourceGroup.DoNotControlIntegrityCaption"),disabled:this.model.isReplacementColumn}),1)}_addDataValueTypeControl(){const e=this.model,t=e.dataValueType,a=[{name:this.translateService.instant(d.aG7[t].translateKey),value:d.aG7[t].type}],i=r.D9$.createSelectFieldConfig({name:this._typeControlName,label:this.translateService.instant("columnFormat"),value:t,options:a,disabled:e.isReplacementColumn});r.D9$.addFieldToGroup(this.fields,r.zKh.General,i,2)}ngOnInit(){super.ngOnInit(),this._addDataValueTypeControl(),this._addDoNotControlIntegrityControl()}}K.\u0275fac=function(e){return new(e||K)(n.Y36(de),n.Y36(g.sK),n.Y36(r.i7Y))},K.\u0275cmp=n.Xpm({type:K,selectors:[["ts-image-lookup-column-editor"]],features:[n.qOj],decls:1,vars:2,consts:[["tsMetaItemPropertiesPage","",3,"model","fields","formCreated"]],template:function(e,t){e&1&&(n.ynx(0,0),n.NdJ("formCreated",function(i){return t.onFormCreated(i)}),n.BQk()),e&2&&n.Q6J("model",t.model)("fields",t.fields)},dependencies:[Ae.b],encapsulation:2});class ae extends K{constructor(e,t,a){super(e,t,a),this.lookupControlValidations=[]}_disabledDataSource(){this.model.type===s.DataValueType.Guid&&r.D9$.findFieldByName(this.fields,r.zKh.DataSource).children.forEach(t=>{t.disabled=!0})}ngOnInit(){super.ngOnInit(),this._disabledDataSource()}}ae.\u0275fac=function(e){return new(e||ae)(n.Y36(de),n.Y36(g.sK),n.Y36(r.i7Y))},ae.\u0275cmp=n.Xpm({type:ae,selectors:[["ts-column-with-reference-editor"]],features:[n.qOj],decls:1,vars:2,consts:[["tsMetaItemPropertiesPage","",3,"model","fields","formCreated"]],template:function(e,t){e&1&&(n.ynx(0,0),n.NdJ("formCreated",function(i){return t.onFormCreated(i)}),n.BQk()),e&2&&n.Q6J("model",t.model)("fields",t.fields)},dependencies:[Ae.b],encapsulation:2});var xt=u(44799),Vt=u(40508),Pt=u(15748),Ot=u(65304),At=u(24996),Mt=u(76567),Ft=u(69880);const Rt=["rightPanelContainer"];function Nt(o,e){if(o&1){const t=n.EpF();n.TgZ(0,"button",18),n.NdJ("click",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.publish())}),n._uU(1),n.ALo(2,"translate"),n.qZA()}o&2&&(n.xp6(1),n.hij(" ",n.lcZ(2,1,"BasePageComponent.Publish")," "))}function Bt(o,e){if(o&1){const t=n.EpF();n.ynx(0),n.TgZ(1,"button",19)(2,"div",20),n.NdJ("click",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.onPublishWithoutCompilation(i))}),n._uU(3),n.ALo(4,"translate"),n.qZA(),n.TgZ(5,"div",21),n._UZ(6,"div",22),n.qZA()(),n.TgZ(7,"mat-menu",null,23)(9,"button",24),n.NdJ("click",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.publish())}),n._uU(10),n.ALo(11,"translate"),n.qZA()(),n.BQk()}if(o&2){const t=n.MAs(8);n.xp6(1),n.Q6J("matMenuTriggerFor",t),n.xp6(2),n.Oqu(n.lcZ(4,3,"BasePageComponent.Publish")),n.xp6(7),n.hij(" ",n.lcZ(11,5,"BasePageComponent.PublishAndCompile")," ")}}function Gt(o,e){if(o&1&&n._UZ(0,"ts-code-editor",25),o&2){const t=n.oxw();n.Q6J("text",t.sourceCode)("language",t.csharpLanguage)("readOnly",!0)}}const kt=function(o){return[o]};function wt(o,e){if(o&1){const t=n.EpF();n.TgZ(0,"crt-business-rule-edit",26),n.NdJ("businessRuleChanged",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.onBusinessRuleChanged(i))})("ruleChanged",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.onRuleChanged(i))}),n.qZA()}if(o&2){const t=n.oxw();n.Q6J("businessRule",t.businessRuleDesign)("isReadOnlyMode",t.isReadOnlyMode)("schemaUId",t.schemaInfo.schemaUId)("schemasInfo",n.VKq(6,kt,t.schemaInfo))("ruleConditionInfo",t.businessRuleConditionInfo)("allowDesignerMode",!0)}}function Ut(o,e){if(o&1){const t=n.EpF();n.TgZ(0,"crt-related-pages-designer",27),n.NdJ("changed",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.onRelatedPageChanged(i))})("createPage",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.onCreatePage(i))})("openPage",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.onOpenPage(i))}),n.ALo(1,"async"),n.qZA()}if(o&2){const t=n.oxw();n.Q6J("isReadOnlyMode",t.isReadOnlyMode)("relatedPagesConfig",n.lcZ(1,4,t.relatedPagesConfig))("createdPage",t.createdRelatedPage)("entityName",t.model.name)}}function Lt(o,e){if(o&1){const t=n.EpF();n.TgZ(0,"div",28)(1,"crt-entity-pages-designer",29),n.NdJ("changed",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.onRelatedPageChanged(i))})("createPage",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.onCreatePage(i))})("openPage",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.onOpenPage(i))}),n.ALo(2,"async"),n.qZA()()}if(o&2){const t=n.oxw();n.xp6(1),n.Q6J("isReadOnlyMode",t.isReadOnlyMode)("config",n.lcZ(2,2,t.entityPagesConfig))}}function Zt(o,e){if(o&1){const t=n.EpF();n.TgZ(0,"crt-timeline-schema-designer",30),n.NdJ("changed",function(i){n.CHM(t);const l=n.oxw();return n.KtG(l.onTimelineEntityChanged(i))}),n.ALo(1,"async"),n.qZA()}if(o&2){const t=n.oxw();n.Q6J("isReadOnlyMode",t.isReadOnlyMode)("timelineEntityConfig",n.lcZ(1,3,t.timelineEntityConfig))("schemaModel",t.model)}}function Ht(o,e){}const $t=function(o){return{"entity-schema-editor":o}};var D;(function(o){o[o.Description=0]="Description",o[o.Columns=1]="Columns",o[o.Indexes=2]="Indexes",o[o.Events=3]="Events",o[o.SourceCode=4]="SourceCode",o[o.Addon=5]="Addon"})(D||(D={}));class f extends p.qj{constructor(e,t,a){super(e),this._designerReadOnlyStructure=t,this._featureValues=a,this._translationPrefix="SchemaDesigners.EntitySchemaDesigner",this._changeParentMessageResourceKey="SchemaDesigners.BaseDesignerPage.ChangeParentSchemaMessage",this._deleteParentMessageResourceKey="SchemaDesigners.BaseDesignerPage.DeleteParentSchemaMessage",this._destroyed$=new fe.x,this._saveConfirmationDialogButtons={saveButton:{caption:"SchemaDesigners.EntitySchemaDesigner.SaveConfirmationDialog.Save",result:_.yG.Primary},doNotSaveButton:{caption:"SchemaDesigners.EntitySchemaDesigner.SaveConfirmationDialog.DoNotSave",result:_.yG.Secondary},cancelButton:{caption:"SchemaDesigners.EntitySchemaDesigner.SaveConfirmationDialog.Cancel",result:_.yG.Cancel}},this.showEntityPagesDesigner=!1,this.csharpLanguage=r.YpL.Csharp,this.showSourceCode=!1,this.showRelatedPages=!1,this.showTimelineEntity=!1,this._appInfoService=e.get(Ie.zz),this._workspaceOpenCreateDialogService=e.get(Te.S),this.showEntityPagesDesigner=!this._featureValues.DisableEntityPagesDesigner}get workspaceItemType(){return Ce.yG.EntitySchema}get modelType(){return C._Q}get apiDataService(){return this._apiDataService}get designerStructureService(){return this.model.isReadOnly?this._designerReadOnlyStructure:this._designerStructureService}get sourceCode(){const e=this.model.sourceCode;return this.isChanged?`// The source code will update after the object is saved\r
\r
${e}`:e}get relatedPagesConfig(){const e=this.model.addons.find(t=>t.addonName===d.nM_.RelatedPage);return e?.addonConfig}get entityPagesConfig(){return this.relatedPagesConfig.pipe((0,S.U)(e=>({metadata:e,schemaModel:this.model})))}get timelineEntityConfig(){const e=this.model.addons.find(t=>t.addonName===d.nM_.TimelineEntity);return e?.addonConfig}get canShowBusinessRules(){return this.showBusinessRules}static _columnEditorPageType(e){switch(!0){case e===s.DataValueType.Lookup:return K;case e===s.DataValueType.Guid:case e===s.DataValueType.IMAGELOOKUP:return ae;case e===s.DataValueType.Boolean:return r.VIe;case d.wQM.DateTime.includes(e):return r.ncu;case d.wQM.Number.includes(e):return r.sNc;default:return r.Yly}}static _getChangedReferenceSchema(e,t){return e.type===s.DataValueType.IMAGELOOKUP?e.referenceSchema:t?{uId:t.value,name:t.name}:null}static _getColumnChangedValues(e,t){const{name:a,dataValueType:i,lookup:l,...c}=t,m=f._getChangedReferenceSchema(e,l);return{...c,uId:e.uId,name:a===void 0?e.name:a,type:i||e.type,referenceSchema:m}}static _getColumnEditorService(e){switch(!0){case e===s.DataValueType.Lookup:case e===s.DataValueType.IMAGELOOKUP:case e===s.DataValueType.Guid:return P;case e===s.DataValueType.SHORT_TEXT:case e===s.DataValueType.PHONE_TEXT:case e===s.DataValueType.WEB_TEXT:case e===s.DataValueType.EMAIL_TEXT:case e===s.DataValueType.MEDIUM_TEXT:case e===s.DataValueType.LONG_TEXT:case e===s.DataValueType.RICH_TEXT:case e===s.DataValueType.MAXSIZE_TEXT:return U;case e===s.DataValueType.Boolean:return Z;case e===s.DataValueType.Text:case e===s.DataValueType.HASH_TEXT:case e===s.DataValueType.SECURE_TEXT:return H;default:return L}}static _processTextValue(e){return e||null}_initStyleClassNameMap(){this._styleClassNameMap=new Map([[D.Description,"description-entity-editor"],[D.Columns,"columns-entity-editor"],[D.Indexes,"indexes-entity-editor"],[D.Events,"events-entity-editor"],[D.SourceCode,"source-code-entity-editor"],[D.Addon,"addon-editor"]])}_metaItemPageChangeDetection(){this._metaItemPageChangeDetectorRef.detectChanges()}_createMetaItemPropertyPage(e,t,a){const i=this._createComponent(e);this.metaItemPropertiesPage=i.instance,this.metaItemPropertiesPage.model=t,this.metaItemPropertiesPage.fields=a,this._metaItemPageChangeDetectorRef=i.changeDetectorRef,this._metaItemPageChangeDetection()}_loadAvailableEntitySchemas(){if(this._availableSchemas||this.model.isReadOnly)return(0,T.of)(!0);const e=this.getUseFullHierarchy();return this._apiDataService.getAvailableReferenceSchemas(this.model.package.uId,e).pipe((0,M.w)(t=>{var a;return this._availableSchemas=((a=t?.items)===null||a===void 0?void 0:a.map(i=>({name:i.name,value:i.uId,allowEdit:!0})))||[],(0,T.of)(!0)}))}_createComponent(e){this.rightPanelContainer.clear();const t=n.zs3.create({providers:[{provide:de,useValue:this._availableSchemas}],parent:this.injector});return this.rightPanelContainer.createComponent(e,{injector:t})}_createRightPanel(e,t,a){this.showSourceCode=!1,this.showBusinessRules=!1,this.showRelatedPages=!1,this.showTimelineEntity=!1;const i=this.injector.get(t);i.getModel(a).pipe((0,W.R)(this.destroyed$)).subscribe(l=>{l.useFullHierarchy=this.getUseFullHierarchy();const c=i.getFields(l);this._createMetaItemPropertyPage(e,l,c)})}_openColumnProperties(e){const t=f._columnEditorPageType(e.type),a=f._getColumnEditorService(e.type);this._changeRightPanelClassName(D.Columns),this._createRightPanel(t,a,e),this._subscribeOnChanges(this._onColumnChanged.bind(this,e.uId))}_onColumnChanged(e,t){const a=this.model.findColumnByUId(e),i=f._getColumnChangedValues(a,t);a.update(i),this.updateStructureElementCaption(a.uId,a.name),this.setIsChanged()}_showEvents(){const e=this.model.events;this._changeRightPanelClassName(D.Events),this._createRightPanel(r.vZd,b,e),this._subscribeOnChanges(this._onEventsChanged.bind(this))}_onEventsChanged(e){const t=this.model.events,a=t.eventsCodes.map(i=>{const l=b.getEventFormGroupName(i),c=e[l];return{hasEventHandler:Boolean(c[i]),eventCode:i}});t.updateEvents(a),this.setIsChanged(),this._showEvents()}_openIndexProperties(e){this._changeRightPanelClassName(D.Indexes),this._createRightPanel(r.vZd,A,e),this._subscribeOnChanges(this._onIndexChanged.bind(this,e.uId))}_onIndexChanged(e,t){const a=this.model.findIndexByUId(e),i={uId:a.uId,name:t.name,isUnique:t.isUnique};a.updateDescription(i),this.updateStructureElementCaption(a.uId,t.name),this.setIsChanged()}_openSourceCode(){this._closeExistSubscription(),this.rightPanelContainer.clear(),this._changeRightPanelClassName(D.SourceCode),this.showSourceCode=!0,this.showBusinessRules=!1,this.showRelatedPages=!1}_deleteSchemaStructureElement(e,t){this.removeItemFromStructure({parentUId:e,uId:t}),this.setIsChanged()}_deleteIndex(e){const t=e.item.uId,a=e.item.parentUId;this.model.deleteIndexByUId(t),this._deleteSchemaStructureElement(a,t)}_deleteColumn(e){const t=e.item.uId,a=e.item.parentUId;this.model.deleteColumnByUId(t),this._deleteSchemaStructureElement(a,t)}_openEntityProperties(){const e=this.model;this._changeRightPanelClassName(D.Description),this._createRightPanel(r.vZd,I,e),this._subscribeOnChanges(this._onEntityPropertiesChanged.bind(this))}_subscribeOnChanges(e){this._closeExistSubscription(),!this.model.isReadOnly&&(this._valueChangedSubscription=this.metaItemPropertiesPage.valueChanged.pipe((0,W.R)(this.destroyed$)).subscribe(e))}_onEntityPropertiesChanged(e){if(this._isParentSchemaChange(e)){this._assignParentSchema(e.parentSchema.value,e.parentSchema.name);return}const t=this._getChangedProperties(e);this.model.updateDescription(t),this.setIsChanged()}_isParentSchemaChange(e){const t=e.parentSchema||{value:null};if(typeof t!="object")return!1;const a=this.model.parentSchema&&this.model.parentSchema.uId||null;return t.value!==a}_assignParentSchema(e,t){const a=e?this._changeParentMessageResourceKey:this._deleteParentMessageResourceKey;this.translateAsync(a).pipe((0,S.U)(i=>(0,d.WUZ)(i,[t])),(0,M.w)(i=>this.openConfirmationDialog(i)),(0,J.b)(i=>{i===_.rM.result&&this._openEntityProperties()}),(0,F.h)(i=>i===_.Zz.result),(0,J.b)(()=>this.showBodyMask()),(0,M.w)(()=>(this.model.useFullHierarchy=this.getUseFullHierarchy(),this._apiDataService.assignParentSchema(this.model,e))),(0,J.b)(i=>this._updateParentSchema(i)),(0,J.b)(()=>this.hideBodyMask()),(0,M.w)(i=>{var l;return i.success?(0,T.of)(void 0):this.openInfoDialog((l=i?.errorInfo)===null||l===void 0?void 0:l.message)})).subscribe(()=>{this._openEntityProperties()})}_updateParentSchema(e){e.success&&(this.model.updateDescription(e.schema),this.model.updateParentSchema(e.schema),this.updateSchemaStructure(),this.setIsChanged())}_findColumnByValue(e){return e?.value?this.model.findColumnByUId(e.value):null}_getChangedProperties(e){const{administratedByColumns:t,administratedByOperations:a,administratedByRecords:i,caption:l,description:c,isDBView:m,isSSPAvailable:B,useLiveEditing:le,isTrackChangesInDB:Jt,showInAdvancedMode:qt,isVirtual:Kt,localizationSchemaName:Qt,name:zt,rightSchemaName:Xt,trackChangesSchemaName:jt,useRecordDeactivation:Wt,masterRecordColumn:en,hierarchyColumn:tn,primaryImageColumn:nn,primaryColorColumn:an,primaryDisplayColumn:sn,ownerColumn:on,primaryOrderColumn:rn,createdByColumn:ln,createdOnColumn:un,modifiedByColumn:cn,modifiedOnColumn:dn,...mn}=e,hn=this._getChangedColumnProperties(mn),Me={uId:this.model.uId,administratedByColumns:t,administratedByOperations:a,administratedByRecords:i,caption:l,description:c,isDBView:m,isSSPAvailable:B,useLiveEditing:le,isTrackChangesInDB:Jt,showInAdvancedMode:qt,isVirtual:Kt,name:zt,localizationSchemaName:f._processTextValue(Qt),rightSchemaName:f._processTextValue(Xt),trackChangesSchemaName:f._processTextValue(jt),useRecordDeactivation:Wt,indexes:this.model.indexes,package:this.model.package,inheritedColumns:this.model.inheritedColumns,parentSchema:this.model.parentSchema,extendParent:this.model.extendParent,masterRecordColumn:this._findColumnByValue(en),hierarchyColumn:this._findColumnByValue(tn),primaryImageColumn:this._findColumnByValue(nn),primaryColorColumn:this._findColumnByValue(an),primaryDisplayColumn:this._findColumnByValue(sn),ownerColumn:this._findColumnByValue(on),primaryOrderColumn:this._findColumnByValue(rn),createdByColumn:this._findColumnByValue(ln),createdOnColumn:this._findColumnByValue(un),modifiedByColumn:this._findColumnByValue(cn),modifiedOnColumn:this._findColumnByValue(dn),...hn},Se=e.parentSchema||{value:null};return typeof Se=="object"&&(Me.parentSchema={uId:Se.value,name:Se.name}),Me}_getChangedColumnProperties(e){const t={};return Object.getOwnPropertyNames(e).forEach(a=>{const i=e[a],l=i?.value,c=this.model.findColumnByUId(l);c&&(t[a]=c)}),t}_closeExistSubscription(){this._valueChangedSubscription&&!this._valueChangedSubscription.closed&&this._valueChangedSubscription.unsubscribe()}_createIndex(){return this.setIsChanged(),this.model.createIndex()}_addIndex(e){const t=this._createIndex();this._createIndexSchemaStructureElement(e,t),this._openIndexProperties(t)}_showIndex(e){const t=this.model.findIndexByUId(e.item.uId);this._openIndexProperties(t)}_addColumnToSchemaStructure(e,t){const a=this._designerStructureService.createColumnStructureElement(e.item.uId,t);this.addNewItemIntoStructure(e,[a])}_createColumn(e){const t=this.getSchemaNamePrefix(),a=this.model.createColumn(e,t);if(e===s.DataValueType.IMAGELOOKUP){const i=this._availableSchemas.find(l=>l.name==="SysImage");a.referenceSchema={uId:i?.value,name:i?.name}}return a}_addColumns(e){const t=this._createColumn(e.menuItemType);this.setIsChanged(),this._addColumnToSchemaStructure(e,t),this._openColumnProperties(t)}_showColumn(e){const t=this.model.findColumnByUId(e.item.uId);this._openColumnProperties(t)}_createIndexSchemaStructureElement(e,t){const a=this._designerStructureService.createIndexStructureElement(e.item.uId,t);this.addNewItemIntoStructure(e,[a])}_changeRightPanelClassName(e){this.rightPanelClassName=this._styleClassNameMap.get(e)}_initActionHandlerMap(){this._setColumnsClickHandlers(),this._setInheritedColumnsClickHandlers(),this._setIndexesClickHandlers(),this._setEventsClickHandlers(),this._setSourceCodeClickHandlers()}_setSourceCodeClickHandlers(){const e=V.SourceCodeItemUId;this.setStructureClickHandler(e,p.AH.show,this._openSourceCode.bind(this))}_initRelatedPagesAddonActionsHandlers(e){e.addonName===d.nM_.RelatedPage&&this.setStructureClickHandler(e.id,p.AH.show,this._openRelatedPageSource.bind(this,e))}_initTimelineEntityAddonActionsHandlers(e){e.addonName===d.nM_.TimelineEntity&&this.setStructureClickHandler(e.id,p.AH.show,this._openTimelineEntitySource.bind(this,e))}_changePageTypeToAddon(){this._closeExistSubscription(),this.rightPanelContainer.clear(),this._changeRightPanelClassName(D.Addon),this.showSourceCode=!1}_openRelatedPageSource(e){this.relatedPagesCaption=this.translateInstant(`${this._translationPrefix}.Addons.RelatedPagesCaption`),this.showRelatedPages=!0,this.showBusinessRules=!1,this.showTimelineEntity=!1,this.currentAddon=e,this._changePageTypeToAddon()}_openTimelineEntitySource(e){this.showRelatedPages=!1,this.showBusinessRules=!1,this.showTimelineEntity=!0,this.currentAddon=e,this._changePageTypeToAddon()}_setEventsClickHandlers(){const e=this.model.events.uId;this.setStructureClickHandler(e,p.AH.show,this._showEvents.bind(this))}_setIndexesClickHandlers(){const e=this.model.indexes.uId;this.setStructureClickHandler(e,p.AH.add,this._addIndex.bind(this)),this.setStructureClickHandler(e,p.AH.show,this._showIndex.bind(this)),this.setStructureClickHandler(e,p.AH.delete,this._deleteIndex.bind(this))}_setInheritedColumnsClickHandlers(){const e=this.model.inheritedColumns.uId;this.setStructureClickHandler(e,p.AH.show,this._showColumn.bind(this))}_setColumnsClickHandlers(){const e=this.model.columns.uId;this.setStructureClickHandler(e,p.AH.add,this._addColumns.bind(this)),this.setStructureClickHandler(e,p.AH.show,this._showColumn.bind(this)),this.setStructureClickHandler(e,p.AH.delete,this._deleteColumn.bind(this))}_updateDBStructure(){let t=1;return this.restErrorHandler.handleRequest(this._workspaceStructureService.updateDBStructure([this.model.uId])).pipe(ke(a=>a.pipe((0,F.h)(i=>i.status===0),(0,we.g)(5e3*t++),(0,Ve.q)(3))))}_changeModelPackage(e){const t=this.getQueryParam(),a=t?.packageId,i=t?.packageName;(0,s.isGuid)(a)&&i&&(e.package.uId=a,e.package.name=i)}_saveNewWithConfirmation(e){const t=this.translateInstant(`${this._translationPrefix}.SaveConfirmationDialog.Message`);this._confirmSaveSchema(t,!1).pipe((0,F.h)(a=>a===this._saveConfirmationDialogButtons.saveButton.result),(0,M.w)(a=>this.save()),(0,F.h)(a=>a.success===!0),(0,M.w)(a=>this._selectPageTemplate(e)),(0,W.R)(this._destroyed$)).subscribe()}_openPage(e,t){this.window.open(e,t).focus()}_saveWithConfirmation(e,t){const a=this.translateInstant(`${this._translationPrefix}.SaveConfirmationDialog.Message`),{saveButton:i,doNotSaveButton:l}=this._saveConfirmationDialogButtons;this._confirmSaveSchema(a).pipe((0,F.h)(c=>c===i.result||c===l.result),(0,M.w)(c=>c===i.result?this.save().pipe((0,F.h)(m=>m.success===!0)):(0,T.of)(null)),(0,J.b)(c=>this._openPage(e,t)),(0,W.R)(this._destroyed$)).subscribe()}_selectPageTemplate(e){var t=this;return(0,De.Z)(function*(){const a=t.model.caption.getValue(t.userCulture),i=(0,se.QZ)(a,e),l={entitySchemaName:t.model.name,entitySchemaCaption:i};t.showEntityPagesDesigner||(l.callbackUrl=t._getRelatedPageCallbackUrl(e));const c=[t.model.package.uId,"true"],m=yield t._getAngularAppInfo(),B=t.showEntityPagesDesigner?d.nNh.Blank:d.nNh.Self;return t._workspaceOpenCreateDialogService.createSchema(m,c,l,B)})()}_getRelatedPageCallbackUrl(e){const t=this.router.parseUrl(this.location.path()),a=new oe.lo(t.root);this._applyDefaultQueryParams(a,t),this.showEntityPagesDesigner||this._applyRelatedPageQueryParams(a,e);const i=this.router.serializeUrl(a);return i==="/"?null:encodeURIComponent(`#${i}`)}_applyRelatedPageQueryParams(e,t){var a;e.queryParams.callbackAction=d.nM_.RelatedPage,t?.action&&(e.queryParams.callbackPageAction=t.action),!((a=t?.role)===null||a===void 0)&&a.value&&(e.queryParams.callbackPageRole=t.role.value)}_applyDefaultQueryParams(e,t){const a=["createdSchemaUId","callbackPageAction"];Object.entries(t.queryParams).forEach(([i,l])=>{!(0,Re.Z)(l)&&!a.includes(i)&&(e.queryParams[i]=l)})}_getAngularAppInfo(){return(0,Ne.z)(this._appInfoService.getAppsInfo().pipe((0,Ve.q)(1),(0,F.h)(e=>e.success),(0,S.U)(e=>e?.appsInfo.find(t=>t.name==="angular-schema"))))}_confirmSaveSchema(e,t=!0){const{saveButton:a,doNotSaveButton:i,cancelButton:l}=this._saveConfirmationDialogButtons,c=[l];return t&&c.unshift(i),this.dialogService.openConfirmationDialog({message:e,primaryButton:a,buttons:c})}_callbackActionHandler(e){var t;const a=e.addons,i=(t=this.activatedRoute.snapshot)===null||t===void 0?void 0:t.queryParamMap,l=i?.get("callbackAction");if(!a||!l)return;let c;switch(l){case d.nM_.RelatedPage:if(c=a.find(m=>m.addonName===d.nM_.RelatedPage),c){this._openRelatedPageSource(c);const m=i?.get("createdSchemaUId"),B=i?.get("callbackPageAction"),le=i?.get("callbackPageRole");m&&(this.createdRelatedPage={pageSchemaUId:m,action:B,roleId:le})}break;case d.nM_.BusinessRule:c=a.find(m=>m.addonName===d.nM_.BusinessRule),c&&c.addonConfig.subscribe(m=>{if(m.rules.length>0){const B=m.rules[0],le=c;this.openBusinessRuleAction(le,m,B.uId,!1)}});break}this.selectedAction=l}_getInterfaceDesignerUrl(){return`${this._appInfoService.getCurrentAppUrl()}InterfaceDesigner`}_buildBusinessRuleConditionInfo(e){const t=[];return[...this.model.columns,...this.model.inheritedColumns].forEach(l=>{const c=l.type;if(c===s.DataValueType.Color)return;let m;c===s.DataValueType.Lookup&&(m={name:l.referenceSchema.name,displayValue:l.referenceSchema.caption}),t.push({value:l.name,displayValue:l.caption.getValue(this.userCulture),dataValueType:l.type,path:l.name,referenceSchema:m})}),{data:this._businessRule7xConverterService.convertConditionTo7xFormat(e.getFirstCase().condition),pageSchema:{attributes:t,dataSources:[]}}}_getIsNeedGenerateCaption(e){const t=this.businessRuleDesign;return t&&this.businessRulesAddonMetadata.rules.find(i=>i.uId===t.uId)&&this.currentAddon.addonName===d.nM_.BusinessRule&&!e.caption.hasCultureValue(this.userCulture,!0)}_generateCaptionForLastSelectedRule(){const e=this.businessRuleDesign;if(this._getIsNeedGenerateCaption(e)){const t=this.currentAddon.resources.map(a=>{var i;return(i=a.value.find(l=>l.key===this.userCulture))===null||i===void 0?void 0:i.value});this._businessRulesCaptionGeneratorService.generate(e,this.schemaInfo,t).subscribe(a=>{e.caption=a,this.onBusinessRuleChanged(e)})}}_getRulesInvolvedInAction(e,t=!1){const a=this.businessRulesAddonMetadata.rules.find(l=>l.uId===e);return this.businessRulesAddonMetadata.rules.filter(l=>l.parentUId===e||l.uId===e||a.parentUId===l.uId).map(l=>{let c;return t&&l.uId===e?c=new d.CjD:c=(0,d.tWQ)(this.currentAddon.resources,l,this.userCulture),new Ee.H3(l,c,this.model.name,this.model.caption,Ee.tH.DataSource)})}_addSubRule(e){this.businessRulesAddonMetadata.rules.push(e.toMetadata()),this.currentAddon.addonConfig=(0,T.of)(this.businessRulesAddonMetadata),this.currentAddon.createOrUpdateResource({key:`${e.uId}.Caption`,value:e.caption.map(t=>({key:t.cultureName,value:t.value}))}),this.showChildRules&&(this.schemaDesignerStructureComponent.addNewItemIntoStructure(this.currentAddon.id,this.designerStructureService.createBusinessRuleStructureElement(e.toMetadata(),!1),!1),this.updateStructureElementCaption(e.uId,this.lczToStringPipe.transform(e.caption)),this.setBusinessRuleElementClickHandlers(this.currentAddon,this.businessRulesAddonMetadata,e.uId)),this.setIsChanged()}initAddonActionsHandlers(e){super.initAddonActionsHandlers(e),this._initRelatedPagesAddonActionsHandlers(e),this._initTimelineEntityAddonActionsHandlers(e)}canInitAddonActionHandlers(e){return(0,T.of)(!0)}openBusinessRuleAction(e,t,a,i){super.openBusinessRuleAction(e,t,a,i),this.showRelatedPages=!1,this.showTimelineEntity=!1,this._generateCaptionForLastSelectedRule();const l=this._getRulesInvolvedInAction(a,i);(0,j.E6)(l),this.businessRuleDesign=l.find(c=>c.uId===a),this.businessRuleConditionInfo=this._buildBusinessRuleConditionInfo(this.businessRuleDesign),this._changePageTypeToAddon()}removeBusinessRuleAction(e,t,a){super.removeBusinessRuleAction(e,t,a),this._changePageTypeToAddon(),this.businessRulesAddonMetadata.rules.filter(i=>i.parentUId===a).map(i=>i.uId).forEach(i=>this.removeBusinessRuleAction(e,t,i))}initEmptyAdditionalResources(){super.initEmptyAdditionalResources(),this._availableSchemas=[]}getAdditionalResourceQueries(){const e=super.getAdditionalResourceQueries();return e.push(this._loadAvailableEntitySchemas()),e}cloneModel(e){return e.clone()}getGtmSchemaName(){return"EntitySchemaDesignerPage"}injectDependencies(){super.injectDependencies(),this._designerStructureService=this.injector.get(E),this._entitySchemaFormsManagerService=this.injector.get(y),this._apiDataService=this.injector.get(C.WK),this._workspaceStructureService=this.injector.get(Ce.fr),this._businessRule7xConverterService=this.injector.get(j.vb),this._businessRulesCaptionGeneratorService=this.injector.get(j.Ct)}onModelSet(e){!this.isNewMode&&e?.package&&this._changeModelPackage(e),super.onModelSet(e),this.isModelLoaded&&(this._initActionHandlerMap(),this._callbackActionHandler(e))}onAdditionalResourcesLoaded(){super.onAdditionalResourcesLoaded(),this._entitySchemaFormsManagerService.setFormModel({schema:this.model,schemaNamePrefix:this.getSchemaNamePrefix()}),this.selectedAction||this._openEntityProperties()}getNeedEditDescription(){return!1}getRequestDataFromParameters(e){return{packageUId:e.packageId,extendParent:/^true$/i.test(e.extendParent)}}createTempDesignItem(e){const t=super.createTempDesignItem(e);return t.extendParent=/^true$/i.test(e.extendParent),t}onPublishFinished(e){return this.showCompilationErrors(e.errors),this._updateDBStructure().pipe((0,M.w)(t=>e?.success?this.onPublishSuccess(e,t.success):(this.hideBodyMask(),(0,T.of)(e))))}onRunODataBuildFinished(e,t){return this._updateDBStructure().pipe((0,M.w)(a=>(e.success&&t.success&&a.success&&this.showSuccessMessage(this.translateInstant("SchemaDesigners.BaseDesignerPage.PublishSuccessMessage")),this.hideBodyMask(),(0,T.of)(a))))}requestInitialPageData(){return(0,be.D)([super.requestInitialPageData(),this.featureService.getFeatureState("EntityPublishWithCompilation")]).pipe((0,J.b)(([e,t])=>this.entityPublishWithCompilation=t),(0,S.U)(([e])=>e))}applySaveUnsuccessfulResponse(e,t){super.applySaveUnsuccessfulResponse(e,t),this.isChanged=!1}getOpenDesignerEditModeUrl(){const e=this.getUseFullHierarchy(),t=this.model,a=[t.uId,t.package.uId,t.package.name,e.toString()],i=Ie.zz.getEntitySchemaDesignerOpenTemplate();return Ue.Ld.format(i,...a)}onRuleChanged(e){const t=this._getRulesInvolvedInAction(e.ruleUId);(0,j.C7)(e,{add:a=>this._addSubRule(a),update:a=>this.onBusinessRuleChanged(a),delete:a=>{this.removeBusinessRuleAction(this.currentAddon,this.businessRulesAddonMetadata,a),this.showBusinessRules=!0}},t,this.userInfo)}onBusinessRuleChanged(e){super.onBusinessRuleChanged(e),e.uId===this.businessRuleDesign.uId&&(this.businessRuleConditionInfo=this._buildBusinessRuleConditionInfo(e))}onStructureItemClick(e){switch(e.tag||p.AH.show){case p.AH.edit:{this._openEntityProperties();break}default:super.onStructureItemClick(e)}}onOpenEmbeddedProcessClick(){const e=(0,d.TIC)()+"/Nui/ViewModule.aspx?vm=SchemaDesigner#entityProcess/"+this.model.uId;this._openPage(e,d.nNh.Blank)}ngOnInit(){this._initStyleClassNameMap(),super.ngOnInit(),this.enableOpenMetaDataMenuItem()}ngOnDestroy(){super.ngOnDestroy(),this._destroyed$.next(),this._destroyed$.complete()}onPublishWithoutCompilation(e){e.stopPropagation(),this.publish(!0)}onRelatedPageChanged(e){const t=this.model.addons.find(a=>a.addonName===d.nM_.RelatedPage);t.addonConfig=(0,T.of)(e),this.setIsChanged()}onTimelineEntityChanged(e){const t=this.model.addons.find(a=>a.addonName===d.nM_.TimelineEntity);t.addonConfig=(0,T.of)(e),this.setIsChanged()}onOpenPage(e){const t=`${this._getInterfaceDesignerUrl()}/${e}`;if(this.isChanged){this._saveWithConfirmation(t,d.nNh.Blank);return}this._openPage(t,d.nNh.Blank)}onCreatePage(e){var t=this;return(0,De.Z)(function*(){if(t.isChanged){t._saveNewWithConfirmation(e);return}yield t._selectPageTemplate(e)})()}onSaveClicked(){this._generateCaptionForLastSelectedRule(),this.save().pipe((0,W.R)(this._destroyed$)).subscribe()}}f.\u0275fac=function(e){return new(e||f)(n.Y36(n.zs3),n.Y36(k),n.Y36(d.Sfm))},f.\u0275cmp=n.Xpm({type:f,selectors:[["ts-entity-schema-designer-page"]],viewQuery:function(e,t){if(e&1&&n.Gf(Rt,7,n.s_b),e&2){let a;n.iGM(a=n.CRH())&&(t.rightPanelContainer=a.first)}},features:[n.qOj],decls:21,vars:23,consts:[[1,"base-section-wrap"],[3,"saveButtonVisible","actionMenuItemsConfig","saveClick","cancelClick","closeClick"],["class","action-button","mat-button","",3,"click",4,"ngIf"],[4,"ngIf"],["mat-button","",1,"action-button",3,"disabled","click"],[1,"schema-designer-page"],[1,"schema-designer-structure-wrapper","pane"],[3,"dataSource","caption","isSearchEnabled","designerTypeCaptionImage","canSelectSchemaDescriptor","hideSchemaDescriptorActions","itemClick","itemActionClick"],[1,"schema-designer-page-main-content"],[1,"pane"],[1,"schema-designer-page-code-editor-wrapper",3,"ngClass"],[3,"text","language","readOnly",4,"ngIf"],[3,"businessRule","isReadOnlyMode","schemaUId","schemasInfo","ruleConditionInfo","allowDesignerMode","businessRuleChanged","ruleChanged",4,"ngIf"],[3,"isReadOnlyMode","relatedPagesConfig","createdPage","entityName","changed","createPage","openPage",4,"ngIf"],["class","entity-pages-designer-wrapper",4,"ngIf"],[3,"isReadOnlyMode","timelineEntityConfig","schemaModel","changed",4,"ngIf"],[3,"className"],["rightPanelContainer",""],["mat-button","",1,"action-button",3,"click"],["mat-button","",1,"action-button",3,"matMenuTriggerFor"],[3,"click"],[1,"mat-select-arrow-wrapper"],[1,"mat-select-arrow"],["publishMenu","matMenu"],["mat-menu-item","",3,"click"],[3,"text","language","readOnly"],[3,"businessRule","isReadOnlyMode","schemaUId","schemasInfo","ruleConditionInfo","allowDesignerMode","businessRuleChanged","ruleChanged"],[3,"isReadOnlyMode","relatedPagesConfig","createdPage","entityName","changed","createPage","openPage"],[1,"entity-pages-designer-wrapper"],[3,"isReadOnlyMode","config","changed","createPage","openPage"],[3,"isReadOnlyMode","timelineEntityConfig","schemaModel","changed"]],template:function(e,t){e&1&&(n.TgZ(0,"div",0)(1,"ts-schema-designer-page-header",1),n.NdJ("saveClick",function(){return t.onSaveClicked()})("cancelClick",function(){return t.cancel()})("closeClick",function(){return t.close()}),n.YNc(2,Nt,3,3,"button",2),n.YNc(3,Bt,12,7,"ng-container",3),n.TgZ(4,"button",4),n.NdJ("click",function(){return t.onOpenEmbeddedProcessClick()}),n._uU(5),n.ALo(6,"translate"),n.qZA()(),n.TgZ(7,"div",5)(8,"div",6)(9,"ts-schema-designer-structure",7),n.NdJ("itemClick",function(i){return t.onStructureItemClick(i)})("itemActionClick",function(i){return t.onStructureItemClick(i)}),n.qZA()(),n.TgZ(10,"div",8)(11,"div",9)(12,"div",10),n.YNc(13,Gt,1,3,"ts-code-editor",11),n.YNc(14,wt,1,8,"crt-business-rule-edit",12),n.YNc(15,Ut,2,6,"crt-related-pages-designer",13),n.YNc(16,Lt,3,4,"div",14),n.YNc(17,Zt,2,5,"crt-timeline-schema-designer",15),n.TgZ(18,"div",16),n.YNc(19,Ht,0,0,"ng-template",null,17,n.W1O),n.qZA()()()()()()),e&2&&(n.xp6(1),n.Q6J("saveButtonVisible",t.saveButtonVisible())("actionMenuItemsConfig",t.getActionsConfig()),n.xp6(1),n.Q6J("ngIf",t.entityPublishWithCompilation),n.xp6(1),n.Q6J("ngIf",!t.entityPublishWithCompilation),n.xp6(1),n.Q6J("disabled",t.isNewMode),n.xp6(1),n.hij(" ",n.lcZ(6,19,"SchemaDesigners.EntitySchemaDesigner.Actions.OpenEmbeddedProcess")," "),n.xp6(4),n.Q6J("dataSource",t.schemaStructure)("caption",t.model.name)("isSearchEnabled",t.isSearchEnabled)("designerTypeCaptionImage","entity-schema-caption-icon.svg")("canSelectSchemaDescriptor",!0)("hideSchemaDescriptorActions",!0),n.xp6(3),n.Q6J("ngClass",n.VKq(21,$t,!t.canShowBusinessRules)),n.xp6(1),n.Q6J("ngIf",t.showSourceCode),n.xp6(1),n.Q6J("ngIf",t.canShowBusinessRules),n.xp6(1),n.Q6J("ngIf",t.showRelatedPages&&!t.showEntityPagesDesigner),n.xp6(1),n.Q6J("ngIf",t.showRelatedPages&&t.showEntityPagesDesigner),n.xp6(1),n.Q6J("ngIf",t.showTimelineEntity),n.xp6(1),n.Q6J("className",t.rightPanelClassName))},dependencies:[xt.z,Vt.w,v.mk,v.O5,X.eB,ie.W0,ie.tN,ie.D8,Pt.h,Ot.a,At.J,Mt._,Ft.k,v.Ov,g.X$],encapsulation:2});const Yt=[{path:"",component:f},{path:"new",component:f},{path:":uId",component:f}];class ${}$.\u0275fac=function(e){return new(e||$)},$.\u0275mod=n.oAB({type:$}),$.\u0275inj=n.cJS({imports:[oe.Bz.forChild(Yt),oe.Bz]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.kYT($,{imports:[oe.Bz],exports:[oe.Bz]})}();var _e;let N=_e=class{constructor(e){this._injector=e,(0,s.bootstrapCrtModule)(_e,{moduleType:"host",resolveDependency:t=>this._injector.get(t)})}};N.\u0275fac=function(e){return new(e||N)(n.LFG(n.zs3))},N.\u0275mod=n.oAB({type:N}),N.\u0275inj=n.cJS({providers:[E,k,I,y,L,P,U,Z,H,A,b,r.Pnv,_.xA,Ce.W1,{provide:r.thQ,useValue:"EntitySchemaDesignerModule"},{provide:p.ZS,useClass:null},r.c64,r.i3c,Te.S,{provide:d.ngC,useClass:d.f5Y},{provide:d.ZsW,useClass:Fe.vH}],imports:[j.wt,r.kLW,r.Y05,v.ez,r.s41,_.Su,r.SSX,$,h.u5,r._yf,z.Ps,r.FN$,_._M,Y.yj,X.yu,ge.uw,ce.x4,ie.jT,G.wp,x.To,ve.Zh,h.UX,_.sm,p.Z_,C.so,g.aw,se.Cf,ye.MV_,se.bv]}),N=_e=(0,Q.gn)([(0,s.CrtModule)({includes:[r.kLW,ye.MV_]}),(0,Q.w6)("design:paramtypes",[n.zs3])],N),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.kYT(N,{declarations:[f,ne,te,ae,K,q,ee],imports:[j.wt,r.kLW,r.Y05,v.ez,r.s41,_.Su,r.SSX,$,h.u5,r._yf,z.Ps,r.FN$,_._M,Y.yj,X.yu,ge.uw,ce.x4,ie.jT,G.wp,x.To,ve.Zh,h.UX,_.sm,p.Z_,C.so,g.aw,se.Cf,ye.MV_,se.bv]})}()},94844:ue=>{ue.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 16 16"><defs/><g transform="translate(-2029.024 -118.517)"><path d="M2038.4,122.663l2.5,2.524-5.669,5.674L2032.6,128.3Z" style="fill: #8095b3;"/><path d="M2031.9,129.413l2.25,2.25-2.958.646Z" style="fill: #8095b3;"/><path d="M2039.4,122.038l2.021,2.125,1.375-1.271-2.021-2.062Z" style="fill: #8095b3;"/></g><rect width="16" height="16" style="fill: none;"/></svg>
`}}]);
