!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@creatio-devkit/common"));else if("function"==typeof define&&define.amd)define("@creatio/utils",["@creatio-devkit/common"],t);else{var r="object"==typeof exports?t(require("@creatio-devkit/common")):t(e["@creatio-devkit/common"]);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(self,(e=>(()=>{var t={223:(e,t,r)=>{"use strict";e.exports=r(138)},438:(e,t,r)=>{"use strict";var n,o,a,i=r(14),u="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",c=!0;function s(){a=!1}function l(e){if(e){if(e!==n){if(c&&e.length!==u.length)throw new Error("Custom alphabet for shortid must be "+u.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,r){return t!==r.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+u.length+" unique characters. These characters were not unique: "+t.join(", "));n=e,s()}}else n!==u&&(n=u,s())}function d(){return a||(a=function(){n||l(u);for(var e,t=n.split(""),r=[],o=i.nextValue();t.length>0;)o=i.nextValue(),e=Math.floor(o*t.length),r.push(t.splice(e,1)[0]);return r.join("")}())}e.exports={get:function(){return n||u},characters:function(e){return l(e),n},seed:function(e){i.seed(e),o!==e&&(s(),o=e)},lookup:function(e){return d()[e]},shuffled:d,setDefaults:function(e){e&&(c=!1)}}},470:(e,t,r)=>{"use strict";var n,o,a,i=r(357),u=(r(438),!0);e.exports={build:function(e){var t="";if(u){var r=Math.floor(.001*(Date.now()-1459707606518));return r===o?n++:(n=0,o=r),t+=i(6),t+=i(e),n>0&&(t+=i(n)),t+=i(r)}for(var c=0;c<a;c++)t+=i(6);return t},setDefaults:function(e){e.disableDefault&&(u=!1,a=e.configLength)}}},357:(e,t,r)=>{"use strict";var n=r(438),o=r(442),a=r(317);e.exports=function(e){for(var t,r=0,i="";!t;)i+=a(o,n.get(),1),t=e<Math.pow(16,r+1),r++;return i}},138:(e,t,r)=>{"use strict";var n=r(438),o=r(470),a=r(506),i=r(253)||0;function u(){return o.build(i)}e.exports=u,e.exports.generate=u,e.exports.seed=function(t){return n.seed(t),e.exports},e.exports.worker=function(t){return i=t,e.exports},e.exports.characters=function(e){return void 0!==e&&n.characters(e),n.shuffled()},e.exports.isValid=a,e.exports.config=function(e){if(e.disableDefaultAlphabetLength&&n.setDefaults(!0),e.disableDefaultIdLength){if(!e.idLength)throw"If you sets disableDefaultIdLength to true the parameter idLength is required";o.setDefaults({configLength:e.idLength,disableDefault:!0})}}},506:(e,t,r)=>{"use strict";var n=r(438);e.exports=function(e){return!(!e||"string"!=typeof e||e.length<6)&&!new RegExp("[^"+n.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)}},442:e=>{"use strict";var t,r="object"==typeof window&&(window.crypto||window.msCrypto);t=r&&r.getRandomValues?function(e){return r.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],r=0;r<e;r++)t.push(Math.floor(256*Math.random()));return t},e.exports=t},14:e=>{"use strict";var t=1;e.exports={nextValue:function(){return(t=(9301*t+49297)%233280)/233280},seed:function(e){t=e}}},253:e=>{"use strict";e.exports=0},317:e=>{e.exports=function(e,t,r){for(var n=(2<<Math.log(t.length-1)/Math.LN2)-1,o=-~(1.6*n*r/t.length),a="";;)for(var i=e(o),u=o;u--;)if((a+=t[i[u]&n]||"").length===+r)return a}},267:t=>{"use strict";t.exports=e}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}};return t[e](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{"use strict";n.r(o),n.d(o,{NavigationUtils:()=>Ne,UITypePriority:()=>xe});var e=n(267),t=Object.prototype;const r=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)};const a=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object);var i=Object.prototype.hasOwnProperty;const u=function(e){if(!r(e))return a(e);var t=[];for(var n in Object(e))i.call(e,n)&&"constructor"!=n&&t.push(n);return t};const c="object"==typeof global&&global&&global.Object===Object&&global;var s="object"==typeof self&&self&&self.Object===Object&&self;const l=c||s||Function("return this")();const d=l.Symbol;var g=Object.prototype,f=g.hasOwnProperty,p=g.toString,v=d?d.toStringTag:void 0;const m=function(e){var t=f.call(e,v),r=e[v];try{e[v]=void 0;var n=!0}catch(e){}var o=p.call(e);return n&&(t?e[v]=r:delete e[v]),o};var y=Object.prototype.toString;const h=function(e){return y.call(e)};var b=d?d.toStringTag:void 0;const S=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":b&&b in Object(e)?m(e):h(e)};const P=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const j=function(e){if(!P(e))return!1;var t=S(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const _=l["__core-js_shared__"];var w,M=(w=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||""))?"Symbol(src)_1."+w:"";const x=function(e){return!!M&&M in e};var A=Function.prototype.toString;const T=function(e){if(null!=e){try{return A.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var N=/^\[object .+?Constructor\]$/,O=Function.prototype,E=Object.prototype,D=O.toString,I=E.hasOwnProperty,F=RegExp("^"+D.call(I).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const V=function(e){return!(!P(e)||x(e))&&(j(e)?F:N).test(T(e))};const C=function(e,t){return null==e?void 0:e[t]};const k=function(e,t){var r=C(e,t);return V(r)?r:void 0};const q=k(l,"DataView");const U=k(l,"Map");const B=k(l,"Promise");const L=k(l,"Set");const R=k(l,"WeakMap");var $="[object Map]",G="[object Promise]",z="[object Set]",H="[object WeakMap]",W="[object DataView]",X=T(q),Y=T(U),J=T(B),K=T(L),Q=T(R),Z=S;(q&&Z(new q(new ArrayBuffer(1)))!=W||U&&Z(new U)!=$||B&&Z(B.resolve())!=G||L&&Z(new L)!=z||R&&Z(new R)!=H)&&(Z=function(e){var t=S(e),r="[object Object]"==t?e.constructor:void 0,n=r?T(r):"";if(n)switch(n){case X:return W;case Y:return $;case J:return G;case K:return z;case Q:return H}return t});const ee=Z;const te=function(e){return null!=e&&"object"==typeof e};const re=function(e){return te(e)&&"[object Arguments]"==S(e)};var ne=Object.prototype,oe=ne.hasOwnProperty,ae=ne.propertyIsEnumerable;const ie=re(function(){return arguments}())?re:function(e){return te(e)&&oe.call(e,"callee")&&!ae.call(e,"callee")};const ue=Array.isArray;const ce=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};const se=function(e){return null!=e&&ce(e.length)&&!j(e)};const le=function(){return!1};var de="object"==typeof exports&&exports&&!exports.nodeType&&exports,ge=de&&"object"==typeof module&&module&&!module.nodeType&&module,fe=ge&&ge.exports===de?l.Buffer:void 0;const pe=(fe?fe.isBuffer:void 0)||le;var ve={};ve["[object Float32Array]"]=ve["[object Float64Array]"]=ve["[object Int8Array]"]=ve["[object Int16Array]"]=ve["[object Int32Array]"]=ve["[object Uint8Array]"]=ve["[object Uint8ClampedArray]"]=ve["[object Uint16Array]"]=ve["[object Uint32Array]"]=!0,ve["[object Arguments]"]=ve["[object Array]"]=ve["[object ArrayBuffer]"]=ve["[object Boolean]"]=ve["[object DataView]"]=ve["[object Date]"]=ve["[object Error]"]=ve["[object Function]"]=ve["[object Map]"]=ve["[object Number]"]=ve["[object Object]"]=ve["[object RegExp]"]=ve["[object Set]"]=ve["[object String]"]=ve["[object WeakMap]"]=!1;const me=function(e){return te(e)&&ce(e.length)&&!!ve[S(e)]};const ye=function(e){return function(t){return e(t)}};var he="object"==typeof exports&&exports&&!exports.nodeType&&exports,be=he&&"object"==typeof module&&module&&!module.nodeType&&module,Se=be&&be.exports===he&&c.process,Pe=function(){try{var e=be&&be.require&&be.require("util").types;return e||Se&&Se.binding&&Se.binding("util")}catch(e){}}();var je=Pe&&Pe.isTypedArray;const _e=je?ye(je):me;var we=Object.prototype.hasOwnProperty;const Me=function(e){if(null==e)return!0;if(se(e)&&(ue(e)||"string"==typeof e||"function"==typeof e.splice||pe(e)||_e(e)||ie(e)))return!e.length;var t=ee(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(r(e))return!u(e).length;for(var n in e)if(we.call(e,n))return!1;return!0};var xe;!function(e){e.Auto="auto",e.PreferFreedomUI="freedom-ui"}(xe||(xe={}));var Ae=n(223);class Te{static initialize(){Ae.config({disableDefaultAlphabetLength:!0,disableDefaultIdLength:!0,idLength:7}),Ae.characters("0123456789abcdefghijklmnopqrstuvwxyz")}static generateUnique(e,t="",r="_"){const n=new RegExp(`^${t}`);return t+e.replace(n,"")+r+Ae.generate()}}Te.initialize();class Ne{static get angularSchemaType(){return Ne._angularSchemaType}static _getTypeColumnName(e){const t=Ne.getEntityStructure(e),r=null==t?void 0:t.pages.find((e=>e.typeColumnName));return null==r?void 0:r.typeColumnName}static async _getTypeColumnValue(t){var r,n;const{entityName:o,typeColumnValue:a}=t;if(a)return a;const i=Ne._getTypeColumnName(o),u=Ne.getRecordLookupValue(t.recordId);if(!i||!u)return null;const c=await e.Model.create(o),s=await c.load({attributes:[i],parameters:[{type:e.ModelParameterType.Filter,value:new e.CompareFilter(e.ComparisonType.Equal,new e.ColumnExpression({columnPath:"Id"}),new e.ParameterExpression({value:u}))}]});return null===(n=null===(r=null==s?void 0:s[0])||void 0===r?void 0:r[i])||void 0===n?void 0:n.value}static _getModuleStructureBySectionSchema(e){return Object.values(Terrasoft.configuration.ModuleStructure).find((t=>t.sectionSchema===e))}static _getSectionModuleName(e){var t;return null===(t=Ne._getModuleStructureBySectionSchema(e))||void 0===t?void 0:t.sectionModule}static _getSectionEditPageModuleName(e){const t=Object.values(Terrasoft.configuration.ModuleStructure).find((t=>{var r;return t.cardSchema===e||(null===(r=t.pages)||void 0===r?void 0:r.some((t=>t.cardSchema===e)))}));return null==t?void 0:t.cardModule}static _getSchemaRequire(e){return new Promise((t=>{Terrasoft.require([e],(e=>t(e)))}))}static async _isSchemaInheritedFrom(e,t){let r=Terrasoft.configuration.Structures[t];r||(await Ne._getSchemaRequire(t),r=Terrasoft.configuration.Structures[t]);const n=null==r?void 0:r.structureParent;return!!n&&(n===e||Ne._isSchemaInheritedFrom(e,n))}static async _getModuleName(e){var t;const r=null!==(t=Ne._getSectionModuleName(e))&&void 0!==t?t:Ne._getSectionEditPageModuleName(e);if(r)return r;if(await Ne._isSchemaInheritedFrom("BasePageV2",e))return"CardModuleV2";switch(!0){case await Ne._isSchemaInheritedFrom("BaseHomePage",e):return"HomePage";case await Ne._isSchemaInheritedFrom("BaseIntroPageSchema",e):return"IntroPage";default:return"PageSchemaViewModule"}}static _getTypedPage(e,t){var r,n;if(!t||t.length<=1)return;if(e.entityPageName){const r=t.find((t=>t.cardSchema===e.entityPageName));if(r)return r}let o=e.typeColumnValue;if(!o&&e.entityName){const t=Ne.getEntityStructure(e.entityName,e.uiTypePriority),a=null==t?void 0:t.attribute;if(a){const t=null===(r=e.defaultValues)||void 0===r?void 0:r.find((e=>e.attributeName===a));o=(null===(n=null==t?void 0:t.value)||void 0===n?void 0:n.value)||(null==t?void 0:t.value)}}return o?t.find((e=>e.UId===o)):void 0}static _getDefaultPages(e){return null==e?void 0:e.filter((e=>Ne._isDefaultPage(e)))}static _getNotTypedAddPage(e){return null==e?void 0:e.find((e=>{var t;return(null===(t=e.actions)||void 0===t?void 0:t.add)&&!e.UId}))}static _getNotTypedDefaultPage(e){return null==e?void 0:e.find((e=>Ne._isDefaultPage(e)&&!e.UId))}static _isDefaultPage(e){return e.isDefault||!e.actions}static _getDefaultPage(e){var t;const r=Ne.getEntityStructure(e.entityName,e.uiTypePriority),n=Ne._getDefaultPages(null==r?void 0:r.pages),o=Ne._getTypedPage(e,n)||Ne._getNotTypedDefaultPage(n);return o||(console.warn("Default page not found and random page is given instead. Please, check passed options."),null===(t=null==r?void 0:r.pages)||void 0===t?void 0:t[0])}static _getAddPage(e){var t;const r=null===(t=Ne.getEntityStructure(e.entityName,e.uiTypePriority))||void 0===t?void 0:t.pages,n=Ne.getPagesForAddAction(r);if(!((null==n?void 0:n.length)>1))return null==n?void 0:n[0];const o=Ne._getTypedPage(e,n);if(o)return o;const a=Ne._getNotTypedAddPage(r);if(a)return a;const i=Ne._getDefaultPages(r),u=Ne._getNotTypedDefaultPage(i);return u||(console.warn("Add or default page not found and random page is given instead. Please, check passed options."),null==r?void 0:r[0])}static _getEditPage(e){return Ne._getDefaultPage(e)}static _getAddOrDefaultPage(e){const t=e.find((e=>{var t;return null===(t=e.actions)||void 0===t?void 0:t.add}));if(!t){return null==e?void 0:e[0]}return t}static _getGroupedTypedPages(e){var t;const r={};for(const n of e){const{UId:e}=n;e&&(r[e]=null!==(t=r[e])&&void 0!==t?t:[],r[e].push(n))}return r}static _getModuleConfig(e){return Object.values(Terrasoft.configuration.ModuleStructure).find((t=>{var r;return t.cardSchema===e||t.sectionSchema===e||(null===(r=t.pages)||void 0===r?void 0:r.some((t=>t.cardSchema===e)))}))}static getPagesForAddAction(e){if(Me(e))return[];const t=Ne._getGroupedTypedPages(e),r=Object.values(t).map((e=>Ne._getAddOrDefaultPage(e)));if(Me(r)){const t=Ne._getAddOrDefaultPage(e);return t?[t]:[]}return r}static getCardSchemaName(e){var t;return null!==(t=null==e?void 0:e.cardSchema)&&void 0!==t?t:null==e?void 0:e.cardSchemaName}static getEntityStructure(e,t=xe.Auto){let r;return t===xe.PreferFreedomUI&&(r=Object.values(Terrasoft.configuration.EntityStructure).find((t=>t.page8X&&t.entitySchemaName===e))),null!=r?r:Terrasoft.ModuleUtils.getEntityStructureByName(e)}static getRecordLookupValue(e){return"string"==typeof e?e:null==e?void 0:e.value}static async getPageForActionAsync(e){const t={typeColumnValue:await Ne._getTypeColumnValue(e),...e};return Ne.getPageForAction(t)}static getPageForAction(t){let r;return r=t.action===e.ModelInPageAction.Add?Ne._getAddPage(t):Ne._getEditPage(t),r||(r=Ne._getDefaultPage(t)),r}static async getPageSchemaNameForAction(e){if(e.entityPageName)return e.entityPageName;const t=await Ne.getPageForActionAsync(e);return Ne.getCardSchemaName(t)}static async isAngularSchema(e){await Ne._getSchemaRequire(e);return(await Ne._getSchemaRequire(e+"Structure")).type===Ne._angularSchemaType}static generateChainModuleId(e){return Te.generateUnique(e+"_chain")}static getValuePairs(e){return e&&e.map((e=>{var t;let r,n;return(null===(t=e.value)||void 0===t?void 0:t.value)?(n=e.value.value,r=e.value.displayValue):n=e.value,{name:e.attributeName,value:n,displayValue:r}}))}static async getModuleName(t,r){if(!t&&!r)throw new e.ArgumentEmptyException("schemaName");return t?r||Ne._getModuleName(t):r}static getEditPageModuleName(e,t=xe.Auto){var r;return null===(r=Ne.getEntityStructure(e,t))||void 0===r?void 0:r.cardModuleName}static async hasEntityEditPage(e){const t=await Ne.getPageForActionAsync(e);return Boolean(t)}static isSectionEditPage(e){return Boolean(Ne._getSectionEditPageModuleName(e))}static async isAngularListPage(e){return await Ne.isAngularSchema(e)&&await Ne._isSchemaInheritedFrom("BaseGridSectionTemplate",e)}static isAngularRouting(e){return Ne._angularModules.includes(e)}static getSectionEntityName(e){var t;return null===(t=Ne._getModuleStructureBySectionSchema(e))||void 0===t?void 0:t.entitySchemaName}static getPageEntitySchemaName(e){const t=this._getModuleConfig(e);if(null==t?void 0:t.entitySchemaName)return t.entitySchemaName;const r=Object.values(Terrasoft.configuration.EntityStructure).find((t=>{var r;return null===(r=t.pages)||void 0===r?void 0:r.some((t=>t.cardSchema===e))}));return null==r?void 0:r.entitySchemaName}static getEntityPageStructure(e){var t;const r=Object.values(Terrasoft.configuration.EntityStructure).find((t=>t.pages.find((t=>t.cardSchema===e))));return null===(t=null==r?void 0:r.pages)||void 0===t?void 0:t.find((t=>t.cardSchema===e))}static isMiniPage(e){const t=Ne.getEntityPageStructure(e);if(t){const e="MiniPage"===t.schemaGroup;return Promise.resolve(e)}return Ne._isSchemaInheritedFrom("BaseMiniPageTemplate",e)}static getSysModuleId(e){const t=Ne._getModuleConfig(e)||Object.values(Terrasoft.configuration.ModuleStructure).find((t=>t.sectionModule===e));return null==t?void 0:t.moduleId}}Ne._angularSchemaType=9,Ne._angularModules=["PageSchemaViewModule","CardSchemaViewModule","HomePage","Desktop","SectionSchemaViewModule"]})(),o})()));